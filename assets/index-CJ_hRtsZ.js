(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function EA(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var eT={exports:{}},G0={};var kR;function TN(){if(kR)return G0;kR=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,s){var a=null;if(s!==void 0&&(a=""+s),i.key!==void 0&&(a=""+i.key),"key"in i){s={};for(var o in i)o!=="key"&&(s[o]=i[o])}else s=i;return i=s.ref,{$$typeof:r,type:n,key:a,ref:i!==void 0?i:null,props:s}}return G0.Fragment=e,G0.jsx=t,G0.jsxs=t,G0}var GR;function bN(){return GR||(GR=1,eT.exports=TN()),eT.exports}var ye=bN(),tT={exports:{}},sn={};var HR;function MN(){if(HR)return sn;HR=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),v=Symbol.iterator;function y(Y){return Y===null||typeof Y!="object"?null:(Y=v&&Y[v]||Y["@@iterator"],typeof Y=="function"?Y:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,E={};function T(Y,Z,le){this.props=Y,this.context=Z,this.refs=E,this.updater=le||_}T.prototype.isReactComponent={},T.prototype.setState=function(Y,Z){if(typeof Y!="object"&&typeof Y!="function"&&Y!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Y,Z,"setState")},T.prototype.forceUpdate=function(Y){this.updater.enqueueForceUpdate(this,Y,"forceUpdate")};function M(){}M.prototype=T.prototype;function R(Y,Z,le){this.props=Y,this.context=Z,this.refs=E,this.updater=le||_}var L=R.prototype=new M;L.constructor=R,A(L,T.prototype),L.isPureReactComponent=!0;var w=Array.isArray;function N(){}var O={H:null,A:null,T:null,S:null},F=Object.prototype.hasOwnProperty;function B(Y,Z,le){var pe=le.ref;return{$$typeof:r,type:Y,key:Z,ref:pe!==void 0?pe:null,props:le}}function P(Y,Z){return B(Y.type,Z,Y.props)}function V(Y){return typeof Y=="object"&&Y!==null&&Y.$$typeof===r}function J(Y){var Z={"=":"=0",":":"=2"};return"$"+Y.replace(/[=:]/g,function(le){return Z[le]})}var Q=/\/+/g;function ie(Y,Z){return typeof Y=="object"&&Y!==null&&Y.key!=null?J(""+Y.key):Z.toString(36)}function ne(Y){switch(Y.status){case"fulfilled":return Y.value;case"rejected":throw Y.reason;default:switch(typeof Y.status=="string"?Y.then(N,N):(Y.status="pending",Y.then(function(Z){Y.status==="pending"&&(Y.status="fulfilled",Y.value=Z)},function(Z){Y.status==="pending"&&(Y.status="rejected",Y.reason=Z)})),Y.status){case"fulfilled":return Y.value;case"rejected":throw Y.reason}}throw Y}function k(Y,Z,le,pe,Te){var ce=typeof Y;(ce==="undefined"||ce==="boolean")&&(Y=null);var Me=!1;if(Y===null)Me=!0;else switch(ce){case"bigint":case"string":case"number":Me=!0;break;case"object":switch(Y.$$typeof){case r:case e:Me=!0;break;case h:return Me=Y._init,k(Me(Y._payload),Z,le,pe,Te)}}if(Me)return Te=Te(Y),Me=pe===""?"."+ie(Y,0):pe,w(Te)?(le="",Me!=null&&(le=Me.replace(Q,"$&/")+"/"),k(Te,Z,le,"",function(at){return at})):Te!=null&&(V(Te)&&(Te=P(Te,le+(Te.key==null||Y&&Y.key===Te.key?"":(""+Te.key).replace(Q,"$&/")+"/")+Me)),Z.push(Te)),1;Me=0;var Xe=pe===""?".":pe+":";if(w(Y))for(var nt=0;nt<Y.length;nt++)pe=Y[nt],ce=Xe+ie(pe,nt),Me+=k(pe,Z,le,ce,Te);else if(nt=y(Y),typeof nt=="function")for(Y=nt.call(Y),nt=0;!(pe=Y.next()).done;)pe=pe.value,ce=Xe+ie(pe,nt++),Me+=k(pe,Z,le,ce,Te);else if(ce==="object"){if(typeof Y.then=="function")return k(ne(Y),Z,le,pe,Te);throw Z=String(Y),Error("Objects are not valid as a React child (found: "+(Z==="[object Object]"?"object with keys {"+Object.keys(Y).join(", ")+"}":Z)+"). If you meant to render a collection of children, use an array instead.")}return Me}function K(Y,Z,le){if(Y==null)return Y;var pe=[],Te=0;return k(Y,pe,"","",function(ce){return Z.call(le,ce,Te++)}),pe}function j(Y){if(Y._status===-1){var Z=Y._result;Z=Z(),Z.then(function(le){(Y._status===0||Y._status===-1)&&(Y._status=1,Y._result=le)},function(le){(Y._status===0||Y._status===-1)&&(Y._status=2,Y._result=le)}),Y._status===-1&&(Y._status=0,Y._result=Z)}if(Y._status===1)return Y._result.default;throw Y._result}var se=typeof reportError=="function"?reportError:function(Y){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Y=="object"&&Y!==null&&typeof Y.message=="string"?String(Y.message):String(Y),error:Y});if(!window.dispatchEvent(Z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Y);return}console.error(Y)},oe={map:K,forEach:function(Y,Z,le){K(Y,function(){Z.apply(this,arguments)},le)},count:function(Y){var Z=0;return K(Y,function(){Z++}),Z},toArray:function(Y){return K(Y,function(Z){return Z})||[]},only:function(Y){if(!V(Y))throw Error("React.Children.only expected to receive a single React element child.");return Y}};return sn.Activity=p,sn.Children=oe,sn.Component=T,sn.Fragment=t,sn.Profiler=i,sn.PureComponent=R,sn.StrictMode=n,sn.Suspense=u,sn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,sn.__COMPILER_RUNTIME={__proto__:null,c:function(Y){return O.H.useMemoCache(Y)}},sn.cache=function(Y){return function(){return Y.apply(null,arguments)}},sn.cacheSignal=function(){return null},sn.cloneElement=function(Y,Z,le){if(Y==null)throw Error("The argument must be a React element, but you passed "+Y+".");var pe=A({},Y.props),Te=Y.key;if(Z!=null)for(ce in Z.key!==void 0&&(Te=""+Z.key),Z)!F.call(Z,ce)||ce==="key"||ce==="__self"||ce==="__source"||ce==="ref"&&Z.ref===void 0||(pe[ce]=Z[ce]);var ce=arguments.length-2;if(ce===1)pe.children=le;else if(1<ce){for(var Me=Array(ce),Xe=0;Xe<ce;Xe++)Me[Xe]=arguments[Xe+2];pe.children=Me}return B(Y.type,Te,pe)},sn.createContext=function(Y){return Y={$$typeof:a,_currentValue:Y,_currentValue2:Y,_threadCount:0,Provider:null,Consumer:null},Y.Provider=Y,Y.Consumer={$$typeof:s,_context:Y},Y},sn.createElement=function(Y,Z,le){var pe,Te={},ce=null;if(Z!=null)for(pe in Z.key!==void 0&&(ce=""+Z.key),Z)F.call(Z,pe)&&pe!=="key"&&pe!=="__self"&&pe!=="__source"&&(Te[pe]=Z[pe]);var Me=arguments.length-2;if(Me===1)Te.children=le;else if(1<Me){for(var Xe=Array(Me),nt=0;nt<Me;nt++)Xe[nt]=arguments[nt+2];Te.children=Xe}if(Y&&Y.defaultProps)for(pe in Me=Y.defaultProps,Me)Te[pe]===void 0&&(Te[pe]=Me[pe]);return B(Y,ce,Te)},sn.createRef=function(){return{current:null}},sn.forwardRef=function(Y){return{$$typeof:o,render:Y}},sn.isValidElement=V,sn.lazy=function(Y){return{$$typeof:h,_payload:{_status:-1,_result:Y},_init:j}},sn.memo=function(Y,Z){return{$$typeof:c,type:Y,compare:Z===void 0?null:Z}},sn.startTransition=function(Y){var Z=O.T,le={};O.T=le;try{var pe=Y(),Te=O.S;Te!==null&&Te(le,pe),typeof pe=="object"&&pe!==null&&typeof pe.then=="function"&&pe.then(N,se)}catch(ce){se(ce)}finally{Z!==null&&le.types!==null&&(Z.types=le.types),O.T=Z}},sn.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},sn.use=function(Y){return O.H.use(Y)},sn.useActionState=function(Y,Z,le){return O.H.useActionState(Y,Z,le)},sn.useCallback=function(Y,Z){return O.H.useCallback(Y,Z)},sn.useContext=function(Y){return O.H.useContext(Y)},sn.useDebugValue=function(){},sn.useDeferredValue=function(Y,Z){return O.H.useDeferredValue(Y,Z)},sn.useEffect=function(Y,Z){return O.H.useEffect(Y,Z)},sn.useEffectEvent=function(Y){return O.H.useEffectEvent(Y)},sn.useId=function(){return O.H.useId()},sn.useImperativeHandle=function(Y,Z,le){return O.H.useImperativeHandle(Y,Z,le)},sn.useInsertionEffect=function(Y,Z){return O.H.useInsertionEffect(Y,Z)},sn.useLayoutEffect=function(Y,Z){return O.H.useLayoutEffect(Y,Z)},sn.useMemo=function(Y,Z){return O.H.useMemo(Y,Z)},sn.useOptimistic=function(Y,Z){return O.H.useOptimistic(Y,Z)},sn.useReducer=function(Y,Z,le){return O.H.useReducer(Y,Z,le)},sn.useRef=function(Y){return O.H.useRef(Y)},sn.useState=function(Y){return O.H.useState(Y)},sn.useSyncExternalStore=function(Y,Z,le){return O.H.useSyncExternalStore(Y,Z,le)},sn.useTransition=function(){return O.H.useTransition()},sn.version="19.2.3",sn}var zR;function ag(){return zR||(zR=1,tT.exports=MN()),tT.exports}var Ue=ag();const Ow=EA(Ue);var nT={exports:{}},H0={},iT={exports:{}},sT={};var VR;function CN(){return VR||(VR=1,(function(r){function e(k,K){var j=k.length;k.push(K);e:for(;0<j;){var se=j-1>>>1,oe=k[se];if(0<i(oe,K))k[se]=K,k[j]=oe,j=se;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var K=k[0],j=k.pop();if(j!==K){k[0]=j;e:for(var se=0,oe=k.length,Y=oe>>>1;se<Y;){var Z=2*(se+1)-1,le=k[Z],pe=Z+1,Te=k[pe];if(0>i(le,j))pe<oe&&0>i(Te,le)?(k[se]=Te,k[pe]=j,se=pe):(k[se]=le,k[Z]=j,se=Z);else if(pe<oe&&0>i(Te,j))k[se]=Te,k[pe]=j,se=pe;else break e}}return K}function i(k,K){var j=k.sortIndex-K.sortIndex;return j!==0?j:k.id-K.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();r.unstable_now=function(){return a.now()-o}}var u=[],c=[],h=1,p=null,v=3,y=!1,_=!1,A=!1,E=!1,T=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function L(k){for(var K=t(c);K!==null;){if(K.callback===null)n(c);else if(K.startTime<=k)n(c),K.sortIndex=K.expirationTime,e(u,K);else break;K=t(c)}}function w(k){if(A=!1,L(k),!_)if(t(u)!==null)_=!0,N||(N=!0,J());else{var K=t(c);K!==null&&ne(w,K.startTime-k)}}var N=!1,O=-1,F=5,B=-1;function P(){return E?!0:!(r.unstable_now()-B<F)}function V(){if(E=!1,N){var k=r.unstable_now();B=k;var K=!0;try{e:{_=!1,A&&(A=!1,M(O),O=-1),y=!0;var j=v;try{t:{for(L(k),p=t(u);p!==null&&!(p.expirationTime>k&&P());){var se=p.callback;if(typeof se=="function"){p.callback=null,v=p.priorityLevel;var oe=se(p.expirationTime<=k);if(k=r.unstable_now(),typeof oe=="function"){p.callback=oe,L(k),K=!0;break t}p===t(u)&&n(u),L(k)}else n(u);p=t(u)}if(p!==null)K=!0;else{var Y=t(c);Y!==null&&ne(w,Y.startTime-k),K=!1}}break e}finally{p=null,v=j,y=!1}K=void 0}}finally{K?J():N=!1}}}var J;if(typeof R=="function")J=function(){R(V)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,ie=Q.port2;Q.port1.onmessage=V,J=function(){ie.postMessage(null)}}else J=function(){T(V,0)};function ne(k,K){O=T(function(){k(r.unstable_now())},K)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(k){k.callback=null},r.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<k?Math.floor(1e3/k):5},r.unstable_getCurrentPriorityLevel=function(){return v},r.unstable_next=function(k){switch(v){case 1:case 2:case 3:var K=3;break;default:K=v}var j=v;v=K;try{return k()}finally{v=j}},r.unstable_requestPaint=function(){E=!0},r.unstable_runWithPriority=function(k,K){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var j=v;v=k;try{return K()}finally{v=j}},r.unstable_scheduleCallback=function(k,K,j){var se=r.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?se+j:se):j=se,k){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=j+oe,k={id:h++,callback:K,priorityLevel:k,startTime:j,expirationTime:oe,sortIndex:-1},j>se?(k.sortIndex=j,e(c,k),t(u)===null&&k===t(c)&&(A?(M(O),O=-1):A=!0,ne(w,j-se))):(k.sortIndex=oe,e(u,k),_||y||(_=!0,N||(N=!0,J()))),k},r.unstable_shouldYield=P,r.unstable_wrapCallback=function(k){var K=v;return function(){var j=v;v=K;try{return k.apply(this,arguments)}finally{v=j}}}})(sT)),sT}var KR;function RN(){return KR||(KR=1,iT.exports=CN()),iT.exports}var rT={exports:{}},mr={};var YR;function DN(){if(YR)return mr;YR=1;var r=ag();function e(u){var c="https://react.dev/errors/"+u;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)c+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+u+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(u,c,h){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:p==null?null:""+p,children:u,containerInfo:c,implementation:h}}var a=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(u,c){if(u==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return mr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,mr.createPortal=function(u,c){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(e(299));return s(u,c,null,h)},mr.flushSync=function(u){var c=a.T,h=n.p;try{if(a.T=null,n.p=2,u)return u()}finally{a.T=c,n.p=h,n.d.f()}},mr.preconnect=function(u,c){typeof u=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,n.d.C(u,c))},mr.prefetchDNS=function(u){typeof u=="string"&&n.d.D(u)},mr.preinit=function(u,c){if(typeof u=="string"&&c&&typeof c.as=="string"){var h=c.as,p=o(h,c.crossOrigin),v=typeof c.integrity=="string"?c.integrity:void 0,y=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;h==="style"?n.d.S(u,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:p,integrity:v,fetchPriority:y}):h==="script"&&n.d.X(u,{crossOrigin:p,integrity:v,fetchPriority:y,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},mr.preinitModule=function(u,c){if(typeof u=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var h=o(c.as,c.crossOrigin);n.d.M(u,{crossOrigin:h,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&n.d.M(u)},mr.preload=function(u,c){if(typeof u=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var h=c.as,p=o(h,c.crossOrigin);n.d.L(u,h,{crossOrigin:p,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},mr.preloadModule=function(u,c){if(typeof u=="string")if(c){var h=o(c.as,c.crossOrigin);n.d.m(u,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:h,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else n.d.m(u)},mr.requestFormReset=function(u){n.d.r(u)},mr.unstable_batchedUpdates=function(u,c){return u(c)},mr.useFormState=function(u,c,h){return a.H.useFormState(u,c,h)},mr.useFormStatus=function(){return a.H.useHostTransitionStatus()},mr.version="19.2.3",mr}var XR;function LN(){if(XR)return rT.exports;XR=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),rT.exports=DN(),rT.exports}var qR;function IN(){if(qR)return H0;qR=1;var r=RN(),e=ag(),t=LN();function n(l){var f="https://react.dev/errors/"+l;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)f+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+l+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function s(l){var f=l,g=l;if(l.alternate)for(;f.return;)f=f.return;else{l=f;do f=l,(f.flags&4098)!==0&&(g=f.return),l=f.return;while(l)}return f.tag===3?g:null}function a(l){if(l.tag===13){var f=l.memoizedState;if(f===null&&(l=l.alternate,l!==null&&(f=l.memoizedState)),f!==null)return f.dehydrated}return null}function o(l){if(l.tag===31){var f=l.memoizedState;if(f===null&&(l=l.alternate,l!==null&&(f=l.memoizedState)),f!==null)return f.dehydrated}return null}function u(l){if(s(l)!==l)throw Error(n(188))}function c(l){var f=l.alternate;if(!f){if(f=s(l),f===null)throw Error(n(188));return f!==l?null:l}for(var g=l,x=f;;){var b=g.return;if(b===null)break;var D=b.alternate;if(D===null){if(x=b.return,x!==null){g=x;continue}break}if(b.child===D.child){for(D=b.child;D;){if(D===g)return u(b),l;if(D===x)return u(b),f;D=D.sibling}throw Error(n(188))}if(g.return!==x.return)g=b,x=D;else{for(var G=!1,q=b.child;q;){if(q===g){G=!0,g=b,x=D;break}if(q===x){G=!0,x=b,g=D;break}q=q.sibling}if(!G){for(q=D.child;q;){if(q===g){G=!0,g=D,x=b;break}if(q===x){G=!0,x=D,g=b;break}q=q.sibling}if(!G)throw Error(n(189))}}if(g.alternate!==x)throw Error(n(190))}if(g.tag!==3)throw Error(n(188));return g.stateNode.current===g?l:f}function h(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l;for(l=l.child;l!==null;){if(f=h(l),f!==null)return f;l=l.sibling}return null}var p=Object.assign,v=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),R=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),V=Symbol.iterator;function J(l){return l===null||typeof l!="object"?null:(l=V&&l[V]||l["@@iterator"],typeof l=="function"?l:null)}var Q=Symbol.for("react.client.reference");function ie(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===Q?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case A:return"Fragment";case T:return"Profiler";case E:return"StrictMode";case w:return"Suspense";case N:return"SuspenseList";case B:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case _:return"Portal";case R:return l.displayName||"Context";case M:return(l._context.displayName||"Context")+".Consumer";case L:var f=l.render;return l=l.displayName,l||(l=f.displayName||f.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case O:return f=l.displayName||null,f!==null?f:ie(l.type)||"Memo";case F:f=l._payload,l=l._init;try{return ie(l(f))}catch{}}return null}var ne=Array.isArray,k=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j={pending:!1,data:null,method:null,action:null},se=[],oe=-1;function Y(l){return{current:l}}function Z(l){0>oe||(l.current=se[oe],se[oe]=null,oe--)}function le(l,f){oe++,se[oe]=l.current,l.current=f}var pe=Y(null),Te=Y(null),ce=Y(null),Me=Y(null);function Xe(l,f){switch(le(ce,f),le(Te,l),le(pe,null),f.nodeType){case 9:case 11:l=(l=f.documentElement)&&(l=l.namespaceURI)?lR(l):0;break;default:if(l=f.tagName,f=f.namespaceURI)f=lR(f),l=uR(f,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}Z(pe),le(pe,l)}function nt(){Z(pe),Z(Te),Z(ce)}function at(l){l.memoizedState!==null&&le(Me,l);var f=pe.current,g=uR(f,l.type);f!==g&&(le(Te,l),le(pe,g))}function Vt(l){Te.current===l&&(Z(pe),Z(Te)),Me.current===l&&(Z(Me),N0._currentValue=j)}var dn,Ut;function Ne(l){if(dn===void 0)try{throw Error()}catch(g){var f=g.stack.trim().match(/\n( *(at )?)/);dn=f&&f[1]||"",Ut=-1<g.stack.indexOf(`
    at`)?" (<anonymous>)":-1<g.stack.indexOf("@")?"@unknown:0:0":""}return`
`+dn+l+Ut}var We=!1;function Ie(l,f){if(!l||We)return"";We=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var x={DetermineComponentFrameRoot:function(){try{if(f){var Ke=function(){throw Error()};if(Object.defineProperty(Ke.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ke,[])}catch(Be){var Re=Be}Reflect.construct(l,[],Ke)}else{try{Ke.call()}catch(Be){Re=Be}l.call(Ke.prototype)}}else{try{throw Error()}catch(Be){Re=Be}(Ke=l())&&typeof Ke.catch=="function"&&Ke.catch(function(){})}}catch(Be){if(Be&&Re&&typeof Be.stack=="string")return[Be.stack,Re.stack]}return[null,null]}};x.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(x.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(x.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var D=x.DetermineComponentFrameRoot(),G=D[0],q=D[1];if(G&&q){var ae=G.split(`
`),Ee=q.split(`
`);for(b=x=0;x<ae.length&&!ae[x].includes("DetermineComponentFrameRoot");)x++;for(;b<Ee.length&&!Ee[b].includes("DetermineComponentFrameRoot");)b++;if(x===ae.length||b===Ee.length)for(x=ae.length-1,b=Ee.length-1;1<=x&&0<=b&&ae[x]!==Ee[b];)b--;for(;1<=x&&0<=b;x--,b--)if(ae[x]!==Ee[b]){if(x!==1||b!==1)do if(x--,b--,0>b||ae[x]!==Ee[b]){var Pe=`
`+ae[x].replace(" at new "," at ");return l.displayName&&Pe.includes("<anonymous>")&&(Pe=Pe.replace("<anonymous>",l.displayName)),Pe}while(1<=x&&0<=b);break}}}finally{We=!1,Error.prepareStackTrace=g}return(g=l?l.displayName||l.name:"")?Ne(g):""}function je(l,f){switch(l.tag){case 26:case 27:case 5:return Ne(l.type);case 16:return Ne("Lazy");case 13:return l.child!==f&&f!==null?Ne("Suspense Fallback"):Ne("Suspense");case 19:return Ne("SuspenseList");case 0:case 15:return Ie(l.type,!1);case 11:return Ie(l.type.render,!1);case 1:return Ie(l.type,!0);case 31:return Ne("Activity");default:return""}}function te(l){try{var f="",g=null;do f+=je(l,g),g=l,l=l.return;while(l);return f}catch(x){return`
Error generating stack: `+x.message+`
`+x.stack}}var St=Object.prototype.hasOwnProperty,$e=r.unstable_scheduleCallback,At=r.unstable_cancelCallback,et=r.unstable_shouldYield,$=r.unstable_requestPaint,z=r.unstable_now,fe=r.unstable_getCurrentPriorityLevel,we=r.unstable_ImmediatePriority,He=r.unstable_UserBlockingPriority,Oe=r.unstable_NormalPriority,Et=r.unstable_LowPriority,it=r.unstable_IdlePriority,vt=r.log,Ft=r.unstable_setDisableYieldValue,Ye=null,Je=null;function ft(l){if(typeof vt=="function"&&Ft(l),Je&&typeof Je.setStrictMode=="function")try{Je.setStrictMode(Ye,l)}catch{}}var ht=Math.clz32?Math.clz32:he,rt=Math.log,Qt=Math.LN2;function he(l){return l>>>=0,l===0?32:31-(rt(l)/Qt|0)|0}var lt=256,Ze=262144,pt=4194304;function qe(l){var f=l&42;if(f!==0)return f;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return l&261888;case 262144:case 524288:case 1048576:case 2097152:return l&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function ze(l,f,g){var x=l.pendingLanes;if(x===0)return 0;var b=0,D=l.suspendedLanes,G=l.pingedLanes;l=l.warmLanes;var q=x&134217727;return q!==0?(x=q&~D,x!==0?b=qe(x):(G&=q,G!==0?b=qe(G):g||(g=q&~l,g!==0&&(b=qe(g))))):(q=x&~D,q!==0?b=qe(q):G!==0?b=qe(G):g||(g=x&~l,g!==0&&(b=qe(g)))),b===0?0:f!==0&&f!==b&&(f&D)===0&&(D=b&-b,g=f&-f,D>=g||D===32&&(g&4194048)!==0)?f:b}function st(l,f){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&f)===0}function Yt(l,f){switch(l){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Cn(){var l=pt;return pt<<=1,(pt&62914560)===0&&(pt=4194304),l}function gn(l){for(var f=[],g=0;31>g;g++)f.push(l);return f}function vs(l,f){l.pendingLanes|=f,f!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function na(l,f,g,x,b,D){var G=l.pendingLanes;l.pendingLanes=g,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=g,l.entangledLanes&=g,l.errorRecoveryDisabledLanes&=g,l.shellSuspendCounter=0;var q=l.entanglements,ae=l.expirationTimes,Ee=l.hiddenUpdates;for(g=G&~g;0<g;){var Pe=31-ht(g),Ke=1<<Pe;q[Pe]=0,ae[Pe]=-1;var Re=Ee[Pe];if(Re!==null)for(Ee[Pe]=null,Pe=0;Pe<Re.length;Pe++){var Be=Re[Pe];Be!==null&&(Be.lane&=-536870913)}g&=~Ke}x!==0&&jf(l,x,0),D!==0&&b===0&&l.tag!==0&&(l.suspendedLanes|=D&~(G&~f))}function jf(l,f,g){l.pendingLanes|=f,l.suspendedLanes&=~f;var x=31-ht(f);l.entangledLanes|=f,l.entanglements[x]=l.entanglements[x]|1073741824|g&261930}function xu(l,f){var g=l.entangledLanes|=f;for(l=l.entanglements;g;){var x=31-ht(g),b=1<<x;b&f|l[x]&f&&(l[x]|=f),g&=~b}}function Al(l,f){var g=f&-f;return g=(g&42)!==0?1:ia(g),(g&(l.suspendedLanes|f))!==0?0:g}function ia(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function Su(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function sa(){var l=K.p;return l!==0?l:(l=window.event,l===void 0?32:wR(l.type))}function as(l,f){var g=K.p;try{return K.p=l,f()}finally{K.p=g}}var Ys=Math.random().toString(36).slice(2),ln="__reactFiber$"+Ys,Zi="__reactProps$"+Ys,Rr="__reactContainer$"+Ys,Au="__reactEvents$"+Ys,Eu="__reactListeners$"+Ys,Hd="__reactHandles$"+Ys,Tu="__reactResources$"+Ys,Go="__reactMarker$"+Ys;function bu(l){delete l[ln],delete l[Zi],delete l[Au],delete l[Eu],delete l[Hd]}function wi(l){var f=l[ln];if(f)return f;for(var g=l.parentNode;g;){if(f=g[Rr]||g[ln]){if(g=f.alternate,f.child!==null||g!==null&&g.child!==null)for(l=gR(l);l!==null;){if(g=l[ln])return g;l=gR(l)}return f}l=g,g=l.parentNode}return null}function $n(l){if(l=l[ln]||l[Rr]){var f=l.tag;if(f===5||f===6||f===13||f===31||f===26||f===27||f===3)return l}return null}function Ma(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l.stateNode;throw Error(n(33))}function Ca(l){var f=l[Tu];return f||(f=l[Tu]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function X(l){l[Go]=!0}var de=new Set,De={};function be(l,f){_e(l,f),_e(l+"Capture",f)}function _e(l,f){for(De[l]=f,l=0;l<f.length;l++)de.add(f[l])}var ot=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),xt={},ut={};function bt(l){return St.call(ut,l)?!0:St.call(xt,l)?!1:ot.test(l)?ut[l]=!0:(xt[l]=!0,!1)}function Rt(l,f,g){if(bt(f))if(g===null)l.removeAttribute(f);else{switch(typeof g){case"undefined":case"function":case"symbol":l.removeAttribute(f);return;case"boolean":var x=f.toLowerCase().slice(0,5);if(x!=="data-"&&x!=="aria-"){l.removeAttribute(f);return}}l.setAttribute(f,""+g)}}function kt(l,f,g){if(g===null)l.removeAttribute(f);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(f);return}l.setAttribute(f,""+g)}}function Mt(l,f,g,x){if(x===null)l.removeAttribute(g);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(g);return}l.setAttributeNS(f,g,""+x)}}function Ht(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function Un(l){var f=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function ui(l,f,g){var x=Object.getOwnPropertyDescriptor(l.constructor.prototype,f);if(!l.hasOwnProperty(f)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var b=x.get,D=x.set;return Object.defineProperty(l,f,{configurable:!0,get:function(){return b.call(this)},set:function(G){g=""+G,D.call(this,G)}}),Object.defineProperty(l,f,{enumerable:x.enumerable}),{getValue:function(){return g},setValue:function(G){g=""+G},stopTracking:function(){l._valueTracker=null,delete l[f]}}}}function Zn(l){if(!l._valueTracker){var f=Un(l)?"checked":"value";l._valueTracker=ui(l,f,""+l[f])}}function Fn(l){if(!l)return!1;var f=l._valueTracker;if(!f)return!0;var g=f.getValue(),x="";return l&&(x=Un(l)?l.checked?"true":"false":l.value),l=x,l!==g?(f.setValue(l),!0):!1}function It(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var Pn=/[\n"\\]/g;function Jt(l){return l.replace(Pn,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function os(l,f,g,x,b,D,G,q){l.name="",G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"?l.type=G:l.removeAttribute("type"),f!=null?G==="number"?(f===0&&l.value===""||l.value!=f)&&(l.value=""+Ht(f)):l.value!==""+Ht(f)&&(l.value=""+Ht(f)):G!=="submit"&&G!=="reset"||l.removeAttribute("value"),f!=null?ls(l,G,Ht(f)):g!=null?ls(l,G,Ht(g)):x!=null&&l.removeAttribute("value"),b==null&&D!=null&&(l.defaultChecked=!!D),b!=null&&(l.checked=b&&typeof b!="function"&&typeof b!="symbol"),q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?l.name=""+Ht(q):l.removeAttribute("name")}function ro(l,f,g,x,b,D,G,q){if(D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(l.type=D),f!=null||g!=null){if(!(D!=="submit"&&D!=="reset"||f!=null)){Zn(l);return}g=g!=null?""+Ht(g):"",f=f!=null?""+Ht(f):g,q||f===l.value||(l.value=f),l.defaultValue=f}x=x??b,x=typeof x!="function"&&typeof x!="symbol"&&!!x,l.checked=q?l.checked:!!x,l.defaultChecked=!!x,G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"&&(l.name=G),Zn(l)}function ls(l,f,g){f==="number"&&It(l.ownerDocument)===l||l.defaultValue===""+g||(l.defaultValue=""+g)}function ra(l,f,g,x){if(l=l.options,f){f={};for(var b=0;b<g.length;b++)f["$"+g[b]]=!0;for(g=0;g<l.length;g++)b=f.hasOwnProperty("$"+l[g].value),l[g].selected!==b&&(l[g].selected=b),b&&x&&(l[g].defaultSelected=!0)}else{for(g=""+Ht(g),f=null,b=0;b<l.length;b++){if(l[b].value===g){l[b].selected=!0,x&&(l[b].defaultSelected=!0);return}f!==null||l[b].disabled||(f=l[b])}f!==null&&(f.selected=!0)}}function Hn(l,f,g){if(f!=null&&(f=""+Ht(f),f!==l.value&&(l.value=f),g==null)){l.defaultValue!==f&&(l.defaultValue=f);return}l.defaultValue=g!=null?""+Ht(g):""}function Si(l,f,g,x){if(f==null){if(x!=null){if(g!=null)throw Error(n(92));if(ne(x)){if(1<x.length)throw Error(n(93));x=x[0]}g=x}g==null&&(g=""),f=g}g=Ht(f),l.defaultValue=g,x=l.textContent,x===g&&x!==""&&x!==null&&(l.value=x),Zn(l)}function zi(l,f){if(f){var g=l.firstChild;if(g&&g===l.lastChild&&g.nodeType===3){g.nodeValue=f;return}}l.textContent=f}var Vi=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ki(l,f,g){var x=f.indexOf("--")===0;g==null||typeof g=="boolean"||g===""?x?l.setProperty(f,""):f==="float"?l.cssFloat="":l[f]="":x?l.setProperty(f,g):typeof g!="number"||g===0||Vi.has(f)?f==="float"?l.cssFloat=g:l[f]=(""+g).trim():l[f]=g+"px"}function Mu(l,f,g){if(f!=null&&typeof f!="object")throw Error(n(62));if(l=l.style,g!=null){for(var x in g)!g.hasOwnProperty(x)||f!=null&&f.hasOwnProperty(x)||(x.indexOf("--")===0?l.setProperty(x,""):x==="float"?l.cssFloat="":l[x]="");for(var b in f)x=f[b],f.hasOwnProperty(b)&&g[b]!==x&&Ki(l,b,x)}else for(var D in f)f.hasOwnProperty(D)&&Ki(l,D,f[D])}function Dr(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var py=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),my=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Jf(l){return my.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}function ao(){}var Qf=null;function zd(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var Cu=null,El=null;function vg(l){var f=$n(l);if(f&&(l=f.stateNode)){var g=l[Zi]||null;e:switch(l=f.stateNode,f.type){case"input":if(os(l,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name),f=g.name,g.type==="radio"&&f!=null){for(g=l;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll('input[name="'+Jt(""+f)+'"][type="radio"]'),f=0;f<g.length;f++){var x=g[f];if(x!==l&&x.form===l.form){var b=x[Zi]||null;if(!b)throw Error(n(90));os(x,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(f=0;f<g.length;f++)x=g[f],x.form===l.form&&Fn(x)}break e;case"textarea":Hn(l,g.value,g.defaultValue);break e;case"select":f=g.value,f!=null&&ra(l,!!g.multiple,f,!1)}}}var Vd=!1;function yg(l,f,g){if(Vd)return l(f,g);Vd=!0;try{var x=l(f);return x}finally{if(Vd=!1,(Cu!==null||El!==null)&&(W(),Cu&&(f=Cu,l=El,El=Cu=null,vg(f),l)))for(f=0;f<l.length;f++)vg(l[f])}}function Ru(l,f){var g=l.stateNode;if(g===null)return null;var x=g[Zi]||null;if(x===null)return null;g=x[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(l=l.type,x=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!x;break e;default:l=!1}if(l)return null;if(g&&typeof g!="function")throw Error(n(231,f,typeof g));return g}var oo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Kd=!1;if(oo)try{var $f={};Object.defineProperty($f,"passive",{get:function(){Kd=!0}}),window.addEventListener("test",$f,$f),window.removeEventListener("test",$f,$f)}catch{Kd=!1}var Tl=null,Yd=null,bl=null;function Xd(){if(bl)return bl;var l,f=Yd,g=f.length,x,b="value"in Tl?Tl.value:Tl.textContent,D=b.length;for(l=0;l<g&&f[l]===b[l];l++);var G=g-l;for(x=1;x<=G&&f[g-x]===b[D-x];x++);return bl=b.slice(l,1<x?1-x:void 0)}function Du(l){var f=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&f===13&&(l=13)):l=f,l===10&&(l=13),32<=l||l===13?l:0}function Zf(){return!0}function _g(){return!1}function Is(l){function f(g,x,b,D,G){this._reactName=g,this._targetInst=b,this.type=x,this.nativeEvent=D,this.target=G,this.currentTarget=null;for(var q in l)l.hasOwnProperty(q)&&(g=l[q],this[q]=g?g(D):D[q]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?Zf:_g,this.isPropagationStopped=_g,this}return p(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=Zf)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=Zf)},persist:function(){},isPersistent:Zf}),f}var Ml={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},eh=Is(Ml),Ra=p({},Ml,{view:0,detail:0}),qd=Is(Ra),Wd,th,Cc,nh=p({},Ra,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:sh,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==Cc&&(Cc&&l.type==="mousemove"?(Wd=l.screenX-Cc.screenX,th=l.screenY-Cc.screenY):th=Wd=0,Cc=l),Wd)},movementY:function(l){return"movementY"in l?l.movementY:th}}),gy=Is(nh),ys=p({},nh,{dataTransfer:0}),vy=Is(ys),yy=p({},Ra,{relatedTarget:0}),jd=Is(yy),_y=p({},Ml,{animationName:0,elapsedTime:0,pseudoElement:0}),xy=Is(_y),ih=p({},Ml,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),xg=Is(ih),Sy=p({},Ml,{data:0}),Sg=Is(Sy),Ay={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ag={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Eg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ey(l){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(l):(l=Eg[l])?!!f[l]:!1}function sh(){return Ey}var Tg=p({},Ra,{key:function(l){if(l.key){var f=Ay[l.key]||l.key;if(f!=="Unidentified")return f}return l.type==="keypress"?(l=Du(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?Ag[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:sh,charCode:function(l){return l.type==="keypress"?Du(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?Du(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),bg=Is(Tg),Ty=p({},nh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Jd=Is(Ty),by=p({},Ra,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:sh}),Ho=Is(by),Mg=p({},Ml,{propertyName:0,elapsedTime:0,pseudoElement:0}),_E=Is(Mg),My=p({},nh,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),Cl=Is(My),zo=p({},Ml,{newState:0,oldState:0}),Cg=Is(zo),Rg=[9,13,27,32],Lu=oo&&"CompositionEvent"in window,Rl=null;oo&&"documentMode"in document&&(Rl=document.documentMode);var Iu=oo&&"TextEvent"in window&&!Rl,_s=oo&&(!Lu||Rl&&8<Rl&&11>=Rl),rh=" ",Dg=!1;function Qd(l,f){switch(l){case"keyup":return Rg.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Rc(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Dl=!1;function $d(l,f){switch(l){case"compositionend":return Rc(f);case"keypress":return f.which!==32?null:(Dg=!0,rh);case"textInput":return l=f.data,l===rh&&Dg?null:l;default:return null}}function Cy(l,f){if(Dl)return l==="compositionend"||!Lu&&Qd(l,f)?(l=Xd(),bl=Yd=Tl=null,Dl=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return _s&&f.locale!=="ko"?null:f.data;default:return null}}var Lr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lg(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f==="input"?!!Lr[l.type]:f==="textarea"}function Zd(l,f,g,x){Cu?El?El.push(x):El=[x]:Cu=x,f=y_(f,"onChange"),0<f.length&&(g=new eh("onChange","change",null,g,x),l.push({event:g,listeners:f}))}var Dc=null,Lc=null;function Ig(l){nR(l,0)}function Ic(l){var f=Ma(l);if(Fn(f))return l}function wg(l,f){if(l==="change")return f}var ah=!1;if(oo){var wu;if(oo){var ci="oninput"in document;if(!ci){var Ry=document.createElement("div");Ry.setAttribute("oninput","return;"),ci=typeof Ry.oninput=="function"}wu=ci}else wu=!1;ah=wu&&(!document.documentMode||9<document.documentMode)}function Dy(){Dc&&(Dc.detachEvent("onpropertychange",Bg),Lc=Dc=null)}function Bg(l){if(l.propertyName==="value"&&Ic(Lc)){var f=[];Zd(f,Lc,l,zd(l)),yg(Ig,f)}}function oh(l,f,g){l==="focusin"?(Dy(),Dc=f,Lc=g,Dc.attachEvent("onpropertychange",Bg)):l==="focusout"&&Dy()}function Ll(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Ic(Lc)}function Ly(l,f){if(l==="click")return Ic(f)}function Iy(l,f){if(l==="input"||l==="change")return Ic(f)}function Bu(l,f){return l===f&&(l!==0||1/l===1/f)||l!==l&&f!==f}var fi=typeof Object.is=="function"?Object.is:Bu;function wc(l,f){if(fi(l,f))return!0;if(typeof l!="object"||l===null||typeof f!="object"||f===null)return!1;var g=Object.keys(l),x=Object.keys(f);if(g.length!==x.length)return!1;for(x=0;x<g.length;x++){var b=g[x];if(!St.call(f,b)||!fi(l[b],f[b]))return!1}return!0}function Og(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function Pg(l,f){var g=Og(l);l=0;for(var x;g;){if(g.nodeType===3){if(x=l+g.textContent.length,l<=f&&x>=f)return{node:g,offset:f-l};l=x}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=Og(g)}}function ep(l,f){return l&&f?l===f?!0:l&&l.nodeType===3?!1:f&&f.nodeType===3?ep(l,f.parentNode):"contains"in l?l.contains(f):l.compareDocumentPosition?!!(l.compareDocumentPosition(f)&16):!1:!1}function tp(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var f=It(l.document);f instanceof l.HTMLIFrameElement;){try{var g=typeof f.contentWindow.location.href=="string"}catch{g=!1}if(g)l=f.contentWindow;else break;f=It(l.document)}return f}function Bc(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f&&(f==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||f==="textarea"||l.contentEditable==="true")}var wy=oo&&"documentMode"in document&&11>=document.documentMode,Oc=null,np=null,Pc=null,Ir=!1;function ip(l,f,g){var x=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;Ir||Oc==null||Oc!==It(x)||(x=Oc,"selectionStart"in x&&Bc(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),Pc&&wc(Pc,x)||(Pc=x,x=y_(np,"onSelect"),0<x.length&&(f=new eh("onSelect","select",null,f,g),l.push({event:f,listeners:x}),f.target=Oc)))}function Il(l,f){var g={};return g[l.toLowerCase()]=f.toLowerCase(),g["Webkit"+l]="webkit"+f,g["Moz"+l]="moz"+f,g}var Nc={animationend:Il("Animation","AnimationEnd"),animationiteration:Il("Animation","AnimationIteration"),animationstart:Il("Animation","AnimationStart"),transitionrun:Il("Transition","TransitionRun"),transitionstart:Il("Transition","TransitionStart"),transitioncancel:Il("Transition","TransitionCancel"),transitionend:Il("Transition","TransitionEnd")},lh={},Xs={};oo&&(Xs=document.createElement("div").style,"AnimationEvent"in window||(delete Nc.animationend.animation,delete Nc.animationiteration.animation,delete Nc.animationstart.animation),"TransitionEvent"in window||delete Nc.transitionend.transition);function wl(l){if(lh[l])return lh[l];if(!Nc[l])return l;var f=Nc[l],g;for(g in f)if(f.hasOwnProperty(g)&&g in Xs)return lh[l]=f[g];return l}var sr=wl("animationend"),Ng=wl("animationiteration"),lo=wl("animationstart"),Uc=wl("transitionrun"),Bl=wl("transitionstart"),Ug=wl("transitioncancel"),sp=wl("transitionend"),Vo=new Map,rp="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");rp.push("scrollEnd");function ws(l,f){Vo.set(l,f),be(f,[l])}var Ol=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)},us=[],Ou=0,ap=0;function Pl(){for(var l=Ou,f=ap=Ou=0;f<l;){var g=us[f];us[f++]=null;var x=us[f];us[f++]=null;var b=us[f];us[f++]=null;var D=us[f];if(us[f++]=null,x!==null&&b!==null){var G=x.pending;G===null?b.next=b:(b.next=G.next,G.next=b),x.pending=b}D!==0&&op(g,b,D)}}function uh(l,f,g,x){us[Ou++]=l,us[Ou++]=f,us[Ou++]=g,us[Ou++]=x,ap|=x,l.lanes|=x,l=l.alternate,l!==null&&(l.lanes|=x)}function Fc(l,f,g,x){return uh(l,f,g,x),kc(l)}function Nl(l,f){return uh(l,null,null,f),kc(l)}function op(l,f,g){l.lanes|=g;var x=l.alternate;x!==null&&(x.lanes|=g);for(var b=!1,D=l.return;D!==null;)D.childLanes|=g,x=D.alternate,x!==null&&(x.childLanes|=g),D.tag===22&&(l=D.stateNode,l===null||l._visibility&1||(b=!0)),l=D,D=D.return;return l.tag===3?(D=l.stateNode,b&&f!==null&&(b=31-ht(g),l=D.hiddenUpdates,x=l[b],x===null?l[b]=[f]:x.push(f),f.lane=g|536870912),D):null}function kc(l){if(50<Qu)throw Qu=0,$u=null,Error(n(185));for(var f=l.return;f!==null;)l=f,f=l.return;return l.tag===3?l.stateNode:null}var Ul={};function By(l,f,g,x){this.tag=l,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qs(l,f,g,x){return new By(l,f,g,x)}function Ws(l){return l=l.prototype,!(!l||!l.isReactComponent)}function uo(l,f){var g=l.alternate;return g===null?(g=qs(l.tag,f,l.key,l.mode),g.elementType=l.elementType,g.type=l.type,g.stateNode=l.stateNode,g.alternate=l,l.alternate=g):(g.pendingProps=f,g.type=l.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=l.flags&65011712,g.childLanes=l.childLanes,g.lanes=l.lanes,g.child=l.child,g.memoizedProps=l.memoizedProps,g.memoizedState=l.memoizedState,g.updateQueue=l.updateQueue,f=l.dependencies,g.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},g.sibling=l.sibling,g.index=l.index,g.ref=l.ref,g.refCleanup=l.refCleanup,g}function Bs(l,f){l.flags&=65011714;var g=l.alternate;return g===null?(l.childLanes=0,l.lanes=f,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=g.childLanes,l.lanes=g.lanes,l.child=g.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=g.memoizedProps,l.memoizedState=g.memoizedState,l.updateQueue=g.updateQueue,l.type=g.type,f=g.dependencies,l.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),l}function ch(l,f,g,x,b,D){var G=0;if(x=l,typeof l=="function")Ws(l)&&(G=1);else if(typeof l=="string")G=hN(l,g,pe.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case B:return l=qs(31,g,f,b),l.elementType=B,l.lanes=D,l;case A:return Ko(g.children,b,D,f);case E:G=8,b|=24;break;case T:return l=qs(12,g,f,b|2),l.elementType=T,l.lanes=D,l;case w:return l=qs(13,g,f,b),l.elementType=w,l.lanes=D,l;case N:return l=qs(19,g,f,b),l.elementType=N,l.lanes=D,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case R:G=10;break e;case M:G=9;break e;case L:G=11;break e;case O:G=14;break e;case F:G=16,x=null;break e}G=29,g=Error(n(130,l===null?"null":typeof l,"")),x=null}return f=qs(G,g,f,b),f.elementType=l,f.type=x,f.lanes=D,f}function Ko(l,f,g,x){return l=qs(7,l,x,f),l.lanes=g,l}function lp(l,f,g){return l=qs(6,l,null,f),l.lanes=g,l}function Oy(l){var f=qs(18,null,null,0);return f.stateNode=l,f}function Da(l,f,g){return f=qs(4,l.children!==null?l.children:[],l.key,f),f.lanes=g,f.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},f}var Fg=new WeakMap;function rr(l,f){if(typeof l=="object"&&l!==null){var g=Fg.get(l);return g!==void 0?g:(f={value:l,source:f,stack:te(f)},Fg.set(l,f),f)}return{value:l,source:f,stack:te(f)}}var La=[],Pu=0,fh=null,Gc=0,wr=[],ar=0,co=null,fo=1,ho="";function Yo(l,f){La[Pu++]=Gc,La[Pu++]=fh,fh=l,Gc=f}function kg(l,f,g){wr[ar++]=fo,wr[ar++]=ho,wr[ar++]=co,co=l;var x=fo;l=ho;var b=32-ht(x)-1;x&=~(1<<b),g+=1;var D=32-ht(f)+b;if(30<D){var G=b-b%5;D=(x&(1<<G)-1).toString(32),x>>=G,b-=G,fo=1<<32-ht(f)+b|g<<b|x,ho=D+l}else fo=1<<D|g<<b|x,ho=l}function up(l){l.return!==null&&(Yo(l,1),kg(l,1,0))}function Fl(l){for(;l===fh;)fh=La[--Pu],La[Pu]=null,Gc=La[--Pu],La[Pu]=null;for(;l===co;)co=wr[--ar],wr[ar]=null,ho=wr[--ar],wr[ar]=null,fo=wr[--ar],wr[ar]=null}function hh(l,f){wr[ar++]=fo,wr[ar++]=ho,wr[ar++]=co,fo=f.id,ho=f.overflow,co=l}var cs=null,si=null,xn=!1,Xo=null,fs=!1,cp=Error(n(519));function vn(l){var f=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw dh(rr(f,l)),cp}function fp(l){var f=l.stateNode,g=l.type,x=l.memoizedProps;switch(f[ln]=l,f[Zi]=x,g){case"dialog":Sn("cancel",f),Sn("close",f);break;case"iframe":case"object":case"embed":Sn("load",f);break;case"video":case"audio":for(g=0;g<I0.length;g++)Sn(I0[g],f);break;case"source":Sn("error",f);break;case"img":case"image":case"link":Sn("error",f),Sn("load",f);break;case"details":Sn("toggle",f);break;case"input":Sn("invalid",f),ro(f,x.value,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name,!0);break;case"select":Sn("invalid",f);break;case"textarea":Sn("invalid",f),Si(f,x.value,x.defaultValue,x.children)}g=x.children,typeof g!="string"&&typeof g!="number"&&typeof g!="bigint"||f.textContent===""+g||x.suppressHydrationWarning===!0||aR(f.textContent,g)?(x.popover!=null&&(Sn("beforetoggle",f),Sn("toggle",f)),x.onScroll!=null&&Sn("scroll",f),x.onScrollEnd!=null&&Sn("scrollend",f),x.onClick!=null&&(f.onclick=ao),f=!0):f=!1,f||vn(l,!0)}function Py(l){for(cs=l.return;cs;)switch(cs.tag){case 5:case 31:case 13:fs=!1;return;case 27:case 3:fs=!0;return;default:cs=cs.return}}function Nu(l){if(l!==cs)return!1;if(!xn)return Py(l),xn=!0,!1;var f=l.tag,g;if((g=f!==3&&f!==27)&&((g=f===5)&&(g=l.type,g=!(g!=="form"&&g!=="button")||kE(l.type,l.memoizedProps)),g=!g),g&&si&&vn(l),Py(l),f===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(n(317));si=mR(l)}else if(f===31){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(n(317));si=mR(l)}else f===27?(f=si,af(l.type)?(l=KE,KE=null,si=l):si=f):si=cs?To(l.stateNode.nextSibling):null;return!0}function Uu(){si=cs=null,xn=!1}function Gg(){var l=Xo;return l!==null&&(ks===null?ks=l:ks.push.apply(ks,l),Xo=null),l}function dh(l){Xo===null?Xo=[l]:Xo.push(l)}var Hg=Y(null),qo=null,Os=null;function Wo(l,f,g){le(Hg,f._currentValue),f._currentValue=g}function aa(l){l._currentValue=Hg.current,Z(Hg)}function jo(l,f,g){for(;l!==null;){var x=l.alternate;if((l.childLanes&f)!==f?(l.childLanes|=f,x!==null&&(x.childLanes|=f)):x!==null&&(x.childLanes&f)!==f&&(x.childLanes|=f),l===g)break;l=l.return}}function hp(l,f,g,x){var b=l.child;for(b!==null&&(b.return=l);b!==null;){var D=b.dependencies;if(D!==null){var G=b.child;D=D.firstContext;e:for(;D!==null;){var q=D;D=b;for(var ae=0;ae<f.length;ae++)if(q.context===f[ae]){D.lanes|=g,q=D.alternate,q!==null&&(q.lanes|=g),jo(D.return,g,l),x||(G=null);break e}D=q.next}}else if(b.tag===18){if(G=b.return,G===null)throw Error(n(341));G.lanes|=g,D=G.alternate,D!==null&&(D.lanes|=g),jo(G,g,l),G=null}else G=b.child;if(G!==null)G.return=b;else for(G=b;G!==null;){if(G===l){G=null;break}if(b=G.sibling,b!==null){b.return=G.return,G=b;break}G=G.return}b=G}}function kl(l,f,g,x){l=null;for(var b=f,D=!1;b!==null;){if(!D){if((b.flags&524288)!==0)D=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var G=b.alternate;if(G===null)throw Error(n(387));if(G=G.memoizedProps,G!==null){var q=b.type;fi(b.pendingProps.value,G.value)||(l!==null?l.push(q):l=[q])}}else if(b===Me.current){if(G=b.alternate,G===null)throw Error(n(387));G.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(l!==null?l.push(N0):l=[N0])}b=b.return}l!==null&&hp(f,l,g,x),f.flags|=262144}function Hc(l){for(l=l.firstContext;l!==null;){if(!fi(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function Fu(l){qo=l,Os=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function hs(l){return zg(qo,l)}function ph(l,f){return qo===null&&Fu(l),zg(l,f)}function zg(l,f){var g=f._currentValue;if(f={context:f,memoizedValue:g,next:null},Os===null){if(l===null)throw Error(n(308));Os=f,l.dependencies={lanes:0,firstContext:f},l.flags|=524288}else Os=Os.next=f;return g}var Ny=typeof AbortController<"u"?AbortController:function(){var l=[],f=this.signal={aborted:!1,addEventListener:function(g,x){l.push(x)}};this.abort=function(){f.aborted=!0,l.forEach(function(g){return g()})}},Uy=r.unstable_scheduleCallback,Vg=r.unstable_NormalPriority,Ot={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Kg(){return{controller:new Ny,data:new Map,refCount:0}}function xs(l){l.refCount--,l.refCount===0&&Uy(Vg,function(){l.controller.abort()})}var ku=null,Yg=0,Jo=0,Ia=null;function zc(l,f){if(ku===null){var g=ku=[];Yg=0,Jo=LE(),Ia={status:"pending",value:void 0,then:function(x){g.push(x)}}}return Yg++,f.then(Xg,Xg),f}function Xg(){if(--Yg===0&&ku!==null){Ia!==null&&(Ia.status="fulfilled");var l=ku;ku=null,Jo=0,Ia=null;for(var f=0;f<l.length;f++)(0,l[f])()}}function qg(l,f){var g=[],x={status:"pending",value:null,reason:null,then:function(b){g.push(b)}};return l.then(function(){x.status="fulfilled",x.value=f;for(var b=0;b<g.length;b++)(0,g[b])(f)},function(b){for(x.status="rejected",x.reason=b,b=0;b<g.length;b++)(0,g[b])(void 0)}),x}var Fy=k.S;k.S=function(l,f){nf=z(),typeof f=="object"&&f!==null&&typeof f.then=="function"&&zc(l,f),Fy!==null&&Fy(l,f)};var Gl=Y(null);function po(){var l=Gl.current;return l!==null?l:Vn.pooledCache}function Vc(l,f){f===null?le(Gl,Gl.current):le(Gl,f.pool)}function dp(){var l=po();return l===null?null:{parent:Ot._currentValue,pool:l}}var Hl=Error(n(460)),mh=Error(n(474)),wa=Error(n(542)),gh={then:function(){}};function ky(l){return l=l.status,l==="fulfilled"||l==="rejected"}function Wg(l,f,g){switch(g=l[g],g===void 0?l.push(f):g!==f&&(f.then(ao,ao),f=g),f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,jg(l),l;default:if(typeof f.status=="string")f.then(ao,ao);else{if(l=Vn,l!==null&&100<l.shellSuspendCounter)throw Error(n(482));l=f,l.status="pending",l.then(function(x){if(f.status==="pending"){var b=f;b.status="fulfilled",b.value=x}},function(x){if(f.status==="pending"){var b=f;b.status="rejected",b.reason=x}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,jg(l),l}throw Kt=f,Hl}}function Gu(l){try{var f=l._init;return f(l._payload)}catch(g){throw g!==null&&typeof g=="object"&&typeof g.then=="function"?(Kt=g,Hl):g}}var Kt=null;function pp(){if(Kt===null)throw Error(n(459));var l=Kt;return Kt=null,l}function jg(l){if(l===Hl||l===wa)throw Error(n(483))}var zl=null,Vl=0;function mp(l){var f=Vl;return Vl+=1,zl===null&&(zl=[]),Wg(zl,l,f)}function vh(l,f){f=f.props.ref,l.ref=f!==void 0?f:null}function yh(l,f){throw f.$$typeof===v?Error(n(525)):(l=Object.prototype.toString.call(f),Error(n(31,l==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":l)))}function Kc(l){function f(ge,ue){if(l){var Ae=ge.deletions;Ae===null?(ge.deletions=[ue],ge.flags|=16):Ae.push(ue)}}function g(ge,ue){if(!l)return null;for(;ue!==null;)f(ge,ue),ue=ue.sibling;return null}function x(ge){for(var ue=new Map;ge!==null;)ge.key!==null?ue.set(ge.key,ge):ue.set(ge.index,ge),ge=ge.sibling;return ue}function b(ge,ue){return ge=uo(ge,ue),ge.index=0,ge.sibling=null,ge}function D(ge,ue,Ae){return ge.index=Ae,l?(Ae=ge.alternate,Ae!==null?(Ae=Ae.index,Ae<ue?(ge.flags|=67108866,ue):Ae):(ge.flags|=67108866,ue)):(ge.flags|=1048576,ue)}function G(ge){return l&&ge.alternate===null&&(ge.flags|=67108866),ge}function q(ge,ue,Ae,Ge){return ue===null||ue.tag!==6?(ue=lp(Ae,ge.mode,Ge),ue.return=ge,ue):(ue=b(ue,Ae),ue.return=ge,ue)}function ae(ge,ue,Ae,Ge){var Gt=Ae.type;return Gt===A?Pe(ge,ue,Ae.props.children,Ge,Ae.key):ue!==null&&(ue.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===F&&Gu(Gt)===ue.type)?(ue=b(ue,Ae.props),vh(ue,Ae),ue.return=ge,ue):(ue=ch(Ae.type,Ae.key,Ae.props,null,ge.mode,Ge),vh(ue,Ae),ue.return=ge,ue)}function Ee(ge,ue,Ae,Ge){return ue===null||ue.tag!==4||ue.stateNode.containerInfo!==Ae.containerInfo||ue.stateNode.implementation!==Ae.implementation?(ue=Da(Ae,ge.mode,Ge),ue.return=ge,ue):(ue=b(ue,Ae.children||[]),ue.return=ge,ue)}function Pe(ge,ue,Ae,Ge,Gt){return ue===null||ue.tag!==7?(ue=Ko(Ae,ge.mode,Ge,Gt),ue.return=ge,ue):(ue=b(ue,Ae),ue.return=ge,ue)}function Ke(ge,ue,Ae){if(typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint")return ue=lp(""+ue,ge.mode,Ae),ue.return=ge,ue;if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case y:return Ae=ch(ue.type,ue.key,ue.props,null,ge.mode,Ae),vh(Ae,ue),Ae.return=ge,Ae;case _:return ue=Da(ue,ge.mode,Ae),ue.return=ge,ue;case F:return ue=Gu(ue),Ke(ge,ue,Ae)}if(ne(ue)||J(ue))return ue=Ko(ue,ge.mode,Ae,null),ue.return=ge,ue;if(typeof ue.then=="function")return Ke(ge,mp(ue),Ae);if(ue.$$typeof===R)return Ke(ge,ph(ge,ue),Ae);yh(ge,ue)}return null}function Re(ge,ue,Ae,Ge){var Gt=ue!==null?ue.key:null;if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return Gt!==null?null:q(ge,ue,""+Ae,Ge);if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case y:return Ae.key===Gt?ae(ge,ue,Ae,Ge):null;case _:return Ae.key===Gt?Ee(ge,ue,Ae,Ge):null;case F:return Ae=Gu(Ae),Re(ge,ue,Ae,Ge)}if(ne(Ae)||J(Ae))return Gt!==null?null:Pe(ge,ue,Ae,Ge,null);if(typeof Ae.then=="function")return Re(ge,ue,mp(Ae),Ge);if(Ae.$$typeof===R)return Re(ge,ue,ph(ge,Ae),Ge);yh(ge,Ae)}return null}function Be(ge,ue,Ae,Ge,Gt){if(typeof Ge=="string"&&Ge!==""||typeof Ge=="number"||typeof Ge=="bigint")return ge=ge.get(Ae)||null,q(ue,ge,""+Ge,Gt);if(typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case y:return ge=ge.get(Ge.key===null?Ae:Ge.key)||null,ae(ue,ge,Ge,Gt);case _:return ge=ge.get(Ge.key===null?Ae:Ge.key)||null,Ee(ue,ge,Ge,Gt);case F:return Ge=Gu(Ge),Be(ge,ue,Ae,Ge,Gt)}if(ne(Ge)||J(Ge))return ge=ge.get(Ae)||null,Pe(ue,ge,Ge,Gt,null);if(typeof Ge.then=="function")return Be(ge,ue,Ae,mp(Ge),Gt);if(Ge.$$typeof===R)return Be(ge,ue,Ae,ph(ue,Ge),Gt);yh(ue,Ge)}return null}function Dt(ge,ue,Ae,Ge){for(var Gt=null,Yn=null,wt=ue,fn=ue=0,bn=null;wt!==null&&fn<Ae.length;fn++){wt.index>fn?(bn=wt,wt=null):bn=wt.sibling;var Xn=Re(ge,wt,Ae[fn],Ge);if(Xn===null){wt===null&&(wt=bn);break}l&&wt&&Xn.alternate===null&&f(ge,wt),ue=D(Xn,ue,fn),Yn===null?Gt=Xn:Yn.sibling=Xn,Yn=Xn,wt=bn}if(fn===Ae.length)return g(ge,wt),xn&&Yo(ge,fn),Gt;if(wt===null){for(;fn<Ae.length;fn++)wt=Ke(ge,Ae[fn],Ge),wt!==null&&(ue=D(wt,ue,fn),Yn===null?Gt=wt:Yn.sibling=wt,Yn=wt);return xn&&Yo(ge,fn),Gt}for(wt=x(wt);fn<Ae.length;fn++)bn=Be(wt,ge,fn,Ae[fn],Ge),bn!==null&&(l&&bn.alternate!==null&&wt.delete(bn.key===null?fn:bn.key),ue=D(bn,ue,fn),Yn===null?Gt=bn:Yn.sibling=bn,Yn=bn);return l&&wt.forEach(function(ff){return f(ge,ff)}),xn&&Yo(ge,fn),Gt}function Xt(ge,ue,Ae,Ge){if(Ae==null)throw Error(n(151));for(var Gt=null,Yn=null,wt=ue,fn=ue=0,bn=null,Xn=Ae.next();wt!==null&&!Xn.done;fn++,Xn=Ae.next()){wt.index>fn?(bn=wt,wt=null):bn=wt.sibling;var ff=Re(ge,wt,Xn.value,Ge);if(ff===null){wt===null&&(wt=bn);break}l&&wt&&ff.alternate===null&&f(ge,wt),ue=D(ff,ue,fn),Yn===null?Gt=ff:Yn.sibling=ff,Yn=ff,wt=bn}if(Xn.done)return g(ge,wt),xn&&Yo(ge,fn),Gt;if(wt===null){for(;!Xn.done;fn++,Xn=Ae.next())Xn=Ke(ge,Xn.value,Ge),Xn!==null&&(ue=D(Xn,ue,fn),Yn===null?Gt=Xn:Yn.sibling=Xn,Yn=Xn);return xn&&Yo(ge,fn),Gt}for(wt=x(wt);!Xn.done;fn++,Xn=Ae.next())Xn=Be(wt,ge,fn,Xn.value,Ge),Xn!==null&&(l&&Xn.alternate!==null&&wt.delete(Xn.key===null?fn:Xn.key),ue=D(Xn,ue,fn),Yn===null?Gt=Xn:Yn.sibling=Xn,Yn=Xn);return l&&wt.forEach(function(EN){return f(ge,EN)}),xn&&Yo(ge,fn),Gt}function oi(ge,ue,Ae,Ge){if(typeof Ae=="object"&&Ae!==null&&Ae.type===A&&Ae.key===null&&(Ae=Ae.props.children),typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case y:e:{for(var Gt=Ae.key;ue!==null;){if(ue.key===Gt){if(Gt=Ae.type,Gt===A){if(ue.tag===7){g(ge,ue.sibling),Ge=b(ue,Ae.props.children),Ge.return=ge,ge=Ge;break e}}else if(ue.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===F&&Gu(Gt)===ue.type){g(ge,ue.sibling),Ge=b(ue,Ae.props),vh(Ge,Ae),Ge.return=ge,ge=Ge;break e}g(ge,ue);break}else f(ge,ue);ue=ue.sibling}Ae.type===A?(Ge=Ko(Ae.props.children,ge.mode,Ge,Ae.key),Ge.return=ge,ge=Ge):(Ge=ch(Ae.type,Ae.key,Ae.props,null,ge.mode,Ge),vh(Ge,Ae),Ge.return=ge,ge=Ge)}return G(ge);case _:e:{for(Gt=Ae.key;ue!==null;){if(ue.key===Gt)if(ue.tag===4&&ue.stateNode.containerInfo===Ae.containerInfo&&ue.stateNode.implementation===Ae.implementation){g(ge,ue.sibling),Ge=b(ue,Ae.children||[]),Ge.return=ge,ge=Ge;break e}else{g(ge,ue);break}else f(ge,ue);ue=ue.sibling}Ge=Da(Ae,ge.mode,Ge),Ge.return=ge,ge=Ge}return G(ge);case F:return Ae=Gu(Ae),oi(ge,ue,Ae,Ge)}if(ne(Ae))return Dt(ge,ue,Ae,Ge);if(J(Ae)){if(Gt=J(Ae),typeof Gt!="function")throw Error(n(150));return Ae=Gt.call(Ae),Xt(ge,ue,Ae,Ge)}if(typeof Ae.then=="function")return oi(ge,ue,mp(Ae),Ge);if(Ae.$$typeof===R)return oi(ge,ue,ph(ge,Ae),Ge);yh(ge,Ae)}return typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint"?(Ae=""+Ae,ue!==null&&ue.tag===6?(g(ge,ue.sibling),Ge=b(ue,Ae),Ge.return=ge,ge=Ge):(g(ge,ue),Ge=lp(Ae,ge.mode,Ge),Ge.return=ge,ge=Ge),G(ge)):g(ge,ue)}return function(ge,ue,Ae,Ge){try{Vl=0;var Gt=oi(ge,ue,Ae,Ge);return zl=null,Gt}catch(wt){if(wt===Hl||wt===wa)throw wt;var Yn=qs(29,wt,null,ge.mode);return Yn.lanes=Ge,Yn.return=ge,Yn}}}var Hu=Kc(!0),Gy=Kc(!1),Kl=!1;function Jg(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Qg(l,f){l=l.updateQueue,f.updateQueue===l&&(f.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function mo(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function Qo(l,f,g){var x=l.updateQueue;if(x===null)return null;if(x=x.shared,(En&2)!==0){var b=x.pending;return b===null?f.next=f:(f.next=b.next,b.next=f),x.pending=f,f=kc(l),op(l,null,g),f}return uh(l,x,f,g),kc(l)}function Yl(l,f,g){if(f=f.updateQueue,f!==null&&(f=f.shared,(g&4194048)!==0)){var x=f.lanes;x&=l.pendingLanes,g|=x,f.lanes=g,xu(l,g)}}function gp(l,f){var g=l.updateQueue,x=l.alternate;if(x!==null&&(x=x.updateQueue,g===x)){var b=null,D=null;if(g=g.firstBaseUpdate,g!==null){do{var G={lane:g.lane,tag:g.tag,payload:g.payload,callback:null,next:null};D===null?b=D=G:D=D.next=G,g=g.next}while(g!==null);D===null?b=D=f:D=D.next=f}else b=D=f;g={baseState:x.baseState,firstBaseUpdate:b,lastBaseUpdate:D,shared:x.shared,callbacks:x.callbacks},l.updateQueue=g;return}l=g.lastBaseUpdate,l===null?g.firstBaseUpdate=f:l.next=f,g.lastBaseUpdate=f}var $g=!1;function _h(){if($g){var l=Ia;if(l!==null)throw l}}function zu(l,f,g,x){$g=!1;var b=l.updateQueue;Kl=!1;var D=b.firstBaseUpdate,G=b.lastBaseUpdate,q=b.shared.pending;if(q!==null){b.shared.pending=null;var ae=q,Ee=ae.next;ae.next=null,G===null?D=Ee:G.next=Ee,G=ae;var Pe=l.alternate;Pe!==null&&(Pe=Pe.updateQueue,q=Pe.lastBaseUpdate,q!==G&&(q===null?Pe.firstBaseUpdate=Ee:q.next=Ee,Pe.lastBaseUpdate=ae))}if(D!==null){var Ke=b.baseState;G=0,Pe=Ee=ae=null,q=D;do{var Re=q.lane&-536870913,Be=Re!==q.lane;if(Be?(yn&Re)===Re:(x&Re)===Re){Re!==0&&Re===Jo&&($g=!0),Pe!==null&&(Pe=Pe.next={lane:0,tag:q.tag,payload:q.payload,callback:null,next:null});e:{var Dt=l,Xt=q;Re=f;var oi=g;switch(Xt.tag){case 1:if(Dt=Xt.payload,typeof Dt=="function"){Ke=Dt.call(oi,Ke,Re);break e}Ke=Dt;break e;case 3:Dt.flags=Dt.flags&-65537|128;case 0:if(Dt=Xt.payload,Re=typeof Dt=="function"?Dt.call(oi,Ke,Re):Dt,Re==null)break e;Ke=p({},Ke,Re);break e;case 2:Kl=!0}}Re=q.callback,Re!==null&&(l.flags|=64,Be&&(l.flags|=8192),Be=b.callbacks,Be===null?b.callbacks=[Re]:Be.push(Re))}else Be={lane:Re,tag:q.tag,payload:q.payload,callback:q.callback,next:null},Pe===null?(Ee=Pe=Be,ae=Ke):Pe=Pe.next=Be,G|=Re;if(q=q.next,q===null){if(q=b.shared.pending,q===null)break;Be=q,q=Be.next,Be.next=null,b.lastBaseUpdate=Be,b.shared.pending=null}}while(!0);Pe===null&&(ae=Ke),b.baseState=ae,b.firstBaseUpdate=Ee,b.lastBaseUpdate=Pe,D===null&&(b.shared.lanes=0),Vr|=G,l.lanes=G,l.memoizedState=Ke}}function go(l,f){if(typeof l!="function")throw Error(n(191,l));l.call(f)}function Ss(l,f){var g=l.callbacks;if(g!==null)for(l.callbacks=null,l=0;l<g.length;l++)go(g[l],f)}var Br=Y(null),js=Y(0);function Zg(l,f){l=Ui,le(js,l),le(Br,f),Ui=l|f.baseLanes}function e0(){le(js,Ui),le(Br,Br.current)}function Ps(){Ui=js.current,Z(Br),Z(js)}var es=Y(null),oa=null;function Xl(l){var f=l.alternate;le(Ai,Ai.current&1),le(es,l),oa===null&&(f===null||Br.current!==null||f.memoizedState!==null)&&(oa=l)}function t0(l){le(Ai,Ai.current),le(es,l),oa===null&&(oa=l)}function Hy(l){l.tag===22?(le(Ai,Ai.current),le(es,l),oa===null&&(oa=l)):$o()}function $o(){le(Ai,Ai.current),le(es,es.current)}function Or(l){Z(es),oa===l&&(oa=null),Z(Ai)}var Ai=Y(0);function vp(l){for(var f=l;f!==null;){if(f.tag===13){var g=f.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||zE(g)||VE(g)))return f}else if(f.tag===19&&(f.memoizedProps.revealOrder==="forwards"||f.memoizedProps.revealOrder==="backwards"||f.memoizedProps.revealOrder==="unstable_legacy-backwards"||f.memoizedProps.revealOrder==="together")){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var or=0,qt=null,jn=null,Yi=null,yp=!1,vo=!1,Vu=!1,_p=0,xh=0,yo=null,xE=0;function Ei(){throw Error(n(321))}function n0(l,f){if(f===null)return!1;for(var g=0;g<f.length&&g<l.length;g++)if(!fi(l[g],f[g]))return!1;return!0}function i0(l,f,g,x,b,D){return or=D,qt=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,k.H=l===null||l.memoizedState===null?o_:qc,Vu=!1,D=g(x,b),Vu=!1,vo&&(D=Vy(f,g,x,b)),zy(l),D}function zy(l){k.H=bh;var f=jn!==null&&jn.next!==null;if(or=0,Yi=jn=qt=null,yp=!1,xh=0,yo=null,f)throw Error(n(300));l===null||hi||(l=l.dependencies,l!==null&&Hc(l)&&(hi=!0))}function Vy(l,f,g,x){qt=l;var b=0;do{if(vo&&(yo=null),xh=0,vo=!1,25<=b)throw Error(n(301));if(b+=1,Yi=jn=null,l.updateQueue!=null){var D=l.updateQueue;D.lastEffect=null,D.events=null,D.stores=null,D.memoCache!=null&&(D.memoCache.index=0)}k.H=Mh,D=f(g,x)}while(vo);return D}function SE(){var l=k.H,f=l.useState()[0];return f=typeof f.then=="function"?Ah(f):f,l=l.useState()[0],(jn!==null?jn.memoizedState:null)!==l&&(qt.flags|=1024),f}function s0(){var l=_p!==0;return _p=0,l}function r0(l,f,g){f.updateQueue=l.updateQueue,f.flags&=-2053,l.lanes&=~g}function a0(l){if(yp){for(l=l.memoizedState;l!==null;){var f=l.queue;f!==null&&(f.pending=null),l=l.next}yp=!1}or=0,Yi=jn=qt=null,vo=!1,xh=_p=0,yo=null}function Js(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yi===null?qt.memoizedState=Yi=l:Yi=Yi.next=l,Yi}function Bi(){if(jn===null){var l=qt.alternate;l=l!==null?l.memoizedState:null}else l=jn.next;var f=Yi===null?qt.memoizedState:Yi.next;if(f!==null)Yi=f,jn=l;else{if(l===null)throw qt.alternate===null?Error(n(467)):Error(n(310));jn=l,l={memoizedState:jn.memoizedState,baseState:jn.baseState,baseQueue:jn.baseQueue,queue:jn.queue,next:null},Yi===null?qt.memoizedState=Yi=l:Yi=Yi.next=l}return Yi}function Sh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ah(l){var f=xh;return xh+=1,yo===null&&(yo=[]),l=Wg(yo,l,f),f=qt,(Yi===null?f.memoizedState:Yi.next)===null&&(f=f.alternate,k.H=f===null||f.memoizedState===null?o_:qc),l}function xp(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return Ah(l);if(l.$$typeof===R)return hs(l)}throw Error(n(438,String(l)))}function o0(l){var f=null,g=qt.updateQueue;if(g!==null&&(f=g.memoCache),f==null){var x=qt.alternate;x!==null&&(x=x.updateQueue,x!==null&&(x=x.memoCache,x!=null&&(f={data:x.data.map(function(b){return b.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),g===null&&(g=Sh(),qt.updateQueue=g),g.memoCache=f,g=f.data[f.index],g===void 0)for(g=f.data[f.index]=Array(l),x=0;x<l;x++)g[x]=P;return f.index++,g}function Zo(l,f){return typeof f=="function"?f(l):f}function Sp(l){var f=Bi();return l0(f,jn,l)}function l0(l,f,g){var x=l.queue;if(x===null)throw Error(n(311));x.lastRenderedReducer=g;var b=l.baseQueue,D=x.pending;if(D!==null){if(b!==null){var G=b.next;b.next=D.next,D.next=G}f.baseQueue=b=D,x.pending=null}if(D=l.baseState,b===null)l.memoizedState=D;else{f=b.next;var q=G=null,ae=null,Ee=f,Pe=!1;do{var Ke=Ee.lane&-536870913;if(Ke!==Ee.lane?(yn&Ke)===Ke:(or&Ke)===Ke){var Re=Ee.revertLane;if(Re===0)ae!==null&&(ae=ae.next={lane:0,revertLane:0,gesture:null,action:Ee.action,hasEagerState:Ee.hasEagerState,eagerState:Ee.eagerState,next:null}),Ke===Jo&&(Pe=!0);else if((or&Re)===Re){Ee=Ee.next,Re===Jo&&(Pe=!0);continue}else Ke={lane:0,revertLane:Ee.revertLane,gesture:null,action:Ee.action,hasEagerState:Ee.hasEagerState,eagerState:Ee.eagerState,next:null},ae===null?(q=ae=Ke,G=D):ae=ae.next=Ke,qt.lanes|=Re,Vr|=Re;Ke=Ee.action,Vu&&g(D,Ke),D=Ee.hasEagerState?Ee.eagerState:g(D,Ke)}else Re={lane:Ke,revertLane:Ee.revertLane,gesture:Ee.gesture,action:Ee.action,hasEagerState:Ee.hasEagerState,eagerState:Ee.eagerState,next:null},ae===null?(q=ae=Re,G=D):ae=ae.next=Re,qt.lanes|=Ke,Vr|=Ke;Ee=Ee.next}while(Ee!==null&&Ee!==f);if(ae===null?G=D:ae.next=q,!fi(D,l.memoizedState)&&(hi=!0,Pe&&(g=Ia,g!==null)))throw g;l.memoizedState=D,l.baseState=G,l.baseQueue=ae,x.lastRenderedState=D}return b===null&&(x.lanes=0),[l.memoizedState,x.dispatch]}function Ap(l){var f=Bi(),g=f.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=l;var x=g.dispatch,b=g.pending,D=f.memoizedState;if(b!==null){g.pending=null;var G=b=b.next;do D=l(D,G.action),G=G.next;while(G!==b);fi(D,f.memoizedState)||(hi=!0),f.memoizedState=D,f.baseQueue===null&&(f.baseState=D),g.lastRenderedState=D}return[D,x]}function u0(l,f,g){var x=qt,b=Bi(),D=xn;if(D){if(g===void 0)throw Error(n(407));g=g()}else g=f();var G=!fi((jn||b).memoizedState,g);if(G&&(b.memoizedState=g,hi=!0),b=b.queue,p0(f0.bind(null,x,b,l),[l]),b.getSnapshot!==f||G||Yi!==null&&Yi.memoizedState.tag&1){if(x.flags|=2048,Yc(9,{destroy:void 0},c0.bind(null,x,b,g,f),null),Vn===null)throw Error(n(349));D||(or&127)!==0||Ky(x,f,g)}return g}function Ky(l,f,g){l.flags|=16384,l={getSnapshot:f,value:g},f=qt.updateQueue,f===null?(f=Sh(),qt.updateQueue=f,f.stores=[l]):(g=f.stores,g===null?f.stores=[l]:g.push(l))}function c0(l,f,g,x){f.value=g,f.getSnapshot=x,h0(f)&&Ep(l)}function f0(l,f,g){return g(function(){h0(f)&&Ep(l)})}function h0(l){var f=l.getSnapshot;l=l.value;try{var g=f();return!fi(l,g)}catch{return!0}}function Ep(l){var f=Nl(l,2);f!==null&&m(f,l,2)}function Eh(l){var f=Js();if(typeof l=="function"){var g=l;if(l=g(),Vu){ft(!0);try{g()}finally{ft(!1)}}}return f.memoizedState=f.baseState=l,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zo,lastRenderedState:l},f}function Yy(l,f,g,x){return l.baseState=g,l0(l,jn,typeof x=="function"?x:Zo)}function AE(l,f,g,x,b){if(el(l))throw Error(n(485));if(l=f.action,l!==null){var D={payload:b,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(G){D.listeners.push(G)}};k.T!==null?g(!0):D.isTransition=!1,x(D),g=f.pending,g===null?(D.next=f.pending=D,Xy(f,D)):(D.next=g.next,f.pending=g.next=D)}}function Xy(l,f){var g=f.action,x=f.payload,b=l.state;if(f.isTransition){var D=k.T,G={};k.T=G;try{var q=g(b,x),ae=k.S;ae!==null&&ae(G,q),qy(l,f,q)}catch(Ee){Tp(l,f,Ee)}finally{D!==null&&G.types!==null&&(D.types=G.types),k.T=D}}else try{D=g(b,x),qy(l,f,D)}catch(Ee){Tp(l,f,Ee)}}function qy(l,f,g){g!==null&&typeof g=="object"&&typeof g.then=="function"?g.then(function(x){d0(l,f,x)},function(x){return Tp(l,f,x)}):d0(l,f,g)}function d0(l,f,g){f.status="fulfilled",f.value=g,Wy(f),l.state=g,f=l.pending,f!==null&&(g=f.next,g===f?l.pending=null:(g=g.next,f.next=g,Xy(l,g)))}function Tp(l,f,g){var x=l.pending;if(l.pending=null,x!==null){x=x.next;do f.status="rejected",f.reason=g,Wy(f),f=f.next;while(f!==x)}l.action=null}function Wy(l){l=l.listeners;for(var f=0;f<l.length;f++)(0,l[f])()}function jy(l,f){return f}function Jy(l,f){if(xn){var g=Vn.formState;if(g!==null){e:{var x=qt;if(xn){if(si){t:{for(var b=si,D=fs;b.nodeType!==8;){if(!D){b=null;break t}if(b=To(b.nextSibling),b===null){b=null;break t}}D=b.data,b=D==="F!"||D==="F"?b:null}if(b){si=To(b.nextSibling),x=b.data==="F!";break e}}vn(x)}x=!1}x&&(f=g[0])}}return g=Js(),g.memoizedState=g.baseState=f,x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:jy,lastRenderedState:f},g.queue=x,g=a_.bind(null,qt,x),x.dispatch=g,x=Eh(!1),D=Th.bind(null,qt,!1,x.queue),x=Js(),b={state:f,dispatch:null,action:l,pending:null},x.queue=b,g=AE.bind(null,qt,b,D,g),b.dispatch=g,x.memoizedState=l,[f,g,!1]}function Qy(l){var f=Bi();return $y(f,jn,l)}function $y(l,f,g){if(f=l0(l,f,jy)[0],l=Sp(Zo)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var x=Ah(f)}catch(G){throw G===Hl?wa:G}else x=f;f=Bi();var b=f.queue,D=b.dispatch;return g!==f.memoizedState&&(qt.flags|=2048,Yc(9,{destroy:void 0},EE.bind(null,b,g),null)),[x,D,l]}function EE(l,f){l.action=f}function Zy(l){var f=Bi(),g=jn;if(g!==null)return $y(f,g,l);Bi(),f=f.memoizedState,g=Bi();var x=g.queue.dispatch;return g.memoizedState=l,[f,x,!1]}function Yc(l,f,g,x){return l={tag:l,create:g,deps:x,inst:f,next:null},f=qt.updateQueue,f===null&&(f=Sh(),qt.updateQueue=f),g=f.lastEffect,g===null?f.lastEffect=l.next=l:(x=g.next,g.next=l,l.next=x,f.lastEffect=l),l}function e_(){return Bi().memoizedState}function bp(l,f,g,x){var b=Js();qt.flags|=l,b.memoizedState=Yc(1|f,{destroy:void 0},g,x===void 0?null:x)}function Mp(l,f,g,x){var b=Bi();x=x===void 0?null:x;var D=b.memoizedState.inst;jn!==null&&x!==null&&n0(x,jn.memoizedState.deps)?b.memoizedState=Yc(f,D,g,x):(qt.flags|=l,b.memoizedState=Yc(1|f,D,g,x))}function t_(l,f){bp(8390656,8,l,f)}function p0(l,f){Mp(2048,8,l,f)}function n_(l){qt.flags|=4;var f=qt.updateQueue;if(f===null)f=Sh(),qt.updateQueue=f,f.events=[l];else{var g=f.events;g===null?f.events=[l]:g.push(l)}}function i_(l){var f=Bi().memoizedState;return n_({ref:f,nextImpl:l}),function(){if((En&2)!==0)throw Error(n(440));return f.impl.apply(void 0,arguments)}}function s_(l,f){return Mp(4,2,l,f)}function Pr(l,f){return Mp(4,4,l,f)}function m0(l,f){if(typeof f=="function"){l=l();var g=f(l);return function(){typeof g=="function"?g():f(null)}}if(f!=null)return l=l(),f.current=l,function(){f.current=null}}function Cp(l,f,g){g=g!=null?g.concat([l]):null,Mp(4,4,m0.bind(null,f,l),g)}function Rp(){}function g0(l,f){var g=Bi();f=f===void 0?null:f;var x=g.memoizedState;return f!==null&&n0(f,x[1])?x[0]:(g.memoizedState=[l,f],l)}function v0(l,f){var g=Bi();f=f===void 0?null:f;var x=g.memoizedState;if(f!==null&&n0(f,x[1]))return x[0];if(x=l(),Vu){ft(!0);try{l()}finally{ft(!1)}}return g.memoizedState=[x,f],x}function y0(l,f,g){return g===void 0||(or&1073741824)!==0&&(yn&261930)===0?l.memoizedState=f:(l.memoizedState=g,l=d(),qt.lanes|=l,Vr|=l,g)}function _0(l,f,g,x){return fi(g,f)?g:Br.current!==null?(l=y0(l,g,x),fi(l,f)||(hi=!0),l):(or&42)===0||(or&1073741824)!==0&&(yn&261930)===0?(hi=!0,l.memoizedState=g):(l=d(),qt.lanes|=l,Vr|=l,f)}function x0(l,f,g,x,b){var D=K.p;K.p=D!==0&&8>D?D:8;var G=k.T,q={};k.T=q,Th(l,!1,f,g);try{var ae=b(),Ee=k.S;if(Ee!==null&&Ee(q,ae),ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var Pe=qg(ae,x);Xc(l,f,Pe,$s(l))}else Xc(l,f,x,$s(l))}catch(Ke){Xc(l,f,{then:function(){},status:"rejected",reason:Ke},$s())}finally{K.p=D,G!==null&&q.types!==null&&(G.types=q.types),k.T=G}}function TE(){}function S0(l,f,g,x){if(l.tag!==5)throw Error(n(476));var b=r_(l).queue;x0(l,b,f,j,g===null?TE:function(){return A0(l),g(x)})}function r_(l){var f=l.memoizedState;if(f!==null)return f;f={memoizedState:j,baseState:j,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zo,lastRenderedState:j},next:null};var g={};return f.next={memoizedState:g,baseState:g,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zo,lastRenderedState:g},next:null},l.memoizedState=f,l=l.alternate,l!==null&&(l.memoizedState=f),f}function A0(l){var f=r_(l);f.next===null&&(f=l.alternate.memoizedState),Xc(l,f.next.queue,{},$s())}function E0(){return hs(N0)}function As(){return Bi().memoizedState}function T0(){return Bi().memoizedState}function bE(l){for(var f=l.return;f!==null;){switch(f.tag){case 24:case 3:var g=$s();l=mo(g);var x=Qo(f,l,g);x!==null&&(m(x,f,g),Yl(x,f,g)),f={cache:Kg()},l.payload=f;return}f=f.return}}function ME(l,f,g){var x=$s();g={lane:x,revertLane:0,gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},el(l)?Ku(f,g):(g=Fc(l,f,g,x),g!==null&&(m(g,l,x),lr(g,f,x)))}function a_(l,f,g){var x=$s();Xc(l,f,g,x)}function Xc(l,f,g,x){var b={lane:x,revertLane:0,gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null};if(el(l))Ku(f,b);else{var D=l.alternate;if(l.lanes===0&&(D===null||D.lanes===0)&&(D=f.lastRenderedReducer,D!==null))try{var G=f.lastRenderedState,q=D(G,g);if(b.hasEagerState=!0,b.eagerState=q,fi(q,G))return uh(l,f,b,0),Vn===null&&Pl(),!1}catch{}if(g=Fc(l,f,b,x),g!==null)return m(g,l,x),lr(g,f,x),!0}return!1}function Th(l,f,g,x){if(x={lane:2,revertLane:LE(),gesture:null,action:x,hasEagerState:!1,eagerState:null,next:null},el(l)){if(f)throw Error(n(479))}else f=Fc(l,g,x,2),f!==null&&m(f,l,2)}function el(l){var f=l.alternate;return l===qt||f!==null&&f===qt}function Ku(l,f){vo=yp=!0;var g=l.pending;g===null?f.next=f:(f.next=g.next,g.next=f),l.pending=f}function lr(l,f,g){if((g&4194048)!==0){var x=f.lanes;x&=l.pendingLanes,g|=x,f.lanes=g,xu(l,g)}}var bh={readContext:hs,use:xp,useCallback:Ei,useContext:Ei,useEffect:Ei,useImperativeHandle:Ei,useLayoutEffect:Ei,useInsertionEffect:Ei,useMemo:Ei,useReducer:Ei,useRef:Ei,useState:Ei,useDebugValue:Ei,useDeferredValue:Ei,useTransition:Ei,useSyncExternalStore:Ei,useId:Ei,useHostTransitionStatus:Ei,useFormState:Ei,useActionState:Ei,useOptimistic:Ei,useMemoCache:Ei,useCacheRefresh:Ei};bh.useEffectEvent=Ei;var o_={readContext:hs,use:xp,useCallback:function(l,f){return Js().memoizedState=[l,f===void 0?null:f],l},useContext:hs,useEffect:t_,useImperativeHandle:function(l,f,g){g=g!=null?g.concat([l]):null,bp(4194308,4,m0.bind(null,f,l),g)},useLayoutEffect:function(l,f){return bp(4194308,4,l,f)},useInsertionEffect:function(l,f){bp(4,2,l,f)},useMemo:function(l,f){var g=Js();f=f===void 0?null:f;var x=l();if(Vu){ft(!0);try{l()}finally{ft(!1)}}return g.memoizedState=[x,f],x},useReducer:function(l,f,g){var x=Js();if(g!==void 0){var b=g(f);if(Vu){ft(!0);try{g(f)}finally{ft(!1)}}}else b=f;return x.memoizedState=x.baseState=b,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:b},x.queue=l,l=l.dispatch=ME.bind(null,qt,l),[x.memoizedState,l]},useRef:function(l){var f=Js();return l={current:l},f.memoizedState=l},useState:function(l){l=Eh(l);var f=l.queue,g=a_.bind(null,qt,f);return f.dispatch=g,[l.memoizedState,g]},useDebugValue:Rp,useDeferredValue:function(l,f){var g=Js();return y0(g,l,f)},useTransition:function(){var l=Eh(!1);return l=x0.bind(null,qt,l.queue,!0,!1),Js().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,f,g){var x=qt,b=Js();if(xn){if(g===void 0)throw Error(n(407));g=g()}else{if(g=f(),Vn===null)throw Error(n(349));(yn&127)!==0||Ky(x,f,g)}b.memoizedState=g;var D={value:g,getSnapshot:f};return b.queue=D,t_(f0.bind(null,x,D,l),[l]),x.flags|=2048,Yc(9,{destroy:void 0},c0.bind(null,x,D,g,f),null),g},useId:function(){var l=Js(),f=Vn.identifierPrefix;if(xn){var g=ho,x=fo;g=(x&~(1<<32-ht(x)-1)).toString(32)+g,f="_"+f+"R_"+g,g=_p++,0<g&&(f+="H"+g.toString(32)),f+="_"}else g=xE++,f="_"+f+"r_"+g.toString(32)+"_";return l.memoizedState=f},useHostTransitionStatus:E0,useFormState:Jy,useActionState:Jy,useOptimistic:function(l){var f=Js();f.memoizedState=f.baseState=l;var g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=g,f=Th.bind(null,qt,!0,g),g.dispatch=f,[l,f]},useMemoCache:o0,useCacheRefresh:function(){return Js().memoizedState=bE.bind(null,qt)},useEffectEvent:function(l){var f=Js(),g={impl:l};return f.memoizedState=g,function(){if((En&2)!==0)throw Error(n(440));return g.impl.apply(void 0,arguments)}}},qc={readContext:hs,use:xp,useCallback:g0,useContext:hs,useEffect:p0,useImperativeHandle:Cp,useInsertionEffect:s_,useLayoutEffect:Pr,useMemo:v0,useReducer:Sp,useRef:e_,useState:function(){return Sp(Zo)},useDebugValue:Rp,useDeferredValue:function(l,f){var g=Bi();return _0(g,jn.memoizedState,l,f)},useTransition:function(){var l=Sp(Zo)[0],f=Bi().memoizedState;return[typeof l=="boolean"?l:Ah(l),f]},useSyncExternalStore:u0,useId:As,useHostTransitionStatus:E0,useFormState:Qy,useActionState:Qy,useOptimistic:function(l,f){var g=Bi();return Yy(g,jn,l,f)},useMemoCache:o0,useCacheRefresh:T0};qc.useEffectEvent=i_;var Mh={readContext:hs,use:xp,useCallback:g0,useContext:hs,useEffect:p0,useImperativeHandle:Cp,useInsertionEffect:s_,useLayoutEffect:Pr,useMemo:v0,useReducer:Ap,useRef:e_,useState:function(){return Ap(Zo)},useDebugValue:Rp,useDeferredValue:function(l,f){var g=Bi();return jn===null?y0(g,l,f):_0(g,jn.memoizedState,l,f)},useTransition:function(){var l=Ap(Zo)[0],f=Bi().memoizedState;return[typeof l=="boolean"?l:Ah(l),f]},useSyncExternalStore:u0,useId:As,useHostTransitionStatus:E0,useFormState:Zy,useActionState:Zy,useOptimistic:function(l,f){var g=Bi();return jn!==null?Yy(g,jn,l,f):(g.baseState=l,[l,g.queue.dispatch])},useMemoCache:o0,useCacheRefresh:T0};Mh.useEffectEvent=i_;function Wc(l,f,g,x){f=l.memoizedState,g=g(x,f),g=g==null?f:p({},f,g),l.memoizedState=g,l.lanes===0&&(l.updateQueue.baseState=g)}var Ch={enqueueSetState:function(l,f,g){l=l._reactInternals;var x=$s(),b=mo(x);b.payload=f,g!=null&&(b.callback=g),f=Qo(l,b,x),f!==null&&(m(f,l,x),Yl(f,l,x))},enqueueReplaceState:function(l,f,g){l=l._reactInternals;var x=$s(),b=mo(x);b.tag=1,b.payload=f,g!=null&&(b.callback=g),f=Qo(l,b,x),f!==null&&(m(f,l,x),Yl(f,l,x))},enqueueForceUpdate:function(l,f){l=l._reactInternals;var g=$s(),x=mo(g);x.tag=2,f!=null&&(x.callback=f),f=Qo(l,x,g),f!==null&&(m(f,l,g),Yl(f,l,g))}};function l_(l,f,g,x,b,D,G){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(x,D,G):f.prototype&&f.prototype.isPureReactComponent?!wc(g,x)||!wc(b,D):!0}function u_(l,f,g,x){l=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(g,x),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(g,x),f.state!==l&&Ch.enqueueReplaceState(f,f.state,null)}function Es(l,f){var g=f;if("ref"in f){g={};for(var x in f)x!=="ref"&&(g[x]=f[x])}if(l=l.defaultProps){g===f&&(g=p({},g));for(var b in l)g[b]===void 0&&(g[b]=l[b])}return g}function b0(l){Ol(l)}function c_(l){console.error(l)}function Dp(l){Ol(l)}function Lp(l,f){try{var g=l.onUncaughtError;g(f.value,{componentStack:f.stack})}catch(x){setTimeout(function(){throw x})}}function f_(l,f,g){try{var x=l.onCaughtError;x(g.value,{componentStack:g.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function M0(l,f,g){return g=mo(g),g.tag=3,g.payload={element:null},g.callback=function(){Lp(l,f)},g}function jc(l){return l=mo(l),l.tag=3,l}function ur(l,f,g,x){var b=g.type.getDerivedStateFromError;if(typeof b=="function"){var D=x.value;l.payload=function(){return b(D)},l.callback=function(){f_(f,g,x)}}var G=g.stateNode;G!==null&&typeof G.componentDidCatch=="function"&&(l.callback=function(){f_(f,g,x),typeof b!="function"&&(Eo===null?Eo=new Set([this]):Eo.add(this));var q=x.stack;this.componentDidCatch(x.value,{componentStack:q!==null?q:""})})}function Nr(l,f,g,x,b){if(g.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){if(f=g.alternate,f!==null&&kl(f,g,b,!0),g=es.current,g!==null){switch(g.tag){case 31:case 13:return oa===null?$t():g.alternate===null&&Kn===0&&(Kn=3),g.flags&=-257,g.flags|=65536,g.lanes=b,x===gh?g.flags|=16384:(f=g.updateQueue,f===null?g.updateQueue=new Set([x]):f.add(x),CE(l,x,b)),!1;case 22:return g.flags|=65536,x===gh?g.flags|=16384:(f=g.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([x])},g.updateQueue=f):(g=f.retryQueue,g===null?f.retryQueue=new Set([x]):g.add(x)),CE(l,x,b)),!1}throw Error(n(435,g.tag))}return CE(l,x,b),$t(),!1}if(xn)return f=es.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=b,x!==cp&&(l=Error(n(422),{cause:x}),dh(rr(l,g)))):(x!==cp&&(f=Error(n(423),{cause:x}),dh(rr(f,g))),l=l.current.alternate,l.flags|=65536,b&=-b,l.lanes|=b,x=rr(x,g),b=M0(l.stateNode,x,b),gp(l,b),Kn!==4&&(Kn=2)),!1;var D=Error(n(520),{cause:x});if(D=rr(D,g),Ua===null?Ua=[D]:Ua.push(D),Kn!==4&&(Kn=2),f===null)return!0;x=rr(x,g),g=f;do{switch(g.tag){case 3:return g.flags|=65536,l=b&-b,g.lanes|=l,l=M0(g.stateNode,x,l),gp(g,l),!1;case 1:if(f=g.type,D=g.stateNode,(g.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(Eo===null||!Eo.has(D))))return g.flags|=65536,b&=-b,g.lanes|=b,b=jc(b),ur(b,l,g,x),gp(g,b),!1}g=g.return}while(g!==null);return!1}var Ip=Error(n(461)),hi=!1;function Ti(l,f,g,x){f.child=l===null?Gy(f,null,g,x):Hu(f,l.child,g,x)}function Rh(l,f,g,x,b){g=g.render;var D=f.ref;if("ref"in x){var G={};for(var q in x)q!=="ref"&&(G[q]=x[q])}else G=x;return Fu(f),x=i0(l,f,g,G,D,b),q=s0(),l!==null&&!hi?(r0(l,f,b),Pa(l,f,b)):(xn&&q&&up(f),f.flags|=1,Ti(l,f,x,b),f.child)}function Dh(l,f,g,x,b){if(l===null){var D=g.type;return typeof D=="function"&&!Ws(D)&&D.defaultProps===void 0&&g.compare===null?(f.tag=15,f.type=D,Ur(l,f,D,x,b)):(l=ch(g.type,null,x,f,f.mode,b),l.ref=f.ref,l.return=f,f.child=l)}if(D=l.child,!Wl(l,b)){var G=D.memoizedProps;if(g=g.compare,g=g!==null?g:wc,g(G,x)&&l.ref===f.ref)return Pa(l,f,b)}return f.flags|=1,l=uo(D,x),l.ref=f.ref,l.return=f,f.child=l}function Ur(l,f,g,x,b){if(l!==null){var D=l.memoizedProps;if(wc(D,x)&&l.ref===f.ref)if(hi=!1,f.pendingProps=x=D,Wl(l,b))(l.flags&131072)!==0&&(hi=!0);else return f.lanes=l.lanes,Pa(l,f,b)}return Jc(l,f,g,x,b)}function Fr(l,f,g,x){var b=x.children,D=l!==null?l.memoizedState:null;if(l===null&&f.stateNode===null&&(f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),x.mode==="hidden"){if((f.flags&128)!==0){if(D=D!==null?D.baseLanes|g:g,l!==null){for(x=f.child=l.child,b=0;x!==null;)b=b|x.lanes|x.childLanes,x=x.sibling;x=b&~D}else x=0,f.child=null;return _o(l,f,D,g,x)}if((g&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},l!==null&&Vc(f,D!==null?D.cachePool:null),D!==null?Zg(f,D):e0(),Hy(f);else return x=f.lanes=536870912,_o(l,f,D!==null?D.baseLanes|g:g,g,x)}else D!==null?(Vc(f,D.cachePool),Zg(f,D),$o(),f.memoizedState=null):(l!==null&&Vc(f,null),e0(),$o());return Ti(l,f,b,g),f.child}function Ba(l,f){return l!==null&&l.tag===22||f.stateNode!==null||(f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.sibling}function _o(l,f,g,x,b){var D=po();return D=D===null?null:{parent:Ot._currentValue,pool:D},f.memoizedState={baseLanes:g,cachePool:D},l!==null&&Vc(f,null),e0(),Hy(f),l!==null&&kl(l,f,x,!0),f.childLanes=b,null}function la(l,f){return f=Qc({mode:f.mode,children:f.children},l.mode),f.ref=l.ref,l.child=f,f.return=l,f}function ds(l,f,g){return Hu(f,l.child,null,g),l=la(f,f.pendingProps),l.flags|=2,Or(f),f.memoizedState=null,l}function Lh(l,f,g){var x=f.pendingProps,b=(f.flags&128)!==0;if(f.flags&=-129,l===null){if(xn){if(x.mode==="hidden")return l=la(f,x),f.lanes=536870912,Ba(null,l);if(t0(f),(l=si)?(l=pR(l,fs),l=l!==null&&l.data==="&"?l:null,l!==null&&(f.memoizedState={dehydrated:l,treeContext:co!==null?{id:fo,overflow:ho}:null,retryLane:536870912,hydrationErrors:null},g=Oy(l),g.return=f,f.child=g,cs=f,si=null)):l=null,l===null)throw vn(f);return f.lanes=536870912,null}return la(f,x)}var D=l.memoizedState;if(D!==null){var G=D.dehydrated;if(t0(f),b)if(f.flags&256)f.flags&=-257,f=ds(l,f,g);else if(f.memoizedState!==null)f.child=l.child,f.flags|=128,f=null;else throw Error(n(558));else if(hi||kl(l,f,g,!1),b=(g&l.childLanes)!==0,hi||b){if(x=Vn,x!==null&&(G=Al(x,g),G!==0&&G!==D.retryLane))throw D.retryLane=G,Nl(l,G),m(x,l,G),Ip;$t(),f=ds(l,f,g)}else l=D.treeContext,si=To(G.nextSibling),cs=f,xn=!0,Xo=null,fs=!1,l!==null&&hh(f,l),f=la(f,x),f.flags|=4096;return f}return l=uo(l.child,{mode:x.mode,children:x.children}),l.ref=f.ref,f.child=l,l.return=f,l}function Oa(l,f){var g=f.ref;if(g===null)l!==null&&l.ref!==null&&(f.flags|=4194816);else{if(typeof g!="function"&&typeof g!="object")throw Error(n(284));(l===null||l.ref!==g)&&(f.flags|=4194816)}}function Jc(l,f,g,x,b){return Fu(f),g=i0(l,f,g,x,void 0,b),x=s0(),l!==null&&!hi?(r0(l,f,b),Pa(l,f,b)):(xn&&x&&up(f),f.flags|=1,Ti(l,f,g,b),f.child)}function Ns(l,f,g,x,b,D){return Fu(f),f.updateQueue=null,g=Vy(f,x,g,b),zy(l),x=s0(),l!==null&&!hi?(r0(l,f,D),Pa(l,f,D)):(xn&&x&&up(f),f.flags|=1,Ti(l,f,g,D),f.child)}function Ts(l,f,g,x,b){if(Fu(f),f.stateNode===null){var D=Ul,G=g.contextType;typeof G=="object"&&G!==null&&(D=hs(G)),D=new g(x,D),f.memoizedState=D.state!==null&&D.state!==void 0?D.state:null,D.updater=Ch,f.stateNode=D,D._reactInternals=f,D=f.stateNode,D.props=x,D.state=f.memoizedState,D.refs={},Jg(f),G=g.contextType,D.context=typeof G=="object"&&G!==null?hs(G):Ul,D.state=f.memoizedState,G=g.getDerivedStateFromProps,typeof G=="function"&&(Wc(f,g,G,x),D.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof D.getSnapshotBeforeUpdate=="function"||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(G=D.state,typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount(),G!==D.state&&Ch.enqueueReplaceState(D,D.state,null),zu(f,x,D,b),_h(),D.state=f.memoizedState),typeof D.componentDidMount=="function"&&(f.flags|=4194308),x=!0}else if(l===null){D=f.stateNode;var q=f.memoizedProps,ae=Es(g,q);D.props=ae;var Ee=D.context,Pe=g.contextType;G=Ul,typeof Pe=="object"&&Pe!==null&&(G=hs(Pe));var Ke=g.getDerivedStateFromProps;Pe=typeof Ke=="function"||typeof D.getSnapshotBeforeUpdate=="function",q=f.pendingProps!==q,Pe||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(q||Ee!==G)&&u_(f,D,x,G),Kl=!1;var Re=f.memoizedState;D.state=Re,zu(f,x,D,b),_h(),Ee=f.memoizedState,q||Re!==Ee||Kl?(typeof Ke=="function"&&(Wc(f,g,Ke,x),Ee=f.memoizedState),(ae=Kl||l_(f,g,ae,x,Re,Ee,G))?(Pe||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount()),typeof D.componentDidMount=="function"&&(f.flags|=4194308)):(typeof D.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=x,f.memoizedState=Ee),D.props=x,D.state=Ee,D.context=G,x=ae):(typeof D.componentDidMount=="function"&&(f.flags|=4194308),x=!1)}else{D=f.stateNode,Qg(l,f),G=f.memoizedProps,Pe=Es(g,G),D.props=Pe,Ke=f.pendingProps,Re=D.context,Ee=g.contextType,ae=Ul,typeof Ee=="object"&&Ee!==null&&(ae=hs(Ee)),q=g.getDerivedStateFromProps,(Ee=typeof q=="function"||typeof D.getSnapshotBeforeUpdate=="function")||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(G!==Ke||Re!==ae)&&u_(f,D,x,ae),Kl=!1,Re=f.memoizedState,D.state=Re,zu(f,x,D,b),_h();var Be=f.memoizedState;G!==Ke||Re!==Be||Kl||l!==null&&l.dependencies!==null&&Hc(l.dependencies)?(typeof q=="function"&&(Wc(f,g,q,x),Be=f.memoizedState),(Pe=Kl||l_(f,g,Pe,x,Re,Be,ae)||l!==null&&l.dependencies!==null&&Hc(l.dependencies))?(Ee||typeof D.UNSAFE_componentWillUpdate!="function"&&typeof D.componentWillUpdate!="function"||(typeof D.componentWillUpdate=="function"&&D.componentWillUpdate(x,Be,ae),typeof D.UNSAFE_componentWillUpdate=="function"&&D.UNSAFE_componentWillUpdate(x,Be,ae)),typeof D.componentDidUpdate=="function"&&(f.flags|=4),typeof D.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof D.componentDidUpdate!="function"||G===l.memoizedProps&&Re===l.memoizedState||(f.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||G===l.memoizedProps&&Re===l.memoizedState||(f.flags|=1024),f.memoizedProps=x,f.memoizedState=Be),D.props=x,D.state=Be,D.context=ae,x=Pe):(typeof D.componentDidUpdate!="function"||G===l.memoizedProps&&Re===l.memoizedState||(f.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||G===l.memoizedProps&&Re===l.memoizedState||(f.flags|=1024),x=!1)}return D=x,Oa(l,f),x=(f.flags&128)!==0,D||x?(D=f.stateNode,g=x&&typeof g.getDerivedStateFromError!="function"?null:D.render(),f.flags|=1,l!==null&&x?(f.child=Hu(f,l.child,null,b),f.child=Hu(f,null,g,b)):Ti(l,f,g,b),f.memoizedState=D.state,l=f.child):l=Pa(l,f,b),l}function Rn(l,f,g,x){return Uu(),f.flags|=256,Ti(l,f,g,x),f.child}var kr={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ua(l){return{baseLanes:l,cachePool:dp()}}function Ih(l,f,g){return l=l!==null?l.childLanes&~g:0,f&&(l|=Tn),l}function Gr(l,f,g){var x=f.pendingProps,b=!1,D=(f.flags&128)!==0,G;if((G=D)||(G=l!==null&&l.memoizedState===null?!1:(Ai.current&2)!==0),G&&(b=!0,f.flags&=-129),G=(f.flags&32)!==0,f.flags&=-33,l===null){if(xn){if(b?Xl(f):$o(),(l=si)?(l=pR(l,fs),l=l!==null&&l.data!=="&"?l:null,l!==null&&(f.memoizedState={dehydrated:l,treeContext:co!==null?{id:fo,overflow:ho}:null,retryLane:536870912,hydrationErrors:null},g=Oy(l),g.return=f,f.child=g,cs=f,si=null)):l=null,l===null)throw vn(f);return VE(l)?f.lanes=32:f.lanes=536870912,null}var q=x.children;return x=x.fallback,b?($o(),b=f.mode,q=Qc({mode:"hidden",children:q},b),x=Ko(x,b,g,null),q.return=f,x.return=f,q.sibling=x,f.child=q,x=f.child,x.memoizedState=ua(g),x.childLanes=Ih(l,G,g),f.memoizedState=kr,Ba(null,x)):(Xl(f),ql(f,q))}var ae=l.memoizedState;if(ae!==null&&(q=ae.dehydrated,q!==null)){if(D)f.flags&256?(Xl(f),f.flags&=-257,f=$c(l,f,g)):f.memoizedState!==null?($o(),f.child=l.child,f.flags|=128,f=null):($o(),q=x.fallback,b=f.mode,x=Qc({mode:"visible",children:x.children},b),q=Ko(q,b,g,null),q.flags|=2,x.return=f,q.return=f,x.sibling=q,f.child=x,Hu(f,l.child,null,g),x=f.child,x.memoizedState=ua(g),x.childLanes=Ih(l,G,g),f.memoizedState=kr,f=Ba(null,x));else if(Xl(f),VE(q)){if(G=q.nextSibling&&q.nextSibling.dataset,G)var Ee=G.dgst;G=Ee,x=Error(n(419)),x.stack="",x.digest=G,dh({value:x,source:null,stack:null}),f=$c(l,f,g)}else if(hi||kl(l,f,g,!1),G=(g&l.childLanes)!==0,hi||G){if(G=Vn,G!==null&&(x=Al(G,g),x!==0&&x!==ae.retryLane))throw ae.retryLane=x,Nl(l,x),m(G,l,x),Ip;zE(q)||$t(),f=$c(l,f,g)}else zE(q)?(f.flags|=192,f.child=l.child,f=null):(l=ae.treeContext,si=To(q.nextSibling),cs=f,xn=!0,Xo=null,fs=!1,l!==null&&hh(f,l),f=ql(f,x.children),f.flags|=4096);return f}return b?($o(),q=x.fallback,b=f.mode,ae=l.child,Ee=ae.sibling,x=uo(ae,{mode:"hidden",children:x.children}),x.subtreeFlags=ae.subtreeFlags&65011712,Ee!==null?q=uo(Ee,q):(q=Ko(q,b,g,null),q.flags|=2),q.return=f,x.return=f,x.sibling=q,f.child=x,Ba(null,x),x=f.child,q=l.child.memoizedState,q===null?q=ua(g):(b=q.cachePool,b!==null?(ae=Ot._currentValue,b=b.parent!==ae?{parent:ae,pool:ae}:b):b=dp(),q={baseLanes:q.baseLanes|g,cachePool:b}),x.memoizedState=q,x.childLanes=Ih(l,G,g),f.memoizedState=kr,Ba(l.child,x)):(Xl(f),g=l.child,l=g.sibling,g=uo(g,{mode:"visible",children:x.children}),g.return=f,g.sibling=null,l!==null&&(G=f.deletions,G===null?(f.deletions=[l],f.flags|=16):G.push(l)),f.child=g,f.memoizedState=null,g)}function ql(l,f){return f=Qc({mode:"visible",children:f},l.mode),f.return=l,l.child=f}function Qc(l,f){return l=qs(22,l,null,f),l.lanes=0,l}function $c(l,f,g){return Hu(f,l.child,null,g),l=ql(f,f.pendingProps.children),l.flags|=2,f.memoizedState=null,l}function Yu(l,f,g){l.lanes|=f;var x=l.alternate;x!==null&&(x.lanes|=f),jo(l.return,f,g)}function wh(l,f,g,x,b,D){var G=l.memoizedState;G===null?l.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:x,tail:g,tailMode:b,treeForkCount:D}:(G.isBackwards=f,G.rendering=null,G.renderingStartTime=0,G.last=x,G.tail=g,G.tailMode=b,G.treeForkCount=D)}function Bh(l,f,g){var x=f.pendingProps,b=x.revealOrder,D=x.tail;x=x.children;var G=Ai.current,q=(G&2)!==0;if(q?(G=G&1|2,f.flags|=128):G&=1,le(Ai,G),Ti(l,f,x,g),x=xn?Gc:0,!q&&l!==null&&(l.flags&128)!==0)e:for(l=f.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&Yu(l,g,f);else if(l.tag===19)Yu(l,g,f);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===f)break e;for(;l.sibling===null;){if(l.return===null||l.return===f)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}switch(b){case"forwards":for(g=f.child,b=null;g!==null;)l=g.alternate,l!==null&&vp(l)===null&&(b=g),g=g.sibling;g=b,g===null?(b=f.child,f.child=null):(b=g.sibling,g.sibling=null),wh(f,!1,b,g,D,x);break;case"backwards":case"unstable_legacy-backwards":for(g=null,b=f.child,f.child=null;b!==null;){if(l=b.alternate,l!==null&&vp(l)===null){f.child=b;break}l=b.sibling,b.sibling=g,g=b,b=l}wh(f,!0,g,null,D,x);break;case"together":wh(f,!1,null,null,void 0,x);break;default:f.memoizedState=null}return f.child}function Pa(l,f,g){if(l!==null&&(f.dependencies=l.dependencies),Vr|=f.lanes,(g&f.childLanes)===0)if(l!==null){if(kl(l,f,g,!1),(g&f.childLanes)===0)return null}else return null;if(l!==null&&f.child!==l.child)throw Error(n(153));if(f.child!==null){for(l=f.child,g=uo(l,l.pendingProps),f.child=g,g.return=f;l.sibling!==null;)l=l.sibling,g=g.sibling=uo(l,l.pendingProps),g.return=f;g.sibling=null}return f.child}function Wl(l,f){return(l.lanes&f)!==0?!0:(l=l.dependencies,!!(l!==null&&Hc(l)))}function Oh(l,f,g){switch(f.tag){case 3:Xe(f,f.stateNode.containerInfo),Wo(f,Ot,l.memoizedState.cache),Uu();break;case 27:case 5:at(f);break;case 4:Xe(f,f.stateNode.containerInfo);break;case 10:Wo(f,f.type,f.memoizedProps.value);break;case 31:if(f.memoizedState!==null)return f.flags|=128,t0(f),null;break;case 13:var x=f.memoizedState;if(x!==null)return x.dehydrated!==null?(Xl(f),f.flags|=128,null):(g&f.child.childLanes)!==0?Gr(l,f,g):(Xl(f),l=Pa(l,f,g),l!==null?l.sibling:null);Xl(f);break;case 19:var b=(l.flags&128)!==0;if(x=(g&f.childLanes)!==0,x||(kl(l,f,g,!1),x=(g&f.childLanes)!==0),b){if(x)return Bh(l,f,g);f.flags|=128}if(b=f.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),le(Ai,Ai.current),x)break;return null;case 22:return f.lanes=0,Fr(l,f,g,f.pendingProps);case 24:Wo(f,Ot,l.memoizedState.cache)}return Pa(l,f,g)}function wp(l,f,g){if(l!==null)if(l.memoizedProps!==f.pendingProps)hi=!0;else{if(!Wl(l,g)&&(f.flags&128)===0)return hi=!1,Oh(l,f,g);hi=(l.flags&131072)!==0}else hi=!1,xn&&(f.flags&1048576)!==0&&kg(f,Gc,f.index);switch(f.lanes=0,f.tag){case 16:e:{var x=f.pendingProps;if(l=Gu(f.elementType),f.type=l,typeof l=="function")Ws(l)?(x=Es(l,x),f.tag=1,f=Ts(null,f,l,x,g)):(f.tag=0,f=Jc(null,f,l,x,g));else{if(l!=null){var b=l.$$typeof;if(b===L){f.tag=11,f=Rh(null,f,l,x,g);break e}else if(b===O){f.tag=14,f=Dh(null,f,l,x,g);break e}}throw f=ie(l)||l,Error(n(306,f,""))}}return f;case 0:return Jc(l,f,f.type,f.pendingProps,g);case 1:return x=f.type,b=Es(x,f.pendingProps),Ts(l,f,x,b,g);case 3:e:{if(Xe(f,f.stateNode.containerInfo),l===null)throw Error(n(387));x=f.pendingProps;var D=f.memoizedState;b=D.element,Qg(l,f),zu(f,x,null,g);var G=f.memoizedState;if(x=G.cache,Wo(f,Ot,x),x!==D.cache&&hp(f,[Ot],g,!0),_h(),x=G.element,D.isDehydrated)if(D={element:x,isDehydrated:!1,cache:G.cache},f.updateQueue.baseState=D,f.memoizedState=D,f.flags&256){f=Rn(l,f,x,g);break e}else if(x!==b){b=rr(Error(n(424)),f),dh(b),f=Rn(l,f,x,g);break e}else{switch(l=f.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for(si=To(l.firstChild),cs=f,xn=!0,Xo=null,fs=!0,g=Gy(f,null,x,g),f.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling}else{if(Uu(),x===b){f=Pa(l,f,g);break e}Ti(l,f,x,g)}f=f.child}return f;case 26:return Oa(l,f),l===null?(g=xR(f.type,null,f.pendingProps,null))?f.memoizedState=g:xn||(g=f.type,l=f.pendingProps,x=__(ce.current).createElement(g),x[ln]=f,x[Zi]=l,Zs(x,g,l),X(x),f.stateNode=x):f.memoizedState=xR(f.type,l.memoizedProps,f.pendingProps,l.memoizedState),null;case 27:return at(f),l===null&&xn&&(x=f.stateNode=vR(f.type,f.pendingProps,ce.current),cs=f,fs=!0,b=si,af(f.type)?(KE=b,si=To(x.firstChild)):si=b),Ti(l,f,f.pendingProps.children,g),Oa(l,f),l===null&&(f.flags|=4194304),f.child;case 5:return l===null&&xn&&((b=x=si)&&(x=ZP(x,f.type,f.pendingProps,fs),x!==null?(f.stateNode=x,cs=f,si=To(x.firstChild),fs=!1,b=!0):b=!1),b||vn(f)),at(f),b=f.type,D=f.pendingProps,G=l!==null?l.memoizedProps:null,x=D.children,kE(b,D)?x=null:G!==null&&kE(b,G)&&(f.flags|=32),f.memoizedState!==null&&(b=i0(l,f,SE,null,null,g),N0._currentValue=b),Oa(l,f),Ti(l,f,x,g),f.child;case 6:return l===null&&xn&&((l=g=si)&&(g=eN(g,f.pendingProps,fs),g!==null?(f.stateNode=g,cs=f,si=null,l=!0):l=!1),l||vn(f)),null;case 13:return Gr(l,f,g);case 4:return Xe(f,f.stateNode.containerInfo),x=f.pendingProps,l===null?f.child=Hu(f,null,x,g):Ti(l,f,x,g),f.child;case 11:return Rh(l,f,f.type,f.pendingProps,g);case 7:return Ti(l,f,f.pendingProps,g),f.child;case 8:return Ti(l,f,f.pendingProps.children,g),f.child;case 12:return Ti(l,f,f.pendingProps.children,g),f.child;case 10:return x=f.pendingProps,Wo(f,f.type,x.value),Ti(l,f,x.children,g),f.child;case 9:return b=f.type._context,x=f.pendingProps.children,Fu(f),b=hs(b),x=x(b),f.flags|=1,Ti(l,f,x,g),f.child;case 14:return Dh(l,f,f.type,f.pendingProps,g);case 15:return Ur(l,f,f.type,f.pendingProps,g);case 19:return Bh(l,f,g);case 31:return Lh(l,f,g);case 22:return Fr(l,f,g,f.pendingProps);case 24:return Fu(f),x=hs(Ot),l===null?(b=po(),b===null&&(b=Vn,D=Kg(),b.pooledCache=D,D.refCount++,D!==null&&(b.pooledCacheLanes|=g),b=D),f.memoizedState={parent:x,cache:b},Jg(f),Wo(f,Ot,b)):((l.lanes&g)!==0&&(Qg(l,f),zu(f,null,null,g),_h()),b=l.memoizedState,D=f.memoizedState,b.parent!==x?(b={parent:x,cache:x},f.memoizedState=b,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=b),Wo(f,Ot,x)):(x=D.cache,Wo(f,Ot,x),x!==b.cache&&hp(f,[Ot],g,!0))),Ti(l,f,f.pendingProps.children,g),f.child;case 29:throw f.pendingProps}throw Error(n(156,f.tag))}function cr(l){l.flags|=4}function jl(l,f,g,x,b){if((f=(l.mode&32)!==0)&&(f=!1),f){if(l.flags|=16777216,(b&335544128)===b)if(l.stateNode.complete)l.flags|=8192;else if(tt())l.flags|=8192;else throw Kt=gh,mh}else l.flags&=-16777217}function tl(l,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!bR(f))if(tt())l.flags|=8192;else throw Kt=gh,mh}function Zc(l,f){f!==null&&(l.flags|=4),l.flags&16384&&(f=l.tag!==22?Cn():536870912,l.lanes|=f,Kr|=f)}function Ph(l,f){if(!xn)switch(l.tailMode){case"hidden":f=l.tail;for(var g=null;f!==null;)f.alternate!==null&&(g=f),f=f.sibling;g===null?l.tail=null:g.sibling=null;break;case"collapsed":g=l.tail;for(var x=null;g!==null;)g.alternate!==null&&(x=g),g=g.sibling;x===null?f||l.tail===null?l.tail=null:l.tail.sibling=null:x.sibling=null}}function Wn(l){var f=l.alternate!==null&&l.alternate.child===l.child,g=0,x=0;if(f)for(var b=l.child;b!==null;)g|=b.lanes|b.childLanes,x|=b.subtreeFlags&65011712,x|=b.flags&65011712,b.return=l,b=b.sibling;else for(b=l.child;b!==null;)g|=b.lanes|b.childLanes,x|=b.subtreeFlags,x|=b.flags,b.return=l,b=b.sibling;return l.subtreeFlags|=x,l.childLanes=g,f}function C0(l,f,g){var x=f.pendingProps;switch(Fl(f),f.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wn(f),null;case 1:return Wn(f),null;case 3:return g=f.stateNode,x=null,l!==null&&(x=l.memoizedState.cache),f.memoizedState.cache!==x&&(f.flags|=2048),aa(Ot),nt(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(l===null||l.child===null)&&(Nu(f)?cr(f):l===null||l.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,Gg())),Wn(f),null;case 26:var b=f.type,D=f.memoizedState;return l===null?(cr(f),D!==null?(Wn(f),tl(f,D)):(Wn(f),jl(f,b,null,x,g))):D?D!==l.memoizedState?(cr(f),Wn(f),tl(f,D)):(Wn(f),f.flags&=-16777217):(l=l.memoizedProps,l!==x&&cr(f),Wn(f),jl(f,b,l,x,g)),null;case 27:if(Vt(f),g=ce.current,b=f.type,l!==null&&f.stateNode!=null)l.memoizedProps!==x&&cr(f);else{if(!x){if(f.stateNode===null)throw Error(n(166));return Wn(f),null}l=pe.current,Nu(f)?fp(f):(l=vR(b,x,g),f.stateNode=l,cr(f))}return Wn(f),null;case 5:if(Vt(f),b=f.type,l!==null&&f.stateNode!=null)l.memoizedProps!==x&&cr(f);else{if(!x){if(f.stateNode===null)throw Error(n(166));return Wn(f),null}if(D=pe.current,Nu(f))fp(f);else{var G=__(ce.current);switch(D){case 1:D=G.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:D=G.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":D=G.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":D=G.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":D=G.createElement("div"),D.innerHTML="<script><\/script>",D=D.removeChild(D.firstChild);break;case"select":D=typeof x.is=="string"?G.createElement("select",{is:x.is}):G.createElement("select"),x.multiple?D.multiple=!0:x.size&&(D.size=x.size);break;default:D=typeof x.is=="string"?G.createElement(b,{is:x.is}):G.createElement(b)}}D[ln]=f,D[Zi]=x;e:for(G=f.child;G!==null;){if(G.tag===5||G.tag===6)D.appendChild(G.stateNode);else if(G.tag!==4&&G.tag!==27&&G.child!==null){G.child.return=G,G=G.child;continue}if(G===f)break e;for(;G.sibling===null;){if(G.return===null||G.return===f)break e;G=G.return}G.sibling.return=G.return,G=G.sibling}f.stateNode=D;e:switch(Zs(D,b,x),b){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}x&&cr(f)}}return Wn(f),jl(f,f.type,l===null?null:l.memoizedProps,f.pendingProps,g),null;case 6:if(l&&f.stateNode!=null)l.memoizedProps!==x&&cr(f);else{if(typeof x!="string"&&f.stateNode===null)throw Error(n(166));if(l=ce.current,Nu(f)){if(l=f.stateNode,g=f.memoizedProps,x=null,b=cs,b!==null)switch(b.tag){case 27:case 5:x=b.memoizedProps}l[ln]=f,l=!!(l.nodeValue===g||x!==null&&x.suppressHydrationWarning===!0||aR(l.nodeValue,g)),l||vn(f,!0)}else l=__(l).createTextNode(x),l[ln]=f,f.stateNode=l}return Wn(f),null;case 31:if(g=f.memoizedState,l===null||l.memoizedState!==null){if(x=Nu(f),g!==null){if(l===null){if(!x)throw Error(n(318));if(l=f.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(n(557));l[ln]=f}else Uu(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Wn(f),l=!1}else g=Gg(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=g),l=!0;if(!l)return f.flags&256?(Or(f),f):(Or(f),null);if((f.flags&128)!==0)throw Error(n(558))}return Wn(f),null;case 13:if(x=f.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(b=Nu(f),x!==null&&x.dehydrated!==null){if(l===null){if(!b)throw Error(n(318));if(b=f.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(n(317));b[ln]=f}else Uu(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Wn(f),b=!1}else b=Gg(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=b),b=!0;if(!b)return f.flags&256?(Or(f),f):(Or(f),null)}return Or(f),(f.flags&128)!==0?(f.lanes=g,f):(g=x!==null,l=l!==null&&l.memoizedState!==null,g&&(x=f.child,b=null,x.alternate!==null&&x.alternate.memoizedState!==null&&x.alternate.memoizedState.cachePool!==null&&(b=x.alternate.memoizedState.cachePool.pool),D=null,x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(D=x.memoizedState.cachePool.pool),D!==b&&(x.flags|=2048)),g!==l&&g&&(f.child.flags|=8192),Zc(f,f.updateQueue),Wn(f),null);case 4:return nt(),l===null&&OE(f.stateNode.containerInfo),Wn(f),null;case 10:return aa(f.type),Wn(f),null;case 19:if(Z(Ai),x=f.memoizedState,x===null)return Wn(f),null;if(b=(f.flags&128)!==0,D=x.rendering,D===null)if(b)Ph(x,!1);else{if(Kn!==0||l!==null&&(l.flags&128)!==0)for(l=f.child;l!==null;){if(D=vp(l),D!==null){for(f.flags|=128,Ph(x,!1),l=D.updateQueue,f.updateQueue=l,Zc(f,l),f.subtreeFlags=0,l=g,g=f.child;g!==null;)Bs(g,l),g=g.sibling;return le(Ai,Ai.current&1|2),xn&&Yo(f,x.treeForkCount),f.child}l=l.sibling}x.tail!==null&&z()>Yr&&(f.flags|=128,b=!0,Ph(x,!1),f.lanes=4194304)}else{if(!b)if(l=vp(D),l!==null){if(f.flags|=128,b=!0,l=l.updateQueue,f.updateQueue=l,Zc(f,l),Ph(x,!0),x.tail===null&&x.tailMode==="hidden"&&!D.alternate&&!xn)return Wn(f),null}else 2*z()-x.renderingStartTime>Yr&&g!==536870912&&(f.flags|=128,b=!0,Ph(x,!1),f.lanes=4194304);x.isBackwards?(D.sibling=f.child,f.child=D):(l=x.last,l!==null?l.sibling=D:f.child=D,x.last=D)}return x.tail!==null?(l=x.tail,x.rendering=l,x.tail=l.sibling,x.renderingStartTime=z(),l.sibling=null,g=Ai.current,le(Ai,b?g&1|2:g&1),xn&&Yo(f,x.treeForkCount),l):(Wn(f),null);case 22:case 23:return Or(f),Ps(),x=f.memoizedState!==null,l!==null?l.memoizedState!==null!==x&&(f.flags|=8192):x&&(f.flags|=8192),x?(g&536870912)!==0&&(f.flags&128)===0&&(Wn(f),f.subtreeFlags&6&&(f.flags|=8192)):Wn(f),g=f.updateQueue,g!==null&&Zc(f,g.retryQueue),g=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(g=l.memoizedState.cachePool.pool),x=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(x=f.memoizedState.cachePool.pool),x!==g&&(f.flags|=2048),l!==null&&Z(Gl),null;case 24:return g=null,l!==null&&(g=l.memoizedState.cache),f.memoizedState.cache!==g&&(f.flags|=2048),aa(Ot),Wn(f),null;case 25:return null;case 30:return null}throw Error(n(156,f.tag))}function Bp(l,f){switch(Fl(f),f.tag){case 1:return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 3:return aa(Ot),nt(),l=f.flags,(l&65536)!==0&&(l&128)===0?(f.flags=l&-65537|128,f):null;case 26:case 27:case 5:return Vt(f),null;case 31:if(f.memoizedState!==null){if(Or(f),f.alternate===null)throw Error(n(340));Uu()}return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 13:if(Or(f),l=f.memoizedState,l!==null&&l.dehydrated!==null){if(f.alternate===null)throw Error(n(340));Uu()}return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 19:return Z(Ai),null;case 4:return nt(),null;case 10:return aa(f.type),null;case 22:case 23:return Or(f),Ps(),l!==null&&Z(Gl),l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 24:return aa(Ot),null;case 25:return null;default:return null}}function Xu(l,f){switch(Fl(f),f.tag){case 3:aa(Ot),nt();break;case 26:case 27:case 5:Vt(f);break;case 4:nt();break;case 31:f.memoizedState!==null&&Or(f);break;case 13:Or(f);break;case 19:Z(Ai);break;case 10:aa(f.type);break;case 22:case 23:Or(f),Ps(),l!==null&&Z(Gl);break;case 24:aa(Ot)}}function xo(l,f){try{var g=f.updateQueue,x=g!==null?g.lastEffect:null;if(x!==null){var b=x.next;g=b;do{if((g.tag&l)===l){x=void 0;var D=g.create,G=g.inst;x=D(),G.destroy=x}g=g.next}while(g!==b)}}catch(q){ei(f,f.return,q)}}function ca(l,f,g){try{var x=f.updateQueue,b=x!==null?x.lastEffect:null;if(b!==null){var D=b.next;x=D;do{if((x.tag&l)===l){var G=x.inst,q=G.destroy;if(q!==void 0){G.destroy=void 0,b=f;var ae=g,Ee=q;try{Ee()}catch(Pe){ei(b,ae,Pe)}}}x=x.next}while(x!==D)}}catch(Pe){ei(f,f.return,Pe)}}function Jl(l){var f=l.updateQueue;if(f!==null){var g=l.stateNode;try{Ss(f,g)}catch(x){ei(l,l.return,x)}}}function R0(l,f,g){g.props=Es(l.type,l.memoizedProps),g.state=l.memoizedState;try{g.componentWillUnmount()}catch(x){ei(l,f,x)}}function So(l,f){try{var g=l.ref;if(g!==null){switch(l.tag){case 26:case 27:case 5:var x=l.stateNode;break;case 30:x=l.stateNode;break;default:x=l.stateNode}typeof g=="function"?l.refCleanup=g(x):g.current=x}}catch(b){ei(l,f,b)}}function Hr(l,f){var g=l.ref,x=l.refCleanup;if(g!==null)if(typeof x=="function")try{x()}catch(b){ei(l,f,b)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof g=="function")try{g(null)}catch(b){ei(l,f,b)}else g.current=null}function zr(l){var f=l.type,g=l.memoizedProps,x=l.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":g.autoFocus&&x.focus();break e;case"img":g.src?x.src=g.src:g.srcSet&&(x.srcset=g.srcSet)}}catch(b){ei(l,l.return,b)}}function fa(l,f,g){try{var x=l.stateNode;qP(x,l.type,g,f),x[Zi]=f}catch(b){ei(l,l.return,b)}}function Xi(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&af(l.type)||l.tag===4}function Ao(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||Xi(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&af(l.type)||l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function rn(l,f,g){var x=l.tag;if(x===5||x===6)l=l.stateNode,f?(g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g).insertBefore(l,f):(f=g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g,f.appendChild(l),g=g._reactRootContainer,g!=null||f.onclick!==null||(f.onclick=ao));else if(x!==4&&(x===27&&af(l.type)&&(g=l.stateNode,f=null),l=l.child,l!==null))for(rn(l,f,g),l=l.sibling;l!==null;)rn(l,f,g),l=l.sibling}function kn(l,f,g){var x=l.tag;if(x===5||x===6)l=l.stateNode,f?g.insertBefore(l,f):g.appendChild(l);else if(x!==4&&(x===27&&af(l.type)&&(g=l.stateNode),l=l.child,l!==null))for(kn(l,f,g),l=l.sibling;l!==null;)kn(l,f,g),l=l.sibling}function Oi(l){var f=l.stateNode,g=l.memoizedProps;try{for(var x=l.type,b=f.attributes;b.length;)f.removeAttributeNode(b[0]);Zs(f,x,g),f[ln]=l,f[Zi]=g}catch(D){ei(l,l.return,D)}}var ha=!1,di=!1,nl=!1,Nh=typeof WeakSet=="function"?WeakSet:Set,bi=null;function ef(l,f){if(l=l.containerInfo,UE=M_,l=tp(l),Bc(l)){if("selectionStart"in l)var g={start:l.selectionStart,end:l.selectionEnd};else e:{g=(g=l.ownerDocument)&&g.defaultView||window;var x=g.getSelection&&g.getSelection();if(x&&x.rangeCount!==0){g=x.anchorNode;var b=x.anchorOffset,D=x.focusNode;x=x.focusOffset;try{g.nodeType,D.nodeType}catch{g=null;break e}var G=0,q=-1,ae=-1,Ee=0,Pe=0,Ke=l,Re=null;t:for(;;){for(var Be;Ke!==g||b!==0&&Ke.nodeType!==3||(q=G+b),Ke!==D||x!==0&&Ke.nodeType!==3||(ae=G+x),Ke.nodeType===3&&(G+=Ke.nodeValue.length),(Be=Ke.firstChild)!==null;)Re=Ke,Ke=Be;for(;;){if(Ke===l)break t;if(Re===g&&++Ee===b&&(q=G),Re===D&&++Pe===x&&(ae=G),(Be=Ke.nextSibling)!==null)break;Ke=Re,Re=Ke.parentNode}Ke=Be}g=q===-1||ae===-1?null:{start:q,end:ae}}else g=null}g=g||{start:0,end:0}}else g=null;for(FE={focusedElem:l,selectionRange:g},M_=!1,bi=f;bi!==null;)if(f=bi,l=f.child,(f.subtreeFlags&1028)!==0&&l!==null)l.return=f,bi=l;else for(;bi!==null;){switch(f=bi,D=f.alternate,l=f.flags,f.tag){case 0:if((l&4)!==0&&(l=f.updateQueue,l=l!==null?l.events:null,l!==null))for(g=0;g<l.length;g++)b=l[g],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((l&1024)!==0&&D!==null){l=void 0,g=f,b=D.memoizedProps,D=D.memoizedState,x=g.stateNode;try{var Dt=Es(g.type,b);l=x.getSnapshotBeforeUpdate(Dt,D),x.__reactInternalSnapshotBeforeUpdate=l}catch(Xt){ei(g,g.return,Xt)}}break;case 3:if((l&1024)!==0){if(l=f.stateNode.containerInfo,g=l.nodeType,g===9)HE(l);else if(g===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":HE(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(n(163))}if(l=f.sibling,l!==null){l.return=f.return,bi=l;break}bi=f.return}}function h_(l,f,g){var x=g.flags;switch(g.tag){case 0:case 11:case 15:il(l,g),x&4&&xo(5,g);break;case 1:if(il(l,g),x&4)if(l=g.stateNode,f===null)try{l.componentDidMount()}catch(G){ei(g,g.return,G)}else{var b=Es(g.type,f.memoizedProps);f=f.memoizedState;try{l.componentDidUpdate(b,f,l.__reactInternalSnapshotBeforeUpdate)}catch(G){ei(g,g.return,G)}}x&64&&Jl(g),x&512&&So(g,g.return);break;case 3:if(il(l,g),x&64&&(l=g.updateQueue,l!==null)){if(f=null,g.child!==null)switch(g.child.tag){case 27:case 5:f=g.child.stateNode;break;case 1:f=g.child.stateNode}try{Ss(l,f)}catch(G){ei(g,g.return,G)}}break;case 27:f===null&&x&4&&Oi(g);case 26:case 5:il(l,g),f===null&&x&4&&zr(g),x&512&&So(g,g.return);break;case 12:il(l,g);break;case 31:il(l,g),x&4&&Pp(l,g);break;case 13:il(l,g),x&4&&D0(l,g),x&64&&(l=g.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(g=PP.bind(null,g),tN(l,g))));break;case 22:if(x=g.memoizedState!==null||ha,!x){f=f!==null&&f.memoizedState!==null||di,b=ha;var D=di;ha=x,(di=f)&&!D?zn(l,g,(g.subtreeFlags&8772)!==0):il(l,g),ha=b,di=D}break;case 30:break;default:il(l,g)}}function Op(l){var f=l.alternate;f!==null&&(l.alternate=null,Op(f)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(f=l.stateNode,f!==null&&bu(f)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var Dn=null,qi=!1;function Us(l,f,g){for(g=g.child;g!==null;)Ql(l,f,g),g=g.sibling}function Ql(l,f,g){if(Je&&typeof Je.onCommitFiberUnmount=="function")try{Je.onCommitFiberUnmount(Ye,g)}catch{}switch(g.tag){case 26:di||Hr(g,f),Us(l,f,g),g.memoizedState?g.memoizedState.count--:g.stateNode&&(g=g.stateNode,g.parentNode.removeChild(g));break;case 27:di||Hr(g,f);var x=Dn,b=qi;af(g.type)&&(Dn=g.stateNode,qi=!1),Us(l,f,g),B0(g.stateNode),Dn=x,qi=b;break;case 5:di||Hr(g,f);case 6:if(x=Dn,b=qi,Dn=null,Us(l,f,g),Dn=x,qi=b,Dn!==null)if(qi)try{(Dn.nodeType===9?Dn.body:Dn.nodeName==="HTML"?Dn.ownerDocument.body:Dn).removeChild(g.stateNode)}catch(D){ei(g,f,D)}else try{Dn.removeChild(g.stateNode)}catch(D){ei(g,f,D)}break;case 18:Dn!==null&&(qi?(l=Dn,hR(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,g.stateNode),Xp(l)):hR(Dn,g.stateNode));break;case 4:x=Dn,b=qi,Dn=g.stateNode.containerInfo,qi=!0,Us(l,f,g),Dn=x,qi=b;break;case 0:case 11:case 14:case 15:ca(2,g,f),di||ca(4,g,f),Us(l,f,g);break;case 1:di||(Hr(g,f),x=g.stateNode,typeof x.componentWillUnmount=="function"&&R0(g,f,x)),Us(l,f,g);break;case 21:Us(l,f,g);break;case 22:di=(x=di)||g.memoizedState!==null,Us(l,f,g),di=x;break;default:Us(l,f,g)}}function Pp(l,f){if(f.memoizedState===null&&(l=f.alternate,l!==null&&(l=l.memoizedState,l!==null))){l=l.dehydrated;try{Xp(l)}catch(g){ei(f,f.return,g)}}}function D0(l,f){if(f.memoizedState===null&&(l=f.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{Xp(l)}catch(g){ei(f,f.return,g)}}function d_(l){switch(l.tag){case 31:case 13:case 19:var f=l.stateNode;return f===null&&(f=l.stateNode=new Nh),f;case 22:return l=l.stateNode,f=l._retryCache,f===null&&(f=l._retryCache=new Nh),f;default:throw Error(n(435,l.tag))}}function Pi(l,f){var g=d_(l);f.forEach(function(x){if(!g.has(x)){g.add(x);var b=NP.bind(null,l,x);x.then(b,b)}})}function Fs(l,f){var g=f.deletions;if(g!==null)for(var x=0;x<g.length;x++){var b=g[x],D=l,G=f,q=G;e:for(;q!==null;){switch(q.tag){case 27:if(af(q.type)){Dn=q.stateNode,qi=!1;break e}break;case 5:Dn=q.stateNode,qi=!1;break e;case 3:case 4:Dn=q.stateNode.containerInfo,qi=!0;break e}q=q.return}if(Dn===null)throw Error(n(160));Ql(D,G,b),Dn=null,qi=!1,D=b.alternate,D!==null&&(D.return=null),b.return=null}if(f.subtreeFlags&13886)for(f=f.child;f!==null;)$l(f,l),f=f.sibling}var fr=null;function $l(l,f){var g=l.alternate,x=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:Fs(f,l),Mi(l),x&4&&(ca(3,l,l.return),xo(3,l),ca(5,l,l.return));break;case 1:Fs(f,l),Mi(l),x&512&&(di||g===null||Hr(g,g.return)),x&64&&ha&&(l=l.updateQueue,l!==null&&(x=l.callbacks,x!==null&&(g=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=g===null?x:g.concat(x))));break;case 26:var b=fr;if(Fs(f,l),Mi(l),x&512&&(di||g===null||Hr(g,g.return)),x&4){var D=g!==null?g.memoizedState:null;if(x=l.memoizedState,g===null)if(x===null)if(l.stateNode===null){e:{x=l.type,g=l.memoizedProps,b=b.ownerDocument||b;t:switch(x){case"title":D=b.getElementsByTagName("title")[0],(!D||D[Go]||D[ln]||D.namespaceURI==="http://www.w3.org/2000/svg"||D.hasAttribute("itemprop"))&&(D=b.createElement(x),b.head.insertBefore(D,b.querySelector("head > title"))),Zs(D,x,g),D[ln]=l,X(D),x=D;break e;case"link":var G=ER("link","href",b).get(x+(g.href||""));if(G){for(var q=0;q<G.length;q++)if(D=G[q],D.getAttribute("href")===(g.href==null||g.href===""?null:g.href)&&D.getAttribute("rel")===(g.rel==null?null:g.rel)&&D.getAttribute("title")===(g.title==null?null:g.title)&&D.getAttribute("crossorigin")===(g.crossOrigin==null?null:g.crossOrigin)){G.splice(q,1);break t}}D=b.createElement(x),Zs(D,x,g),b.head.appendChild(D);break;case"meta":if(G=ER("meta","content",b).get(x+(g.content||""))){for(q=0;q<G.length;q++)if(D=G[q],D.getAttribute("content")===(g.content==null?null:""+g.content)&&D.getAttribute("name")===(g.name==null?null:g.name)&&D.getAttribute("property")===(g.property==null?null:g.property)&&D.getAttribute("http-equiv")===(g.httpEquiv==null?null:g.httpEquiv)&&D.getAttribute("charset")===(g.charSet==null?null:g.charSet)){G.splice(q,1);break t}}D=b.createElement(x),Zs(D,x,g),b.head.appendChild(D);break;default:throw Error(n(468,x))}D[ln]=l,X(D),x=D}l.stateNode=x}else TR(b,l.type,l.stateNode);else l.stateNode=AR(b,x,l.memoizedProps);else D!==x?(D===null?g.stateNode!==null&&(g=g.stateNode,g.parentNode.removeChild(g)):D.count--,x===null?TR(b,l.type,l.stateNode):AR(b,x,l.memoizedProps)):x===null&&l.stateNode!==null&&fa(l,l.memoizedProps,g.memoizedProps)}break;case 27:Fs(f,l),Mi(l),x&512&&(di||g===null||Hr(g,g.return)),g!==null&&x&4&&fa(l,l.memoizedProps,g.memoizedProps);break;case 5:if(Fs(f,l),Mi(l),x&512&&(di||g===null||Hr(g,g.return)),l.flags&32){b=l.stateNode;try{zi(b,"")}catch(Dt){ei(l,l.return,Dt)}}x&4&&l.stateNode!=null&&(b=l.memoizedProps,fa(l,b,g!==null?g.memoizedProps:b)),x&1024&&(nl=!0);break;case 6:if(Fs(f,l),Mi(l),x&4){if(l.stateNode===null)throw Error(n(162));x=l.memoizedProps,g=l.stateNode;try{g.nodeValue=x}catch(Dt){ei(l,l.return,Dt)}}break;case 3:if(A_=null,b=fr,fr=x_(f.containerInfo),Fs(f,l),fr=b,Mi(l),x&4&&g!==null&&g.memoizedState.isDehydrated)try{Xp(f.containerInfo)}catch(Dt){ei(l,l.return,Dt)}nl&&(nl=!1,p_(l));break;case 4:x=fr,fr=x_(l.stateNode.containerInfo),Fs(f,l),Mi(l),fr=x;break;case 12:Fs(f,l),Mi(l);break;case 31:Fs(f,l),Mi(l),x&4&&(x=l.updateQueue,x!==null&&(l.updateQueue=null,Pi(l,x)));break;case 13:Fs(f,l),Mi(l),l.child.flags&8192&&l.memoizedState!==null!=(g!==null&&g.memoizedState!==null)&&(al=z()),x&4&&(x=l.updateQueue,x!==null&&(l.updateQueue=null,Pi(l,x)));break;case 22:b=l.memoizedState!==null;var ae=g!==null&&g.memoizedState!==null,Ee=ha,Pe=di;if(ha=Ee||b,di=Pe||ae,Fs(f,l),di=Pe,ha=Ee,Mi(l),x&8192)e:for(f=l.stateNode,f._visibility=b?f._visibility&-2:f._visibility|1,b&&(g===null||ae||ha||di||qu(l)),g=null,f=l;;){if(f.tag===5||f.tag===26){if(g===null){ae=g=f;try{if(D=ae.stateNode,b)G=D.style,typeof G.setProperty=="function"?G.setProperty("display","none","important"):G.display="none";else{q=ae.stateNode;var Ke=ae.memoizedProps.style,Re=Ke!=null&&Ke.hasOwnProperty("display")?Ke.display:null;q.style.display=Re==null||typeof Re=="boolean"?"":(""+Re).trim()}}catch(Dt){ei(ae,ae.return,Dt)}}}else if(f.tag===6){if(g===null){ae=f;try{ae.stateNode.nodeValue=b?"":ae.memoizedProps}catch(Dt){ei(ae,ae.return,Dt)}}}else if(f.tag===18){if(g===null){ae=f;try{var Be=ae.stateNode;b?dR(Be,!0):dR(ae.stateNode,!1)}catch(Dt){ei(ae,ae.return,Dt)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===l)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break e;for(;f.sibling===null;){if(f.return===null||f.return===l)break e;g===f&&(g=null),f=f.return}g===f&&(g=null),f.sibling.return=f.return,f=f.sibling}x&4&&(x=l.updateQueue,x!==null&&(g=x.retryQueue,g!==null&&(x.retryQueue=null,Pi(l,g))));break;case 19:Fs(f,l),Mi(l),x&4&&(x=l.updateQueue,x!==null&&(l.updateQueue=null,Pi(l,x)));break;case 30:break;case 21:break;default:Fs(f,l),Mi(l)}}function Mi(l){var f=l.flags;if(f&2){try{for(var g,x=l.return;x!==null;){if(Xi(x)){g=x;break}x=x.return}if(g==null)throw Error(n(160));switch(g.tag){case 27:var b=g.stateNode,D=Ao(l);kn(l,D,b);break;case 5:var G=g.stateNode;g.flags&32&&(zi(G,""),g.flags&=-33);var q=Ao(l);kn(l,q,G);break;case 3:case 4:var ae=g.stateNode.containerInfo,Ee=Ao(l);rn(l,Ee,ae);break;default:throw Error(n(161))}}catch(Pe){ei(l,l.return,Pe)}l.flags&=-3}f&4096&&(l.flags&=-4097)}function p_(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var f=l;p_(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),l=l.sibling}}function il(l,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)h_(l,f.alternate,f),f=f.sibling}function qu(l){for(l=l.child;l!==null;){var f=l;switch(f.tag){case 0:case 11:case 14:case 15:ca(4,f,f.return),qu(f);break;case 1:Hr(f,f.return);var g=f.stateNode;typeof g.componentWillUnmount=="function"&&R0(f,f.return,g),qu(f);break;case 27:B0(f.stateNode);case 26:case 5:Hr(f,f.return),qu(f);break;case 22:f.memoizedState===null&&qu(f);break;case 30:qu(f);break;default:qu(f)}l=l.sibling}}function zn(l,f,g){for(g=g&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var x=f.alternate,b=l,D=f,G=D.flags;switch(D.tag){case 0:case 11:case 15:zn(b,D,g),xo(4,D);break;case 1:if(zn(b,D,g),x=D,b=x.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Ee){ei(x,x.return,Ee)}if(x=D,b=x.updateQueue,b!==null){var q=x.stateNode;try{var ae=b.shared.hiddenCallbacks;if(ae!==null)for(b.shared.hiddenCallbacks=null,b=0;b<ae.length;b++)go(ae[b],q)}catch(Ee){ei(x,x.return,Ee)}}g&&G&64&&Jl(D),So(D,D.return);break;case 27:Oi(D);case 26:case 5:zn(b,D,g),g&&x===null&&G&4&&zr(D),So(D,D.return);break;case 12:zn(b,D,g);break;case 31:zn(b,D,g),g&&G&4&&Pp(b,D);break;case 13:zn(b,D,g),g&&G&4&&D0(b,D);break;case 22:D.memoizedState===null&&zn(b,D,g),So(D,D.return);break;case 30:break;default:zn(b,D,g)}f=f.sibling}}function Np(l,f){var g=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(g=l.memoizedState.cachePool.pool),l=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(l=f.memoizedState.cachePool.pool),l!==g&&(l!=null&&l.refCount++,g!=null&&xs(g))}function sl(l,f){l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&xs(l))}function ts(l,f,g,x){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)_i(l,f,g,x),f=f.sibling}function _i(l,f,g,x){var b=f.flags;switch(f.tag){case 0:case 11:case 15:ts(l,f,g,x),b&2048&&xo(9,f);break;case 1:ts(l,f,g,x);break;case 3:ts(l,f,g,x),b&2048&&(l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&xs(l)));break;case 12:if(b&2048){ts(l,f,g,x),l=f.stateNode;try{var D=f.memoizedProps,G=D.id,q=D.onPostCommit;typeof q=="function"&&q(G,f.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(ae){ei(f,f.return,ae)}}else ts(l,f,g,x);break;case 31:ts(l,f,g,x);break;case 13:ts(l,f,g,x);break;case 23:break;case 22:D=f.stateNode,G=f.alternate,f.memoizedState!==null?D._visibility&2?ts(l,f,g,x):tf(l,f):D._visibility&2?ts(l,f,g,x):(D._visibility|=2,Zl(l,f,g,x,(f.subtreeFlags&10256)!==0||!1)),b&2048&&Np(G,f);break;case 24:ts(l,f,g,x),b&2048&&sl(f.alternate,f);break;default:ts(l,f,g,x)}}function Zl(l,f,g,x,b){for(b=b&&((f.subtreeFlags&10256)!==0||!1),f=f.child;f!==null;){var D=l,G=f,q=g,ae=x,Ee=G.flags;switch(G.tag){case 0:case 11:case 15:Zl(D,G,q,ae,b),xo(8,G);break;case 23:break;case 22:var Pe=G.stateNode;G.memoizedState!==null?Pe._visibility&2?Zl(D,G,q,ae,b):tf(D,G):(Pe._visibility|=2,Zl(D,G,q,ae,b)),b&&Ee&2048&&Np(G.alternate,G);break;case 24:Zl(D,G,q,ae,b),b&&Ee&2048&&sl(G.alternate,G);break;default:Zl(D,G,q,ae,b)}f=f.sibling}}function tf(l,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var g=l,x=f,b=x.flags;switch(x.tag){case 22:tf(g,x),b&2048&&Np(x.alternate,x);break;case 24:tf(g,x),b&2048&&sl(x.alternate,x);break;default:tf(g,x)}f=f.sibling}}var Ci=8192;function Wu(l,f,g){if(l.subtreeFlags&Ci)for(l=l.child;l!==null;)Ni(l,f,g),l=l.sibling}function Ni(l,f,g){switch(l.tag){case 26:Wu(l,f,g),l.flags&Ci&&l.memoizedState!==null&&dN(g,fr,l.memoizedState,l.memoizedProps);break;case 5:Wu(l,f,g);break;case 3:case 4:var x=fr;fr=x_(l.stateNode.containerInfo),Wu(l,f,g),fr=x;break;case 22:l.memoizedState===null&&(x=l.alternate,x!==null&&x.memoizedState!==null?(x=Ci,Ci=16777216,Wu(l,f,g),Ci=x):Wu(l,f,g));break;default:Wu(l,f,g)}}function hr(l){var f=l.alternate;if(f!==null&&(l=f.child,l!==null)){f.child=null;do f=l.sibling,l.sibling=null,l=f;while(l!==null)}}function Qs(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var g=0;g<f.length;g++){var x=f[g];bi=x,Uh(x,l)}hr(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)ju(l),l=l.sibling}function ju(l){switch(l.tag){case 0:case 11:case 15:Qs(l),l.flags&2048&&ca(9,l,l.return);break;case 3:Qs(l);break;case 12:Qs(l);break;case 22:var f=l.stateNode;l.memoizedState!==null&&f._visibility&2&&(l.return===null||l.return.tag!==13)?(f._visibility&=-3,Up(l)):Qs(l);break;default:Qs(l)}}function Up(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var g=0;g<f.length;g++){var x=f[g];bi=x,Uh(x,l)}hr(l)}for(l=l.child;l!==null;){switch(f=l,f.tag){case 0:case 11:case 15:ca(8,f,f.return),Up(f);break;case 22:g=f.stateNode,g._visibility&2&&(g._visibility&=-3,Up(f));break;default:Up(f)}l=l.sibling}}function Uh(l,f){for(;bi!==null;){var g=bi;switch(g.tag){case 0:case 11:case 15:ca(8,g,f);break;case 23:case 22:if(g.memoizedState!==null&&g.memoizedState.cachePool!==null){var x=g.memoizedState.cachePool.pool;x!=null&&x.refCount++}break;case 24:xs(g.memoizedState.cache)}if(x=g.child,x!==null)x.return=g,bi=x;else e:for(g=l;bi!==null;){x=bi;var b=x.sibling,D=x.return;if(Op(x),x===g){bi=null;break e}if(b!==null){b.return=D,bi=b;break e}bi=D}}}var Fp={getCacheForType:function(l){var f=hs(Ot),g=f.data.get(l);return g===void 0&&(g=l(),f.data.set(l,g)),g},cacheSignal:function(){return hs(Ot).controller.signal}},kp=typeof WeakMap=="function"?WeakMap:Map,En=0,Vn=null,an=null,yn=0,Pt=0,pn=null,tn=!1,cn=!1,Jn=!1,Ui=0,Kn=0,Vr=0,rl=0,Na=0,Tn=0,Kr=0,Ua=null,ks=null,dr=!1,al=0,nf=0,Yr=1/0,sf=null,Eo=null,xi=0,Fa=null,Xr=null,da=0,ol=0,Ju=null,Gp=null,Qu=0,$u=null;function $s(){return(En&2)!==0&&yn!==0?yn&-yn:k.T!==null?LE():sa()}function d(){if(Tn===0)if((yn&536870912)===0||xn){var l=Ze;Ze<<=1,(Ze&3932160)===0&&(Ze=262144),Tn=l}else Tn=536870912;return l=es.current,l!==null&&(l.flags|=32),Tn}function m(l,f,g){(l===Vn&&(Pt===2||Pt===9)||l.cancelPendingCommit!==null)&&(ve(l,0),U(l,yn,Tn,!1)),vs(l,g),((En&2)===0||l!==Vn)&&(l===Vn&&((En&2)===0&&(rl|=g),Kn===4&&U(l,yn,Tn,!1)),eu(l))}function S(l,f,g){if((En&6)!==0)throw Error(n(327));var x=!g&&(f&127)===0&&(f&l.expiredLanes)===0||st(l,f),b=x?Zu(l,f):pr(l,f,!0),D=x;do{if(b===0){cn&&!x&&U(l,f,0,!1);break}else{if(g=l.current.alternate,D&&!I(g)){b=pr(l,f,!1),D=!1;continue}if(b===2){if(D=f,l.errorRecoveryDisabledLanes&D)var G=0;else G=l.pendingLanes&-536870913,G=G!==0?G:G&536870912?536870912:0;if(G!==0){f=G;e:{var q=l;b=Ua;var ae=q.current.memoizedState.isDehydrated;if(ae&&(ve(q,G).flags|=256),G=pr(q,G,!1),G!==2){if(Jn&&!ae){q.errorRecoveryDisabledLanes|=D,rl|=D,b=4;break e}D=ks,ks=b,D!==null&&(ks===null?ks=D:ks.push.apply(ks,D))}b=G}if(D=!1,b!==2)continue}}if(b===1){ve(l,0),U(l,f,0,!0);break}e:{switch(x=l,D=b,D){case 0:case 1:throw Error(n(345));case 4:if((f&4194048)!==f)break;case 6:U(x,f,Tn,!tn);break e;case 2:ks=null;break;case 3:case 5:break;default:throw Error(n(329))}if((f&62914560)===f&&(b=al+300-z(),10<b)){if(U(x,f,Tn,!tn),ze(x,0,!0)!==0)break e;da=f,x.timeoutHandle=cR(C.bind(null,x,g,ks,sf,dr,f,Tn,rl,Kr,tn,D,"Throttled",-0,0),b);break e}C(x,g,ks,sf,dr,f,Tn,rl,Kr,tn,D,null,-0,0)}}break}while(!0);eu(l)}function C(l,f,g,x,b,D,G,q,ae,Ee,Pe,Ke,Re,Be){if(l.timeoutHandle=-1,Ke=f.subtreeFlags,Ke&8192||(Ke&16785408)===16785408){Ke={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ao},Ni(f,D,Ke);var Dt=(D&62914560)===D?al-z():(D&4194048)===D?nf-z():0;if(Dt=pN(Ke,Dt),Dt!==null){da=D,l.cancelPendingCommit=Dt(Wt.bind(null,l,f,D,g,x,b,G,q,ae,Pe,Ke,null,Re,Be)),U(l,D,G,!Ee);return}}Wt(l,f,D,g,x,b,G,q,ae)}function I(l){for(var f=l;;){var g=f.tag;if((g===0||g===11||g===15)&&f.flags&16384&&(g=f.updateQueue,g!==null&&(g=g.stores,g!==null)))for(var x=0;x<g.length;x++){var b=g[x],D=b.getSnapshot;b=b.value;try{if(!fi(D(),b))return!1}catch{return!1}}if(g=f.child,f.subtreeFlags&16384&&g!==null)g.return=f,f=g;else{if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function U(l,f,g,x){f&=~Na,f&=~rl,l.suspendedLanes|=f,l.pingedLanes&=~f,x&&(l.warmLanes|=f),x=l.expirationTimes;for(var b=f;0<b;){var D=31-ht(b),G=1<<D;x[D]=-1,b&=~G}g!==0&&jf(l,g,f)}function W(){return(En&6)===0?(L0(0),!1):!0}function re(){if(an!==null){if(Pt===0)var l=an.return;else l=an,Os=qo=null,a0(l),zl=null,Vl=0,l=an;for(;l!==null;)Xu(l.alternate,l),l=l.return;an=null}}function ve(l,f){var g=l.timeoutHandle;g!==-1&&(l.timeoutHandle=-1,JP(g)),g=l.cancelPendingCommit,g!==null&&(l.cancelPendingCommit=null,g()),da=0,re(),Vn=l,an=g=uo(l.current,null),yn=f,Pt=0,pn=null,tn=!1,cn=st(l,f),Jn=!1,Kr=Tn=Na=rl=Vr=Kn=0,ks=Ua=null,dr=!1,(f&8)!==0&&(f|=f&32);var x=l.entangledLanes;if(x!==0)for(l=l.entanglements,x&=f;0<x;){var b=31-ht(x),D=1<<b;f|=l[b],x&=~D}return Ui=f,Pl(),g}function Fe(l,f){qt=null,k.H=bh,f===Hl||f===wa?(f=pp(),Pt=3):f===mh?(f=pp(),Pt=4):Pt=f===Ip?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,pn=f,an===null&&(Kn=1,Lp(l,rr(f,l.current)))}function tt(){var l=es.current;return l===null?!0:(yn&4194048)===yn?oa===null:(yn&62914560)===yn||(yn&536870912)!==0?l===oa:!1}function mt(){var l=k.H;return k.H=bh,l===null?bh:l}function _t(){var l=k.A;return k.A=Fp,l}function $t(){Kn=4,tn||(yn&4194048)!==yn&&es.current!==null||(cn=!0),(Vr&134217727)===0&&(rl&134217727)===0||Vn===null||U(Vn,yn,Tn,!1)}function pr(l,f,g){var x=En;En|=2;var b=mt(),D=_t();(Vn!==l||yn!==f)&&(sf=null,ve(l,f)),f=!1;var G=Kn;e:do try{if(Pt!==0&&an!==null){var q=an,ae=pn;switch(Pt){case 8:re(),G=6;break e;case 3:case 2:case 9:case 6:es.current===null&&(f=!0);var Ee=Pt;if(Pt=0,pn=null,Qe(l,q,ae,Ee),g&&cn){G=0;break e}break;default:Ee=Pt,Pt=0,pn=null,Qe(l,q,ae,Ee)}}Fh(),G=Kn;break}catch(Pe){Fe(l,Pe)}while(!0);return f&&l.shellSuspendCounter++,Os=qo=null,En=x,k.H=b,k.A=D,an===null&&(Vn=null,yn=0,Pl()),G}function Fh(){for(;an!==null;)me(an)}function Zu(l,f){var g=En;En|=2;var x=mt(),b=_t();Vn!==l||yn!==f?(sf=null,Yr=z()+500,ve(l,f)):cn=st(l,f);e:do try{if(Pt!==0&&an!==null){f=an;var D=pn;t:switch(Pt){case 1:Pt=0,pn=null,Qe(l,f,D,1);break;case 2:case 9:if(ky(D)){Pt=0,pn=null,Le(f);break}f=function(){Pt!==2&&Pt!==9||Vn!==l||(Pt=7),eu(l)},D.then(f,f);break e;case 3:Pt=7;break e;case 4:Pt=5;break e;case 7:ky(D)?(Pt=0,pn=null,Le(f)):(Pt=0,pn=null,Qe(l,f,D,7));break;case 5:var G=null;switch(an.tag){case 26:G=an.memoizedState;case 5:case 27:var q=an;if(G?bR(G):q.stateNode.complete){Pt=0,pn=null;var ae=q.sibling;if(ae!==null)an=ae;else{var Ee=q.return;Ee!==null?(an=Ee,Bt(Ee)):an=null}break t}}Pt=0,pn=null,Qe(l,f,D,5);break;case 6:Pt=0,pn=null,Qe(l,f,D,6);break;case 8:re(),Kn=6;break e;default:throw Error(n(462))}}Ce();break}catch(Pe){Fe(l,Pe)}while(!0);return Os=qo=null,k.H=x,k.A=b,En=g,an!==null?0:(Vn=null,yn=0,Pl(),Kn)}function Ce(){for(;an!==null&&!et();)me(an)}function me(l){var f=wp(l.alternate,l,Ui);l.memoizedProps=l.pendingProps,f===null?Bt(l):an=f}function Le(l){var f=l,g=f.alternate;switch(f.tag){case 15:case 0:f=Ns(g,f,f.pendingProps,f.type,void 0,yn);break;case 11:f=Ns(g,f,f.pendingProps,f.type.render,f.ref,yn);break;case 5:a0(f);default:Xu(g,f),f=an=Bs(f,Ui),f=wp(g,f,Ui)}l.memoizedProps=l.pendingProps,f===null?Bt(l):an=f}function Qe(l,f,g,x){Os=qo=null,a0(f),zl=null,Vl=0;var b=f.return;try{if(Nr(l,b,f,g,yn)){Kn=1,Lp(l,rr(g,l.current)),an=null;return}}catch(D){if(b!==null)throw an=b,D;Kn=1,Lp(l,rr(g,l.current)),an=null;return}f.flags&32768?(xn||x===1?l=!0:cn||(yn&536870912)!==0?l=!1:(tn=l=!0,(x===2||x===9||x===3||x===6)&&(x=es.current,x!==null&&x.tag===13&&(x.flags|=16384))),ri(f,l)):Bt(f)}function Bt(l){var f=l;do{if((f.flags&32768)!==0){ri(f,tn);return}l=f.return;var g=C0(f.alternate,f,Ui);if(g!==null){an=g;return}if(f=f.sibling,f!==null){an=f;return}an=f=l}while(f!==null);Kn===0&&(Kn=5)}function ri(l,f){do{var g=Bp(l.alternate,l);if(g!==null){g.flags&=32767,an=g;return}if(g=l.return,g!==null&&(g.flags|=32768,g.subtreeFlags=0,g.deletions=null),!f&&(l=l.sibling,l!==null)){an=l;return}an=l=g}while(l!==null);Kn=6,an=null}function Wt(l,f,g,x,b,D,G,q,ae){l.cancelPendingCommit=null;do Hp();while(xi!==0);if((En&6)!==0)throw Error(n(327));if(f!==null){if(f===l.current)throw Error(n(177));if(D=f.lanes|f.childLanes,D|=ap,na(l,g,D,G,q,ae),l===Vn&&(an=Vn=null,yn=0),Xr=f,Fa=l,da=g,ol=D,Ju=b,Gp=x,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,UP(Oe,function(){return qC(),null})):(l.callbackNode=null,l.callbackPriority=0),x=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||x){x=k.T,k.T=null,b=K.p,K.p=2,G=En,En|=4;try{ef(l,f,g)}finally{En=G,K.p=b,k.T=x}}xi=1,Ln(),ns(),In()}}function Ln(){if(xi===1){xi=0;var l=Fa,f=Xr,g=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||g){g=k.T,k.T=null;var x=K.p;K.p=2;var b=En;En|=4;try{$l(f,l);var D=FE,G=tp(l.containerInfo),q=D.focusedElem,ae=D.selectionRange;if(G!==q&&q&&q.ownerDocument&&ep(q.ownerDocument.documentElement,q)){if(ae!==null&&Bc(q)){var Ee=ae.start,Pe=ae.end;if(Pe===void 0&&(Pe=Ee),"selectionStart"in q)q.selectionStart=Ee,q.selectionEnd=Math.min(Pe,q.value.length);else{var Ke=q.ownerDocument||document,Re=Ke&&Ke.defaultView||window;if(Re.getSelection){var Be=Re.getSelection(),Dt=q.textContent.length,Xt=Math.min(ae.start,Dt),oi=ae.end===void 0?Xt:Math.min(ae.end,Dt);!Be.extend&&Xt>oi&&(G=oi,oi=Xt,Xt=G);var ge=Pg(q,Xt),ue=Pg(q,oi);if(ge&&ue&&(Be.rangeCount!==1||Be.anchorNode!==ge.node||Be.anchorOffset!==ge.offset||Be.focusNode!==ue.node||Be.focusOffset!==ue.offset)){var Ae=Ke.createRange();Ae.setStart(ge.node,ge.offset),Be.removeAllRanges(),Xt>oi?(Be.addRange(Ae),Be.extend(ue.node,ue.offset)):(Ae.setEnd(ue.node,ue.offset),Be.addRange(Ae))}}}}for(Ke=[],Be=q;Be=Be.parentNode;)Be.nodeType===1&&Ke.push({element:Be,left:Be.scrollLeft,top:Be.scrollTop});for(typeof q.focus=="function"&&q.focus(),q=0;q<Ke.length;q++){var Ge=Ke[q];Ge.element.scrollLeft=Ge.left,Ge.element.scrollTop=Ge.top}}M_=!!UE,FE=UE=null}finally{En=b,K.p=x,k.T=g}}l.current=f,xi=2}}function ns(){if(xi===2){xi=0;var l=Fa,f=Xr,g=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||g){g=k.T,k.T=null;var x=K.p;K.p=2;var b=En;En|=4;try{h_(l,f.alternate,f)}finally{En=b,K.p=x,k.T=g}}xi=3}}function In(){if(xi===4||xi===3){xi=0,$();var l=Fa,f=Xr,g=da,x=Gp;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?xi=5:(xi=0,Xr=Fa=null,ll(l,l.pendingLanes));var b=l.pendingLanes;if(b===0&&(Eo=null),Su(g),f=f.stateNode,Je&&typeof Je.onCommitFiberRoot=="function")try{Je.onCommitFiberRoot(Ye,f,void 0,(f.current.flags&128)===128)}catch{}if(x!==null){f=k.T,b=K.p,K.p=2,k.T=null;try{for(var D=l.onRecoverableError,G=0;G<x.length;G++){var q=x[G];D(q.value,{componentStack:q.stack})}}finally{k.T=f,K.p=b}}(da&3)!==0&&Hp(),eu(l),b=l.pendingLanes,(g&261930)!==0&&(b&42)!==0?l===$u?Qu++:(Qu=0,$u=l):Qu=0,L0(0)}}function ll(l,f){(l.pooledCacheLanes&=f)===0&&(f=l.pooledCache,f!=null&&(l.pooledCache=null,xs(f)))}function Hp(){return Ln(),ns(),In(),qC()}function qC(){if(xi!==5)return!1;var l=Fa,f=ol;ol=0;var g=Su(da),x=k.T,b=K.p;try{K.p=32>g?32:g,k.T=null,g=Ju,Ju=null;var D=Fa,G=da;if(xi=0,Xr=Fa=null,da=0,(En&6)!==0)throw Error(n(331));var q=En;if(En|=4,ju(D.current),_i(D,D.current,G,g),En=q,L0(0,!1),Je&&typeof Je.onPostCommitFiberRoot=="function")try{Je.onPostCommitFiberRoot(Ye,D)}catch{}return!0}finally{K.p=b,k.T=x,ll(l,f)}}function WC(l,f,g){f=rr(g,f),f=M0(l.stateNode,f,2),l=Qo(l,f,2),l!==null&&(vs(l,2),eu(l))}function ei(l,f,g){if(l.tag===3)WC(l,l,g);else for(;f!==null;){if(f.tag===3){WC(f,l,g);break}else if(f.tag===1){var x=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(Eo===null||!Eo.has(x))){l=rr(g,l),g=jc(2),x=Qo(f,g,2),x!==null&&(ur(g,x,f,l),vs(x,2),eu(x));break}}f=f.return}}function CE(l,f,g){var x=l.pingCache;if(x===null){x=l.pingCache=new kp;var b=new Set;x.set(f,b)}else b=x.get(f),b===void 0&&(b=new Set,x.set(f,b));b.has(g)||(Jn=!0,b.add(g),l=OP.bind(null,l,f,g),f.then(l,l))}function OP(l,f,g){var x=l.pingCache;x!==null&&x.delete(f),l.pingedLanes|=l.suspendedLanes&g,l.warmLanes&=~g,Vn===l&&(yn&g)===g&&(Kn===4||Kn===3&&(yn&62914560)===yn&&300>z()-al?(En&2)===0&&ve(l,0):Na|=g,Kr===yn&&(Kr=0)),eu(l)}function jC(l,f){f===0&&(f=Cn()),l=Nl(l,f),l!==null&&(vs(l,f),eu(l))}function PP(l){var f=l.memoizedState,g=0;f!==null&&(g=f.retryLane),jC(l,g)}function NP(l,f){var g=0;switch(l.tag){case 31:case 13:var x=l.stateNode,b=l.memoizedState;b!==null&&(g=b.retryLane);break;case 19:x=l.stateNode;break;case 22:x=l.stateNode._retryCache;break;default:throw Error(n(314))}x!==null&&x.delete(f),jC(l,g)}function UP(l,f){return $e(l,f)}var m_=null,zp=null,RE=!1,g_=!1,DE=!1,rf=0;function eu(l){l!==zp&&l.next===null&&(zp===null?m_=zp=l:zp=zp.next=l),g_=!0,RE||(RE=!0,kP())}function L0(l,f){if(!DE&&g_){DE=!0;do for(var g=!1,x=m_;x!==null;){if(l!==0){var b=x.pendingLanes;if(b===0)var D=0;else{var G=x.suspendedLanes,q=x.pingedLanes;D=(1<<31-ht(42|l)+1)-1,D&=b&~(G&~q),D=D&201326741?D&201326741|1:D?D|2:0}D!==0&&(g=!0,ZC(x,D))}else D=yn,D=ze(x,x===Vn?D:0,x.cancelPendingCommit!==null||x.timeoutHandle!==-1),(D&3)===0||st(x,D)||(g=!0,ZC(x,D));x=x.next}while(g);DE=!1}}function FP(){JC()}function JC(){g_=RE=!1;var l=0;rf!==0&&jP()&&(l=rf);for(var f=z(),g=null,x=m_;x!==null;){var b=x.next,D=QC(x,f);D===0?(x.next=null,g===null?m_=b:g.next=b,b===null&&(zp=g)):(g=x,(l!==0||(D&3)!==0)&&(g_=!0)),x=b}xi!==0&&xi!==5||L0(l),rf!==0&&(rf=0)}function QC(l,f){for(var g=l.suspendedLanes,x=l.pingedLanes,b=l.expirationTimes,D=l.pendingLanes&-62914561;0<D;){var G=31-ht(D),q=1<<G,ae=b[G];ae===-1?((q&g)===0||(q&x)!==0)&&(b[G]=Yt(q,f)):ae<=f&&(l.expiredLanes|=q),D&=~q}if(f=Vn,g=yn,g=ze(l,l===f?g:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),x=l.callbackNode,g===0||l===f&&(Pt===2||Pt===9)||l.cancelPendingCommit!==null)return x!==null&&x!==null&&At(x),l.callbackNode=null,l.callbackPriority=0;if((g&3)===0||st(l,g)){if(f=g&-g,f===l.callbackPriority)return f;switch(x!==null&&At(x),Su(g)){case 2:case 8:g=He;break;case 32:g=Oe;break;case 268435456:g=it;break;default:g=Oe}return x=$C.bind(null,l),g=$e(g,x),l.callbackPriority=f,l.callbackNode=g,f}return x!==null&&x!==null&&At(x),l.callbackPriority=2,l.callbackNode=null,2}function $C(l,f){if(xi!==0&&xi!==5)return l.callbackNode=null,l.callbackPriority=0,null;var g=l.callbackNode;if(Hp()&&l.callbackNode!==g)return null;var x=yn;return x=ze(l,l===Vn?x:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),x===0?null:(S(l,x,f),QC(l,z()),l.callbackNode!=null&&l.callbackNode===g?$C.bind(null,l):null)}function ZC(l,f){if(Hp())return null;S(l,f,!0)}function kP(){QP(function(){(En&6)!==0?$e(we,FP):JC()})}function LE(){if(rf===0){var l=Jo;l===0&&(l=lt,lt<<=1,(lt&261888)===0&&(lt=256)),rf=l}return rf}function eR(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:Jf(""+l)}function tR(l,f){var g=f.ownerDocument.createElement("input");return g.name=f.name,g.value=f.value,l.id&&g.setAttribute("form",l.id),f.parentNode.insertBefore(g,f),l=new FormData(l),g.parentNode.removeChild(g),l}function GP(l,f,g,x,b){if(f==="submit"&&g&&g.stateNode===b){var D=eR((b[Zi]||null).action),G=x.submitter;G&&(f=(f=G[Zi]||null)?eR(f.formAction):G.getAttribute("formAction"),f!==null&&(D=f,G=null));var q=new eh("action","action",null,x,b);l.push({event:q,listeners:[{instance:null,listener:function(){if(x.defaultPrevented){if(rf!==0){var ae=G?tR(b,G):new FormData(b);S0(g,{pending:!0,data:ae,method:b.method,action:D},null,ae)}}else typeof D=="function"&&(q.preventDefault(),ae=G?tR(b,G):new FormData(b),S0(g,{pending:!0,data:ae,method:b.method,action:D},D,ae))},currentTarget:b}]})}}for(var IE=0;IE<rp.length;IE++){var wE=rp[IE],HP=wE.toLowerCase(),zP=wE[0].toUpperCase()+wE.slice(1);ws(HP,"on"+zP)}ws(sr,"onAnimationEnd"),ws(Ng,"onAnimationIteration"),ws(lo,"onAnimationStart"),ws("dblclick","onDoubleClick"),ws("focusin","onFocus"),ws("focusout","onBlur"),ws(Uc,"onTransitionRun"),ws(Bl,"onTransitionStart"),ws(Ug,"onTransitionCancel"),ws(sp,"onTransitionEnd"),_e("onMouseEnter",["mouseout","mouseover"]),_e("onMouseLeave",["mouseout","mouseover"]),_e("onPointerEnter",["pointerout","pointerover"]),_e("onPointerLeave",["pointerout","pointerover"]),be("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),be("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),be("onBeforeInput",["compositionend","keypress","textInput","paste"]),be("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),be("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),be("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var I0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),VP=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(I0));function nR(l,f){f=(f&4)!==0;for(var g=0;g<l.length;g++){var x=l[g],b=x.event;x=x.listeners;e:{var D=void 0;if(f)for(var G=x.length-1;0<=G;G--){var q=x[G],ae=q.instance,Ee=q.currentTarget;if(q=q.listener,ae!==D&&b.isPropagationStopped())break e;D=q,b.currentTarget=Ee;try{D(b)}catch(Pe){Ol(Pe)}b.currentTarget=null,D=ae}else for(G=0;G<x.length;G++){if(q=x[G],ae=q.instance,Ee=q.currentTarget,q=q.listener,ae!==D&&b.isPropagationStopped())break e;D=q,b.currentTarget=Ee;try{D(b)}catch(Pe){Ol(Pe)}b.currentTarget=null,D=ae}}}}function Sn(l,f){var g=f[Au];g===void 0&&(g=f[Au]=new Set);var x=l+"__bubble";g.has(x)||(iR(f,l,2,!1),g.add(x))}function BE(l,f,g){var x=0;f&&(x|=4),iR(g,l,x,f)}var v_="_reactListening"+Math.random().toString(36).slice(2);function OE(l){if(!l[v_]){l[v_]=!0,de.forEach(function(g){g!=="selectionchange"&&(VP.has(g)||BE(g,!1,l),BE(g,!0,l))});var f=l.nodeType===9?l:l.ownerDocument;f===null||f[v_]||(f[v_]=!0,BE("selectionchange",!1,f))}}function iR(l,f,g,x){switch(wR(f)){case 2:var b=vN;break;case 8:b=yN;break;default:b=jE}g=b.bind(null,f,g,l),b=void 0,!Kd||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(b=!0),x?b!==void 0?l.addEventListener(f,g,{capture:!0,passive:b}):l.addEventListener(f,g,!0):b!==void 0?l.addEventListener(f,g,{passive:b}):l.addEventListener(f,g,!1)}function PE(l,f,g,x,b){var D=x;if((f&1)===0&&(f&2)===0&&x!==null)e:for(;;){if(x===null)return;var G=x.tag;if(G===3||G===4){var q=x.stateNode.containerInfo;if(q===b)break;if(G===4)for(G=x.return;G!==null;){var ae=G.tag;if((ae===3||ae===4)&&G.stateNode.containerInfo===b)return;G=G.return}for(;q!==null;){if(G=wi(q),G===null)return;if(ae=G.tag,ae===5||ae===6||ae===26||ae===27){x=D=G;continue e}q=q.parentNode}}x=x.return}yg(function(){var Ee=D,Pe=zd(g),Ke=[];e:{var Re=Vo.get(l);if(Re!==void 0){var Be=eh,Dt=l;switch(l){case"keypress":if(Du(g)===0)break e;case"keydown":case"keyup":Be=bg;break;case"focusin":Dt="focus",Be=jd;break;case"focusout":Dt="blur",Be=jd;break;case"beforeblur":case"afterblur":Be=jd;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Be=gy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Be=vy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Be=Ho;break;case sr:case Ng:case lo:Be=xy;break;case sp:Be=_E;break;case"scroll":case"scrollend":Be=qd;break;case"wheel":Be=Cl;break;case"copy":case"cut":case"paste":Be=xg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Be=Jd;break;case"toggle":case"beforetoggle":Be=Cg}var Xt=(f&4)!==0,oi=!Xt&&(l==="scroll"||l==="scrollend"),ge=Xt?Re!==null?Re+"Capture":null:Re;Xt=[];for(var ue=Ee,Ae;ue!==null;){var Ge=ue;if(Ae=Ge.stateNode,Ge=Ge.tag,Ge!==5&&Ge!==26&&Ge!==27||Ae===null||ge===null||(Ge=Ru(ue,ge),Ge!=null&&Xt.push(w0(ue,Ge,Ae))),oi)break;ue=ue.return}0<Xt.length&&(Re=new Be(Re,Dt,null,g,Pe),Ke.push({event:Re,listeners:Xt}))}}if((f&7)===0){e:{if(Re=l==="mouseover"||l==="pointerover",Be=l==="mouseout"||l==="pointerout",Re&&g!==Qf&&(Dt=g.relatedTarget||g.fromElement)&&(wi(Dt)||Dt[Rr]))break e;if((Be||Re)&&(Re=Pe.window===Pe?Pe:(Re=Pe.ownerDocument)?Re.defaultView||Re.parentWindow:window,Be?(Dt=g.relatedTarget||g.toElement,Be=Ee,Dt=Dt?wi(Dt):null,Dt!==null&&(oi=s(Dt),Xt=Dt.tag,Dt!==oi||Xt!==5&&Xt!==27&&Xt!==6)&&(Dt=null)):(Be=null,Dt=Ee),Be!==Dt)){if(Xt=gy,Ge="onMouseLeave",ge="onMouseEnter",ue="mouse",(l==="pointerout"||l==="pointerover")&&(Xt=Jd,Ge="onPointerLeave",ge="onPointerEnter",ue="pointer"),oi=Be==null?Re:Ma(Be),Ae=Dt==null?Re:Ma(Dt),Re=new Xt(Ge,ue+"leave",Be,g,Pe),Re.target=oi,Re.relatedTarget=Ae,Ge=null,wi(Pe)===Ee&&(Xt=new Xt(ge,ue+"enter",Dt,g,Pe),Xt.target=Ae,Xt.relatedTarget=oi,Ge=Xt),oi=Ge,Be&&Dt)t:{for(Xt=KP,ge=Be,ue=Dt,Ae=0,Ge=ge;Ge;Ge=Xt(Ge))Ae++;Ge=0;for(var Gt=ue;Gt;Gt=Xt(Gt))Ge++;for(;0<Ae-Ge;)ge=Xt(ge),Ae--;for(;0<Ge-Ae;)ue=Xt(ue),Ge--;for(;Ae--;){if(ge===ue||ue!==null&&ge===ue.alternate){Xt=ge;break t}ge=Xt(ge),ue=Xt(ue)}Xt=null}else Xt=null;Be!==null&&sR(Ke,Re,Be,Xt,!1),Dt!==null&&oi!==null&&sR(Ke,oi,Dt,Xt,!0)}}e:{if(Re=Ee?Ma(Ee):window,Be=Re.nodeName&&Re.nodeName.toLowerCase(),Be==="select"||Be==="input"&&Re.type==="file")var Yn=wg;else if(Lg(Re))if(ah)Yn=Iy;else{Yn=Ll;var wt=oh}else Be=Re.nodeName,!Be||Be.toLowerCase()!=="input"||Re.type!=="checkbox"&&Re.type!=="radio"?Ee&&Dr(Ee.elementType)&&(Yn=wg):Yn=Ly;if(Yn&&(Yn=Yn(l,Ee))){Zd(Ke,Yn,g,Pe);break e}wt&&wt(l,Re,Ee),l==="focusout"&&Ee&&Re.type==="number"&&Ee.memoizedProps.value!=null&&ls(Re,"number",Re.value)}switch(wt=Ee?Ma(Ee):window,l){case"focusin":(Lg(wt)||wt.contentEditable==="true")&&(Oc=wt,np=Ee,Pc=null);break;case"focusout":Pc=np=Oc=null;break;case"mousedown":Ir=!0;break;case"contextmenu":case"mouseup":case"dragend":Ir=!1,ip(Ke,g,Pe);break;case"selectionchange":if(wy)break;case"keydown":case"keyup":ip(Ke,g,Pe)}var fn;if(Lu)e:{switch(l){case"compositionstart":var bn="onCompositionStart";break e;case"compositionend":bn="onCompositionEnd";break e;case"compositionupdate":bn="onCompositionUpdate";break e}bn=void 0}else Dl?Qd(l,g)&&(bn="onCompositionEnd"):l==="keydown"&&g.keyCode===229&&(bn="onCompositionStart");bn&&(_s&&g.locale!=="ko"&&(Dl||bn!=="onCompositionStart"?bn==="onCompositionEnd"&&Dl&&(fn=Xd()):(Tl=Pe,Yd="value"in Tl?Tl.value:Tl.textContent,Dl=!0)),wt=y_(Ee,bn),0<wt.length&&(bn=new Sg(bn,l,null,g,Pe),Ke.push({event:bn,listeners:wt}),fn?bn.data=fn:(fn=Rc(g),fn!==null&&(bn.data=fn)))),(fn=Iu?$d(l,g):Cy(l,g))&&(bn=y_(Ee,"onBeforeInput"),0<bn.length&&(wt=new Sg("onBeforeInput","beforeinput",null,g,Pe),Ke.push({event:wt,listeners:bn}),wt.data=fn)),GP(Ke,l,Ee,g,Pe)}nR(Ke,f)})}function w0(l,f,g){return{instance:l,listener:f,currentTarget:g}}function y_(l,f){for(var g=f+"Capture",x=[];l!==null;){var b=l,D=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||D===null||(b=Ru(l,g),b!=null&&x.unshift(w0(l,b,D)),b=Ru(l,f),b!=null&&x.push(w0(l,b,D))),l.tag===3)return x;l=l.return}return[]}function KP(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function sR(l,f,g,x,b){for(var D=f._reactName,G=[];g!==null&&g!==x;){var q=g,ae=q.alternate,Ee=q.stateNode;if(q=q.tag,ae!==null&&ae===x)break;q!==5&&q!==26&&q!==27||Ee===null||(ae=Ee,b?(Ee=Ru(g,D),Ee!=null&&G.unshift(w0(g,Ee,ae))):b||(Ee=Ru(g,D),Ee!=null&&G.push(w0(g,Ee,ae)))),g=g.return}G.length!==0&&l.push({event:f,listeners:G})}var YP=/\r\n?/g,XP=/\u0000|\uFFFD/g;function rR(l){return(typeof l=="string"?l:""+l).replace(YP,`
`).replace(XP,"")}function aR(l,f){return f=rR(f),rR(l)===f}function ai(l,f,g,x,b,D){switch(g){case"children":typeof x=="string"?f==="body"||f==="textarea"&&x===""||zi(l,x):(typeof x=="number"||typeof x=="bigint")&&f!=="body"&&zi(l,""+x);break;case"className":kt(l,"class",x);break;case"tabIndex":kt(l,"tabindex",x);break;case"dir":case"role":case"viewBox":case"width":case"height":kt(l,g,x);break;case"style":Mu(l,x,D);break;case"data":if(f!=="object"){kt(l,"data",x);break}case"src":case"href":if(x===""&&(f!=="a"||g!=="href")){l.removeAttribute(g);break}if(x==null||typeof x=="function"||typeof x=="symbol"||typeof x=="boolean"){l.removeAttribute(g);break}x=Jf(""+x),l.setAttribute(g,x);break;case"action":case"formAction":if(typeof x=="function"){l.setAttribute(g,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof D=="function"&&(g==="formAction"?(f!=="input"&&ai(l,f,"name",b.name,b,null),ai(l,f,"formEncType",b.formEncType,b,null),ai(l,f,"formMethod",b.formMethod,b,null),ai(l,f,"formTarget",b.formTarget,b,null)):(ai(l,f,"encType",b.encType,b,null),ai(l,f,"method",b.method,b,null),ai(l,f,"target",b.target,b,null)));if(x==null||typeof x=="symbol"||typeof x=="boolean"){l.removeAttribute(g);break}x=Jf(""+x),l.setAttribute(g,x);break;case"onClick":x!=null&&(l.onclick=ao);break;case"onScroll":x!=null&&Sn("scroll",l);break;case"onScrollEnd":x!=null&&Sn("scrollend",l);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(n(61));if(g=x.__html,g!=null){if(b.children!=null)throw Error(n(60));l.innerHTML=g}}break;case"multiple":l.multiple=x&&typeof x!="function"&&typeof x!="symbol";break;case"muted":l.muted=x&&typeof x!="function"&&typeof x!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(x==null||typeof x=="function"||typeof x=="boolean"||typeof x=="symbol"){l.removeAttribute("xlink:href");break}g=Jf(""+x),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":x!=null&&typeof x!="function"&&typeof x!="symbol"?l.setAttribute(g,""+x):l.removeAttribute(g);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":x&&typeof x!="function"&&typeof x!="symbol"?l.setAttribute(g,""):l.removeAttribute(g);break;case"capture":case"download":x===!0?l.setAttribute(g,""):x!==!1&&x!=null&&typeof x!="function"&&typeof x!="symbol"?l.setAttribute(g,x):l.removeAttribute(g);break;case"cols":case"rows":case"size":case"span":x!=null&&typeof x!="function"&&typeof x!="symbol"&&!isNaN(x)&&1<=x?l.setAttribute(g,x):l.removeAttribute(g);break;case"rowSpan":case"start":x==null||typeof x=="function"||typeof x=="symbol"||isNaN(x)?l.removeAttribute(g):l.setAttribute(g,x);break;case"popover":Sn("beforetoggle",l),Sn("toggle",l),Rt(l,"popover",x);break;case"xlinkActuate":Mt(l,"http://www.w3.org/1999/xlink","xlink:actuate",x);break;case"xlinkArcrole":Mt(l,"http://www.w3.org/1999/xlink","xlink:arcrole",x);break;case"xlinkRole":Mt(l,"http://www.w3.org/1999/xlink","xlink:role",x);break;case"xlinkShow":Mt(l,"http://www.w3.org/1999/xlink","xlink:show",x);break;case"xlinkTitle":Mt(l,"http://www.w3.org/1999/xlink","xlink:title",x);break;case"xlinkType":Mt(l,"http://www.w3.org/1999/xlink","xlink:type",x);break;case"xmlBase":Mt(l,"http://www.w3.org/XML/1998/namespace","xml:base",x);break;case"xmlLang":Mt(l,"http://www.w3.org/XML/1998/namespace","xml:lang",x);break;case"xmlSpace":Mt(l,"http://www.w3.org/XML/1998/namespace","xml:space",x);break;case"is":Rt(l,"is",x);break;case"innerText":case"textContent":break;default:(!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(g=py.get(g)||g,Rt(l,g,x))}}function NE(l,f,g,x,b,D){switch(g){case"style":Mu(l,x,D);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(n(61));if(g=x.__html,g!=null){if(b.children!=null)throw Error(n(60));l.innerHTML=g}}break;case"children":typeof x=="string"?zi(l,x):(typeof x=="number"||typeof x=="bigint")&&zi(l,""+x);break;case"onScroll":x!=null&&Sn("scroll",l);break;case"onScrollEnd":x!=null&&Sn("scrollend",l);break;case"onClick":x!=null&&(l.onclick=ao);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!De.hasOwnProperty(g))e:{if(g[0]==="o"&&g[1]==="n"&&(b=g.endsWith("Capture"),f=g.slice(2,b?g.length-7:void 0),D=l[Zi]||null,D=D!=null?D[g]:null,typeof D=="function"&&l.removeEventListener(f,D,b),typeof x=="function")){typeof D!="function"&&D!==null&&(g in l?l[g]=null:l.hasAttribute(g)&&l.removeAttribute(g)),l.addEventListener(f,x,b);break e}g in l?l[g]=x:x===!0?l.setAttribute(g,""):Rt(l,g,x)}}}function Zs(l,f,g){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Sn("error",l),Sn("load",l);var x=!1,b=!1,D;for(D in g)if(g.hasOwnProperty(D)){var G=g[D];if(G!=null)switch(D){case"src":x=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,f));default:ai(l,f,D,G,g,null)}}b&&ai(l,f,"srcSet",g.srcSet,g,null),x&&ai(l,f,"src",g.src,g,null);return;case"input":Sn("invalid",l);var q=D=G=b=null,ae=null,Ee=null;for(x in g)if(g.hasOwnProperty(x)){var Pe=g[x];if(Pe!=null)switch(x){case"name":b=Pe;break;case"type":G=Pe;break;case"checked":ae=Pe;break;case"defaultChecked":Ee=Pe;break;case"value":D=Pe;break;case"defaultValue":q=Pe;break;case"children":case"dangerouslySetInnerHTML":if(Pe!=null)throw Error(n(137,f));break;default:ai(l,f,x,Pe,g,null)}}ro(l,D,q,ae,Ee,G,b,!1);return;case"select":Sn("invalid",l),x=G=D=null;for(b in g)if(g.hasOwnProperty(b)&&(q=g[b],q!=null))switch(b){case"value":D=q;break;case"defaultValue":G=q;break;case"multiple":x=q;default:ai(l,f,b,q,g,null)}f=D,g=G,l.multiple=!!x,f!=null?ra(l,!!x,f,!1):g!=null&&ra(l,!!x,g,!0);return;case"textarea":Sn("invalid",l),D=b=x=null;for(G in g)if(g.hasOwnProperty(G)&&(q=g[G],q!=null))switch(G){case"value":x=q;break;case"defaultValue":b=q;break;case"children":D=q;break;case"dangerouslySetInnerHTML":if(q!=null)throw Error(n(91));break;default:ai(l,f,G,q,g,null)}Si(l,x,b,D);return;case"option":for(ae in g)if(g.hasOwnProperty(ae)&&(x=g[ae],x!=null))switch(ae){case"selected":l.selected=x&&typeof x!="function"&&typeof x!="symbol";break;default:ai(l,f,ae,x,g,null)}return;case"dialog":Sn("beforetoggle",l),Sn("toggle",l),Sn("cancel",l),Sn("close",l);break;case"iframe":case"object":Sn("load",l);break;case"video":case"audio":for(x=0;x<I0.length;x++)Sn(I0[x],l);break;case"image":Sn("error",l),Sn("load",l);break;case"details":Sn("toggle",l);break;case"embed":case"source":case"link":Sn("error",l),Sn("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ee in g)if(g.hasOwnProperty(Ee)&&(x=g[Ee],x!=null))switch(Ee){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,f));default:ai(l,f,Ee,x,g,null)}return;default:if(Dr(f)){for(Pe in g)g.hasOwnProperty(Pe)&&(x=g[Pe],x!==void 0&&NE(l,f,Pe,x,g,void 0));return}}for(q in g)g.hasOwnProperty(q)&&(x=g[q],x!=null&&ai(l,f,q,x,g,null))}function qP(l,f,g,x){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,D=null,G=null,q=null,ae=null,Ee=null,Pe=null;for(Be in g){var Ke=g[Be];if(g.hasOwnProperty(Be)&&Ke!=null)switch(Be){case"checked":break;case"value":break;case"defaultValue":ae=Ke;default:x.hasOwnProperty(Be)||ai(l,f,Be,null,x,Ke)}}for(var Re in x){var Be=x[Re];if(Ke=g[Re],x.hasOwnProperty(Re)&&(Be!=null||Ke!=null))switch(Re){case"type":D=Be;break;case"name":b=Be;break;case"checked":Ee=Be;break;case"defaultChecked":Pe=Be;break;case"value":G=Be;break;case"defaultValue":q=Be;break;case"children":case"dangerouslySetInnerHTML":if(Be!=null)throw Error(n(137,f));break;default:Be!==Ke&&ai(l,f,Re,Be,x,Ke)}}os(l,G,q,ae,Ee,Pe,D,b);return;case"select":Be=G=q=Re=null;for(D in g)if(ae=g[D],g.hasOwnProperty(D)&&ae!=null)switch(D){case"value":break;case"multiple":Be=ae;default:x.hasOwnProperty(D)||ai(l,f,D,null,x,ae)}for(b in x)if(D=x[b],ae=g[b],x.hasOwnProperty(b)&&(D!=null||ae!=null))switch(b){case"value":Re=D;break;case"defaultValue":q=D;break;case"multiple":G=D;default:D!==ae&&ai(l,f,b,D,x,ae)}f=q,g=G,x=Be,Re!=null?ra(l,!!g,Re,!1):!!x!=!!g&&(f!=null?ra(l,!!g,f,!0):ra(l,!!g,g?[]:"",!1));return;case"textarea":Be=Re=null;for(q in g)if(b=g[q],g.hasOwnProperty(q)&&b!=null&&!x.hasOwnProperty(q))switch(q){case"value":break;case"children":break;default:ai(l,f,q,null,x,b)}for(G in x)if(b=x[G],D=g[G],x.hasOwnProperty(G)&&(b!=null||D!=null))switch(G){case"value":Re=b;break;case"defaultValue":Be=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(n(91));break;default:b!==D&&ai(l,f,G,b,x,D)}Hn(l,Re,Be);return;case"option":for(var Dt in g)if(Re=g[Dt],g.hasOwnProperty(Dt)&&Re!=null&&!x.hasOwnProperty(Dt))switch(Dt){case"selected":l.selected=!1;break;default:ai(l,f,Dt,null,x,Re)}for(ae in x)if(Re=x[ae],Be=g[ae],x.hasOwnProperty(ae)&&Re!==Be&&(Re!=null||Be!=null))switch(ae){case"selected":l.selected=Re&&typeof Re!="function"&&typeof Re!="symbol";break;default:ai(l,f,ae,Re,x,Be)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Xt in g)Re=g[Xt],g.hasOwnProperty(Xt)&&Re!=null&&!x.hasOwnProperty(Xt)&&ai(l,f,Xt,null,x,Re);for(Ee in x)if(Re=x[Ee],Be=g[Ee],x.hasOwnProperty(Ee)&&Re!==Be&&(Re!=null||Be!=null))switch(Ee){case"children":case"dangerouslySetInnerHTML":if(Re!=null)throw Error(n(137,f));break;default:ai(l,f,Ee,Re,x,Be)}return;default:if(Dr(f)){for(var oi in g)Re=g[oi],g.hasOwnProperty(oi)&&Re!==void 0&&!x.hasOwnProperty(oi)&&NE(l,f,oi,void 0,x,Re);for(Pe in x)Re=x[Pe],Be=g[Pe],!x.hasOwnProperty(Pe)||Re===Be||Re===void 0&&Be===void 0||NE(l,f,Pe,Re,x,Be);return}}for(var ge in g)Re=g[ge],g.hasOwnProperty(ge)&&Re!=null&&!x.hasOwnProperty(ge)&&ai(l,f,ge,null,x,Re);for(Ke in x)Re=x[Ke],Be=g[Ke],!x.hasOwnProperty(Ke)||Re===Be||Re==null&&Be==null||ai(l,f,Ke,Re,x,Be)}function oR(l){switch(l){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function WP(){if(typeof performance.getEntriesByType=="function"){for(var l=0,f=0,g=performance.getEntriesByType("resource"),x=0;x<g.length;x++){var b=g[x],D=b.transferSize,G=b.initiatorType,q=b.duration;if(D&&q&&oR(G)){for(G=0,q=b.responseEnd,x+=1;x<g.length;x++){var ae=g[x],Ee=ae.startTime;if(Ee>q)break;var Pe=ae.transferSize,Ke=ae.initiatorType;Pe&&oR(Ke)&&(ae=ae.responseEnd,G+=Pe*(ae<q?1:(q-Ee)/(ae-Ee)))}if(--x,f+=8*(D+G)/(b.duration/1e3),l++,10<l)break}}if(0<l)return f/l/1e6}return navigator.connection&&(l=navigator.connection.downlink,typeof l=="number")?l:5}var UE=null,FE=null;function __(l){return l.nodeType===9?l:l.ownerDocument}function lR(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function uR(l,f){if(l===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&f==="foreignObject"?0:l}function kE(l,f){return l==="textarea"||l==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var GE=null;function jP(){var l=window.event;return l&&l.type==="popstate"?l===GE?!1:(GE=l,!0):(GE=null,!1)}var cR=typeof setTimeout=="function"?setTimeout:void 0,JP=typeof clearTimeout=="function"?clearTimeout:void 0,fR=typeof Promise=="function"?Promise:void 0,QP=typeof queueMicrotask=="function"?queueMicrotask:typeof fR<"u"?function(l){return fR.resolve(null).then(l).catch($P)}:cR;function $P(l){setTimeout(function(){throw l})}function af(l){return l==="head"}function hR(l,f){var g=f,x=0;do{var b=g.nextSibling;if(l.removeChild(g),b&&b.nodeType===8)if(g=b.data,g==="/$"||g==="/&"){if(x===0){l.removeChild(b),Xp(f);return}x--}else if(g==="$"||g==="$?"||g==="$~"||g==="$!"||g==="&")x++;else if(g==="html")B0(l.ownerDocument.documentElement);else if(g==="head"){g=l.ownerDocument.head,B0(g);for(var D=g.firstChild;D;){var G=D.nextSibling,q=D.nodeName;D[Go]||q==="SCRIPT"||q==="STYLE"||q==="LINK"&&D.rel.toLowerCase()==="stylesheet"||g.removeChild(D),D=G}}else g==="body"&&B0(l.ownerDocument.body);g=b}while(g);Xp(f)}function dR(l,f){var g=l;l=0;do{var x=g.nextSibling;if(g.nodeType===1?f?(g._stashedDisplay=g.style.display,g.style.display="none"):(g.style.display=g._stashedDisplay||"",g.getAttribute("style")===""&&g.removeAttribute("style")):g.nodeType===3&&(f?(g._stashedText=g.nodeValue,g.nodeValue=""):g.nodeValue=g._stashedText||""),x&&x.nodeType===8)if(g=x.data,g==="/$"){if(l===0)break;l--}else g!=="$"&&g!=="$?"&&g!=="$~"&&g!=="$!"||l++;g=x}while(g)}function HE(l){var f=l.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var g=f;switch(f=f.nextSibling,g.nodeName){case"HTML":case"HEAD":case"BODY":HE(g),bu(g);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(g.rel.toLowerCase()==="stylesheet")continue}l.removeChild(g)}}function ZP(l,f,g,x){for(;l.nodeType===1;){var b=g;if(l.nodeName.toLowerCase()!==f.toLowerCase()){if(!x&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(x){if(!l[Go])switch(f){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(D=l.getAttribute("rel"),D==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(D!==b.rel||l.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||l.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||l.getAttribute("title")!==(b.title==null?null:b.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(D=l.getAttribute("src"),(D!==(b.src==null?null:b.src)||l.getAttribute("type")!==(b.type==null?null:b.type)||l.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&D&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(f==="input"&&l.type==="hidden"){var D=b.name==null?null:""+b.name;if(b.type==="hidden"&&l.getAttribute("name")===D)return l}else return l;if(l=To(l.nextSibling),l===null)break}return null}function eN(l,f,g){if(f==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!g||(l=To(l.nextSibling),l===null))return null;return l}function pR(l,f){for(;l.nodeType!==8;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!f||(l=To(l.nextSibling),l===null))return null;return l}function zE(l){return l.data==="$?"||l.data==="$~"}function VE(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState!=="loading"}function tN(l,f){var g=l.ownerDocument;if(l.data==="$~")l._reactRetry=f;else if(l.data!=="$?"||g.readyState!=="loading")f();else{var x=function(){f(),g.removeEventListener("DOMContentLoaded",x)};g.addEventListener("DOMContentLoaded",x),l._reactRetry=x}}function To(l){for(;l!=null;l=l.nextSibling){var f=l.nodeType;if(f===1||f===3)break;if(f===8){if(f=l.data,f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"||f==="F!"||f==="F")break;if(f==="/$"||f==="/&")return null}}return l}var KE=null;function mR(l){l=l.nextSibling;for(var f=0;l;){if(l.nodeType===8){var g=l.data;if(g==="/$"||g==="/&"){if(f===0)return To(l.nextSibling);f--}else g!=="$"&&g!=="$!"&&g!=="$?"&&g!=="$~"&&g!=="&"||f++}l=l.nextSibling}return null}function gR(l){l=l.previousSibling;for(var f=0;l;){if(l.nodeType===8){var g=l.data;if(g==="$"||g==="$!"||g==="$?"||g==="$~"||g==="&"){if(f===0)return l;f--}else g!=="/$"&&g!=="/&"||f++}l=l.previousSibling}return null}function vR(l,f,g){switch(f=__(g),l){case"html":if(l=f.documentElement,!l)throw Error(n(452));return l;case"head":if(l=f.head,!l)throw Error(n(453));return l;case"body":if(l=f.body,!l)throw Error(n(454));return l;default:throw Error(n(451))}}function B0(l){for(var f=l.attributes;f.length;)l.removeAttributeNode(f[0]);bu(l)}var bo=new Map,yR=new Set;function x_(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var ec=K.d;K.d={f:nN,r:iN,D:sN,C:rN,L:aN,m:oN,X:uN,S:lN,M:cN};function nN(){var l=ec.f(),f=W();return l||f}function iN(l){var f=$n(l);f!==null&&f.tag===5&&f.type==="form"?A0(f):ec.r(l)}var Vp=typeof document>"u"?null:document;function _R(l,f,g){var x=Vp;if(x&&typeof f=="string"&&f){var b=Jt(f);b='link[rel="'+l+'"][href="'+b+'"]',typeof g=="string"&&(b+='[crossorigin="'+g+'"]'),yR.has(b)||(yR.add(b),l={rel:l,crossOrigin:g,href:f},x.querySelector(b)===null&&(f=x.createElement("link"),Zs(f,"link",l),X(f),x.head.appendChild(f)))}}function sN(l){ec.D(l),_R("dns-prefetch",l,null)}function rN(l,f){ec.C(l,f),_R("preconnect",l,f)}function aN(l,f,g){ec.L(l,f,g);var x=Vp;if(x&&l&&f){var b='link[rel="preload"][as="'+Jt(f)+'"]';f==="image"&&g&&g.imageSrcSet?(b+='[imagesrcset="'+Jt(g.imageSrcSet)+'"]',typeof g.imageSizes=="string"&&(b+='[imagesizes="'+Jt(g.imageSizes)+'"]')):b+='[href="'+Jt(l)+'"]';var D=b;switch(f){case"style":D=Kp(l);break;case"script":D=Yp(l)}bo.has(D)||(l=p({rel:"preload",href:f==="image"&&g&&g.imageSrcSet?void 0:l,as:f},g),bo.set(D,l),x.querySelector(b)!==null||f==="style"&&x.querySelector(O0(D))||f==="script"&&x.querySelector(P0(D))||(f=x.createElement("link"),Zs(f,"link",l),X(f),x.head.appendChild(f)))}}function oN(l,f){ec.m(l,f);var g=Vp;if(g&&l){var x=f&&typeof f.as=="string"?f.as:"script",b='link[rel="modulepreload"][as="'+Jt(x)+'"][href="'+Jt(l)+'"]',D=b;switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":D=Yp(l)}if(!bo.has(D)&&(l=p({rel:"modulepreload",href:l},f),bo.set(D,l),g.querySelector(b)===null)){switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(g.querySelector(P0(D)))return}x=g.createElement("link"),Zs(x,"link",l),X(x),g.head.appendChild(x)}}}function lN(l,f,g){ec.S(l,f,g);var x=Vp;if(x&&l){var b=Ca(x).hoistableStyles,D=Kp(l);f=f||"default";var G=b.get(D);if(!G){var q={loading:0,preload:null};if(G=x.querySelector(O0(D)))q.loading=5;else{l=p({rel:"stylesheet",href:l,"data-precedence":f},g),(g=bo.get(D))&&YE(l,g);var ae=G=x.createElement("link");X(ae),Zs(ae,"link",l),ae._p=new Promise(function(Ee,Pe){ae.onload=Ee,ae.onerror=Pe}),ae.addEventListener("load",function(){q.loading|=1}),ae.addEventListener("error",function(){q.loading|=2}),q.loading|=4,S_(G,f,x)}G={type:"stylesheet",instance:G,count:1,state:q},b.set(D,G)}}}function uN(l,f){ec.X(l,f);var g=Vp;if(g&&l){var x=Ca(g).hoistableScripts,b=Yp(l),D=x.get(b);D||(D=g.querySelector(P0(b)),D||(l=p({src:l,async:!0},f),(f=bo.get(b))&&XE(l,f),D=g.createElement("script"),X(D),Zs(D,"link",l),g.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},x.set(b,D))}}function cN(l,f){ec.M(l,f);var g=Vp;if(g&&l){var x=Ca(g).hoistableScripts,b=Yp(l),D=x.get(b);D||(D=g.querySelector(P0(b)),D||(l=p({src:l,async:!0,type:"module"},f),(f=bo.get(b))&&XE(l,f),D=g.createElement("script"),X(D),Zs(D,"link",l),g.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},x.set(b,D))}}function xR(l,f,g,x){var b=(b=ce.current)?x_(b):null;if(!b)throw Error(n(446));switch(l){case"meta":case"title":return null;case"style":return typeof g.precedence=="string"&&typeof g.href=="string"?(f=Kp(g.href),g=Ca(b).hoistableStyles,x=g.get(f),x||(x={type:"style",instance:null,count:0,state:null},g.set(f,x)),x):{type:"void",instance:null,count:0,state:null};case"link":if(g.rel==="stylesheet"&&typeof g.href=="string"&&typeof g.precedence=="string"){l=Kp(g.href);var D=Ca(b).hoistableStyles,G=D.get(l);if(G||(b=b.ownerDocument||b,G={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},D.set(l,G),(D=b.querySelector(O0(l)))&&!D._p&&(G.instance=D,G.state.loading=5),bo.has(l)||(g={rel:"preload",as:"style",href:g.href,crossOrigin:g.crossOrigin,integrity:g.integrity,media:g.media,hrefLang:g.hrefLang,referrerPolicy:g.referrerPolicy},bo.set(l,g),D||fN(b,l,g,G.state))),f&&x===null)throw Error(n(528,""));return G}if(f&&x!==null)throw Error(n(529,""));return null;case"script":return f=g.async,g=g.src,typeof g=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=Yp(g),g=Ca(b).hoistableScripts,x=g.get(f),x||(x={type:"script",instance:null,count:0,state:null},g.set(f,x)),x):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,l))}}function Kp(l){return'href="'+Jt(l)+'"'}function O0(l){return'link[rel="stylesheet"]['+l+"]"}function SR(l){return p({},l,{"data-precedence":l.precedence,precedence:null})}function fN(l,f,g,x){l.querySelector('link[rel="preload"][as="style"]['+f+"]")?x.loading=1:(f=l.createElement("link"),x.preload=f,f.addEventListener("load",function(){return x.loading|=1}),f.addEventListener("error",function(){return x.loading|=2}),Zs(f,"link",g),X(f),l.head.appendChild(f))}function Yp(l){return'[src="'+Jt(l)+'"]'}function P0(l){return"script[async]"+l}function AR(l,f,g){if(f.count++,f.instance===null)switch(f.type){case"style":var x=l.querySelector('style[data-href~="'+Jt(g.href)+'"]');if(x)return f.instance=x,X(x),x;var b=p({},g,{"data-href":g.href,"data-precedence":g.precedence,href:null,precedence:null});return x=(l.ownerDocument||l).createElement("style"),X(x),Zs(x,"style",b),S_(x,g.precedence,l),f.instance=x;case"stylesheet":b=Kp(g.href);var D=l.querySelector(O0(b));if(D)return f.state.loading|=4,f.instance=D,X(D),D;x=SR(g),(b=bo.get(b))&&YE(x,b),D=(l.ownerDocument||l).createElement("link"),X(D);var G=D;return G._p=new Promise(function(q,ae){G.onload=q,G.onerror=ae}),Zs(D,"link",x),f.state.loading|=4,S_(D,g.precedence,l),f.instance=D;case"script":return D=Yp(g.src),(b=l.querySelector(P0(D)))?(f.instance=b,X(b),b):(x=g,(b=bo.get(D))&&(x=p({},g),XE(x,b)),l=l.ownerDocument||l,b=l.createElement("script"),X(b),Zs(b,"link",x),l.head.appendChild(b),f.instance=b);case"void":return null;default:throw Error(n(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(x=f.instance,f.state.loading|=4,S_(x,g.precedence,l));return f.instance}function S_(l,f,g){for(var x=g.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=x.length?x[x.length-1]:null,D=b,G=0;G<x.length;G++){var q=x[G];if(q.dataset.precedence===f)D=q;else if(D!==b)break}D?D.parentNode.insertBefore(l,D.nextSibling):(f=g.nodeType===9?g.head:g,f.insertBefore(l,f.firstChild))}function YE(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.title==null&&(l.title=f.title)}function XE(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.integrity==null&&(l.integrity=f.integrity)}var A_=null;function ER(l,f,g){if(A_===null){var x=new Map,b=A_=new Map;b.set(g,x)}else b=A_,x=b.get(g),x||(x=new Map,b.set(g,x));if(x.has(l))return x;for(x.set(l,null),g=g.getElementsByTagName(l),b=0;b<g.length;b++){var D=g[b];if(!(D[Go]||D[ln]||l==="link"&&D.getAttribute("rel")==="stylesheet")&&D.namespaceURI!=="http://www.w3.org/2000/svg"){var G=D.getAttribute(f)||"";G=l+G;var q=x.get(G);q?q.push(D):x.set(G,[D])}}return x}function TR(l,f,g){l=l.ownerDocument||l,l.head.insertBefore(g,f==="title"?l.querySelector("head > title"):null)}function hN(l,f,g){if(g===1||f.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return l=f.disabled,typeof f.precedence=="string"&&l==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function bR(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}function dN(l,f,g,x){if(g.type==="stylesheet"&&(typeof x.media!="string"||matchMedia(x.media).matches!==!1)&&(g.state.loading&4)===0){if(g.instance===null){var b=Kp(x.href),D=f.querySelector(O0(b));if(D){f=D._p,f!==null&&typeof f=="object"&&typeof f.then=="function"&&(l.count++,l=E_.bind(l),f.then(l,l)),g.state.loading|=4,g.instance=D,X(D);return}D=f.ownerDocument||f,x=SR(x),(b=bo.get(b))&&YE(x,b),D=D.createElement("link"),X(D);var G=D;G._p=new Promise(function(q,ae){G.onload=q,G.onerror=ae}),Zs(D,"link",x),g.instance=D}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(g,f),(f=g.state.preload)&&(g.state.loading&3)===0&&(l.count++,g=E_.bind(l),f.addEventListener("load",g),f.addEventListener("error",g))}}var qE=0;function pN(l,f){return l.stylesheets&&l.count===0&&b_(l,l.stylesheets),0<l.count||0<l.imgCount?function(g){var x=setTimeout(function(){if(l.stylesheets&&b_(l,l.stylesheets),l.unsuspend){var D=l.unsuspend;l.unsuspend=null,D()}},6e4+f);0<l.imgBytes&&qE===0&&(qE=62500*WP());var b=setTimeout(function(){if(l.waitingForImages=!1,l.count===0&&(l.stylesheets&&b_(l,l.stylesheets),l.unsuspend)){var D=l.unsuspend;l.unsuspend=null,D()}},(l.imgBytes>qE?50:800)+f);return l.unsuspend=g,function(){l.unsuspend=null,clearTimeout(x),clearTimeout(b)}}:null}function E_(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)b_(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var T_=null;function b_(l,f){l.stylesheets=null,l.unsuspend!==null&&(l.count++,T_=new Map,f.forEach(mN,l),T_=null,E_.call(l))}function mN(l,f){if(!(f.state.loading&4)){var g=T_.get(l);if(g)var x=g.get(null);else{g=new Map,T_.set(l,g);for(var b=l.querySelectorAll("link[data-precedence],style[data-precedence]"),D=0;D<b.length;D++){var G=b[D];(G.nodeName==="LINK"||G.getAttribute("media")!=="not all")&&(g.set(G.dataset.precedence,G),x=G)}x&&g.set(null,x)}b=f.instance,G=b.getAttribute("data-precedence"),D=g.get(G)||x,D===x&&g.set(null,b),g.set(G,b),this.count++,x=E_.bind(this),b.addEventListener("load",x),b.addEventListener("error",x),D?D.parentNode.insertBefore(b,D.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(b,l.firstChild)),f.state.loading|=4}}var N0={$$typeof:R,Provider:null,Consumer:null,_currentValue:j,_currentValue2:j,_threadCount:0};function gN(l,f,g,x,b,D,G,q,ae){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=gn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gn(0),this.hiddenUpdates=gn(null),this.identifierPrefix=x,this.onUncaughtError=b,this.onCaughtError=D,this.onRecoverableError=G,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ae,this.incompleteTransitions=new Map}function MR(l,f,g,x,b,D,G,q,ae,Ee,Pe,Ke){return l=new gN(l,f,g,G,ae,Ee,Pe,Ke,q),f=1,D===!0&&(f|=24),D=qs(3,null,null,f),l.current=D,D.stateNode=l,f=Kg(),f.refCount++,l.pooledCache=f,f.refCount++,D.memoizedState={element:x,isDehydrated:g,cache:f},Jg(D),l}function CR(l){return l?(l=Ul,l):Ul}function RR(l,f,g,x,b,D){b=CR(b),x.context===null?x.context=b:x.pendingContext=b,x=mo(f),x.payload={element:g},D=D===void 0?null:D,D!==null&&(x.callback=D),g=Qo(l,x,f),g!==null&&(m(g,l,f),Yl(g,l,f))}function DR(l,f){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var g=l.retryLane;l.retryLane=g!==0&&g<f?g:f}}function WE(l,f){DR(l,f),(l=l.alternate)&&DR(l,f)}function LR(l){if(l.tag===13||l.tag===31){var f=Nl(l,67108864);f!==null&&m(f,l,67108864),WE(l,67108864)}}function IR(l){if(l.tag===13||l.tag===31){var f=$s();f=ia(f);var g=Nl(l,f);g!==null&&m(g,l,f),WE(l,f)}}var M_=!0;function vN(l,f,g,x){var b=k.T;k.T=null;var D=K.p;try{K.p=2,jE(l,f,g,x)}finally{K.p=D,k.T=b}}function yN(l,f,g,x){var b=k.T;k.T=null;var D=K.p;try{K.p=8,jE(l,f,g,x)}finally{K.p=D,k.T=b}}function jE(l,f,g,x){if(M_){var b=JE(x);if(b===null)PE(l,f,x,C_,g),BR(l,x);else if(xN(b,l,f,g,x))x.stopPropagation();else if(BR(l,x),f&4&&-1<_N.indexOf(l)){for(;b!==null;){var D=$n(b);if(D!==null)switch(D.tag){case 3:if(D=D.stateNode,D.current.memoizedState.isDehydrated){var G=qe(D.pendingLanes);if(G!==0){var q=D;for(q.pendingLanes|=2,q.entangledLanes|=2;G;){var ae=1<<31-ht(G);q.entanglements[1]|=ae,G&=~ae}eu(D),(En&6)===0&&(Yr=z()+500,L0(0))}}break;case 31:case 13:q=Nl(D,2),q!==null&&m(q,D,2),W(),WE(D,2)}if(D=JE(x),D===null&&PE(l,f,x,C_,g),D===b)break;b=D}b!==null&&x.stopPropagation()}else PE(l,f,x,null,g)}}function JE(l){return l=zd(l),QE(l)}var C_=null;function QE(l){if(C_=null,l=wi(l),l!==null){var f=s(l);if(f===null)l=null;else{var g=f.tag;if(g===13){if(l=a(f),l!==null)return l;l=null}else if(g===31){if(l=o(f),l!==null)return l;l=null}else if(g===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;l=null}else f!==l&&(l=null)}}return C_=l,null}function wR(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(fe()){case we:return 2;case He:return 8;case Oe:case Et:return 32;case it:return 268435456;default:return 32}default:return 32}}var $E=!1,of=null,lf=null,uf=null,U0=new Map,F0=new Map,cf=[],_N="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function BR(l,f){switch(l){case"focusin":case"focusout":of=null;break;case"dragenter":case"dragleave":lf=null;break;case"mouseover":case"mouseout":uf=null;break;case"pointerover":case"pointerout":U0.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":F0.delete(f.pointerId)}}function k0(l,f,g,x,b,D){return l===null||l.nativeEvent!==D?(l={blockedOn:f,domEventName:g,eventSystemFlags:x,nativeEvent:D,targetContainers:[b]},f!==null&&(f=$n(f),f!==null&&LR(f)),l):(l.eventSystemFlags|=x,f=l.targetContainers,b!==null&&f.indexOf(b)===-1&&f.push(b),l)}function xN(l,f,g,x,b){switch(f){case"focusin":return of=k0(of,l,f,g,x,b),!0;case"dragenter":return lf=k0(lf,l,f,g,x,b),!0;case"mouseover":return uf=k0(uf,l,f,g,x,b),!0;case"pointerover":var D=b.pointerId;return U0.set(D,k0(U0.get(D)||null,l,f,g,x,b)),!0;case"gotpointercapture":return D=b.pointerId,F0.set(D,k0(F0.get(D)||null,l,f,g,x,b)),!0}return!1}function OR(l){var f=wi(l.target);if(f!==null){var g=s(f);if(g!==null){if(f=g.tag,f===13){if(f=a(g),f!==null){l.blockedOn=f,as(l.priority,function(){IR(g)});return}}else if(f===31){if(f=o(g),f!==null){l.blockedOn=f,as(l.priority,function(){IR(g)});return}}else if(f===3&&g.stateNode.current.memoizedState.isDehydrated){l.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}l.blockedOn=null}function R_(l){if(l.blockedOn!==null)return!1;for(var f=l.targetContainers;0<f.length;){var g=JE(l.nativeEvent);if(g===null){g=l.nativeEvent;var x=new g.constructor(g.type,g);Qf=x,g.target.dispatchEvent(x),Qf=null}else return f=$n(g),f!==null&&LR(f),l.blockedOn=g,!1;f.shift()}return!0}function PR(l,f,g){R_(l)&&g.delete(f)}function SN(){$E=!1,of!==null&&R_(of)&&(of=null),lf!==null&&R_(lf)&&(lf=null),uf!==null&&R_(uf)&&(uf=null),U0.forEach(PR),F0.forEach(PR)}function D_(l,f){l.blockedOn===f&&(l.blockedOn=null,$E||($E=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,SN)))}var L_=null;function NR(l){L_!==l&&(L_=l,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){L_===l&&(L_=null);for(var f=0;f<l.length;f+=3){var g=l[f],x=l[f+1],b=l[f+2];if(typeof x!="function"){if(QE(x||g)===null)continue;break}var D=$n(g);D!==null&&(l.splice(f,3),f-=3,S0(D,{pending:!0,data:b,method:g.method,action:x},x,b))}}))}function Xp(l){function f(ae){return D_(ae,l)}of!==null&&D_(of,l),lf!==null&&D_(lf,l),uf!==null&&D_(uf,l),U0.forEach(f),F0.forEach(f);for(var g=0;g<cf.length;g++){var x=cf[g];x.blockedOn===l&&(x.blockedOn=null)}for(;0<cf.length&&(g=cf[0],g.blockedOn===null);)OR(g),g.blockedOn===null&&cf.shift();if(g=(l.ownerDocument||l).$$reactFormReplay,g!=null)for(x=0;x<g.length;x+=3){var b=g[x],D=g[x+1],G=b[Zi]||null;if(typeof D=="function")G||NR(g);else if(G){var q=null;if(D&&D.hasAttribute("formAction")){if(b=D,G=D[Zi]||null)q=G.formAction;else if(QE(b)!==null)continue}else q=G.action;typeof q=="function"?g[x+1]=q:(g.splice(x,3),x-=3),NR(g)}}}function UR(){function l(D){D.canIntercept&&D.info==="react-transition"&&D.intercept({handler:function(){return new Promise(function(G){return b=G})},focusReset:"manual",scroll:"manual"})}function f(){b!==null&&(b(),b=null),x||setTimeout(g,20)}function g(){if(!x&&!navigation.transition){var D=navigation.currentEntry;D&&D.url!=null&&navigation.navigate(D.url,{state:D.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var x=!1,b=null;return navigation.addEventListener("navigate",l),navigation.addEventListener("navigatesuccess",f),navigation.addEventListener("navigateerror",f),setTimeout(g,100),function(){x=!0,navigation.removeEventListener("navigate",l),navigation.removeEventListener("navigatesuccess",f),navigation.removeEventListener("navigateerror",f),b!==null&&(b(),b=null)}}}function ZE(l){this._internalRoot=l}I_.prototype.render=ZE.prototype.render=function(l){var f=this._internalRoot;if(f===null)throw Error(n(409));var g=f.current,x=$s();RR(g,x,l,f,null,null)},I_.prototype.unmount=ZE.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var f=l.containerInfo;RR(l.current,2,null,l,null,null),W(),f[Rr]=null}};function I_(l){this._internalRoot=l}I_.prototype.unstable_scheduleHydration=function(l){if(l){var f=sa();l={blockedOn:null,target:l,priority:f};for(var g=0;g<cf.length&&f!==0&&f<cf[g].priority;g++);cf.splice(g,0,l),g===0&&OR(l)}};var FR=e.version;if(FR!=="19.2.3")throw Error(n(527,FR,"19.2.3"));K.findDOMNode=function(l){var f=l._reactInternals;if(f===void 0)throw typeof l.render=="function"?Error(n(188)):(l=Object.keys(l).join(","),Error(n(268,l)));return l=c(f),l=l!==null?h(l):null,l=l===null?null:l.stateNode,l};var AN={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var w_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!w_.isDisabled&&w_.supportsFiber)try{Ye=w_.inject(AN),Je=w_}catch{}}return H0.createRoot=function(l,f){if(!i(l))throw Error(n(299));var g=!1,x="",b=b0,D=c_,G=Dp;return f!=null&&(f.unstable_strictMode===!0&&(g=!0),f.identifierPrefix!==void 0&&(x=f.identifierPrefix),f.onUncaughtError!==void 0&&(b=f.onUncaughtError),f.onCaughtError!==void 0&&(D=f.onCaughtError),f.onRecoverableError!==void 0&&(G=f.onRecoverableError)),f=MR(l,1,!1,null,null,g,x,null,b,D,G,UR),l[Rr]=f.current,OE(l),new ZE(f)},H0.hydrateRoot=function(l,f,g){if(!i(l))throw Error(n(299));var x=!1,b="",D=b0,G=c_,q=Dp,ae=null;return g!=null&&(g.unstable_strictMode===!0&&(x=!0),g.identifierPrefix!==void 0&&(b=g.identifierPrefix),g.onUncaughtError!==void 0&&(D=g.onUncaughtError),g.onCaughtError!==void 0&&(G=g.onCaughtError),g.onRecoverableError!==void 0&&(q=g.onRecoverableError),g.formState!==void 0&&(ae=g.formState)),f=MR(l,1,!0,f,g??null,x,b,ae,D,G,q,UR),f.context=CR(null),g=f.current,x=$s(),x=ia(x),b=mo(x),b.callback=null,Qo(g,b,x),g=x,f.current.lanes=g,vs(f,g),eu(f),l[Rr]=f.current,OE(l),new I_(f)},H0.version="19.2.3",H0}var WR;function wN(){if(WR)return nT.exports;WR=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),nT.exports=IN(),nT.exports}var BN=wN();const ON=EA(BN);var aT={exports:{}},tc={};var jR;function PN(){return jR||(jR=1,tc.ConcurrentRoot=1,tc.ContinuousEventPriority=8,tc.DefaultEventPriority=32,tc.DiscreteEventPriority=2,tc.IdleEventPriority=268435456,tc.LegacyRoot=0,tc.NoEventPriority=0),tc}var JR;function NN(){return JR||(JR=1,aT.exports=PN()),aT.exports}var Vx=NN();const og="182",UN={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},FN={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Pw=0,$b=1,Nw=2,kN=3,Uw=0,Rm=1,hv=2,ud=3,du=0,ta=1,Lo=2,vl=0,vd=1,Zb=2,e1=3,t1=4,Fw=5,Tf=100,kw=101,Gw=102,Hw=103,zw=104,Vw=200,Kw=201,Yw=202,Xw=203,rS=204,aS=205,qw=206,Ww=207,jw=208,Jw=209,Qw=210,$w=211,Zw=212,e2=213,t2=214,oS=0,lS=1,uS=2,Md=3,cS=4,fS=5,hS=6,dS=7,Zv=0,n2=1,i2=2,Oo=0,nM=1,iM=2,sM=3,TA=4,rM=5,aM=6,oM=7,n1="attached",s2="detached",bA=300,pu=301,Pf=302,Rv=303,Dv=304,lg=306,mu=1e3,Zr=1001,km=1002,Ji=1003,MA=1004,GN=1004,cd=1005,HN=1005,Gn=1006,Dm=1007,zN=1007,Io=1008,VN=1008,Jr=1009,lM=1010,uM=1011,Cd=1012,CA=1013,Po=1014,Ar=1015,Za=1016,RA=1017,DA=1018,Gm=1020,cM=35902,fM=35899,hM=1021,dM=1022,Er=1023,_l=1026,Mf=1027,LA=1028,ey=1029,Rd=1030,IA=1031,KN=1032,wA=1033,dv=33776,pv=33777,mv=33778,gv=33779,pS=35840,mS=35841,gS=35842,vS=35843,yS=36196,_S=37492,xS=37496,SS=37488,AS=37489,ES=37490,TS=37491,bS=37808,MS=37809,CS=37810,RS=37811,DS=37812,LS=37813,IS=37814,wS=37815,BS=37816,OS=37817,PS=37818,NS=37819,US=37820,FS=37821,kS=36492,GS=36494,HS=36495,zS=36283,VS=36284,KS=36285,YS=36286,r2=2200,a2=2201,o2=2202,Hm=2300,zm=2301,Kx=2302,fd=2400,hd=2401,Lv=2402,BA=2500,pM=2501,l2=0,mM=1,XS=2,u2=3200,YN=3201,XN=3202,qN=3203,Kf=0,c2=1,gc="",xr="srgb",Nf="srgb-linear",Iv="linear",Qn="srgb",WN="",jN="rg",JN="ga",QN=0,sd=7680,$N=7681,ZN=7682,eU=7683,tU=34055,nU=34056,iU=5386,sU=512,rU=513,aU=514,oU=515,lU=516,uU=517,cU=518,i1=519,f2=512,h2=513,d2=514,OA=515,p2=516,m2=517,PA=518,g2=519,wv=35044,fU=35048,hU=35040,dU=35045,pU=35049,mU=35041,gU=35046,vU=35050,yU=35042,_U="100",s1="300 es",Ya=2e3,Vm=2001,xU={COMPUTE:"compute",RENDER:"render"},SU={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},AU={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function v2(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}const EU={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Tm(r,e){return new EU[r](e)}function y2(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Bv(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function _2(){const r=Bv("canvas");return r.style.display="block",r}const QR={};let Uf=null;function TU(r){Uf=r}function bU(){return Uf}function Ov(...r){const e="THREE."+r.shift();Uf?Uf("log",e,...r):console.log(e,...r)}function ct(...r){const e="THREE."+r.shift();Uf?Uf("warn",e,...r):console.warn(e,...r)}function Nt(...r){const e="THREE."+r.shift();Uf?Uf("error",e,...r):console.error(e,...r)}function Km(...r){const e=r.join(" ");e in QR||(QR[e]=!0,ct(...r))}function MU(r,e,t){return new Promise(function(n,i){function s(){switch(r.clientWaitSync(e,r.SYNC_FLUSH_COMMANDS_BIT,0)){case r.WAIT_FAILED:i();break;case r.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:n()}}setTimeout(s,t)})}class _u{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const i=n[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let s=0,a=i.length;s<a;s++)i[s].call(this,e);e.target=null}}}const gr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let $R=1234567;const yd=Math.PI/180,Ym=180/Math.PI;function ja(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(gr[r&255]+gr[r>>8&255]+gr[r>>16&255]+gr[r>>24&255]+"-"+gr[e&255]+gr[e>>8&255]+"-"+gr[e>>16&15|64]+gr[e>>24&255]+"-"+gr[t&63|128]+gr[t>>8&255]+"-"+gr[t>>16&255]+gr[t>>24&255]+gr[n&255]+gr[n>>8&255]+gr[n>>16&255]+gr[n>>24&255]).toLowerCase()}function jt(r,e,t){return Math.max(e,Math.min(t,r))}function gM(r,e){return(r%e+e)%e}function CU(r,e,t,n,i){return n+(r-e)*(i-n)/(t-e)}function RU(r,e,t){return r!==e?(t-r)/(e-r):0}function vv(r,e,t){return(1-t)*r+t*e}function DU(r,e,t,n){return vv(r,e,1-Math.exp(-t*n))}function LU(r,e=1){return e-Math.abs(gM(r,e*2)-e)}function IU(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*(3-2*r))}function wU(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*r*(r*(r*6-15)+10))}function BU(r,e){return r+Math.floor(Math.random()*(e-r+1))}function OU(r,e){return r+Math.random()*(e-r)}function PU(r){return r*(.5-Math.random())}function NU(r){r!==void 0&&($R=r);let e=$R+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function UU(r){return r*yd}function FU(r){return r*Ym}function kU(r){return(r&r-1)===0&&r!==0}function GU(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function HU(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function zU(r,e,t,n,i){const s=Math.cos,a=Math.sin,o=s(t/2),u=a(t/2),c=s((e+n)/2),h=a((e+n)/2),p=s((e-n)/2),v=a((e-n)/2),y=s((n-e)/2),_=a((n-e)/2);switch(i){case"XYX":r.set(o*h,u*p,u*v,o*c);break;case"YZY":r.set(u*v,o*h,u*p,o*c);break;case"ZXZ":r.set(u*p,u*v,o*h,o*c);break;case"XZX":r.set(o*h,u*_,u*y,o*c);break;case"YXY":r.set(u*y,o*h,u*_,o*c);break;case"ZYZ":r.set(u*_,u*y,o*h,o*c);break;default:ct("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Qr(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function un(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const qS={DEG2RAD:yd,RAD2DEG:Ym,generateUUID:ja,clamp:jt,euclideanModulo:gM,mapLinear:CU,inverseLerp:RU,lerp:vv,damp:DU,pingpong:LU,smoothstep:IU,smootherstep:wU,randInt:BU,randFloat:OU,randFloatSpread:PU,seededRandom:NU,degToRad:UU,radToDeg:FU,isPowerOfTwo:kU,ceilPowerOfTwo:GU,floorPowerOfTwo:HU,setQuaternionFromProperEuler:zU,normalize:un,denormalize:Qr};class Ve{constructor(e=0,t=0){Ve.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=jt(this.x,e.x,t.x),this.y=jt(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=jt(this.x,e,t),this.y=jt(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(jt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(jt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*n-a*i+e.x,this.y=s*i+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Tr{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,s,a,o){let u=n[i+0],c=n[i+1],h=n[i+2],p=n[i+3],v=s[a+0],y=s[a+1],_=s[a+2],A=s[a+3];if(o<=0){e[t+0]=u,e[t+1]=c,e[t+2]=h,e[t+3]=p;return}if(o>=1){e[t+0]=v,e[t+1]=y,e[t+2]=_,e[t+3]=A;return}if(p!==A||u!==v||c!==y||h!==_){let E=u*v+c*y+h*_+p*A;E<0&&(v=-v,y=-y,_=-_,A=-A,E=-E);let T=1-o;if(E<.9995){const M=Math.acos(E),R=Math.sin(M);T=Math.sin(T*M)/R,o=Math.sin(o*M)/R,u=u*T+v*o,c=c*T+y*o,h=h*T+_*o,p=p*T+A*o}else{u=u*T+v*o,c=c*T+y*o,h=h*T+_*o,p=p*T+A*o;const M=1/Math.sqrt(u*u+c*c+h*h+p*p);u*=M,c*=M,h*=M,p*=M}}e[t]=u,e[t+1]=c,e[t+2]=h,e[t+3]=p}static multiplyQuaternionsFlat(e,t,n,i,s,a){const o=n[i],u=n[i+1],c=n[i+2],h=n[i+3],p=s[a],v=s[a+1],y=s[a+2],_=s[a+3];return e[t]=o*_+h*p+u*y-c*v,e[t+1]=u*_+h*v+c*p-o*y,e[t+2]=c*_+h*y+o*v-u*p,e[t+3]=h*_-o*p-u*v-c*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,s=e._z,a=e._order,o=Math.cos,u=Math.sin,c=o(n/2),h=o(i/2),p=o(s/2),v=u(n/2),y=u(i/2),_=u(s/2);switch(a){case"XYZ":this._x=v*h*p+c*y*_,this._y=c*y*p-v*h*_,this._z=c*h*_+v*y*p,this._w=c*h*p-v*y*_;break;case"YXZ":this._x=v*h*p+c*y*_,this._y=c*y*p-v*h*_,this._z=c*h*_-v*y*p,this._w=c*h*p+v*y*_;break;case"ZXY":this._x=v*h*p-c*y*_,this._y=c*y*p+v*h*_,this._z=c*h*_+v*y*p,this._w=c*h*p-v*y*_;break;case"ZYX":this._x=v*h*p-c*y*_,this._y=c*y*p+v*h*_,this._z=c*h*_-v*y*p,this._w=c*h*p+v*y*_;break;case"YZX":this._x=v*h*p+c*y*_,this._y=c*y*p+v*h*_,this._z=c*h*_-v*y*p,this._w=c*h*p-v*y*_;break;case"XZY":this._x=v*h*p-c*y*_,this._y=c*y*p-v*h*_,this._z=c*h*_+v*y*p,this._w=c*h*p+v*y*_;break;default:ct("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],s=t[8],a=t[1],o=t[5],u=t[9],c=t[2],h=t[6],p=t[10],v=n+o+p;if(v>0){const y=.5/Math.sqrt(v+1);this._w=.25/y,this._x=(h-u)*y,this._y=(s-c)*y,this._z=(a-i)*y}else if(n>o&&n>p){const y=2*Math.sqrt(1+n-o-p);this._w=(h-u)/y,this._x=.25*y,this._y=(i+a)/y,this._z=(s+c)/y}else if(o>p){const y=2*Math.sqrt(1+o-n-p);this._w=(s-c)/y,this._x=(i+a)/y,this._y=.25*y,this._z=(u+h)/y}else{const y=2*Math.sqrt(1+p-n-o);this._w=(a-i)/y,this._x=(s+c)/y,this._y=(u+h)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(jt(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,s=e._z,a=e._w,o=t._x,u=t._y,c=t._z,h=t._w;return this._x=n*h+a*o+i*c-s*u,this._y=i*h+a*u+s*o-n*c,this._z=s*h+a*c+n*u-i*o,this._w=a*h-n*o-i*u-s*c,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let n=e._x,i=e._y,s=e._z,a=e._w,o=this.dot(e);o<0&&(n=-n,i=-i,s=-s,a=-a,o=-o);let u=1-t;if(o<.9995){const c=Math.acos(o),h=Math.sin(c);u=Math.sin(u*c)/h,t=Math.sin(t*c)/h,this._x=this._x*u+n*t,this._y=this._y*u+i*t,this._z=this._z*u+s*t,this._w=this._w*u+a*t,this._onChangeCallback()}else this._x=this._x*u+n*t,this._y=this._y*u+i*t,this._z=this._z*u+s*t,this._w=this._w*u+a*t,this.normalize();return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ee{constructor(e=0,t=0,n=0){ee.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(ZR.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(ZR.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*i,this.y=s[1]*t+s[4]*n+s[7]*i,this.z=s[2]*t+s[5]*n+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=e.elements,a=1/(s[3]*t+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*i+s[12])*a,this.y=(s[1]*t+s[5]*n+s[9]*i+s[13])*a,this.z=(s[2]*t+s[6]*n+s[10]*i+s[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,s=e.x,a=e.y,o=e.z,u=e.w,c=2*(a*i-o*n),h=2*(o*t-s*i),p=2*(s*n-a*t);return this.x=t+u*c+a*p-o*h,this.y=n+u*h+o*c-s*p,this.z=i+u*p+s*h-a*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i,this.y=s[1]*t+s[5]*n+s[9]*i,this.z=s[2]*t+s[6]*n+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=jt(this.x,e.x,t.x),this.y=jt(this.y,e.y,t.y),this.z=jt(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=jt(this.x,e,t),this.y=jt(this.y,e,t),this.z=jt(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(jt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,s=e.z,a=t.x,o=t.y,u=t.z;return this.x=i*u-s*o,this.y=s*a-n*u,this.z=n*o-i*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return oT.copy(this).projectOnVector(e),this.sub(oT)}reflect(e){return this.sub(oT.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(jt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const oT=new ee,ZR=new Tr;class on{constructor(e,t,n,i,s,a,o,u,c){on.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,a,o,u,c)}set(e,t,n,i,s,a,o,u,c){const h=this.elements;return h[0]=e,h[1]=i,h[2]=o,h[3]=t,h[4]=s,h[5]=u,h[6]=n,h[7]=a,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,a=n[0],o=n[3],u=n[6],c=n[1],h=n[4],p=n[7],v=n[2],y=n[5],_=n[8],A=i[0],E=i[3],T=i[6],M=i[1],R=i[4],L=i[7],w=i[2],N=i[5],O=i[8];return s[0]=a*A+o*M+u*w,s[3]=a*E+o*R+u*N,s[6]=a*T+o*L+u*O,s[1]=c*A+h*M+p*w,s[4]=c*E+h*R+p*N,s[7]=c*T+h*L+p*O,s[2]=v*A+y*M+_*w,s[5]=v*E+y*R+_*N,s[8]=v*T+y*L+_*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],c=e[7],h=e[8];return t*a*h-t*o*c-n*s*h+n*o*u+i*s*c-i*a*u}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],c=e[7],h=e[8],p=h*a-o*c,v=o*u-h*s,y=c*s-a*u,_=t*p+n*v+i*y;if(_===0)return this.set(0,0,0,0,0,0,0,0,0);const A=1/_;return e[0]=p*A,e[1]=(i*c-h*n)*A,e[2]=(o*n-i*a)*A,e[3]=v*A,e[4]=(h*t-i*u)*A,e[5]=(i*s-o*t)*A,e[6]=y*A,e[7]=(n*u-c*t)*A,e[8]=(a*t-n*s)*A,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,s,a,o){const u=Math.cos(s),c=Math.sin(s);return this.set(n*u,n*c,-n*(u*a+c*o)+a+e,-i*c,i*u,-i*(-c*a+u*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(lT.makeScale(e,t)),this}rotate(e){return this.premultiply(lT.makeRotation(-e)),this}translate(e,t){return this.premultiply(lT.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const lT=new on,eD=new on().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),tD=new on().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function VU(){const r={enabled:!0,workingColorSpace:Nf,spaces:{},convert:function(i,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===Qn&&(i.r=xc(i.r),i.g=xc(i.g),i.b=xc(i.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Qn&&(i.r=Lm(i.r),i.g=Lm(i.g),i.b=Lm(i.b))),i},workingToColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},colorSpaceToWorking:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===gc?Iv:this.spaces[i].transfer},getToneMappingMode:function(i){return this.spaces[i].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,a){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,s){return Km("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),r.workingToColorSpace(i,s)},toWorkingColorSpace:function(i,s){return Km("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),r.colorSpaceToWorking(i,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return r.define({[Nf]:{primaries:e,whitePoint:n,transfer:Iv,toXYZ:eD,fromXYZ:tD,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:xr},outputColorSpaceConfig:{drawingBufferColorSpace:xr}},[xr]:{primaries:e,whitePoint:n,transfer:Qn,toXYZ:eD,fromXYZ:tD,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:xr}}}),r}const Mn=VU();function xc(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function Lm(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let qp;class x2{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{qp===void 0&&(qp=Bv("canvas")),qp.width=e.width,qp.height=e.height;const i=qp.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=qp}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Bv("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),s=i.data;for(let a=0;a<s.length;a++)s[a]=xc(s[a]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(xc(t[n]/255)*255):t[n]=xc(t[n]);return{data:t,width:e.width,height:e.height}}else return ct("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let KU=0;class Cf{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:KU++}),this.uuid=ja(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let a=0,o=i.length;a<o;a++)i[a].isDataTexture?s.push(uT(i[a].image)):s.push(uT(i[a]))}else s=uT(i);n.url=s}return t||(e.images[this.uuid]=n),n}}function uT(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?x2.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(ct("Texture: Unable to serialize Texture."),{})}let YU=0;const cT=new ee;class yi extends _u{constructor(e=yi.DEFAULT_IMAGE,t=yi.DEFAULT_MAPPING,n=Zr,i=Zr,s=Gn,a=Io,o=Er,u=Jr,c=yi.DEFAULT_ANISOTROPY,h=gc){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:YU++}),this.uuid=ja(),this.name="",this.source=new Cf(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=u,this.offset=new Ve(0,0),this.repeat=new Ve(1,1),this.center=new Ve(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new on,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(cT).x}get height(){return this.source.getSize(cT).y}get depth(){return this.source.getSize(cT).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){ct(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){ct(`Texture.setValues(): property '${t}' does not exist.`);continue}i&&n&&i.isVector2&&n.isVector2||i&&n&&i.isVector3&&n.isVector3||i&&n&&i.isMatrix3&&n.isMatrix3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==bA)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case mu:e.x=e.x-Math.floor(e.x);break;case Zr:e.x=e.x<0?0:1;break;case km:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case mu:e.y=e.y-Math.floor(e.y);break;case Zr:e.y=e.y<0?0:1;break;case km:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}yi.DEFAULT_IMAGE=null;yi.DEFAULT_MAPPING=bA;yi.DEFAULT_ANISOTROPY=1;class ni{constructor(e=0,t=0,n=0,i=1){ni.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*s,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*s,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*s,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,s;const u=e.elements,c=u[0],h=u[4],p=u[8],v=u[1],y=u[5],_=u[9],A=u[2],E=u[6],T=u[10];if(Math.abs(h-v)<.01&&Math.abs(p-A)<.01&&Math.abs(_-E)<.01){if(Math.abs(h+v)<.1&&Math.abs(p+A)<.1&&Math.abs(_+E)<.1&&Math.abs(c+y+T-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const R=(c+1)/2,L=(y+1)/2,w=(T+1)/2,N=(h+v)/4,O=(p+A)/4,F=(_+E)/4;return R>L&&R>w?R<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(R),i=N/n,s=O/n):L>w?L<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(L),n=N/i,s=F/i):w<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(w),n=O/s,i=F/s),this.set(n,i,s,t),this}let M=Math.sqrt((E-_)*(E-_)+(p-A)*(p-A)+(v-h)*(v-h));return Math.abs(M)<.001&&(M=1),this.x=(E-_)/M,this.y=(p-A)/M,this.z=(v-h)/M,this.w=Math.acos((c+y+T-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=jt(this.x,e.x,t.x),this.y=jt(this.y,e.y,t.y),this.z=jt(this.z,e.z,t.z),this.w=jt(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=jt(this.x,e,t),this.y=jt(this.y,e,t),this.z=jt(this.z,e,t),this.w=jt(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(jt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class vM extends _u{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Gn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new ni(0,0,e,t),this.scissorTest=!1,this.viewport=new ni(0,0,e,t);const i={width:e,height:t,depth:n.depth},s=new yi(i);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:Gn,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n,this.textures[i].isData3DTexture!==!0&&(this.textures[i].isArrayTexture=this.textures[i].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new Cf(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class tr extends vM{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class NA extends yi{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Ji,this.minFilter=Ji,this.wrapR=Zr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class XU extends tr{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new NA(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class UA extends yi{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Ji,this.minFilter=Ji,this.wrapR=Zr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class qU extends tr{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new UA(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class nr{constructor(e=new ee(1/0,1/0,1/0),t=new ee(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(ul.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(ul.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ul.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,ul):ul.fromBufferAttribute(s,a),ul.applyMatrix4(e.matrixWorld),this.expandByPoint(ul);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),B_.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),B_.copy(n.boundingBox)),B_.applyMatrix4(e.matrixWorld),this.union(B_)}const i=e.children;for(let s=0,a=i.length;s<a;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,ul),ul.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(z0),O_.subVectors(this.max,z0),Wp.subVectors(e.a,z0),jp.subVectors(e.b,z0),Jp.subVectors(e.c,z0),hf.subVectors(jp,Wp),df.subVectors(Jp,jp),kh.subVectors(Wp,Jp);let t=[0,-hf.z,hf.y,0,-df.z,df.y,0,-kh.z,kh.y,hf.z,0,-hf.x,df.z,0,-df.x,kh.z,0,-kh.x,-hf.y,hf.x,0,-df.y,df.x,0,-kh.y,kh.x,0];return!fT(t,Wp,jp,Jp,O_)||(t=[1,0,0,0,1,0,0,0,1],!fT(t,Wp,jp,Jp,O_))?!1:(P_.crossVectors(hf,df),t=[P_.x,P_.y,P_.z],fT(t,Wp,jp,Jp,O_))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ul).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(ul).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(nc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),nc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),nc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),nc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),nc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),nc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),nc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),nc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(nc),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const nc=[new ee,new ee,new ee,new ee,new ee,new ee,new ee,new ee],ul=new ee,B_=new nr,Wp=new ee,jp=new ee,Jp=new ee,hf=new ee,df=new ee,kh=new ee,z0=new ee,O_=new ee,P_=new ee,Gh=new ee;function fT(r,e,t,n,i){for(let s=0,a=r.length-3;s<=a;s+=3){Gh.fromArray(r,s);const o=i.x*Math.abs(Gh.x)+i.y*Math.abs(Gh.y)+i.z*Math.abs(Gh.z),u=e.dot(Gh),c=t.dot(Gh),h=n.dot(Gh);if(Math.max(-Math.max(u,c,h),Math.min(u,c,h))>o)return!1}return!0}const WU=new nr,V0=new ee,hT=new ee;class Vs{constructor(e=new ee,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):WU.setFromPoints(e).getCenter(n);let i=0;for(let s=0,a=e.length;s<a;s++)i=Math.max(i,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;V0.subVectors(e,this.center);const t=V0.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(V0,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(hT.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(V0.copy(e.center).add(hT)),this.expandByPoint(V0.copy(e.center).sub(hT))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const ic=new ee,dT=new ee,N_=new ee,pf=new ee,pT=new ee,U_=new ee,mT=new ee;class ug{constructor(e=new ee,t=new ee(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ic)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ic.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ic.copy(this.origin).addScaledVector(this.direction,t),ic.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){dT.copy(e).add(t).multiplyScalar(.5),N_.copy(t).sub(e).normalize(),pf.copy(this.origin).sub(dT);const s=e.distanceTo(t)*.5,a=-this.direction.dot(N_),o=pf.dot(this.direction),u=-pf.dot(N_),c=pf.lengthSq(),h=Math.abs(1-a*a);let p,v,y,_;if(h>0)if(p=a*u-o,v=a*o-u,_=s*h,p>=0)if(v>=-_)if(v<=_){const A=1/h;p*=A,v*=A,y=p*(p+a*v+2*o)+v*(a*p+v+2*u)+c}else v=s,p=Math.max(0,-(a*v+o)),y=-p*p+v*(v+2*u)+c;else v=-s,p=Math.max(0,-(a*v+o)),y=-p*p+v*(v+2*u)+c;else v<=-_?(p=Math.max(0,-(-a*s+o)),v=p>0?-s:Math.min(Math.max(-s,-u),s),y=-p*p+v*(v+2*u)+c):v<=_?(p=0,v=Math.min(Math.max(-s,-u),s),y=v*(v+2*u)+c):(p=Math.max(0,-(a*s+o)),v=p>0?s:Math.min(Math.max(-s,-u),s),y=-p*p+v*(v+2*u)+c);else v=a>0?-s:s,p=Math.max(0,-(a*v+o)),y=-p*p+v*(v+2*u)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,p),i&&i.copy(dT).addScaledVector(N_,v),y}intersectSphere(e,t){ic.subVectors(e.center,this.origin);const n=ic.dot(this.direction),i=ic.dot(ic)-n*n,s=e.radius*e.radius;if(i>s)return null;const a=Math.sqrt(s-i),o=n-a,u=n+a;return u<0?null:o<0?this.at(u,t):this.at(o,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,s,a,o,u;const c=1/this.direction.x,h=1/this.direction.y,p=1/this.direction.z,v=this.origin;return c>=0?(n=(e.min.x-v.x)*c,i=(e.max.x-v.x)*c):(n=(e.max.x-v.x)*c,i=(e.min.x-v.x)*c),h>=0?(s=(e.min.y-v.y)*h,a=(e.max.y-v.y)*h):(s=(e.max.y-v.y)*h,a=(e.min.y-v.y)*h),n>a||s>i||((s>n||isNaN(n))&&(n=s),(a<i||isNaN(i))&&(i=a),p>=0?(o=(e.min.z-v.z)*p,u=(e.max.z-v.z)*p):(o=(e.max.z-v.z)*p,u=(e.min.z-v.z)*p),n>u||o>i)||((o>n||n!==n)&&(n=o),(u<i||i!==i)&&(i=u),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,ic)!==null}intersectTriangle(e,t,n,i,s){pT.subVectors(t,e),U_.subVectors(n,e),mT.crossVectors(pT,U_);let a=this.direction.dot(mT),o;if(a>0){if(i)return null;o=1}else if(a<0)o=-1,a=-a;else return null;pf.subVectors(this.origin,e);const u=o*this.direction.dot(U_.crossVectors(pf,U_));if(u<0)return null;const c=o*this.direction.dot(pT.cross(pf));if(c<0||u+c>a)return null;const h=-o*pf.dot(mT);return h<0?null:this.at(h/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class zt{constructor(e,t,n,i,s,a,o,u,c,h,p,v,y,_,A,E){zt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,a,o,u,c,h,p,v,y,_,A,E)}set(e,t,n,i,s,a,o,u,c,h,p,v,y,_,A,E){const T=this.elements;return T[0]=e,T[4]=t,T[8]=n,T[12]=i,T[1]=s,T[5]=a,T[9]=o,T[13]=u,T[2]=c,T[6]=h,T[10]=p,T[14]=v,T[3]=y,T[7]=_,T[11]=A,T[15]=E,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new zt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),n.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this)}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,n=e.elements,i=1/Qp.setFromMatrixColumn(e,0).length(),s=1/Qp.setFromMatrixColumn(e,1).length(),a=1/Qp.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,s=e.z,a=Math.cos(n),o=Math.sin(n),u=Math.cos(i),c=Math.sin(i),h=Math.cos(s),p=Math.sin(s);if(e.order==="XYZ"){const v=a*h,y=a*p,_=o*h,A=o*p;t[0]=u*h,t[4]=-u*p,t[8]=c,t[1]=y+_*c,t[5]=v-A*c,t[9]=-o*u,t[2]=A-v*c,t[6]=_+y*c,t[10]=a*u}else if(e.order==="YXZ"){const v=u*h,y=u*p,_=c*h,A=c*p;t[0]=v+A*o,t[4]=_*o-y,t[8]=a*c,t[1]=a*p,t[5]=a*h,t[9]=-o,t[2]=y*o-_,t[6]=A+v*o,t[10]=a*u}else if(e.order==="ZXY"){const v=u*h,y=u*p,_=c*h,A=c*p;t[0]=v-A*o,t[4]=-a*p,t[8]=_+y*o,t[1]=y+_*o,t[5]=a*h,t[9]=A-v*o,t[2]=-a*c,t[6]=o,t[10]=a*u}else if(e.order==="ZYX"){const v=a*h,y=a*p,_=o*h,A=o*p;t[0]=u*h,t[4]=_*c-y,t[8]=v*c+A,t[1]=u*p,t[5]=A*c+v,t[9]=y*c-_,t[2]=-c,t[6]=o*u,t[10]=a*u}else if(e.order==="YZX"){const v=a*u,y=a*c,_=o*u,A=o*c;t[0]=u*h,t[4]=A-v*p,t[8]=_*p+y,t[1]=p,t[5]=a*h,t[9]=-o*h,t[2]=-c*h,t[6]=y*p+_,t[10]=v-A*p}else if(e.order==="XZY"){const v=a*u,y=a*c,_=o*u,A=o*c;t[0]=u*h,t[4]=-p,t[8]=c*h,t[1]=v*p+A,t[5]=a*h,t[9]=y*p-_,t[2]=_*p-y,t[6]=o*h,t[10]=A*p+v}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(jU,e,JU)}lookAt(e,t,n){const i=this.elements;return ka.subVectors(e,t),ka.lengthSq()===0&&(ka.z=1),ka.normalize(),mf.crossVectors(n,ka),mf.lengthSq()===0&&(Math.abs(n.z)===1?ka.x+=1e-4:ka.z+=1e-4,ka.normalize(),mf.crossVectors(n,ka)),mf.normalize(),F_.crossVectors(ka,mf),i[0]=mf.x,i[4]=F_.x,i[8]=ka.x,i[1]=mf.y,i[5]=F_.y,i[9]=ka.y,i[2]=mf.z,i[6]=F_.z,i[10]=ka.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,a=n[0],o=n[4],u=n[8],c=n[12],h=n[1],p=n[5],v=n[9],y=n[13],_=n[2],A=n[6],E=n[10],T=n[14],M=n[3],R=n[7],L=n[11],w=n[15],N=i[0],O=i[4],F=i[8],B=i[12],P=i[1],V=i[5],J=i[9],Q=i[13],ie=i[2],ne=i[6],k=i[10],K=i[14],j=i[3],se=i[7],oe=i[11],Y=i[15];return s[0]=a*N+o*P+u*ie+c*j,s[4]=a*O+o*V+u*ne+c*se,s[8]=a*F+o*J+u*k+c*oe,s[12]=a*B+o*Q+u*K+c*Y,s[1]=h*N+p*P+v*ie+y*j,s[5]=h*O+p*V+v*ne+y*se,s[9]=h*F+p*J+v*k+y*oe,s[13]=h*B+p*Q+v*K+y*Y,s[2]=_*N+A*P+E*ie+T*j,s[6]=_*O+A*V+E*ne+T*se,s[10]=_*F+A*J+E*k+T*oe,s[14]=_*B+A*Q+E*K+T*Y,s[3]=M*N+R*P+L*ie+w*j,s[7]=M*O+R*V+L*ne+w*se,s[11]=M*F+R*J+L*k+w*oe,s[15]=M*B+R*Q+L*K+w*Y,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],s=e[12],a=e[1],o=e[5],u=e[9],c=e[13],h=e[2],p=e[6],v=e[10],y=e[14],_=e[3],A=e[7],E=e[11],T=e[15],M=u*y-c*v,R=o*y-c*p,L=o*v-u*p,w=a*y-c*h,N=a*v-u*h,O=a*p-o*h;return t*(A*M-E*R+T*L)-n*(_*M-E*w+T*N)+i*(_*R-A*w+T*O)-s*(_*L-A*N+E*O)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],c=e[7],h=e[8],p=e[9],v=e[10],y=e[11],_=e[12],A=e[13],E=e[14],T=e[15],M=p*E*c-A*v*c+A*u*y-o*E*y-p*u*T+o*v*T,R=_*v*c-h*E*c-_*u*y+a*E*y+h*u*T-a*v*T,L=h*A*c-_*p*c+_*o*y-a*A*y-h*o*T+a*p*T,w=_*p*u-h*A*u-_*o*v+a*A*v+h*o*E-a*p*E,N=t*M+n*R+i*L+s*w;if(N===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const O=1/N;return e[0]=M*O,e[1]=(A*v*s-p*E*s-A*i*y+n*E*y+p*i*T-n*v*T)*O,e[2]=(o*E*s-A*u*s+A*i*c-n*E*c-o*i*T+n*u*T)*O,e[3]=(p*u*s-o*v*s-p*i*c+n*v*c+o*i*y-n*u*y)*O,e[4]=R*O,e[5]=(h*E*s-_*v*s+_*i*y-t*E*y-h*i*T+t*v*T)*O,e[6]=(_*u*s-a*E*s-_*i*c+t*E*c+a*i*T-t*u*T)*O,e[7]=(a*v*s-h*u*s+h*i*c-t*v*c-a*i*y+t*u*y)*O,e[8]=L*O,e[9]=(_*p*s-h*A*s-_*n*y+t*A*y+h*n*T-t*p*T)*O,e[10]=(a*A*s-_*o*s+_*n*c-t*A*c-a*n*T+t*o*T)*O,e[11]=(h*o*s-a*p*s-h*n*c+t*p*c+a*n*y-t*o*y)*O,e[12]=w*O,e[13]=(h*A*i-_*p*i+_*n*v-t*A*v-h*n*E+t*p*E)*O,e[14]=(_*o*i-a*A*i-_*n*u+t*A*u+a*n*E-t*o*E)*O,e[15]=(a*p*i-h*o*i+h*n*u-t*p*u-a*n*v+t*o*v)*O,this}scale(e){const t=this.elements,n=e.x,i=e.y,s=e.z;return t[0]*=n,t[4]*=i,t[8]*=s,t[1]*=n,t[5]*=i,t[9]*=s,t[2]*=n,t[6]*=i,t[10]*=s,t[3]*=n,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),s=1-n,a=e.x,o=e.y,u=e.z,c=s*a,h=s*o;return this.set(c*a+n,c*o-i*u,c*u+i*o,0,c*o+i*u,h*o+n,h*u-i*a,0,c*u-i*o,h*u+i*a,s*u*u+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,s,a){return this.set(1,n,s,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,s=t._x,a=t._y,o=t._z,u=t._w,c=s+s,h=a+a,p=o+o,v=s*c,y=s*h,_=s*p,A=a*h,E=a*p,T=o*p,M=u*c,R=u*h,L=u*p,w=n.x,N=n.y,O=n.z;return i[0]=(1-(A+T))*w,i[1]=(y+L)*w,i[2]=(_-R)*w,i[3]=0,i[4]=(y-L)*N,i[5]=(1-(v+T))*N,i[6]=(E+M)*N,i[7]=0,i[8]=(_+R)*O,i[9]=(E-M)*O,i[10]=(1-(v+A))*O,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;if(e.x=i[12],e.y=i[13],e.z=i[14],this.determinant()===0)return n.set(1,1,1),t.identity(),this;let s=Qp.set(i[0],i[1],i[2]).length();const a=Qp.set(i[4],i[5],i[6]).length(),o=Qp.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),cl.copy(this);const c=1/s,h=1/a,p=1/o;return cl.elements[0]*=c,cl.elements[1]*=c,cl.elements[2]*=c,cl.elements[4]*=h,cl.elements[5]*=h,cl.elements[6]*=h,cl.elements[8]*=p,cl.elements[9]*=p,cl.elements[10]*=p,t.setFromRotationMatrix(cl),n.x=s,n.y=a,n.z=o,this}makePerspective(e,t,n,i,s,a,o=Ya,u=!1){const c=this.elements,h=2*s/(t-e),p=2*s/(n-i),v=(t+e)/(t-e),y=(n+i)/(n-i);let _,A;if(u)_=s/(a-s),A=a*s/(a-s);else if(o===Ya)_=-(a+s)/(a-s),A=-2*a*s/(a-s);else if(o===Vm)_=-a/(a-s),A=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return c[0]=h,c[4]=0,c[8]=v,c[12]=0,c[1]=0,c[5]=p,c[9]=y,c[13]=0,c[2]=0,c[6]=0,c[10]=_,c[14]=A,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,n,i,s,a,o=Ya,u=!1){const c=this.elements,h=2/(t-e),p=2/(n-i),v=-(t+e)/(t-e),y=-(n+i)/(n-i);let _,A;if(u)_=1/(a-s),A=a/(a-s);else if(o===Ya)_=-2/(a-s),A=-(a+s)/(a-s);else if(o===Vm)_=-1/(a-s),A=-s/(a-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return c[0]=h,c[4]=0,c[8]=0,c[12]=v,c[1]=0,c[5]=p,c[9]=0,c[13]=y,c[2]=0,c[6]=0,c[10]=_,c[14]=A,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Qp=new ee,cl=new zt,jU=new ee(0,0,0),JU=new ee(1,1,1),mf=new ee,F_=new ee,ka=new ee,nD=new zt,iD=new Tr;class eo{constructor(e=0,t=0,n=0,i=eo.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,s=i[0],a=i[4],o=i[8],u=i[1],c=i[5],h=i[9],p=i[2],v=i[6],y=i[10];switch(t){case"XYZ":this._y=Math.asin(jt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,y),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(v,c),this._z=0);break;case"YXZ":this._x=Math.asin(-jt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,y),this._z=Math.atan2(u,c)):(this._y=Math.atan2(-p,s),this._z=0);break;case"ZXY":this._x=Math.asin(jt(v,-1,1)),Math.abs(v)<.9999999?(this._y=Math.atan2(-p,y),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(u,s));break;case"ZYX":this._y=Math.asin(-jt(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(v,y),this._z=Math.atan2(u,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(jt(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-p,s)):(this._x=0,this._y=Math.atan2(o,y));break;case"XZY":this._z=Math.asin(-jt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(v,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-h,y),this._y=0);break;default:ct("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return nD.makeRotationFromQuaternion(e),this.setFromRotationMatrix(nD,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return iD.setFromEuler(this),this.setFromQuaternion(iD,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}eo.DEFAULT_ORDER="XYZ";class Xm{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let QU=0;const sD=new ee,$p=new Tr,sc=new zt,k_=new ee,K0=new ee,$U=new ee,ZU=new Tr,rD=new ee(1,0,0),aD=new ee(0,1,0),oD=new ee(0,0,1),lD={type:"added"},eF={type:"removed"},Zp={type:"childadded",child:null},gT={type:"childremoved",child:null};class Bn extends _u{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:QU++}),this.uuid=ja(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Bn.DEFAULT_UP.clone();const e=new ee,t=new eo,n=new Tr,i=new ee(1,1,1);function s(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new zt},normalMatrix:{value:new on}}),this.matrix=new zt,this.matrixWorld=new zt,this.matrixAutoUpdate=Bn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Bn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Xm,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return $p.setFromAxisAngle(e,t),this.quaternion.multiply($p),this}rotateOnWorldAxis(e,t){return $p.setFromAxisAngle(e,t),this.quaternion.premultiply($p),this}rotateX(e){return this.rotateOnAxis(rD,e)}rotateY(e){return this.rotateOnAxis(aD,e)}rotateZ(e){return this.rotateOnAxis(oD,e)}translateOnAxis(e,t){return sD.copy(e).applyQuaternion(this.quaternion),this.position.add(sD.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(rD,e)}translateY(e){return this.translateOnAxis(aD,e)}translateZ(e){return this.translateOnAxis(oD,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(sc.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?k_.copy(e):k_.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),K0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?sc.lookAt(K0,k_,this.up):sc.lookAt(k_,K0,this.up),this.quaternion.setFromRotationMatrix(sc),i&&(sc.extractRotation(i.matrixWorld),$p.setFromRotationMatrix(sc),this.quaternion.premultiply($p.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(Nt("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(lD),Zp.child=e,this.dispatchEvent(Zp),Zp.child=null):Nt("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(eF),gT.child=e,this.dispatchEvent(gT),gT.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),sc.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),sc.multiply(e.parent.matrixWorld)),e.applyMatrix4(sc),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(lD),Zp.child=e,this.dispatchEvent(Zp),Zp.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(K0,e,$U),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(K0,ZU,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(o=>({...o})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function s(o,u){return o[u.uuid]===void 0&&(o[u.uuid]=u.toJSON(e)),u.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const u=o.shapes;if(Array.isArray(u))for(let c=0,h=u.length;c<h;c++){const p=u[c];s(e.shapes,p)}else s(e.shapes,u)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let u=0,c=this.material.length;u<c;u++)o.push(s(e.materials,this.material[u]));i.material=o}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const u=this.animations[o];i.animations.push(s(e.animations,u))}}if(t){const o=a(e.geometries),u=a(e.materials),c=a(e.textures),h=a(e.images),p=a(e.shapes),v=a(e.skeletons),y=a(e.animations),_=a(e.nodes);o.length>0&&(n.geometries=o),u.length>0&&(n.materials=u),c.length>0&&(n.textures=c),h.length>0&&(n.images=h),p.length>0&&(n.shapes=p),v.length>0&&(n.skeletons=v),y.length>0&&(n.animations=y),_.length>0&&(n.nodes=_)}return n.object=i,n;function a(o){const u=[];for(const c in o){const h=o[c];delete h.metadata,u.push(h)}return u}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}Bn.DEFAULT_UP=new ee(0,1,0);Bn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Bn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const fl=new ee,rc=new ee,vT=new ee,ac=new ee,em=new ee,tm=new ee,uD=new ee,yT=new ee,_T=new ee,xT=new ee,ST=new ni,AT=new ni,ET=new ni;class _a{constructor(e=new ee,t=new ee,n=new ee){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),fl.subVectors(e,t),i.cross(fl);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,n,i,s){fl.subVectors(i,t),rc.subVectors(n,t),vT.subVectors(e,t);const a=fl.dot(fl),o=fl.dot(rc),u=fl.dot(vT),c=rc.dot(rc),h=rc.dot(vT),p=a*c-o*o;if(p===0)return s.set(0,0,0),null;const v=1/p,y=(c*u-o*h)*v,_=(a*h-o*u)*v;return s.set(1-y-_,_,y)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,ac)===null?!1:ac.x>=0&&ac.y>=0&&ac.x+ac.y<=1}static getInterpolation(e,t,n,i,s,a,o,u){return this.getBarycoord(e,t,n,i,ac)===null?(u.x=0,u.y=0,"z"in u&&(u.z=0),"w"in u&&(u.w=0),null):(u.setScalar(0),u.addScaledVector(s,ac.x),u.addScaledVector(a,ac.y),u.addScaledVector(o,ac.z),u)}static getInterpolatedAttribute(e,t,n,i,s,a){return ST.setScalar(0),AT.setScalar(0),ET.setScalar(0),ST.fromBufferAttribute(e,t),AT.fromBufferAttribute(e,n),ET.fromBufferAttribute(e,i),a.setScalar(0),a.addScaledVector(ST,s.x),a.addScaledVector(AT,s.y),a.addScaledVector(ET,s.z),a}static isFrontFacing(e,t,n,i){return fl.subVectors(n,t),rc.subVectors(e,t),fl.cross(rc).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return fl.subVectors(this.c,this.b),rc.subVectors(this.a,this.b),fl.cross(rc).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return _a.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return _a.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,s){return _a.getInterpolation(e,this.a,this.b,this.c,t,n,i,s)}containsPoint(e){return _a.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return _a.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,s=this.c;let a,o;em.subVectors(i,n),tm.subVectors(s,n),yT.subVectors(e,n);const u=em.dot(yT),c=tm.dot(yT);if(u<=0&&c<=0)return t.copy(n);_T.subVectors(e,i);const h=em.dot(_T),p=tm.dot(_T);if(h>=0&&p<=h)return t.copy(i);const v=u*p-h*c;if(v<=0&&u>=0&&h<=0)return a=u/(u-h),t.copy(n).addScaledVector(em,a);xT.subVectors(e,s);const y=em.dot(xT),_=tm.dot(xT);if(_>=0&&y<=_)return t.copy(s);const A=y*c-u*_;if(A<=0&&c>=0&&_<=0)return o=c/(c-_),t.copy(n).addScaledVector(tm,o);const E=h*_-y*p;if(E<=0&&p-h>=0&&y-_>=0)return uD.subVectors(s,i),o=(p-h)/(p-h+(y-_)),t.copy(i).addScaledVector(uD,o);const T=1/(E+A+v);return a=A*T,o=v*T,t.copy(n).addScaledVector(em,a).addScaledVector(tm,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const S2={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},gf={h:0,s:0,l:0},G_={h:0,s:0,l:0};function TT(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}class dt{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=xr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Mn.colorSpaceToWorking(this,t),this}setRGB(e,t,n,i=Mn.workingColorSpace){return this.r=e,this.g=t,this.b=n,Mn.colorSpaceToWorking(this,i),this}setHSL(e,t,n,i=Mn.workingColorSpace){if(e=gM(e,1),t=jt(t,0,1),n=jt(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,a=2*n-s;this.r=TT(a,s,e+1/3),this.g=TT(a,s,e),this.b=TT(a,s,e-1/3)}return Mn.colorSpaceToWorking(this,i),this}setStyle(e,t=xr){function n(s){s!==void 0&&parseFloat(s)<1&&ct("Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=i[1],o=i[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:ct("Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);ct("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=xr){const n=S2[e.toLowerCase()];return n!==void 0?this.setHex(n,t):ct("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=xc(e.r),this.g=xc(e.g),this.b=xc(e.b),this}copyLinearToSRGB(e){return this.r=Lm(e.r),this.g=Lm(e.g),this.b=Lm(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=xr){return Mn.workingToColorSpace(vr.copy(this),e),Math.round(jt(vr.r*255,0,255))*65536+Math.round(jt(vr.g*255,0,255))*256+Math.round(jt(vr.b*255,0,255))}getHexString(e=xr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Mn.workingColorSpace){Mn.workingToColorSpace(vr.copy(this),t);const n=vr.r,i=vr.g,s=vr.b,a=Math.max(n,i,s),o=Math.min(n,i,s);let u,c;const h=(o+a)/2;if(o===a)u=0,c=0;else{const p=a-o;switch(c=h<=.5?p/(a+o):p/(2-a-o),a){case n:u=(i-s)/p+(i<s?6:0);break;case i:u=(s-n)/p+2;break;case s:u=(n-i)/p+4;break}u/=6}return e.h=u,e.s=c,e.l=h,e}getRGB(e,t=Mn.workingColorSpace){return Mn.workingToColorSpace(vr.copy(this),t),e.r=vr.r,e.g=vr.g,e.b=vr.b,e}getStyle(e=xr){Mn.workingToColorSpace(vr.copy(this),e);const t=vr.r,n=vr.g,i=vr.b;return e!==xr?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(gf),this.setHSL(gf.h+e,gf.s+t,gf.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(gf),e.getHSL(G_);const n=vv(gf.h,G_.h,t),i=vv(gf.s,G_.s,t),s=vv(gf.l,G_.l,t);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*i,this.g=s[1]*t+s[4]*n+s[7]*i,this.b=s[2]*t+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const vr=new dt;dt.NAMES=S2;let tF=0;class Rs extends _u{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:tF++}),this.uuid=ja(),this.name="",this.type="Material",this.blending=vd,this.side=du,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=rS,this.blendDst=aS,this.blendEquation=Tf,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new dt(0,0,0),this.blendAlpha=0,this.depthFunc=Md,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=i1,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=sd,this.stencilZFail=sd,this.stencilZPass=sd,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){ct(`Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){ct(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==vd&&(n.blending=this.blending),this.side!==du&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==rS&&(n.blendSrc=this.blendSrc),this.blendDst!==aS&&(n.blendDst=this.blendDst),this.blendEquation!==Tf&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Md&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==i1&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==sd&&(n.stencilFail=this.stencilFail),this.stencilZFail!==sd&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==sd&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.allowOverride===!1&&(n.allowOverride=!1),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(s){const a=[];for(const o in s){const u=s[o];delete u.metadata,a.push(u)}return a}if(t){const s=i(e.textures),a=i(e.images);s.length>0&&(n.textures=s),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let s=0;s!==i;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Xa extends Rs{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new dt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new eo,this.combine=Zv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const vc=nF();function nF(){const r=new ArrayBuffer(4),e=new Float32Array(r),t=new Uint32Array(r),n=new Uint32Array(512),i=new Uint32Array(512);for(let u=0;u<256;++u){const c=u-127;c<-27?(n[u]=0,n[u|256]=32768,i[u]=24,i[u|256]=24):c<-14?(n[u]=1024>>-c-14,n[u|256]=1024>>-c-14|32768,i[u]=-c-1,i[u|256]=-c-1):c<=15?(n[u]=c+15<<10,n[u|256]=c+15<<10|32768,i[u]=13,i[u|256]=13):c<128?(n[u]=31744,n[u|256]=64512,i[u]=24,i[u|256]=24):(n[u]=31744,n[u|256]=64512,i[u]=13,i[u|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let u=1;u<1024;++u){let c=u<<13,h=0;for(;(c&8388608)===0;)c<<=1,h-=8388608;c&=-8388609,h+=947912704,s[u]=c|h}for(let u=1024;u<2048;++u)s[u]=939524096+(u-1024<<13);for(let u=1;u<31;++u)a[u]=u<<23;a[31]=1199570944,a[32]=2147483648;for(let u=33;u<63;++u)a[u]=2147483648+(u-32<<23);a[63]=3347054592;for(let u=1;u<64;++u)u!==32&&(o[u]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:i,mantissaTable:s,exponentTable:a,offsetTable:o}}function ga(r){Math.abs(r)>65504&&ct("DataUtils.toHalfFloat(): Value out of range."),r=jt(r,-65504,65504),vc.floatView[0]=r;const e=vc.uint32View[0],t=e>>23&511;return vc.baseTable[t]+((e&8388607)>>vc.shiftTable[t])}function av(r){const e=r>>10;return vc.uint32View[0]=vc.mantissaTable[vc.offsetTable[e]+(r&1023)]+vc.exponentTable[e],vc.floatView[0]}class iF{static toHalfFloat(e){return ga(e)}static fromHalfFloat(e){return av(e)}}const ps=new ee,H_=new Ve;let sF=0;class On{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:sF++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=wv,this.updateRanges=[],this.gpuType=Ar,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)H_.fromBufferAttribute(this,t),H_.applyMatrix3(e),this.setXY(t,H_.x,H_.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)ps.fromBufferAttribute(this,t),ps.applyMatrix3(e),this.setXYZ(t,ps.x,ps.y,ps.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)ps.fromBufferAttribute(this,t),ps.applyMatrix4(e),this.setXYZ(t,ps.x,ps.y,ps.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ps.fromBufferAttribute(this,t),ps.applyNormalMatrix(e),this.setXYZ(t,ps.x,ps.y,ps.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ps.fromBufferAttribute(this,t),ps.transformDirection(e),this.setXYZ(t,ps.x,ps.y,ps.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Qr(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=un(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Qr(t,this.array)),t}setX(e,t){return this.normalized&&(t=un(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Qr(t,this.array)),t}setY(e,t){return this.normalized&&(t=un(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Qr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=un(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Qr(t,this.array)),t}setW(e,t){return this.normalized&&(t=un(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=un(t,this.array),n=un(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=un(t,this.array),n=un(n,this.array),i=un(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=un(t,this.array),n=un(n,this.array),i=un(i,this.array),s=un(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==wv&&(e.usage=this.usage),e}}class rF extends On{constructor(e,t,n){super(new Int8Array(e),t,n)}}class aF extends On{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class oF extends On{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class lF extends On{constructor(e,t,n){super(new Int16Array(e),t,n)}}class yM extends On{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class uF extends On{constructor(e,t,n){super(new Int32Array(e),t,n)}}class _M extends On{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class cF extends On{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=av(this.array[e*this.itemSize]);return this.normalized&&(t=Qr(t,this.array)),t}setX(e,t){return this.normalized&&(t=un(t,this.array)),this.array[e*this.itemSize]=ga(t),this}getY(e){let t=av(this.array[e*this.itemSize+1]);return this.normalized&&(t=Qr(t,this.array)),t}setY(e,t){return this.normalized&&(t=un(t,this.array)),this.array[e*this.itemSize+1]=ga(t),this}getZ(e){let t=av(this.array[e*this.itemSize+2]);return this.normalized&&(t=Qr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=un(t,this.array)),this.array[e*this.itemSize+2]=ga(t),this}getW(e){let t=av(this.array[e*this.itemSize+3]);return this.normalized&&(t=Qr(t,this.array)),t}setW(e,t){return this.normalized&&(t=un(t,this.array)),this.array[e*this.itemSize+3]=ga(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=un(t,this.array),n=un(n,this.array)),this.array[e+0]=ga(t),this.array[e+1]=ga(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=un(t,this.array),n=un(n,this.array),i=un(i,this.array)),this.array[e+0]=ga(t),this.array[e+1]=ga(n),this.array[e+2]=ga(i),this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=un(t,this.array),n=un(n,this.array),i=un(i,this.array),s=un(s,this.array)),this.array[e+0]=ga(t),this.array[e+1]=ga(n),this.array[e+2]=ga(i),this.array[e+3]=ga(s),this}}class Ct extends On{constructor(e,t,n){super(new Float32Array(e),t,n)}}let fF=0;const Mo=new zt,bT=new Bn,nm=new ee,Ga=new nr,Y0=new nr,Gs=new ee;class en extends _u{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:fF++}),this.uuid=ja(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(v2(e)?_M:yM)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new on().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Mo.makeRotationFromQuaternion(e),this.applyMatrix4(Mo),this}rotateX(e){return Mo.makeRotationX(e),this.applyMatrix4(Mo),this}rotateY(e){return Mo.makeRotationY(e),this.applyMatrix4(Mo),this}rotateZ(e){return Mo.makeRotationZ(e),this.applyMatrix4(Mo),this}translate(e,t,n){return Mo.makeTranslation(e,t,n),this.applyMatrix4(Mo),this}scale(e,t,n){return Mo.makeScale(e,t,n),this.applyMatrix4(Mo),this}lookAt(e){return bT.lookAt(e),bT.updateMatrix(),this.applyMatrix4(bT.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(nm).negate(),this.translate(nm.x,nm.y,nm.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let i=0,s=e.length;i<s;i++){const a=e[i];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new Ct(n,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const s=e[i];t.setXYZ(i,s.x,s.y,s.z||0)}e.length>t.count&&ct("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new nr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Nt("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new ee(-1/0,-1/0,-1/0),new ee(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const s=t[n];Ga.setFromBufferAttribute(s),this.morphTargetsRelative?(Gs.addVectors(this.boundingBox.min,Ga.min),this.boundingBox.expandByPoint(Gs),Gs.addVectors(this.boundingBox.max,Ga.max),this.boundingBox.expandByPoint(Gs)):(this.boundingBox.expandByPoint(Ga.min),this.boundingBox.expandByPoint(Ga.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Nt('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Vs);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Nt("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new ee,1/0);return}if(e){const n=this.boundingSphere.center;if(Ga.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const o=t[s];Y0.setFromBufferAttribute(o),this.morphTargetsRelative?(Gs.addVectors(Ga.min,Y0.min),Ga.expandByPoint(Gs),Gs.addVectors(Ga.max,Y0.max),Ga.expandByPoint(Gs)):(Ga.expandByPoint(Y0.min),Ga.expandByPoint(Y0.max))}Ga.getCenter(n);let i=0;for(let s=0,a=e.count;s<a;s++)Gs.fromBufferAttribute(e,s),i=Math.max(i,n.distanceToSquared(Gs));if(t)for(let s=0,a=t.length;s<a;s++){const o=t[s],u=this.morphTargetsRelative;for(let c=0,h=o.count;c<h;c++)Gs.fromBufferAttribute(o,c),u&&(nm.fromBufferAttribute(e,c),Gs.add(nm)),i=Math.max(i,n.distanceToSquared(Gs))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&Nt('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){Nt("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new On(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],u=[];for(let F=0;F<n.count;F++)o[F]=new ee,u[F]=new ee;const c=new ee,h=new ee,p=new ee,v=new Ve,y=new Ve,_=new Ve,A=new ee,E=new ee;function T(F,B,P){c.fromBufferAttribute(n,F),h.fromBufferAttribute(n,B),p.fromBufferAttribute(n,P),v.fromBufferAttribute(s,F),y.fromBufferAttribute(s,B),_.fromBufferAttribute(s,P),h.sub(c),p.sub(c),y.sub(v),_.sub(v);const V=1/(y.x*_.y-_.x*y.y);isFinite(V)&&(A.copy(h).multiplyScalar(_.y).addScaledVector(p,-y.y).multiplyScalar(V),E.copy(p).multiplyScalar(y.x).addScaledVector(h,-_.x).multiplyScalar(V),o[F].add(A),o[B].add(A),o[P].add(A),u[F].add(E),u[B].add(E),u[P].add(E))}let M=this.groups;M.length===0&&(M=[{start:0,count:e.count}]);for(let F=0,B=M.length;F<B;++F){const P=M[F],V=P.start,J=P.count;for(let Q=V,ie=V+J;Q<ie;Q+=3)T(e.getX(Q+0),e.getX(Q+1),e.getX(Q+2))}const R=new ee,L=new ee,w=new ee,N=new ee;function O(F){w.fromBufferAttribute(i,F),N.copy(w);const B=o[F];R.copy(B),R.sub(w.multiplyScalar(w.dot(B))).normalize(),L.crossVectors(N,B);const V=L.dot(u[F])<0?-1:1;a.setXYZW(F,R.x,R.y,R.z,V)}for(let F=0,B=M.length;F<B;++F){const P=M[F],V=P.start,J=P.count;for(let Q=V,ie=V+J;Q<ie;Q+=3)O(e.getX(Q+0)),O(e.getX(Q+1)),O(e.getX(Q+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new On(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let v=0,y=n.count;v<y;v++)n.setXYZ(v,0,0,0);const i=new ee,s=new ee,a=new ee,o=new ee,u=new ee,c=new ee,h=new ee,p=new ee;if(e)for(let v=0,y=e.count;v<y;v+=3){const _=e.getX(v+0),A=e.getX(v+1),E=e.getX(v+2);i.fromBufferAttribute(t,_),s.fromBufferAttribute(t,A),a.fromBufferAttribute(t,E),h.subVectors(a,s),p.subVectors(i,s),h.cross(p),o.fromBufferAttribute(n,_),u.fromBufferAttribute(n,A),c.fromBufferAttribute(n,E),o.add(h),u.add(h),c.add(h),n.setXYZ(_,o.x,o.y,o.z),n.setXYZ(A,u.x,u.y,u.z),n.setXYZ(E,c.x,c.y,c.z)}else for(let v=0,y=t.count;v<y;v+=3)i.fromBufferAttribute(t,v+0),s.fromBufferAttribute(t,v+1),a.fromBufferAttribute(t,v+2),h.subVectors(a,s),p.subVectors(i,s),h.cross(p),n.setXYZ(v+0,h.x,h.y,h.z),n.setXYZ(v+1,h.x,h.y,h.z),n.setXYZ(v+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Gs.fromBufferAttribute(e,t),Gs.normalize(),e.setXYZ(t,Gs.x,Gs.y,Gs.z)}toNonIndexed(){function e(o,u){const c=o.array,h=o.itemSize,p=o.normalized,v=new c.constructor(u.length*h);let y=0,_=0;for(let A=0,E=u.length;A<E;A++){o.isInterleavedBufferAttribute?y=u[A]*o.data.stride+o.offset:y=u[A]*h;for(let T=0;T<h;T++)v[_++]=c[y++]}return new On(v,h,p)}if(this.index===null)return ct("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new en,n=this.index.array,i=this.attributes;for(const o in i){const u=i[o],c=e(u,n);t.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const u=[],c=s[o];for(let h=0,p=c.length;h<p;h++){const v=c[h],y=e(v,n);u.push(y)}t.morphAttributes[o]=u}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,u=a.length;o<u;o++){const c=a[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const u=this.parameters;for(const c in u)u[c]!==void 0&&(e[c]=u[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const u in n){const c=n[u];e.data.attributes[u]=c.toJSON(e.data)}const i={};let s=!1;for(const u in this.morphAttributes){const c=this.morphAttributes[u],h=[];for(let p=0,v=c.length;p<v;p++){const y=c[p];h.push(y.toJSON(e.data))}h.length>0&&(i[u]=h,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const i=e.attributes;for(const c in i){const h=i[c];this.setAttribute(c,h.clone(t))}const s=e.morphAttributes;for(const c in s){const h=[],p=s[c];for(let v=0,y=p.length;v<y;v++)h.push(p[v].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,h=a.length;c<h;c++){const p=a[c];this.addGroup(p.start,p.count,p.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const cD=new zt,Hh=new ug,z_=new Vs,fD=new ee,V_=new ee,K_=new ee,Y_=new ee,MT=new ee,X_=new ee,hD=new ee,q_=new ee;class $i extends Bn{constructor(e=new en,t=new Xa){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(s&&o){X_.set(0,0,0);for(let u=0,c=s.length;u<c;u++){const h=o[u],p=s[u];h!==0&&(MT.fromBufferAttribute(p,e),a?X_.addScaledVector(MT,h):X_.addScaledVector(MT.sub(t),h))}t.add(X_)}return t}raycast(e,t){const n=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),z_.copy(n.boundingSphere),z_.applyMatrix4(s),Hh.copy(e.ray).recast(e.near),!(z_.containsPoint(Hh.origin)===!1&&(Hh.intersectSphere(z_,fD)===null||Hh.origin.distanceToSquared(fD)>(e.far-e.near)**2))&&(cD.copy(s).invert(),Hh.copy(e.ray).applyMatrix4(cD),!(n.boundingBox!==null&&Hh.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Hh)))}_computeIntersections(e,t,n){let i;const s=this.geometry,a=this.material,o=s.index,u=s.attributes.position,c=s.attributes.uv,h=s.attributes.uv1,p=s.attributes.normal,v=s.groups,y=s.drawRange;if(o!==null)if(Array.isArray(a))for(let _=0,A=v.length;_<A;_++){const E=v[_],T=a[E.materialIndex],M=Math.max(E.start,y.start),R=Math.min(o.count,Math.min(E.start+E.count,y.start+y.count));for(let L=M,w=R;L<w;L+=3){const N=o.getX(L),O=o.getX(L+1),F=o.getX(L+2);i=W_(this,T,e,n,c,h,p,N,O,F),i&&(i.faceIndex=Math.floor(L/3),i.face.materialIndex=E.materialIndex,t.push(i))}}else{const _=Math.max(0,y.start),A=Math.min(o.count,y.start+y.count);for(let E=_,T=A;E<T;E+=3){const M=o.getX(E),R=o.getX(E+1),L=o.getX(E+2);i=W_(this,a,e,n,c,h,p,M,R,L),i&&(i.faceIndex=Math.floor(E/3),t.push(i))}}else if(u!==void 0)if(Array.isArray(a))for(let _=0,A=v.length;_<A;_++){const E=v[_],T=a[E.materialIndex],M=Math.max(E.start,y.start),R=Math.min(u.count,Math.min(E.start+E.count,y.start+y.count));for(let L=M,w=R;L<w;L+=3){const N=L,O=L+1,F=L+2;i=W_(this,T,e,n,c,h,p,N,O,F),i&&(i.faceIndex=Math.floor(L/3),i.face.materialIndex=E.materialIndex,t.push(i))}}else{const _=Math.max(0,y.start),A=Math.min(u.count,y.start+y.count);for(let E=_,T=A;E<T;E+=3){const M=E,R=E+1,L=E+2;i=W_(this,a,e,n,c,h,p,M,R,L),i&&(i.faceIndex=Math.floor(E/3),t.push(i))}}}}function hF(r,e,t,n,i,s,a,o){let u;if(e.side===ta?u=n.intersectTriangle(a,s,i,!0,o):u=n.intersectTriangle(i,s,a,e.side===du,o),u===null)return null;q_.copy(o),q_.applyMatrix4(r.matrixWorld);const c=t.ray.origin.distanceTo(q_);return c<t.near||c>t.far?null:{distance:c,point:q_.clone(),object:r}}function W_(r,e,t,n,i,s,a,o,u,c){r.getVertexPosition(o,V_),r.getVertexPosition(u,K_),r.getVertexPosition(c,Y_);const h=hF(r,e,t,n,V_,K_,Y_,hD);if(h){const p=new ee;_a.getBarycoord(hD,V_,K_,Y_,p),i&&(h.uv=_a.getInterpolatedAttribute(i,o,u,c,p,new Ve)),s&&(h.uv1=_a.getInterpolatedAttribute(s,o,u,c,p,new Ve)),a&&(h.normal=_a.getInterpolatedAttribute(a,o,u,c,p,new ee),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));const v={a:o,b:u,c,normal:new ee,materialIndex:0};_a.getNormal(V_,K_,Y_,v.normal),h.face=v,h.barycoord=p}return h}class Nd extends en{constructor(e=1,t=1,n=1,i=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:s,depthSegments:a};const o=this;i=Math.floor(i),s=Math.floor(s),a=Math.floor(a);const u=[],c=[],h=[],p=[];let v=0,y=0;_("z","y","x",-1,-1,n,t,e,a,s,0),_("z","y","x",1,-1,n,t,-e,a,s,1),_("x","z","y",1,1,e,n,t,i,a,2),_("x","z","y",1,-1,e,n,-t,i,a,3),_("x","y","z",1,-1,e,t,n,i,s,4),_("x","y","z",-1,-1,e,t,-n,i,s,5),this.setIndex(u),this.setAttribute("position",new Ct(c,3)),this.setAttribute("normal",new Ct(h,3)),this.setAttribute("uv",new Ct(p,2));function _(A,E,T,M,R,L,w,N,O,F,B){const P=L/O,V=w/F,J=L/2,Q=w/2,ie=N/2,ne=O+1,k=F+1;let K=0,j=0;const se=new ee;for(let oe=0;oe<k;oe++){const Y=oe*V-Q;for(let Z=0;Z<ne;Z++){const le=Z*P-J;se[A]=le*M,se[E]=Y*R,se[T]=ie,c.push(se.x,se.y,se.z),se[A]=0,se[E]=0,se[T]=N>0?1:-1,h.push(se.x,se.y,se.z),p.push(Z/O),p.push(1-oe/F),K+=1}}for(let oe=0;oe<F;oe++)for(let Y=0;Y<O;Y++){const Z=v+Y+ne*oe,le=v+Y+ne*(oe+1),pe=v+(Y+1)+ne*(oe+1),Te=v+(Y+1)+ne*oe;u.push(Z,le,Te),u.push(le,pe,Te),j+=6}o.addGroup(y,j,B),y+=j,v+=K}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Nd(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function qm(r){const e={};for(const t in r){e[t]={};for(const n in r[t]){const i=r[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(ct("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function Wr(r){const e={};for(let t=0;t<r.length;t++){const n=qm(r[t]);for(const i in n)e[i]=n[i]}return e}function dF(r){const e=[];for(let t=0;t<r.length;t++)e.push(r[t].clone());return e}function A2(r){const e=r.getRenderTarget();return e===null?r.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Mn.workingColorSpace}const E2={clone:qm,merge:Wr};var pF=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,mF=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class to extends Rs{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=pF,this.fragmentShader=mF,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=qm(e.uniforms),this.uniformsGroups=dF(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?t.uniforms[i]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[i]={type:"m4",value:a.toArray()}:t.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class ty extends Bn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new zt,this.projectionMatrix=new zt,this.projectionMatrixInverse=new zt,this.coordinateSystem=Ya,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const vf=new ee,dD=new Ve,pD=new Ve;class gs extends ty{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Ym*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(yd*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Ym*2*Math.atan(Math.tan(yd*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){vf.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(vf.x,vf.y).multiplyScalar(-e/vf.z),vf.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(vf.x,vf.y).multiplyScalar(-e/vf.z)}getViewSize(e,t){return this.getViewBounds(e,dD,pD),t.subVectors(pD,dD)}setViewOffset(e,t,n,i,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(yd*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,s=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const u=a.fullWidth,c=a.fullHeight;s+=a.offsetX*i/u,t-=a.offsetY*n/c,i*=a.width/u,n*=a.height/c}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const im=-90,sm=1;class T2 extends Bn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new gs(im,sm,e,t);i.layers=this.layers,this.add(i);const s=new gs(im,sm,e,t);s.layers=this.layers,this.add(s);const a=new gs(im,sm,e,t);a.layers=this.layers,this.add(a);const o=new gs(im,sm,e,t);o.layers=this.layers,this.add(o);const u=new gs(im,sm,e,t);u.layers=this.layers,this.add(u);const c=new gs(im,sm,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,s,a,o,u]=t;for(const c of t)this.remove(c);if(e===Ya)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),u.up.set(0,1,0),u.lookAt(0,0,-1);else if(e===Vm)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),u.up.set(0,-1,0),u.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,u,c,h]=this.children,p=e.getRenderTarget(),v=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),_=e.xr.enabled;e.xr.enabled=!1;const A=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,s),e.setRenderTarget(n,1,i),e.render(t,a),e.setRenderTarget(n,2,i),e.render(t,o),e.setRenderTarget(n,3,i),e.render(t,u),e.setRenderTarget(n,4,i),e.render(t,c),n.texture.generateMipmaps=A,e.setRenderTarget(n,5,i),e.render(t,h),e.setRenderTarget(p,v,y),e.xr.enabled=_,n.texture.needsPMREMUpdate=!0}}class ny extends yi{constructor(e=[],t=pu,n,i,s,a,o,u,c,h){super(e,t,n,i,s,a,o,u,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class xM extends tr{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new ny(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Nd(5,5,5),s=new to({name:"CubemapFromEquirect",uniforms:qm(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:ta,blending:vl});s.uniforms.tEquirect.value=t;const a=new $i(i,s),o=t.minFilter;return t.minFilter===Io&&(t.minFilter=Gn),new T2(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,n=!0,i=!0){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(s)}}class _c extends Bn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const gF={type:"move"};class Yx{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new _c,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new _c,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ee,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ee),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new _c,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ee,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ee),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,s=null,a=null;const o=this._targetRay,u=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const A of e.hand.values()){const E=t.getJointPose(A,n),T=this._getHandJoint(c,A);E!==null&&(T.matrix.fromArray(E.transform.matrix),T.matrix.decompose(T.position,T.rotation,T.scale),T.matrixWorldNeedsUpdate=!0,T.jointRadius=E.radius),T.visible=E!==null}const h=c.joints["index-finger-tip"],p=c.joints["thumb-tip"],v=h.position.distanceTo(p.position),y=.02,_=.005;c.inputState.pinching&&v>y+_?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&v<=y-_&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else u!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(u.matrix.fromArray(s.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,s.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(s.linearVelocity)):u.hasLinearVelocity=!1,s.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(s.angularVelocity)):u.hasAngularVelocity=!1));o!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&s!==null&&(i=s),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(gF)))}return o!==null&&(o.visible=i!==null),u!==null&&(u.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new _c;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class FA{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new dt(e),this.density=t}clone(){return new FA(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class kA{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new dt(e),this.near=t,this.far=n}clone(){return new kA(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class iy extends Bn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new eo,this.environmentIntensity=1,this.environmentRotation=new eo,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class sy{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=wv,this.updateRanges=[],this.version=0,this.uuid=ja()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ja()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ja()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const qr=new ee;class Ff{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)qr.fromBufferAttribute(this,t),qr.applyMatrix4(e),this.setXYZ(t,qr.x,qr.y,qr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)qr.fromBufferAttribute(this,t),qr.applyNormalMatrix(e),this.setXYZ(t,qr.x,qr.y,qr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)qr.fromBufferAttribute(this,t),qr.transformDirection(e),this.setXYZ(t,qr.x,qr.y,qr.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=Qr(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=un(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=un(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=un(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=un(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=un(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Qr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Qr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Qr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Qr(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=un(t,this.array),n=un(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=un(t,this.array),n=un(n,this.array),i=un(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=un(t,this.array),n=un(n,this.array),i=un(i,this.array),s=un(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(e===void 0){Ov("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new On(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ff(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){Ov("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class SM extends Rs{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new dt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let rm;const X0=new ee,am=new ee,om=new ee,lm=new Ve,q0=new Ve,b2=new zt,j_=new ee,W0=new ee,J_=new ee,mD=new Ve,CT=new Ve,gD=new Ve;class M2 extends Bn{constructor(e=new SM){if(super(),this.isSprite=!0,this.type="Sprite",rm===void 0){rm=new en;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new sy(t,5);rm.setIndex([0,1,2,0,2,3]),rm.setAttribute("position",new Ff(n,3,0,!1)),rm.setAttribute("uv",new Ff(n,2,3,!1))}this.geometry=rm,this.material=e,this.center=new Ve(.5,.5),this.count=1}raycast(e,t){e.camera===null&&Nt('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),am.setFromMatrixScale(this.matrixWorld),b2.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),om.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&am.multiplyScalar(-om.z);const n=this.material.rotation;let i,s;n!==0&&(s=Math.cos(n),i=Math.sin(n));const a=this.center;Q_(j_.set(-.5,-.5,0),om,a,am,i,s),Q_(W0.set(.5,-.5,0),om,a,am,i,s),Q_(J_.set(.5,.5,0),om,a,am,i,s),mD.set(0,0),CT.set(1,0),gD.set(1,1);let o=e.ray.intersectTriangle(j_,W0,J_,!1,X0);if(o===null&&(Q_(W0.set(-.5,.5,0),om,a,am,i,s),CT.set(0,1),o=e.ray.intersectTriangle(j_,J_,W0,!1,X0),o===null))return;const u=e.ray.origin.distanceTo(X0);u<e.near||u>e.far||t.push({distance:u,point:X0.clone(),uv:_a.getInterpolation(X0,j_,W0,J_,mD,CT,gD,new Ve),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Q_(r,e,t,n,i,s){lm.subVectors(r,t).addScalar(.5).multiply(n),i!==void 0?(q0.x=s*lm.x-i*lm.y,q0.y=i*lm.x+s*lm.y):q0.copy(lm),r.copy(e),r.x+=q0.x,r.y+=q0.y,r.applyMatrix4(b2)}const $_=new ee,vD=new ee;class C2 extends Bn{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const s=t[n];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const i=this.levels;let s;for(s=0;s<i.length&&!(t<i[s].distance);s++);return i.splice(s,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const i=t.splice(n,1);return this.remove(i[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let s=t[n].distance;if(t[n].object.visible&&(s-=s*t[n].hysteresis),e<s)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){$_.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo($_);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){$_.setFromMatrixPosition(e.matrixWorld),vD.setFromMatrixPosition(this.matrixWorld);const n=$_.distanceTo(vD)/e.zoom;t[0].object.visible=!0;let i,s;for(i=1,s=t.length;i<s;i++){let a=t[i].distance;if(t[i].object.visible&&(a-=a*t[i].hysteresis),n>=a)t[i-1].object.visible=!1,t[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<s;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,s=n.length;i<s;i++){const a=n[i];t.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return t}}const yD=new ee,_D=new ni,xD=new ni,vF=new ee,SD=new zt,Z_=new ee,RT=new Vs,AD=new zt,DT=new ug;class AM extends $i{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=n1,this.bindMatrix=new zt,this.bindMatrixInverse=new zt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new nr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,Z_),this.boundingBox.expandByPoint(Z_)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Vs),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,Z_),this.boundingSphere.expandByPoint(Z_)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),RT.copy(this.boundingSphere),RT.applyMatrix4(i),e.ray.intersectsSphere(RT)!==!1&&(AD.copy(i).invert(),DT.copy(e.ray).applyMatrix4(AD),!(this.boundingBox!==null&&DT.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,DT)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ni,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===n1?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===s2?this.bindMatrixInverse.copy(this.bindMatrix).invert():ct("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;_D.fromBufferAttribute(i.attributes.skinIndex,e),xD.fromBufferAttribute(i.attributes.skinWeight,e),yD.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const a=xD.getComponent(s);if(a!==0){const o=_D.getComponent(s);SD.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(vF.copy(yD).applyMatrix4(SD),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class GA extends Bn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class yl extends yi{constructor(e=null,t=1,n=1,i,s,a,o,u,c=Ji,h=Ji,p,v){super(null,a,o,u,c,h,i,s,p,v),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const ED=new zt,yF=new zt;class ry{constructor(e=[],t=[]){this.uuid=ja(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.previousBoneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){ct("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new zt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new zt;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const o=e[s]?e[s].matrixWorld:yF;ED.multiplyMatrices(o,t[s]),ED.toArray(n,s*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new ry(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new yl(t,e,e,Er,Ar);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const s=e.bones[n];let a=t[s];a===void 0&&(ct("Skeleton: No bone found with UUID:",s),a=new GA),this.bones.push(a),this.boneInverses.push(new zt().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,s=t.length;i<s;i++){const a=t[i];e.bones.push(a.uuid);const o=n[i];e.boneInverses.push(o.toArray())}return e}}class Dd extends On{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const um=new zt,TD=new zt,ex=[],bD=new nr,_F=new zt,j0=new $i,J0=new Vs;class EM extends $i{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Dd(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,_F)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new nr),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,um),bD.copy(e.boundingBox).applyMatrix4(um),this.boundingBox.union(bD)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Vs),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,um),J0.copy(e.boundingSphere).applyMatrix4(um),this.boundingSphere.union(J0)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,s=n.length+1,a=e*s+1;for(let o=0;o<n.length;o++)n[o]=i[a+o]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(j0.geometry=this.geometry,j0.material=this.material,j0.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),J0.copy(this.boundingSphere),J0.applyMatrix4(n),e.ray.intersectsSphere(J0)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,um),TD.multiplyMatrices(n,um),j0.matrixWorld=TD,j0.raycast(e,ex);for(let a=0,o=ex.length;a<o;a++){const u=ex[a];u.instanceId=s,u.object=this,t.push(u)}ex.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Dd(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;this.morphTexture===null&&(this.morphTexture=new yl(new Float32Array(i*this.count),i,this.count,LA,Ar));const s=this.morphTexture.source.data.data;let a=0;for(let c=0;c<n.length;c++)a+=n[c];const o=this.geometry.morphTargetsRelative?1:1-a,u=i*e;s[u]=o,s.set(n,u+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const LT=new ee,xF=new ee,SF=new on;class pc{constructor(e=new ee(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=LT.subVectors(n,t).cross(xF.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(LT),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||SF.getNormalMatrix(e),i=this.coplanarPoint(LT).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const zh=new Vs,AF=new Ve(.5,.5),tx=new ee;class cg{constructor(e=new pc,t=new pc,n=new pc,i=new pc,s=new pc,a=new pc){this.planes=[e,t,n,i,s,a]}set(e,t,n,i,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(s),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Ya,n=!1){const i=this.planes,s=e.elements,a=s[0],o=s[1],u=s[2],c=s[3],h=s[4],p=s[5],v=s[6],y=s[7],_=s[8],A=s[9],E=s[10],T=s[11],M=s[12],R=s[13],L=s[14],w=s[15];if(i[0].setComponents(c-a,y-h,T-_,w-M).normalize(),i[1].setComponents(c+a,y+h,T+_,w+M).normalize(),i[2].setComponents(c+o,y+p,T+A,w+R).normalize(),i[3].setComponents(c-o,y-p,T-A,w-R).normalize(),n)i[4].setComponents(u,v,E,L).normalize(),i[5].setComponents(c-u,y-v,T-E,w-L).normalize();else if(i[4].setComponents(c-u,y-v,T-E,w-L).normalize(),t===Ya)i[5].setComponents(c+u,y+v,T+E,w+L).normalize();else if(t===Vm)i[5].setComponents(u,v,E,L).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),zh.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),zh.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(zh)}intersectsSprite(e){zh.center.set(0,0,0);const t=AF.distanceTo(e.center);return zh.radius=.7071067811865476+t,zh.applyMatrix4(e.matrixWorld),this.intersectsSphere(zh)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(tx.x=i.normal.x>0?e.max.x:e.min.x,tx.y=i.normal.y>0?e.max.y:e.min.y,tx.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(tx)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const tu=new zt,nu=new cg;class HA{constructor(){this.coordinateSystem=Ya}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(tu.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),nu.setFromProjectionMatrix(tu,i.coordinateSystem,i.reversedDepth),nu.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(tu.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),nu.setFromProjectionMatrix(tu,i.coordinateSystem,i.reversedDepth),nu.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(tu.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),nu.setFromProjectionMatrix(tu,i.coordinateSystem,i.reversedDepth),nu.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(tu.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),nu.setFromProjectionMatrix(tu,i.coordinateSystem,i.reversedDepth),nu.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(tu.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),nu.setFromProjectionMatrix(tu,i.coordinateSystem,i.reversedDepth),nu.containsPoint(e))return!0}return!1}clone(){return new HA}}function IT(r,e){return r-e}function EF(r,e){return r.z-e.z}function TF(r,e){return e.z-r.z}class bF{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,i){const s=this.pool,a=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const o=s[this.index];a.push(o),this.index++,o.start=e,o.count=t,o.z=n,o.index=i}reset(){this.list.length=0,this.index=0}}const pa=new zt,MF=new dt(1,1,1),MD=new cg,CF=new HA,nx=new nr,Vh=new Vs,Q0=new ee,CD=new ee,RF=new ee,wT=new bF,yr=new $i,ix=[];function DF(r,e,t=0){const n=e.itemSize;if(r.isInterleavedBufferAttribute||r.array.constructor!==e.array.constructor){const i=r.count;for(let s=0;s<i;s++)for(let a=0;a<n;a++)e.setComponent(s+t,a,r.getComponent(s,a))}else e.array.set(r.array,t*n);e.needsUpdate=!0}function Kh(r,e){if(r.constructor!==e.constructor){const t=Math.min(r.length,e.length);for(let n=0;n<t;n++)e[n]=r[n]}else{const t=Math.min(r.length,e.length);e.set(new r.constructor(r.buffer,0,t))}}class R2 extends $i{constructor(e,t,n=t*2,i){super(new en,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new yl(t,e,e,Er,Ar);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new yl(t,e,e,ey,Po);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new yl(t,e,e,Er,Ar);n.colorSpace=Mn.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const a=e.getAttribute(s),{array:o,itemSize:u,normalized:c}=a,h=new o.constructor(n*u),p=new On(h,u,c);t.setAttribute(s,p)}if(e.getIndex()!==null){const s=n>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new On(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=e.getAttribute(n),s=t.getAttribute(n);if(i.itemSize!==s.itemSize||i.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new nr);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(t[n].active===!1)continue;const s=t[n].geometryIndex;this.getMatrixAt(n,pa),this.getBoundingBoxAt(s,nx).applyMatrix4(pa),e.union(nx)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Vs);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(t[n].active===!1)continue;const s=t[n].geometryIndex;this.getMatrixAt(n,pa),this.getBoundingSphereAt(s,Vh).applyMatrix4(pa),e.union(Vh)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:e};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(IT),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=n):(i=this._instanceInfo.length,this._instanceInfo.push(n));const s=this._matricesTexture;pa.identity().toArray(s.image.data,i*16),s.needsUpdate=!0;const a=this._colorsTexture;return a&&(MF.toArray(a.image.data,i*4),a.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const a=e.getIndex();if(a!==null&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=n===-1?a.count:n),i.indexStart!==-1&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let u;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(IT),u=this._availableGeometryIds.shift(),s[u]=i):(u=this._geometryCount,this._geometryCount++,s.push(i)),this.setGeometryAt(u,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,u}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,i=n.getIndex()!==null,s=n.getIndex(),a=t.getIndex(),o=this._geometryInfo[e];if(i&&a.count>o.reservedIndexCount||t.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const u=o.vertexStart,c=o.reservedVertexCount;o.vertexCount=t.getAttribute("position").count;for(const h in n.attributes){const p=t.getAttribute(h),v=n.getAttribute(h);DF(p,v,u);const y=p.itemSize;for(let _=p.count,A=c;_<A;_++){const E=u+_;for(let T=0;T<y;T++)v.setComponent(E,T,0)}v.needsUpdate=!0,v.addUpdateRange(u*y,c*y)}if(i){const h=o.indexStart,p=o.reservedIndexCount;o.indexCount=t.getIndex().count;for(let v=0;v<a.count;v++)s.setX(h+v,u+a.getX(v));for(let v=a.count,y=p;v<y;v++)s.setX(h+v,u);s.needsUpdate=!0,s.addUpdateRange(h,o.reservedIndexCount)}return o.start=i?o.indexStart:o.vertexStart,o.count=i?o.indexCount:o.vertexCount,o.boundingBox=null,t.boundingBox!==null&&(o.boundingBox=t.boundingBox.clone()),o.boundingSphere=null,t.boundingSphere!==null&&(o.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const n=this._instanceInfo;for(let i=0,s=n.length;i<s;i++)n[i].active&&n[i].geometryIndex===e&&this.deleteInstance(i);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,i=n.map((a,o)=>o).sort((a,o)=>n[a].vertexStart-n[o].vertexStart),s=this.geometry;for(let a=0,o=n.length;a<o;a++){const u=i[a],c=n[u];if(c.active!==!1){if(s.index!==null){if(c.indexStart!==t){const{indexStart:h,vertexStart:p,reservedIndexCount:v}=c,y=s.index,_=y.array,A=e-p;for(let E=h;E<h+v;E++)_[E]=_[E]+A;y.array.copyWithin(t,h,h+v),y.addUpdateRange(t,v),y.needsUpdate=!0,c.indexStart=t}t+=c.reservedIndexCount}if(c.vertexStart!==e){const{vertexStart:h,reservedVertexCount:p}=c,v=s.attributes;for(const y in v){const _=v[y],{array:A,itemSize:E}=_;A.copyWithin(e*E,h*E,(h+p)*E),_.addUpdateRange(e*E,p*E),_.needsUpdate=!0}c.vertexStart=e}e+=c.reservedVertexCount,c.start=s.index?c.indexStart:c.vertexStart,this._nextIndexStart=s.index?c.indexStart+c.reservedIndexCount:0,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this._visibilityChanged=!0,this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(i.boundingBox===null){const s=new nr,a=n.index,o=n.attributes.position;for(let u=i.start,c=i.start+i.count;u<c;u++){let h=u;a&&(h=a.getX(h)),s.expandByPoint(Q0.fromBufferAttribute(o,h))}i.boundingBox=s}return t.copy(i.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(i.boundingSphere===null){const s=new Vs;this.getBoundingBoxAt(e,nx),nx.getCenter(s.center);const a=n.index,o=n.attributes.position;let u=0;for(let c=i.start,h=i.start+i.count;c<h;c++){let p=c;a&&(p=a.getX(p)),Q0.fromBufferAttribute(o,p),u=Math.max(u,s.center.distanceToSquared(Q0))}s.radius=Math.sqrt(u),i.boundingSphere=s}return t.copy(i.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,i=this._matricesTexture.image.data;return t.toArray(i,e*16),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(IT);t[t.length-1]===n.length-1;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const i=new Int32Array(e),s=new Int32Array(e);Kh(this._multiDrawCounts,i),Kh(this._multiDrawStarts,s),this._multiDrawCounts=i,this._multiDrawStarts=s,this._maxInstanceCount=e;const a=this._indirectTexture,o=this._matricesTexture,u=this._colorsTexture;a.dispose(),this._initIndirectTexture(),Kh(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),Kh(o.image.data,this._matricesTexture.image.data),u&&(u.dispose(),this._initColorsTexture(),Kh(u.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...n.map(o=>o.vertexStart+o.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(u=>u.indexStart+u.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new en,this._initializeGeometry(s));const a=this.geometry;s.index&&Kh(s.index.array,a.index.array);for(const o in s.attributes)Kh(s.attributes[o].array,a.attributes[o].array)}raycast(e,t){const n=this._instanceInfo,i=this._geometryInfo,s=this.matrixWorld,a=this.geometry;yr.material=this.material,yr.geometry.index=a.index,yr.geometry.attributes=a.attributes,yr.geometry.boundingBox===null&&(yr.geometry.boundingBox=new nr),yr.geometry.boundingSphere===null&&(yr.geometry.boundingSphere=new Vs);for(let o=0,u=n.length;o<u;o++){if(!n[o].visible||!n[o].active)continue;const c=n[o].geometryIndex,h=i[c];yr.geometry.setDrawRange(h.start,h.count),this.getMatrixAt(o,yr.matrixWorld).premultiply(s),this.getBoundingBoxAt(c,yr.geometry.boundingBox),this.getBoundingSphereAt(c,yr.geometry.boundingSphere),yr.raycast(e,ix);for(let p=0,v=ix.length;p<v;p++){const y=ix[p];y.object=this,y.batchId=o,t.push(y)}ix.length=0}yr.material=null,yr.geometry.index=null,yr.geometry.attributes={},yr.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,i,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=i.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,u=this._instanceInfo,c=this._multiDrawStarts,h=this._multiDrawCounts,p=this._geometryInfo,v=this.perObjectFrustumCulled,y=this._indirectTexture,_=y.image.data,A=n.isArrayCamera?CF:MD;v&&!n.isArrayCamera&&(pa.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),MD.setFromProjectionMatrix(pa,n.coordinateSystem,n.reversedDepth));let E=0;if(this.sortObjects){pa.copy(this.matrixWorld).invert(),Q0.setFromMatrixPosition(n.matrixWorld).applyMatrix4(pa),CD.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(pa);for(let R=0,L=u.length;R<L;R++)if(u[R].visible&&u[R].active){const w=u[R].geometryIndex;this.getMatrixAt(R,pa),this.getBoundingSphereAt(w,Vh).applyMatrix4(pa);let N=!1;if(v&&(N=!A.intersectsSphere(Vh,n)),!N){const O=p[w],F=RF.subVectors(Vh.center,Q0).dot(CD);wT.push(O.start,O.count,F,R)}}const T=wT.list,M=this.customSort;M===null?T.sort(s.transparent?TF:EF):M.call(this,T,n);for(let R=0,L=T.length;R<L;R++){const w=T[R];c[E]=w.start*o,h[E]=w.count,_[E]=w.index,E++}wT.reset()}else for(let T=0,M=u.length;T<M;T++)if(u[T].visible&&u[T].active){const R=u[T].geometryIndex;let L=!1;if(v&&(this.getMatrixAt(T,pa),this.getBoundingSphereAt(R,Vh).applyMatrix4(pa),L=!A.intersectsSphere(Vh,n)),!L){const w=p[R];c[E]=w.start*o,h[E]=w.count,_[E]=T,E++}}y.needsUpdate=!0,this._multiDrawCount=E,this._visibilityChanged=!1}onBeforeShadow(e,t,n,i,s,a){this.onBeforeRender(e,null,i,s,a)}}class Mr extends Rs{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new dt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const WS=new ee,jS=new ee,RD=new zt,$0=new ug,sx=new Vs,BT=new ee,DD=new ee;class Ec extends Bn{constructor(e=new en,t=new Mr){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,s=t.count;i<s;i++)WS.fromBufferAttribute(t,i-1),jS.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=WS.distanceTo(jS);e.setAttribute("lineDistance",new Ct(n,1))}else ct("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),sx.copy(n.boundingSphere),sx.applyMatrix4(i),sx.radius+=s,e.ray.intersectsSphere(sx)===!1)return;RD.copy(i).invert(),$0.copy(e.ray).applyMatrix4(RD);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),u=o*o,c=this.isLineSegments?2:1,h=n.index,v=n.attributes.position;if(h!==null){const y=Math.max(0,a.start),_=Math.min(h.count,a.start+a.count);for(let A=y,E=_-1;A<E;A+=c){const T=h.getX(A),M=h.getX(A+1),R=rx(this,e,$0,u,T,M,A);R&&t.push(R)}if(this.isLineLoop){const A=h.getX(_-1),E=h.getX(y),T=rx(this,e,$0,u,A,E,_-1);T&&t.push(T)}}else{const y=Math.max(0,a.start),_=Math.min(v.count,a.start+a.count);for(let A=y,E=_-1;A<E;A+=c){const T=rx(this,e,$0,u,A,A+1,A);T&&t.push(T)}if(this.isLineLoop){const A=rx(this,e,$0,u,_-1,y,_-1);A&&t.push(A)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function rx(r,e,t,n,i,s,a){const o=r.geometry.attributes.position;if(WS.fromBufferAttribute(o,i),jS.fromBufferAttribute(o,s),t.distanceSqToSegment(WS,jS,BT,DD)>n)return;BT.applyMatrix4(r.matrixWorld);const c=e.ray.origin.distanceTo(BT);if(!(c<e.near||c>e.far))return{distance:c,point:DD.clone().applyMatrix4(r.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:r}}const LD=new ee,ID=new ee;class xl extends Ec{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,s=t.count;i<s;i+=2)LD.fromBufferAttribute(t,i),ID.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+LD.distanceTo(ID);e.setAttribute("lineDistance",new Ct(n,1))}else ct("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class TM extends Ec{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class zA extends Rs{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new dt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const wD=new zt,r1=new ug,ax=new Vs,ox=new ee;class bM extends Bn{constructor(e=new en,t=new zA){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),ax.copy(n.boundingSphere),ax.applyMatrix4(i),ax.radius+=s,e.ray.intersectsSphere(ax)===!1)return;wD.copy(i).invert(),r1.copy(e.ray).applyMatrix4(wD);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),u=o*o,c=n.index,p=n.attributes.position;if(c!==null){const v=Math.max(0,a.start),y=Math.min(c.count,a.start+a.count);for(let _=v,A=y;_<A;_++){const E=c.getX(_);ox.fromBufferAttribute(p,E),BD(ox,E,u,i,e,t,this)}}else{const v=Math.max(0,a.start),y=Math.min(p.count,a.start+a.count);for(let _=v,A=y;_<A;_++)ox.fromBufferAttribute(p,_),BD(ox,_,u,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function BD(r,e,t,n,i,s,a){const o=r1.distanceSqToPoint(r);if(o<t){const u=new ee;r1.closestPointToPoint(r,u),u.applyMatrix4(n);const c=i.ray.origin.distanceTo(u);if(c<i.near||c>i.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:u,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class MM extends yi{constructor(e,t,n,i,s=Gn,a=Gn,o,u,c){super(e,t,n,i,s,a,o,u,c),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const h=this;function p(){h.needsUpdate=!0,h._requestVideoFrameCallbackId=e.requestVideoFrameCallback(p)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(p))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class LF extends MM{constructor(e,t,n,i,s,a,o,u){super({},e,t,n,i,s,a,o,u),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class IF extends yi{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Ji,this.minFilter=Ji,this.generateMipmaps=!1,this.needsUpdate=!0}}class VA extends yi{constructor(e,t,n,i,s,a,o,u,c,h,p,v){super(null,a,o,u,c,h,i,s,p,v),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class wF extends VA{constructor(e,t,n,i,s,a){super(e,t,n,s,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=Zr,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class BF extends VA{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,pu),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class OF extends yi{constructor(e,t,n,i,s,a,o,u,c){super(e,t,n,i,s,a,o,u,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class kf extends yi{constructor(e,t,n=Po,i,s,a,o=Ji,u=Ji,c,h=_l,p=1){if(h!==_l&&h!==Mf)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const v={width:e,height:t,depth:p};super(v,i,s,a,o,u,h,n,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Cf(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class D2 extends kf{constructor(e,t=Po,n=pu,i,s,a=Ji,o=Ji,u,c=_l){const h={width:e,height:e,depth:1},p=[h,h,h,h,h,h];super(e,e,t,n,i,s,a,o,u,c),this.image=p,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class CM extends yi{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class KA extends en{constructor(e=1,t=1,n=4,i=8,s=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:i,heightSegments:s},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),i=Math.max(3,Math.floor(i)),s=Math.max(1,Math.floor(s));const a=[],o=[],u=[],c=[],h=t/2,p=Math.PI/2*e,v=t,y=2*p+v,_=n*2+s,A=i+1,E=new ee,T=new ee;for(let M=0;M<=_;M++){let R=0,L=0,w=0,N=0;if(M<=n){const B=M/n,P=B*Math.PI/2;L=-h-e*Math.cos(P),w=e*Math.sin(P),N=-e*Math.cos(P),R=B*p}else if(M<=n+s){const B=(M-n)/s;L=-h+B*t,w=e,N=0,R=p+B*v}else{const B=(M-n-s)/n,P=B*Math.PI/2;L=h+e*Math.sin(P),w=e*Math.cos(P),N=e*Math.sin(P),R=p+v+B*p}const O=Math.max(0,Math.min(1,R/y));let F=0;M===0?F=.5/i:M===_&&(F=-.5/i);for(let B=0;B<=i;B++){const P=B/i,V=P*Math.PI*2,J=Math.sin(V),Q=Math.cos(V);T.x=-w*Q,T.y=L,T.z=w*J,o.push(T.x,T.y,T.z),E.set(-w*Q,N,w*J),E.normalize(),u.push(E.x,E.y,E.z),c.push(P+F,O)}if(M>0){const B=(M-1)*A;for(let P=0;P<i;P++){const V=B+P,J=B+P+1,Q=M*A+P,ie=M*A+P+1;a.push(V,J,Q),a.push(J,ie,Q)}}}this.setIndex(a),this.setAttribute("position",new Ct(o,3)),this.setAttribute("normal",new Ct(u,3)),this.setAttribute("uv",new Ct(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new KA(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class YA extends en{constructor(e=1,t=32,n=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const s=[],a=[],o=[],u=[],c=new ee,h=new Ve;a.push(0,0,0),o.push(0,0,1),u.push(.5,.5);for(let p=0,v=3;p<=t;p++,v+=3){const y=n+p/t*i;c.x=e*Math.cos(y),c.y=e*Math.sin(y),a.push(c.x,c.y,c.z),o.push(0,0,1),h.x=(a[v]/e+1)/2,h.y=(a[v+1]/e+1)/2,u.push(h.x,h.y)}for(let p=1;p<=t;p++)s.push(p,p+1,0);this.setIndex(s),this.setAttribute("position",new Ct(a,3)),this.setAttribute("normal",new Ct(o,3)),this.setAttribute("uv",new Ct(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new YA(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class ay extends en{constructor(e=1,t=1,n=1,i=32,s=1,a=!1,o=0,u=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:u};const c=this;i=Math.floor(i),s=Math.floor(s);const h=[],p=[],v=[],y=[];let _=0;const A=[],E=n/2;let T=0;M(),a===!1&&(e>0&&R(!0),t>0&&R(!1)),this.setIndex(h),this.setAttribute("position",new Ct(p,3)),this.setAttribute("normal",new Ct(v,3)),this.setAttribute("uv",new Ct(y,2));function M(){const L=new ee,w=new ee;let N=0;const O=(t-e)/n;for(let F=0;F<=s;F++){const B=[],P=F/s,V=P*(t-e)+e;for(let J=0;J<=i;J++){const Q=J/i,ie=Q*u+o,ne=Math.sin(ie),k=Math.cos(ie);w.x=V*ne,w.y=-P*n+E,w.z=V*k,p.push(w.x,w.y,w.z),L.set(ne,O,k).normalize(),v.push(L.x,L.y,L.z),y.push(Q,1-P),B.push(_++)}A.push(B)}for(let F=0;F<i;F++)for(let B=0;B<s;B++){const P=A[B][F],V=A[B+1][F],J=A[B+1][F+1],Q=A[B][F+1];(e>0||B!==0)&&(h.push(P,V,Q),N+=3),(t>0||B!==s-1)&&(h.push(V,J,Q),N+=3)}c.addGroup(T,N,0),T+=N}function R(L){const w=_,N=new Ve,O=new ee;let F=0;const B=L===!0?e:t,P=L===!0?1:-1;for(let J=1;J<=i;J++)p.push(0,E*P,0),v.push(0,P,0),y.push(.5,.5),_++;const V=_;for(let J=0;J<=i;J++){const ie=J/i*u+o,ne=Math.cos(ie),k=Math.sin(ie);O.x=B*k,O.y=E*P,O.z=B*ne,p.push(O.x,O.y,O.z),v.push(0,P,0),N.x=ne*.5+.5,N.y=k*.5*P+.5,y.push(N.x,N.y),_++}for(let J=0;J<i;J++){const Q=w+J,ie=V+J;L===!0?h.push(ie,ie+1,Q):h.push(ie+1,ie,Q),F+=3}c.addGroup(T,F,L===!0?1:2),T+=F}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ay(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class oy extends ay{constructor(e=1,t=1,n=32,i=1,s=!1,a=0,o=Math.PI*2){super(0,e,t,n,i,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new oy(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Yf extends en{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const s=[],a=[];o(i),c(n),h(),this.setAttribute("position",new Ct(s,3)),this.setAttribute("normal",new Ct(s.slice(),3)),this.setAttribute("uv",new Ct(a,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function o(M){const R=new ee,L=new ee,w=new ee;for(let N=0;N<t.length;N+=3)y(t[N+0],R),y(t[N+1],L),y(t[N+2],w),u(R,L,w,M)}function u(M,R,L,w){const N=w+1,O=[];for(let F=0;F<=N;F++){O[F]=[];const B=M.clone().lerp(L,F/N),P=R.clone().lerp(L,F/N),V=N-F;for(let J=0;J<=V;J++)J===0&&F===N?O[F][J]=B:O[F][J]=B.clone().lerp(P,J/V)}for(let F=0;F<N;F++)for(let B=0;B<2*(N-F)-1;B++){const P=Math.floor(B/2);B%2===0?(v(O[F][P+1]),v(O[F+1][P]),v(O[F][P])):(v(O[F][P+1]),v(O[F+1][P+1]),v(O[F+1][P]))}}function c(M){const R=new ee;for(let L=0;L<s.length;L+=3)R.x=s[L+0],R.y=s[L+1],R.z=s[L+2],R.normalize().multiplyScalar(M),s[L+0]=R.x,s[L+1]=R.y,s[L+2]=R.z}function h(){const M=new ee;for(let R=0;R<s.length;R+=3){M.x=s[R+0],M.y=s[R+1],M.z=s[R+2];const L=E(M)/2/Math.PI+.5,w=T(M)/Math.PI+.5;a.push(L,1-w)}_(),p()}function p(){for(let M=0;M<a.length;M+=6){const R=a[M+0],L=a[M+2],w=a[M+4],N=Math.max(R,L,w),O=Math.min(R,L,w);N>.9&&O<.1&&(R<.2&&(a[M+0]+=1),L<.2&&(a[M+2]+=1),w<.2&&(a[M+4]+=1))}}function v(M){s.push(M.x,M.y,M.z)}function y(M,R){const L=M*3;R.x=e[L+0],R.y=e[L+1],R.z=e[L+2]}function _(){const M=new ee,R=new ee,L=new ee,w=new ee,N=new Ve,O=new Ve,F=new Ve;for(let B=0,P=0;B<s.length;B+=9,P+=6){M.set(s[B+0],s[B+1],s[B+2]),R.set(s[B+3],s[B+4],s[B+5]),L.set(s[B+6],s[B+7],s[B+8]),N.set(a[P+0],a[P+1]),O.set(a[P+2],a[P+3]),F.set(a[P+4],a[P+5]),w.copy(M).add(R).add(L).divideScalar(3);const V=E(w);A(N,P+0,M,V),A(O,P+2,R,V),A(F,P+4,L,V)}}function A(M,R,L,w){w<0&&M.x===1&&(a[R]=M.x-1),L.x===0&&L.z===0&&(a[R]=w/2/Math.PI+.5)}function E(M){return Math.atan2(M.z,-M.x)}function T(M){return Math.atan2(-M.y,Math.sqrt(M.x*M.x+M.z*M.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yf(e.vertices,e.indices,e.radius,e.detail)}}class XA extends Yf{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new XA(e.radius,e.detail)}}const lx=new ee,ux=new ee,OT=new ee,cx=new _a;class L2 extends en{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),s=Math.cos(yd*t),a=e.getIndex(),o=e.getAttribute("position"),u=a?a.count:o.count,c=[0,0,0],h=["a","b","c"],p=new Array(3),v={},y=[];for(let _=0;_<u;_+=3){a?(c[0]=a.getX(_),c[1]=a.getX(_+1),c[2]=a.getX(_+2)):(c[0]=_,c[1]=_+1,c[2]=_+2);const{a:A,b:E,c:T}=cx;if(A.fromBufferAttribute(o,c[0]),E.fromBufferAttribute(o,c[1]),T.fromBufferAttribute(o,c[2]),cx.getNormal(OT),p[0]=`${Math.round(A.x*i)},${Math.round(A.y*i)},${Math.round(A.z*i)}`,p[1]=`${Math.round(E.x*i)},${Math.round(E.y*i)},${Math.round(E.z*i)}`,p[2]=`${Math.round(T.x*i)},${Math.round(T.y*i)},${Math.round(T.z*i)}`,!(p[0]===p[1]||p[1]===p[2]||p[2]===p[0]))for(let M=0;M<3;M++){const R=(M+1)%3,L=p[M],w=p[R],N=cx[h[M]],O=cx[h[R]],F=`${L}_${w}`,B=`${w}_${L}`;B in v&&v[B]?(OT.dot(v[B].normal)<=s&&(y.push(N.x,N.y,N.z),y.push(O.x,O.y,O.z)),v[B]=null):F in v||(v[F]={index0:c[M],index1:c[R],normal:OT.clone()})}}for(const _ in v)if(v[_]){const{index0:A,index1:E}=v[_];lx.fromBufferAttribute(o,A),ux.fromBufferAttribute(o,E),y.push(lx.x,lx.y,lx.z),y.push(ux.x,ux.y,ux.z)}this.setAttribute("position",new Ct(y,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Sl{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){ct("Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),s+=n.distanceTo(i),t.push(s),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let i=0;const s=n.length;let a;t?a=t:a=e*n[s-1];let o=0,u=s-1,c;for(;o<=u;)if(i=Math.floor(o+(u-o)/2),c=n[i]-a,c<0)o=i+1;else if(c>0)u=i-1;else{u=i;break}if(i=u,n[i]===a)return i/(s-1);const h=n[i],v=n[i+1]-h,y=(a-h)/v;return(i+y)/(s-1)}getTangent(e,t){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const a=this.getPoint(i),o=this.getPoint(s),u=t||(a.isVector2?new Ve:new ee);return u.copy(o).sub(a).normalize(),u}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new ee,i=[],s=[],a=[],o=new ee,u=new zt;for(let y=0;y<=e;y++){const _=y/e;i[y]=this.getTangentAt(_,new ee)}s[0]=new ee,a[0]=new ee;let c=Number.MAX_VALUE;const h=Math.abs(i[0].x),p=Math.abs(i[0].y),v=Math.abs(i[0].z);h<=c&&(c=h,n.set(1,0,0)),p<=c&&(c=p,n.set(0,1,0)),v<=c&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),s[0].crossVectors(i[0],o),a[0].crossVectors(i[0],s[0]);for(let y=1;y<=e;y++){if(s[y]=s[y-1].clone(),a[y]=a[y-1].clone(),o.crossVectors(i[y-1],i[y]),o.length()>Number.EPSILON){o.normalize();const _=Math.acos(jt(i[y-1].dot(i[y]),-1,1));s[y].applyMatrix4(u.makeRotationAxis(o,_))}a[y].crossVectors(i[y],s[y])}if(t===!0){let y=Math.acos(jt(s[0].dot(s[e]),-1,1));y/=e,i[0].dot(o.crossVectors(s[0],s[e]))>0&&(y=-y);for(let _=1;_<=e;_++)s[_].applyMatrix4(u.makeRotationAxis(i[_],y*_)),a[_].crossVectors(i[_],s[_])}return{tangents:i,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class qA extends Sl{constructor(e=0,t=0,n=1,i=1,s=0,a=Math.PI*2,o=!1,u=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=u}getPoint(e,t=new Ve){const n=t,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(a?s=0:s=i),this.aClockwise===!0&&!a&&(s===i?s=-i:s=s-i);const o=this.aStartAngle+e*s;let u=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const h=Math.cos(this.aRotation),p=Math.sin(this.aRotation),v=u-this.aX,y=c-this.aY;u=v*h-y*p+this.aX,c=v*p+y*h+this.aY}return n.set(u,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class I2 extends qA{constructor(e,t,n,i,s,a){super(e,t,n,n,i,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function RM(){let r=0,e=0,t=0,n=0;function i(s,a,o,u){r=s,e=o,t=-3*s+3*a-2*o-u,n=2*s-2*a+o+u}return{initCatmullRom:function(s,a,o,u,c){i(a,o,c*(o-s),c*(u-a))},initNonuniformCatmullRom:function(s,a,o,u,c,h,p){let v=(a-s)/c-(o-s)/(c+h)+(o-a)/h,y=(o-a)/h-(u-a)/(h+p)+(u-o)/p;v*=h,y*=h,i(a,o,v,y)},calc:function(s){const a=s*s,o=a*s;return r+e*s+t*a+n*o}}}const fx=new ee,PT=new RM,NT=new RM,UT=new RM;class w2 extends Sl{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new ee){const n=t,i=this.points,s=i.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),u=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:u===0&&o===s-1&&(o=s-2,u=1);let c,h;this.closed||o>0?c=i[(o-1)%s]:(fx.subVectors(i[0],i[1]).add(i[0]),c=fx);const p=i[o%s],v=i[(o+1)%s];if(this.closed||o+2<s?h=i[(o+2)%s]:(fx.subVectors(i[s-1],i[s-2]).add(i[s-1]),h=fx),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let _=Math.pow(c.distanceToSquared(p),y),A=Math.pow(p.distanceToSquared(v),y),E=Math.pow(v.distanceToSquared(h),y);A<1e-4&&(A=1),_<1e-4&&(_=A),E<1e-4&&(E=A),PT.initNonuniformCatmullRom(c.x,p.x,v.x,h.x,_,A,E),NT.initNonuniformCatmullRom(c.y,p.y,v.y,h.y,_,A,E),UT.initNonuniformCatmullRom(c.z,p.z,v.z,h.z,_,A,E)}else this.curveType==="catmullrom"&&(PT.initCatmullRom(c.x,p.x,v.x,h.x,this.tension),NT.initCatmullRom(c.y,p.y,v.y,h.y,this.tension),UT.initCatmullRom(c.z,p.z,v.z,h.z,this.tension));return n.set(PT.calc(u),NT.calc(u),UT.calc(u)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new ee().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function OD(r,e,t,n,i){const s=(n-e)*.5,a=(i-t)*.5,o=r*r,u=r*o;return(2*t-2*n+s+a)*u+(-3*t+3*n-2*s-a)*o+s*r+t}function PF(r,e){const t=1-r;return t*t*e}function NF(r,e){return 2*(1-r)*r*e}function UF(r,e){return r*r*e}function yv(r,e,t,n){return PF(r,e)+NF(r,t)+UF(r,n)}function FF(r,e){const t=1-r;return t*t*t*e}function kF(r,e){const t=1-r;return 3*t*t*r*e}function GF(r,e){return 3*(1-r)*r*r*e}function HF(r,e){return r*r*r*e}function _v(r,e,t,n,i){return FF(r,e)+kF(r,t)+GF(r,n)+HF(r,i)}class DM extends Sl{constructor(e=new Ve,t=new Ve,n=new Ve,i=new Ve){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Ve){const n=t,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return n.set(_v(e,i.x,s.x,a.x,o.x),_v(e,i.y,s.y,a.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class B2 extends Sl{constructor(e=new ee,t=new ee,n=new ee,i=new ee){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new ee){const n=t,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return n.set(_v(e,i.x,s.x,a.x,o.x),_v(e,i.y,s.y,a.y,o.y),_v(e,i.z,s.z,a.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class LM extends Sl{constructor(e=new Ve,t=new Ve){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Ve){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ve){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class O2 extends Sl{constructor(e=new ee,t=new ee){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new ee){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ee){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class IM extends Sl{constructor(e=new Ve,t=new Ve,n=new Ve){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ve){const n=t,i=this.v0,s=this.v1,a=this.v2;return n.set(yv(e,i.x,s.x,a.x),yv(e,i.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class wM extends Sl{constructor(e=new ee,t=new ee,n=new ee){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ee){const n=t,i=this.v0,s=this.v1,a=this.v2;return n.set(yv(e,i.x,s.x,a.x),yv(e,i.y,s.y,a.y),yv(e,i.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class BM extends Sl{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Ve){const n=t,i=this.points,s=(i.length-1)*e,a=Math.floor(s),o=s-a,u=i[a===0?a:a-1],c=i[a],h=i[a>i.length-2?i.length-1:a+1],p=i[a>i.length-3?i.length-1:a+2];return n.set(OD(o,u.x,c.x,h.x,p.x),OD(o,u.y,c.y,h.y,p.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new Ve().fromArray(i))}return this}}var JS=Object.freeze({__proto__:null,ArcCurve:I2,CatmullRomCurve3:w2,CubicBezierCurve:DM,CubicBezierCurve3:B2,EllipseCurve:qA,LineCurve:LM,LineCurve3:O2,QuadraticBezierCurve:IM,QuadraticBezierCurve3:wM,SplineCurve:BM});class P2 extends Sl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new JS[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=n){const a=i[s]-n,o=this.curves[s],u=o.getLength(),c=u===0?0:1-a/u;return o.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,s=this.curves;i<s.length;i++){const a=s[i],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,u=a.getPoints(o);for(let c=0;c<u.length;c++){const h=u[c];n&&n.equals(h)||(t.push(h),n=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(new JS[i.type]().fromJSON(i))}return this}}class QS extends P2{constructor(e){super(),this.type="Path",this.currentPoint=new Ve,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new LM(this.currentPoint.clone(),new Ve(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const s=new IM(this.currentPoint.clone(),new Ve(e,t),new Ve(n,i));return this.curves.push(s),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,s,a){const o=new DM(this.currentPoint.clone(),new Ve(e,t),new Ve(n,i),new Ve(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new BM(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,s,a){const o=this.currentPoint.x,u=this.currentPoint.y;return this.absarc(e+o,t+u,n,i,s,a),this}absarc(e,t,n,i,s,a){return this.absellipse(e,t,n,n,i,s,a),this}ellipse(e,t,n,i,s,a,o,u){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,n,i,s,a,o,u),this}absellipse(e,t,n,i,s,a,o,u){const c=new qA(e,t,n,i,s,a,o,u);if(this.curves.length>0){const p=c.getPoint(0);p.equals(this.currentPoint)||this.lineTo(p.x,p.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class _d extends QS{constructor(e){super(e),this.uuid=ja(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(new QS().fromJSON(i))}return this}}function zF(r,e,t=2){const n=e&&e.length,i=n?e[0]*t:r.length;let s=N2(r,0,i,t,!0);const a=[];if(!s||s.next===s.prev)return a;let o,u,c;if(n&&(s=qF(r,e,s,t)),r.length>80*t){o=r[0],u=r[1];let h=o,p=u;for(let v=t;v<i;v+=t){const y=r[v],_=r[v+1];y<o&&(o=y),_<u&&(u=_),y>h&&(h=y),_>p&&(p=_)}c=Math.max(h-o,p-u),c=c!==0?32767/c:0}return Pv(s,a,t,o,u,c,0),a}function N2(r,e,t,n,i){let s;if(i===sk(r,e,t,n)>0)for(let a=e;a<t;a+=n)s=PD(a/n|0,r[a],r[a+1],s);else for(let a=t-n;a>=e;a-=n)s=PD(a/n|0,r[a],r[a+1],s);return s&&Wm(s,s.next)&&(Uv(s),s=s.next),s}function Ld(r,e){if(!r)return r;e||(e=r);let t=r,n;do if(n=!1,!t.steiner&&(Wm(t,t.next)||Gi(t.prev,t,t.next)===0)){if(Uv(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Pv(r,e,t,n,i,s,a){if(!r)return;!a&&s&&$F(r,n,i,s);let o=r;for(;r.prev!==r.next;){const u=r.prev,c=r.next;if(s?KF(r,n,i,s):VF(r)){e.push(u.i,r.i,c.i),Uv(r),r=c.next,o=c.next;continue}if(r=c,r===o){a?a===1?(r=YF(Ld(r),e),Pv(r,e,t,n,i,s,2)):a===2&&XF(r,e,t,n,i,s):Pv(Ld(r),e,t,n,i,s,1);break}}}function VF(r){const e=r.prev,t=r,n=r.next;if(Gi(e,t,n)>=0)return!1;const i=e.x,s=t.x,a=n.x,o=e.y,u=t.y,c=n.y,h=Math.min(i,s,a),p=Math.min(o,u,c),v=Math.max(i,s,a),y=Math.max(o,u,c);let _=n.next;for(;_!==e;){if(_.x>=h&&_.x<=v&&_.y>=p&&_.y<=y&&ov(i,o,s,u,a,c,_.x,_.y)&&Gi(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function KF(r,e,t,n){const i=r.prev,s=r,a=r.next;if(Gi(i,s,a)>=0)return!1;const o=i.x,u=s.x,c=a.x,h=i.y,p=s.y,v=a.y,y=Math.min(o,u,c),_=Math.min(h,p,v),A=Math.max(o,u,c),E=Math.max(h,p,v),T=a1(y,_,e,t,n),M=a1(A,E,e,t,n);let R=r.prevZ,L=r.nextZ;for(;R&&R.z>=T&&L&&L.z<=M;){if(R.x>=y&&R.x<=A&&R.y>=_&&R.y<=E&&R!==i&&R!==a&&ov(o,h,u,p,c,v,R.x,R.y)&&Gi(R.prev,R,R.next)>=0||(R=R.prevZ,L.x>=y&&L.x<=A&&L.y>=_&&L.y<=E&&L!==i&&L!==a&&ov(o,h,u,p,c,v,L.x,L.y)&&Gi(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;R&&R.z>=T;){if(R.x>=y&&R.x<=A&&R.y>=_&&R.y<=E&&R!==i&&R!==a&&ov(o,h,u,p,c,v,R.x,R.y)&&Gi(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;L&&L.z<=M;){if(L.x>=y&&L.x<=A&&L.y>=_&&L.y<=E&&L!==i&&L!==a&&ov(o,h,u,p,c,v,L.x,L.y)&&Gi(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function YF(r,e){let t=r;do{const n=t.prev,i=t.next.next;!Wm(n,i)&&F2(n,t,t.next,i)&&Nv(n,i)&&Nv(i,n)&&(e.push(n.i,t.i,i.i),Uv(t),Uv(t.next),t=r=i),t=t.next}while(t!==r);return Ld(t)}function XF(r,e,t,n,i,s){let a=r;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&tk(a,o)){let u=k2(a,o);a=Ld(a,a.next),u=Ld(u,u.next),Pv(a,e,t,n,i,s,0),Pv(u,e,t,n,i,s,0);return}o=o.next}a=a.next}while(a!==r)}function qF(r,e,t,n){const i=[];for(let s=0,a=e.length;s<a;s++){const o=e[s]*n,u=s<a-1?e[s+1]*n:r.length,c=N2(r,o,u,n,!1);c===c.next&&(c.steiner=!0),i.push(ek(c))}i.sort(WF);for(let s=0;s<i.length;s++)t=jF(i[s],t);return t}function WF(r,e){let t=r.x-e.x;if(t===0&&(t=r.y-e.y,t===0)){const n=(r.next.y-r.y)/(r.next.x-r.x),i=(e.next.y-e.y)/(e.next.x-e.x);t=n-i}return t}function jF(r,e){const t=JF(r,e);if(!t)return e;const n=k2(t,r);return Ld(n,n.next),Ld(t,t.next)}function JF(r,e){let t=e;const n=r.x,i=r.y;let s=-1/0,a;if(Wm(r,t))return t;do{if(Wm(r,t.next))return t.next;if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const p=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(p<=n&&p>s&&(s=p,a=t.x<t.next.x?t:t.next,p===n))return a}t=t.next}while(t!==e);if(!a)return null;const o=a,u=a.x,c=a.y;let h=1/0;t=a;do{if(n>=t.x&&t.x>=u&&n!==t.x&&U2(i<c?n:s,i,u,c,i<c?s:n,i,t.x,t.y)){const p=Math.abs(i-t.y)/(n-t.x);Nv(t,r)&&(p<h||p===h&&(t.x>a.x||t.x===a.x&&QF(a,t)))&&(a=t,h=p)}t=t.next}while(t!==o);return a}function QF(r,e){return Gi(r.prev,r,e.prev)<0&&Gi(e.next,r,r.next)<0}function $F(r,e,t,n){let i=r;do i.z===0&&(i.z=a1(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,ZF(i)}function ZF(r){let e,t=1;do{let n=r,i;r=null;let s=null;for(e=0;n;){e++;let a=n,o=0;for(let c=0;c<t&&(o++,a=a.nextZ,!!a);c++);let u=t;for(;o>0||u>0&&a;)o!==0&&(u===0||!a||n.z<=a.z)?(i=n,n=n.nextZ,o--):(i=a,a=a.nextZ,u--),s?s.nextZ=i:r=i,i.prevZ=s,s=i;n=a}s.nextZ=null,t*=2}while(e>1);return r}function a1(r,e,t,n,i){return r=(r-t)*i|0,e=(e-n)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function ek(r){let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function U2(r,e,t,n,i,s,a,o){return(i-a)*(e-o)>=(r-a)*(s-o)&&(r-a)*(n-o)>=(t-a)*(e-o)&&(t-a)*(s-o)>=(i-a)*(n-o)}function ov(r,e,t,n,i,s,a,o){return!(r===a&&e===o)&&U2(r,e,t,n,i,s,a,o)}function tk(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!nk(r,e)&&(Nv(r,e)&&Nv(e,r)&&ik(r,e)&&(Gi(r.prev,r,e.prev)||Gi(r,e.prev,e))||Wm(r,e)&&Gi(r.prev,r,r.next)>0&&Gi(e.prev,e,e.next)>0)}function Gi(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Wm(r,e){return r.x===e.x&&r.y===e.y}function F2(r,e,t,n){const i=dx(Gi(r,e,t)),s=dx(Gi(r,e,n)),a=dx(Gi(t,n,r)),o=dx(Gi(t,n,e));return!!(i!==s&&a!==o||i===0&&hx(r,t,e)||s===0&&hx(r,n,e)||a===0&&hx(t,r,n)||o===0&&hx(t,e,n))}function hx(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function dx(r){return r>0?1:r<0?-1:0}function nk(r,e){let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&F2(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function Nv(r,e){return Gi(r.prev,r,r.next)<0?Gi(r,e,r.next)>=0&&Gi(r,r.prev,e)>=0:Gi(r,e,r.prev)<0||Gi(r,r.next,e)<0}function ik(r,e){let t=r,n=!1;const i=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n}function k2(r,e){const t=o1(r.i,r.x,r.y),n=o1(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function PD(r,e,t,n){const i=o1(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Uv(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function o1(r,e,t){return{i:r,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function sk(r,e,t,n){let i=0;for(let s=e,a=t-n;s<t;s+=n)i+=(r[a]-r[s])*(r[s+1]+r[a+1]),a=s;return i}class rk{static triangulate(e,t,n=2){return zF(e,t,n)}}class ml{static area(e){const t=e.length;let n=0;for(let i=t-1,s=0;s<t;i=s++)n+=e[i].x*e[s].y-e[s].x*e[i].y;return n*.5}static isClockWise(e){return ml.area(e)<0}static triangulateShape(e,t){const n=[],i=[],s=[];ND(e),UD(n,e);let a=e.length;t.forEach(ND);for(let u=0;u<t.length;u++)i.push(a),a+=t[u].length,UD(n,t[u]);const o=rk.triangulate(n,i);for(let u=0;u<o.length;u+=3)s.push(o.slice(u,u+3));return s}}function ND(r){const e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function UD(r,e){for(let t=0;t<e.length;t++)r.push(e[t].x),r.push(e[t].y)}class WA extends en{constructor(e=new _d([new Ve(.5,.5),new Ve(-.5,.5),new Ve(-.5,-.5),new Ve(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],s=[];for(let o=0,u=e.length;o<u;o++){const c=e[o];a(c)}this.setAttribute("position",new Ct(i,3)),this.setAttribute("uv",new Ct(s,2)),this.computeVertexNormals();function a(o){const u=[],c=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,p=t.depth!==void 0?t.depth:1;let v=t.bevelEnabled!==void 0?t.bevelEnabled:!0,y=t.bevelThickness!==void 0?t.bevelThickness:.2,_=t.bevelSize!==void 0?t.bevelSize:y-.1,A=t.bevelOffset!==void 0?t.bevelOffset:0,E=t.bevelSegments!==void 0?t.bevelSegments:3;const T=t.extrudePath,M=t.UVGenerator!==void 0?t.UVGenerator:ak;let R,L=!1,w,N,O,F;if(T){R=T.getSpacedPoints(h),L=!0,v=!1;const Ne=T.isCatmullRomCurve3?T.closed:!1;w=T.computeFrenetFrames(h,Ne),N=new ee,O=new ee,F=new ee}v||(E=0,y=0,_=0,A=0);const B=o.extractPoints(c);let P=B.shape;const V=B.holes;if(!ml.isClockWise(P)){P=P.reverse();for(let Ne=0,We=V.length;Ne<We;Ne++){const Ie=V[Ne];ml.isClockWise(Ie)&&(V[Ne]=Ie.reverse())}}function Q(Ne){const Ie=10000000000000001e-36;let je=Ne[0];for(let te=1;te<=Ne.length;te++){const St=te%Ne.length,$e=Ne[St],At=$e.x-je.x,et=$e.y-je.y,$=At*At+et*et,z=Math.max(Math.abs($e.x),Math.abs($e.y),Math.abs(je.x),Math.abs(je.y)),fe=Ie*z*z;if($<=fe){Ne.splice(St,1),te--;continue}je=$e}}Q(P),V.forEach(Q);const ie=V.length,ne=P;for(let Ne=0;Ne<ie;Ne++){const We=V[Ne];P=P.concat(We)}function k(Ne,We,Ie){return We||Nt("ExtrudeGeometry: vec does not exist"),Ne.clone().addScaledVector(We,Ie)}const K=P.length;function j(Ne,We,Ie){let je,te,St;const $e=Ne.x-We.x,At=Ne.y-We.y,et=Ie.x-Ne.x,$=Ie.y-Ne.y,z=$e*$e+At*At,fe=$e*$-At*et;if(Math.abs(fe)>Number.EPSILON){const we=Math.sqrt(z),He=Math.sqrt(et*et+$*$),Oe=We.x-At/we,Et=We.y+$e/we,it=Ie.x-$/He,vt=Ie.y+et/He,Ft=((it-Oe)*$-(vt-Et)*et)/($e*$-At*et);je=Oe+$e*Ft-Ne.x,te=Et+At*Ft-Ne.y;const Ye=je*je+te*te;if(Ye<=2)return new Ve(je,te);St=Math.sqrt(Ye/2)}else{let we=!1;$e>Number.EPSILON?et>Number.EPSILON&&(we=!0):$e<-Number.EPSILON?et<-Number.EPSILON&&(we=!0):Math.sign(At)===Math.sign($)&&(we=!0),we?(je=-At,te=$e,St=Math.sqrt(z)):(je=$e,te=At,St=Math.sqrt(z/2))}return new Ve(je/St,te/St)}const se=[];for(let Ne=0,We=ne.length,Ie=We-1,je=Ne+1;Ne<We;Ne++,Ie++,je++)Ie===We&&(Ie=0),je===We&&(je=0),se[Ne]=j(ne[Ne],ne[Ie],ne[je]);const oe=[];let Y,Z=se.concat();for(let Ne=0,We=ie;Ne<We;Ne++){const Ie=V[Ne];Y=[];for(let je=0,te=Ie.length,St=te-1,$e=je+1;je<te;je++,St++,$e++)St===te&&(St=0),$e===te&&($e=0),Y[je]=j(Ie[je],Ie[St],Ie[$e]);oe.push(Y),Z=Z.concat(Y)}let le;if(E===0)le=ml.triangulateShape(ne,V);else{const Ne=[],We=[];for(let Ie=0;Ie<E;Ie++){const je=Ie/E,te=y*Math.cos(je*Math.PI/2),St=_*Math.sin(je*Math.PI/2)+A;for(let $e=0,At=ne.length;$e<At;$e++){const et=k(ne[$e],se[$e],St);nt(et.x,et.y,-te),je===0&&Ne.push(et)}for(let $e=0,At=ie;$e<At;$e++){const et=V[$e];Y=oe[$e];const $=[];for(let z=0,fe=et.length;z<fe;z++){const we=k(et[z],Y[z],St);nt(we.x,we.y,-te),je===0&&$.push(we)}je===0&&We.push($)}}le=ml.triangulateShape(Ne,We)}const pe=le.length,Te=_+A;for(let Ne=0;Ne<K;Ne++){const We=v?k(P[Ne],Z[Ne],Te):P[Ne];L?(O.copy(w.normals[0]).multiplyScalar(We.x),N.copy(w.binormals[0]).multiplyScalar(We.y),F.copy(R[0]).add(O).add(N),nt(F.x,F.y,F.z)):nt(We.x,We.y,0)}for(let Ne=1;Ne<=h;Ne++)for(let We=0;We<K;We++){const Ie=v?k(P[We],Z[We],Te):P[We];L?(O.copy(w.normals[Ne]).multiplyScalar(Ie.x),N.copy(w.binormals[Ne]).multiplyScalar(Ie.y),F.copy(R[Ne]).add(O).add(N),nt(F.x,F.y,F.z)):nt(Ie.x,Ie.y,p/h*Ne)}for(let Ne=E-1;Ne>=0;Ne--){const We=Ne/E,Ie=y*Math.cos(We*Math.PI/2),je=_*Math.sin(We*Math.PI/2)+A;for(let te=0,St=ne.length;te<St;te++){const $e=k(ne[te],se[te],je);nt($e.x,$e.y,p+Ie)}for(let te=0,St=V.length;te<St;te++){const $e=V[te];Y=oe[te];for(let At=0,et=$e.length;At<et;At++){const $=k($e[At],Y[At],je);L?nt($.x,$.y+R[h-1].y,R[h-1].x+Ie):nt($.x,$.y,p+Ie)}}}ce(),Me();function ce(){const Ne=i.length/3;if(v){let We=0,Ie=K*We;for(let je=0;je<pe;je++){const te=le[je];at(te[2]+Ie,te[1]+Ie,te[0]+Ie)}We=h+E*2,Ie=K*We;for(let je=0;je<pe;je++){const te=le[je];at(te[0]+Ie,te[1]+Ie,te[2]+Ie)}}else{for(let We=0;We<pe;We++){const Ie=le[We];at(Ie[2],Ie[1],Ie[0])}for(let We=0;We<pe;We++){const Ie=le[We];at(Ie[0]+K*h,Ie[1]+K*h,Ie[2]+K*h)}}n.addGroup(Ne,i.length/3-Ne,0)}function Me(){const Ne=i.length/3;let We=0;Xe(ne,We),We+=ne.length;for(let Ie=0,je=V.length;Ie<je;Ie++){const te=V[Ie];Xe(te,We),We+=te.length}n.addGroup(Ne,i.length/3-Ne,1)}function Xe(Ne,We){let Ie=Ne.length;for(;--Ie>=0;){const je=Ie;let te=Ie-1;te<0&&(te=Ne.length-1);for(let St=0,$e=h+E*2;St<$e;St++){const At=K*St,et=K*(St+1),$=We+je+At,z=We+te+At,fe=We+te+et,we=We+je+et;Vt($,z,fe,we)}}}function nt(Ne,We,Ie){u.push(Ne),u.push(We),u.push(Ie)}function at(Ne,We,Ie){dn(Ne),dn(We),dn(Ie);const je=i.length/3,te=M.generateTopUV(n,i,je-3,je-2,je-1);Ut(te[0]),Ut(te[1]),Ut(te[2])}function Vt(Ne,We,Ie,je){dn(Ne),dn(We),dn(je),dn(We),dn(Ie),dn(je);const te=i.length/3,St=M.generateSideWallUV(n,i,te-6,te-3,te-2,te-1);Ut(St[0]),Ut(St[1]),Ut(St[3]),Ut(St[1]),Ut(St[2]),Ut(St[3])}function dn(Ne){i.push(u[Ne*3+0]),i.push(u[Ne*3+1]),i.push(u[Ne*3+2])}function Ut(Ne){s.push(Ne.x),s.push(Ne.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return ok(t,n,e)}static fromJSON(e,t){const n=[];for(let s=0,a=e.shapes.length;s<a;s++){const o=t[e.shapes[s]];n.push(o)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new JS[i.type]().fromJSON(i)),new WA(n,e.options)}}const ak={generateTopUV:function(r,e,t,n,i){const s=e[t*3],a=e[t*3+1],o=e[n*3],u=e[n*3+1],c=e[i*3],h=e[i*3+1];return[new Ve(s,a),new Ve(o,u),new Ve(c,h)]},generateSideWallUV:function(r,e,t,n,i,s){const a=e[t*3],o=e[t*3+1],u=e[t*3+2],c=e[n*3],h=e[n*3+1],p=e[n*3+2],v=e[i*3],y=e[i*3+1],_=e[i*3+2],A=e[s*3],E=e[s*3+1],T=e[s*3+2];return Math.abs(o-h)<Math.abs(a-c)?[new Ve(a,1-u),new Ve(c,1-p),new Ve(v,1-_),new Ve(A,1-T)]:[new Ve(o,1-u),new Ve(h,1-p),new Ve(y,1-_),new Ve(E,1-T)]}};function ok(r,e,t){if(t.shapes=[],Array.isArray(r))for(let n=0,i=r.length;n<i;n++){const s=r[n];t.shapes.push(s.uuid)}else t.shapes.push(r.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class jA extends Yf{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new jA(e.radius,e.detail)}}class JA extends en{constructor(e=[new Ve(0,-.5),new Ve(.5,0),new Ve(0,.5)],t=12,n=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=jt(i,0,Math.PI*2);const s=[],a=[],o=[],u=[],c=[],h=1/t,p=new ee,v=new Ve,y=new ee,_=new ee,A=new ee;let E=0,T=0;for(let M=0;M<=e.length-1;M++)switch(M){case 0:E=e[M+1].x-e[M].x,T=e[M+1].y-e[M].y,y.x=T*1,y.y=-E,y.z=T*0,A.copy(y),y.normalize(),u.push(y.x,y.y,y.z);break;case e.length-1:u.push(A.x,A.y,A.z);break;default:E=e[M+1].x-e[M].x,T=e[M+1].y-e[M].y,y.x=T*1,y.y=-E,y.z=T*0,_.copy(y),y.x+=A.x,y.y+=A.y,y.z+=A.z,y.normalize(),u.push(y.x,y.y,y.z),A.copy(_)}for(let M=0;M<=t;M++){const R=n+M*h*i,L=Math.sin(R),w=Math.cos(R);for(let N=0;N<=e.length-1;N++){p.x=e[N].x*L,p.y=e[N].y,p.z=e[N].x*w,a.push(p.x,p.y,p.z),v.x=M/t,v.y=N/(e.length-1),o.push(v.x,v.y);const O=u[3*N+0]*L,F=u[3*N+1],B=u[3*N+0]*w;c.push(O,F,B)}}for(let M=0;M<t;M++)for(let R=0;R<e.length-1;R++){const L=R+M*e.length,w=L,N=L+e.length,O=L+e.length+1,F=L+1;s.push(w,N,F),s.push(O,F,N)}this.setIndex(s),this.setAttribute("position",new Ct(a,3)),this.setAttribute("uv",new Ct(o,2)),this.setAttribute("normal",new Ct(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new JA(e.points,e.segments,e.phiStart,e.phiLength)}}class ly extends Yf{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ly(e.radius,e.detail)}}class fg extends en{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const s=e/2,a=t/2,o=Math.floor(n),u=Math.floor(i),c=o+1,h=u+1,p=e/o,v=t/u,y=[],_=[],A=[],E=[];for(let T=0;T<h;T++){const M=T*v-a;for(let R=0;R<c;R++){const L=R*p-s;_.push(L,-M,0),A.push(0,0,1),E.push(R/o),E.push(1-T/u)}}for(let T=0;T<u;T++)for(let M=0;M<o;M++){const R=M+c*T,L=M+c*(T+1),w=M+1+c*(T+1),N=M+1+c*T;y.push(R,L,N),y.push(L,w,N)}this.setIndex(y),this.setAttribute("position",new Ct(_,3)),this.setAttribute("normal",new Ct(A,3)),this.setAttribute("uv",new Ct(E,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fg(e.width,e.height,e.widthSegments,e.heightSegments)}}class QA extends en{constructor(e=.5,t=1,n=32,i=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:s,thetaLength:a},n=Math.max(3,n),i=Math.max(1,i);const o=[],u=[],c=[],h=[];let p=e;const v=(t-e)/i,y=new ee,_=new Ve;for(let A=0;A<=i;A++){for(let E=0;E<=n;E++){const T=s+E/n*a;y.x=p*Math.cos(T),y.y=p*Math.sin(T),u.push(y.x,y.y,y.z),c.push(0,0,1),_.x=(y.x/t+1)/2,_.y=(y.y/t+1)/2,h.push(_.x,_.y)}p+=v}for(let A=0;A<i;A++){const E=A*(n+1);for(let T=0;T<n;T++){const M=T+E,R=M,L=M+n+1,w=M+n+2,N=M+1;o.push(R,L,N),o.push(L,w,N)}}this.setIndex(o),this.setAttribute("position",new Ct(u,3)),this.setAttribute("normal",new Ct(c,3)),this.setAttribute("uv",new Ct(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new QA(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class $A extends en{constructor(e=new _d([new Ve(0,.5),new Ve(-.5,-.5),new Ve(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],s=[],a=[];let o=0,u=0;if(Array.isArray(e)===!1)c(e);else for(let h=0;h<e.length;h++)c(e[h]),this.addGroup(o,u,h),o+=u,u=0;this.setIndex(n),this.setAttribute("position",new Ct(i,3)),this.setAttribute("normal",new Ct(s,3)),this.setAttribute("uv",new Ct(a,2));function c(h){const p=i.length/3,v=h.extractPoints(t);let y=v.shape;const _=v.holes;ml.isClockWise(y)===!1&&(y=y.reverse());for(let E=0,T=_.length;E<T;E++){const M=_[E];ml.isClockWise(M)===!0&&(_[E]=M.reverse())}const A=ml.triangulateShape(y,_);for(let E=0,T=_.length;E<T;E++){const M=_[E];y=y.concat(M)}for(let E=0,T=y.length;E<T;E++){const M=y[E];i.push(M.x,M.y,0),s.push(0,0,1),a.push(M.x,M.y)}for(let E=0,T=A.length;E<T;E++){const M=A[E],R=M[0]+p,L=M[1]+p,w=M[2]+p;n.push(R,L,w),u+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return lk(t,e)}static fromJSON(e,t){const n=[];for(let i=0,s=e.shapes.length;i<s;i++){const a=t[e.shapes[i]];n.push(a)}return new $A(n,e.curveSegments)}}function lk(r,e){if(e.shapes=[],Array.isArray(r))for(let t=0,n=r.length;t<n;t++){const i=r[t];e.shapes.push(i.uuid)}else e.shapes.push(r.uuid);return e}class uy extends en{constructor(e=1,t=32,n=16,i=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:s,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const u=Math.min(a+o,Math.PI);let c=0;const h=[],p=new ee,v=new ee,y=[],_=[],A=[],E=[];for(let T=0;T<=n;T++){const M=[],R=T/n;let L=0;T===0&&a===0?L=.5/t:T===n&&u===Math.PI&&(L=-.5/t);for(let w=0;w<=t;w++){const N=w/t;p.x=-e*Math.cos(i+N*s)*Math.sin(a+R*o),p.y=e*Math.cos(a+R*o),p.z=e*Math.sin(i+N*s)*Math.sin(a+R*o),_.push(p.x,p.y,p.z),v.copy(p).normalize(),A.push(v.x,v.y,v.z),E.push(N+L,1-R),M.push(c++)}h.push(M)}for(let T=0;T<n;T++)for(let M=0;M<t;M++){const R=h[T][M+1],L=h[T][M],w=h[T+1][M],N=h[T+1][M+1];(T!==0||a>0)&&y.push(R,L,N),(T!==n-1||u<Math.PI)&&y.push(L,w,N)}this.setIndex(y),this.setAttribute("position",new Ct(_,3)),this.setAttribute("normal",new Ct(A,3)),this.setAttribute("uv",new Ct(E,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uy(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class ZA extends Yf{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ZA(e.radius,e.detail)}}class eE extends en{constructor(e=1,t=.4,n=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:s},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],u=[],c=[],h=new ee,p=new ee,v=new ee;for(let y=0;y<=n;y++)for(let _=0;_<=i;_++){const A=_/i*s,E=y/n*Math.PI*2;p.x=(e+t*Math.cos(E))*Math.cos(A),p.y=(e+t*Math.cos(E))*Math.sin(A),p.z=t*Math.sin(E),o.push(p.x,p.y,p.z),h.x=e*Math.cos(A),h.y=e*Math.sin(A),v.subVectors(p,h).normalize(),u.push(v.x,v.y,v.z),c.push(_/i),c.push(y/n)}for(let y=1;y<=n;y++)for(let _=1;_<=i;_++){const A=(i+1)*y+_-1,E=(i+1)*(y-1)+_-1,T=(i+1)*(y-1)+_,M=(i+1)*y+_;a.push(A,E,M),a.push(E,T,M)}this.setIndex(a),this.setAttribute("position",new Ct(o,3)),this.setAttribute("normal",new Ct(u,3)),this.setAttribute("uv",new Ct(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new eE(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class tE extends en{constructor(e=1,t=.4,n=64,i=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:s,q:a},n=Math.floor(n),i=Math.floor(i);const o=[],u=[],c=[],h=[],p=new ee,v=new ee,y=new ee,_=new ee,A=new ee,E=new ee,T=new ee;for(let R=0;R<=n;++R){const L=R/n*s*Math.PI*2;M(L,s,a,e,y),M(L+.01,s,a,e,_),E.subVectors(_,y),T.addVectors(_,y),A.crossVectors(E,T),T.crossVectors(A,E),A.normalize(),T.normalize();for(let w=0;w<=i;++w){const N=w/i*Math.PI*2,O=-t*Math.cos(N),F=t*Math.sin(N);p.x=y.x+(O*T.x+F*A.x),p.y=y.y+(O*T.y+F*A.y),p.z=y.z+(O*T.z+F*A.z),u.push(p.x,p.y,p.z),v.subVectors(p,y).normalize(),c.push(v.x,v.y,v.z),h.push(R/n),h.push(w/i)}}for(let R=1;R<=n;R++)for(let L=1;L<=i;L++){const w=(i+1)*(R-1)+(L-1),N=(i+1)*R+(L-1),O=(i+1)*R+L,F=(i+1)*(R-1)+L;o.push(w,N,F),o.push(N,O,F)}this.setIndex(o),this.setAttribute("position",new Ct(u,3)),this.setAttribute("normal",new Ct(c,3)),this.setAttribute("uv",new Ct(h,2));function M(R,L,w,N,O){const F=Math.cos(R),B=Math.sin(R),P=w/L*R,V=Math.cos(P);O.x=N*(2+V)*.5*F,O.y=N*(2+V)*B*.5,O.z=N*Math.sin(P)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new tE(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class nE extends en{constructor(e=new wM(new ee(-1,-1,0),new ee(-1,1,0),new ee(1,1,0)),t=64,n=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:s};const a=e.computeFrenetFrames(t,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new ee,u=new ee,c=new Ve;let h=new ee;const p=[],v=[],y=[],_=[];A(),this.setIndex(_),this.setAttribute("position",new Ct(p,3)),this.setAttribute("normal",new Ct(v,3)),this.setAttribute("uv",new Ct(y,2));function A(){for(let R=0;R<t;R++)E(R);E(s===!1?t:0),M(),T()}function E(R){h=e.getPointAt(R/t,h);const L=a.normals[R],w=a.binormals[R];for(let N=0;N<=i;N++){const O=N/i*Math.PI*2,F=Math.sin(O),B=-Math.cos(O);u.x=B*L.x+F*w.x,u.y=B*L.y+F*w.y,u.z=B*L.z+F*w.z,u.normalize(),v.push(u.x,u.y,u.z),o.x=h.x+n*u.x,o.y=h.y+n*u.y,o.z=h.z+n*u.z,p.push(o.x,o.y,o.z)}}function T(){for(let R=1;R<=t;R++)for(let L=1;L<=i;L++){const w=(i+1)*(R-1)+(L-1),N=(i+1)*R+(L-1),O=(i+1)*R+L,F=(i+1)*(R-1)+L;_.push(w,N,F),_.push(N,O,F)}}function M(){for(let R=0;R<=t;R++)for(let L=0;L<=i;L++)c.x=R/t,c.y=L/i,y.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new nE(new JS[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class G2 extends en{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,i=new ee,s=new ee;if(e.index!==null){const a=e.attributes.position,o=e.index;let u=e.groups;u.length===0&&(u=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,h=u.length;c<h;++c){const p=u[c],v=p.start,y=p.count;for(let _=v,A=v+y;_<A;_+=3)for(let E=0;E<3;E++){const T=o.getX(_+E),M=o.getX(_+(E+1)%3);i.fromBufferAttribute(a,T),s.fromBufferAttribute(a,M),FD(i,s,n)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}}else{const a=e.attributes.position;for(let o=0,u=a.count/3;o<u;o++)for(let c=0;c<3;c++){const h=3*o+c,p=3*o+(c+1)%3;i.fromBufferAttribute(a,h),s.fromBufferAttribute(a,p),FD(i,s,n)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new Ct(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function FD(r,e,t){const n=`${r.x},${r.y},${r.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${r.x},${r.y},${r.z}`;return t.has(n)===!0||t.has(i)===!0?!1:(t.add(n),t.add(i),!0)}var kD=Object.freeze({__proto__:null,BoxGeometry:Nd,CapsuleGeometry:KA,CircleGeometry:YA,ConeGeometry:oy,CylinderGeometry:ay,DodecahedronGeometry:XA,EdgesGeometry:L2,ExtrudeGeometry:WA,IcosahedronGeometry:jA,LatheGeometry:JA,OctahedronGeometry:ly,PlaneGeometry:fg,PolyhedronGeometry:Yf,RingGeometry:QA,ShapeGeometry:$A,SphereGeometry:uy,TetrahedronGeometry:ZA,TorusGeometry:eE,TorusKnotGeometry:tE,TubeGeometry:nE,WireframeGeometry:G2});class H2 extends Rs{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new dt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class OM extends to{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class hg extends Rs{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new dt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kf,this.normalScale=new Ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new eo,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Uo extends hg{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ve(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return jt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new dt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new dt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new dt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class z2 extends Rs{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new dt(16777215),this.specular=new dt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kf,this.normalScale=new Ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new eo,this.combine=Zv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class V2 extends Rs{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new dt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kf,this.normalScale=new Ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class K2 extends Rs{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kf,this.normalScale=new Ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Y2 extends Rs{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new dt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kf,this.normalScale=new Ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new eo,this.combine=Zv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class PM extends Rs{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=u2,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class NM extends Rs{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class X2 extends Rs{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new dt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kf,this.normalScale=new Ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class q2 extends Mr{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function dd(r,e){return!r||r.constructor===e?r:typeof e.BYTES_PER_ELEMENT=="number"?new e(r):Array.prototype.slice.call(r)}function W2(r){function e(i,s){return r[i]-r[s]}const t=r.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n}function l1(r,e,t){const n=r.length,i=new r.constructor(n);for(let s=0,a=0;a!==n;++s){const o=t[s]*e;for(let u=0;u!==e;++u)i[a++]=r[o+u]}return i}function UM(r,e,t,n){let i=1,s=r[0];for(;s!==void 0&&s[n]===void 0;)s=r[i++];if(s===void 0)return;let a=s[n];if(a!==void 0)if(Array.isArray(a))do a=s[n],a!==void 0&&(e.push(s.time),t.push(...a)),s=r[i++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[n],a!==void 0&&(e.push(s.time),a.toArray(t,t.length)),s=r[i++];while(s!==void 0);else do a=s[n],a!==void 0&&(e.push(s.time),t.push(a)),s=r[i++];while(s!==void 0)}function uk(r,e,t,n,i=30){const s=r.clone();s.name=e;const a=[];for(let u=0;u<s.tracks.length;++u){const c=s.tracks[u],h=c.getValueSize(),p=[],v=[];for(let y=0;y<c.times.length;++y){const _=c.times[y]*i;if(!(_<t||_>=n)){p.push(c.times[y]);for(let A=0;A<h;++A)v.push(c.values[y*h+A])}}p.length!==0&&(c.times=dd(p,c.times.constructor),c.values=dd(v,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let u=0;u<s.tracks.length;++u)o>s.tracks[u].times[0]&&(o=s.tracks[u].times[0]);for(let u=0;u<s.tracks.length;++u)s.tracks[u].shift(-1*o);return s.resetDuration(),s}function ck(r,e=0,t=r,n=30){n<=0&&(n=30);const i=t.tracks.length,s=e/n;for(let a=0;a<i;++a){const o=t.tracks[a],u=o.ValueTypeName;if(u==="bool"||u==="string")continue;const c=r.tracks.find(function(T){return T.name===o.name&&T.ValueTypeName===u});if(c===void 0)continue;let h=0;const p=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=p/3);let v=0;const y=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(v=y/3);const _=o.times.length-1;let A;if(s<=o.times[0]){const T=h,M=p-h;A=o.values.slice(T,M)}else if(s>=o.times[_]){const T=_*p+h,M=T+p-h;A=o.values.slice(T,M)}else{const T=o.createInterpolant(),M=h,R=p-h;T.evaluate(s),A=T.resultBuffer.slice(M,R)}u==="quaternion"&&new Tr().fromArray(A).normalize().conjugate().toArray(A);const E=c.times.length;for(let T=0;T<E;++T){const M=T*y+v;if(u==="quaternion")Tr.multiplyQuaternionsFlat(c.values,M,A,0,c.values,M);else{const R=y-v*2;for(let L=0;L<R;++L)c.values[M+L]-=A[L]}}}return r.blendMode=pM,r}class fk{static convertArray(e,t){return dd(e,t)}static isTypedArray(e){return y2(e)}static getKeyframeOrder(e){return W2(e)}static sortedArray(e,t,n){return l1(e,t,n)}static flattenJSON(e,t,n,i){UM(e,t,n,i)}static subclip(e,t,n,i,s=30){return uk(e,t,n,i,s)}static makeClipAdditive(e,t=0,n=e,i=30){return ck(e,t,n,i)}}class dg{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],s=t[n-1];e:{t:{let a;n:{i:if(!(e<i)){for(let o=n+2;;){if(i===void 0){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(s=i,i=t[++n],e<i)break t}a=t.length;break n}if(!(e>=s)){const o=t[1];e<o&&(n=2,s=o);for(let u=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===u)break;if(i=s,s=t[--n-1],e>=s)break t}a=n,n=0;break n}break e}for(;n<a;){const o=n+a>>>1;e<t[o]?a=o:n=o+1}if(i=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,i)}return this.interpolate_(n,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i;for(let a=0;a!==i;++a)t[a]=n[s+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class j2 extends dg{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:fd,endingEnd:fd}}intervalChanged_(e,t,n){const i=this.parameterPositions;let s=e-2,a=e+1,o=i[s],u=i[a];if(o===void 0)switch(this.getSettings_().endingStart){case hd:s=e,o=2*t-n;break;case Lv:s=i.length-2,o=t+i[s]-i[s+1];break;default:s=e,o=n}if(u===void 0)switch(this.getSettings_().endingEnd){case hd:a=e,u=2*n-t;break;case Lv:a=1,u=n+i[1]-i[0];break;default:a=e-1,u=t}const c=(n-t)*.5,h=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(u-n),this._offsetPrev=s*h,this._offsetNext=a*h}interpolate_(e,t,n,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,u=e*o,c=u-o,h=this._offsetPrev,p=this._offsetNext,v=this._weightPrev,y=this._weightNext,_=(n-t)/(i-t),A=_*_,E=A*_,T=-v*E+2*v*A-v*_,M=(1+v)*E+(-1.5-2*v)*A+(-.5+v)*_+1,R=(-1-y)*E+(1.5+y)*A+.5*_,L=y*E-y*A;for(let w=0;w!==o;++w)s[w]=T*a[h+w]+M*a[c+w]+R*a[u+w]+L*a[p+w];return s}}class FM extends dg{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,u=e*o,c=u-o,h=(n-t)/(i-t),p=1-h;for(let v=0;v!==o;++v)s[v]=a[c+v]*p+a[u+v]*h;return s}}class J2 extends dg{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Fo{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=dd(t,this.TimeBufferType),this.values=dd(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:dd(e.times,Array),values:dd(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new J2(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new FM(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new j2(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Hm:t=this.InterpolantFactoryMethodDiscrete;break;case zm:t=this.InterpolantFactoryMethodLinear;break;case Kx:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return ct("KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Hm;case this.InterpolantFactoryMethodLinear:return zm;case this.InterpolantFactoryMethodSmooth:return Kx}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let s=0,a=i-1;for(;s!==i&&n[s]<e;)++s;for(;a!==-1&&n[a]>t;)--a;if(++a,s!==0||a!==i){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=n.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(Nt("KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,s=n.length;s===0&&(Nt("KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==s;o++){const u=n[o];if(typeof u=="number"&&isNaN(u)){Nt("KeyframeTrack: Time is not a valid number.",this,o,u),e=!1;break}if(a!==null&&a>u){Nt("KeyframeTrack: Out of order keys.",this,o,u,a),e=!1;break}a=u}if(i!==void 0&&y2(i))for(let o=0,u=i.length;o!==u;++o){const c=i[o];if(isNaN(c)){Nt("KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Kx,s=e.length-1;let a=1;for(let o=1;o<s;++o){let u=!1;const c=e[o],h=e[o+1];if(c!==h&&(o!==1||c!==e[0]))if(i)u=!0;else{const p=o*n,v=p-n,y=p+n;for(let _=0;_!==n;++_){const A=t[p+_];if(A!==t[v+_]||A!==t[y+_]){u=!0;break}}}if(u){if(o!==a){e[a]=e[o];const p=o*n,v=a*n;for(let y=0;y!==n;++y)t[v+y]=t[p+y]}++a}}if(s>0){e[a]=e[s];for(let o=s*n,u=a*n,c=0;c!==n;++c)t[u+c]=t[o+c];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Fo.prototype.ValueTypeName="";Fo.prototype.TimeBufferType=Float32Array;Fo.prototype.ValueBufferType=Float32Array;Fo.prototype.DefaultInterpolation=zm;class Ud extends Fo{constructor(e,t,n){super(e,t,n)}}Ud.prototype.ValueTypeName="bool";Ud.prototype.ValueBufferType=Array;Ud.prototype.DefaultInterpolation=Hm;Ud.prototype.InterpolantFactoryMethodLinear=void 0;Ud.prototype.InterpolantFactoryMethodSmooth=void 0;class kM extends Fo{constructor(e,t,n,i){super(e,t,n,i)}}kM.prototype.ValueTypeName="color";class Id extends Fo{constructor(e,t,n,i){super(e,t,n,i)}}Id.prototype.ValueTypeName="number";class Q2 extends dg{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,u=(n-t)/(i-t);let c=e*o;for(let h=c+o;c!==h;c+=4)Tr.slerpFlat(s,0,a,c-o,a,c,u);return s}}class wd extends Fo{constructor(e,t,n,i){super(e,t,n,i)}InterpolantFactoryMethodLinear(e){return new Q2(this.times,this.values,this.getValueSize(),e)}}wd.prototype.ValueTypeName="quaternion";wd.prototype.InterpolantFactoryMethodSmooth=void 0;class Fd extends Fo{constructor(e,t,n){super(e,t,n)}}Fd.prototype.ValueTypeName="string";Fd.prototype.ValueBufferType=Array;Fd.prototype.DefaultInterpolation=Hm;Fd.prototype.InterpolantFactoryMethodLinear=void 0;Fd.prototype.InterpolantFactoryMethodSmooth=void 0;class Bd extends Fo{constructor(e,t,n,i){super(e,t,n,i)}}Bd.prototype.ValueTypeName="vector";class jm{constructor(e="",t=-1,n=[],i=BA){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=ja(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let a=0,o=n.length;a!==o;++a)t.push(dk(n[a]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s.userData=JSON.parse(e.userData||"{}"),s}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let s=0,a=n.length;s!==a;++s)t.push(Fo.toJSON(n[s]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const s=t.length,a=[];for(let o=0;o<s;o++){let u=[],c=[];u.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const h=W2(u);u=l1(u,1,h),c=l1(c,1,h),!i&&u[0]===0&&(u.push(s),c.push(c[0])),a.push(new Id(".morphTargetInfluences["+t[o].name+"]",u,c).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,u=e.length;o<u;o++){const c=e[o],h=c.name.match(s);if(h&&h.length>1){const p=h[1];let v=i[p];v||(i[p]=v=[]),v.push(c)}}const a=[];for(const o in i)a.push(this.CreateFromMorphTargetSequence(o,i[o],t,n));return a}static parseAnimation(e,t){if(ct("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return Nt("AnimationClip: No animation in JSONLoader data."),null;const n=function(p,v,y,_,A){if(y.length!==0){const E=[],T=[];UM(y,E,T,_),E.length!==0&&A.push(new p(v,E,T))}},i=[],s=e.name||"default",a=e.fps||30,o=e.blendMode;let u=e.length||-1;const c=e.hierarchy||[];for(let p=0;p<c.length;p++){const v=c[p].keys;if(!(!v||v.length===0))if(v[0].morphTargets){const y={};let _;for(_=0;_<v.length;_++)if(v[_].morphTargets)for(let A=0;A<v[_].morphTargets.length;A++)y[v[_].morphTargets[A]]=-1;for(const A in y){const E=[],T=[];for(let M=0;M!==v[_].morphTargets.length;++M){const R=v[_];E.push(R.time),T.push(R.morphTarget===A?1:0)}i.push(new Id(".morphTargetInfluence["+A+"]",E,T))}u=y.length*a}else{const y=".bones["+t[p].name+"]";n(Bd,y+".position",v,"pos",i),n(wd,y+".quaternion",v,"rot",i),n(Bd,y+".scale",v,"scl",i)}}return i.length===0?null:new this(s,u,i,o)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,i=e.length;n!==i;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function hk(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Id;case"vector":case"vector2":case"vector3":case"vector4":return Bd;case"color":return kM;case"quaternion":return wd;case"bool":case"boolean":return Ud;case"string":return Fd}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function dk(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=hk(r.type);if(r.times===void 0){const t=[],n=[];UM(r.keys,t,n,"value"),r.times=t,r.values=n}return e.parse!==void 0?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}const cu={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class GM{constructor(e,t,n){const i=this;let s=!1,a=0,o=0,u;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this._abortController=null,this.itemStart=function(h){o++,s===!1&&i.onStart!==void 0&&i.onStart(h,a,o),s=!0},this.itemEnd=function(h){a++,i.onProgress!==void 0&&i.onProgress(h,a,o),a===o&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(h){i.onError!==void 0&&i.onError(h)},this.resolveURL=function(h){return u?u(h):h},this.setURLModifier=function(h){return u=h,this},this.addHandler=function(h,p){return c.push(h,p),this},this.removeHandler=function(h){const p=c.indexOf(h);return p!==-1&&c.splice(p,2),this},this.getHandler=function(h){for(let p=0,v=c.length;p<v;p+=2){const y=c[p],_=c[p+1];if(y.global&&(y.lastIndex=0),y.test(h))return _}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const $2=new GM;class Cr{constructor(e){this.manager=e!==void 0?e:$2,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,s){n.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}Cr.DEFAULT_MATERIAL_NAME="__DEFAULT";const oc={};class pk extends Error{constructor(e,t){super(e),this.response=t}}class no extends Cr{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=cu.get(`file:${e}`);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(oc[e]!==void 0){oc[e].push({onLoad:t,onProgress:n,onError:i});return}oc[e]=[],oc[e].push({onLoad:t,onProgress:n,onError:i});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,u=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&ct("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=oc[e],p=c.body.getReader(),v=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),y=v?parseInt(v):0,_=y!==0;let A=0;const E=new ReadableStream({start(T){M();function M(){p.read().then(({done:R,value:L})=>{if(R)T.close();else{A+=L.byteLength;const w=new ProgressEvent("progress",{lengthComputable:_,loaded:A,total:y});for(let N=0,O=h.length;N<O;N++){const F=h[N];F.onProgress&&F.onProgress(w)}T.enqueue(L),M()}},R=>{T.error(R)})}}});return new Response(E)}else throw new pk(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(u){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,o));case"json":return c.json();default:if(o==="")return c.text();{const p=/charset="?([^;"\s]*)"?/i.exec(o),v=p&&p[1]?p[1].toLowerCase():void 0,y=new TextDecoder(v);return c.arrayBuffer().then(_=>y.decode(_))}}}).then(c=>{cu.add(`file:${e}`,c);const h=oc[e];delete oc[e];for(let p=0,v=h.length;p<v;p++){const y=h[p];y.onLoad&&y.onLoad(c)}}).catch(c=>{const h=oc[e];if(h===void 0)throw this.manager.itemError(e),c;delete oc[e];for(let p=0,v=h.length;p<v;p++){const y=h[p];y.onError&&y.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class mk extends Cr{constructor(e){super(e)}load(e,t,n,i){const s=this,a=new no(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(u){i?i(u):Nt(u),s.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=jm.parse(e[n]);t.push(i)}return t}}class gk extends Cr{constructor(e){super(e)}load(e,t,n,i){const s=this,a=[],o=new VA,u=new no(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(s.withCredentials);let c=0;function h(p){u.load(e[p],function(v){const y=s.parse(v,!0);a[p]={width:y.width,height:y.height,format:y.format,mipmaps:y.mipmaps},c+=1,c===6&&(y.mipmapCount===1&&(o.minFilter=Gn),o.image=a,o.format=y.format,o.needsUpdate=!0,t&&t(o))},n,i)}if(Array.isArray(e))for(let p=0,v=e.length;p<v;++p)h(p);else u.load(e,function(p){const v=s.parse(p,!0);if(v.isCubemap){const y=v.mipmaps.length/v.mipmapCount;for(let _=0;_<y;_++){a[_]={mipmaps:[]};for(let A=0;A<v.mipmapCount;A++)a[_].mipmaps.push(v.mipmaps[_*v.mipmapCount+A]),a[_].format=v.format,a[_].width=v.width,a[_].height=v.height}o.image=a}else o.image.width=v.width,o.image.height=v.height,o.mipmaps=v.mipmaps;v.mipmapCount===1&&(o.minFilter=Gn),o.format=v.format,o.needsUpdate=!0,t&&t(o)},n,i);return o}}const cm=new WeakMap;class Fv extends Cr{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=cu.get(`image:${e}`);if(a!==void 0){if(a.complete===!0)s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0);else{let p=cm.get(a);p===void 0&&(p=[],cm.set(a,p)),p.push({onLoad:t,onError:i})}return a}const o=Bv("img");function u(){h(),t&&t(this);const p=cm.get(this)||[];for(let v=0;v<p.length;v++){const y=p[v];y.onLoad&&y.onLoad(this)}cm.delete(this),s.manager.itemEnd(e)}function c(p){h(),i&&i(p),cu.remove(`image:${e}`);const v=cm.get(this)||[];for(let y=0;y<v.length;y++){const _=v[y];_.onError&&_.onError(p)}cm.delete(this),s.manager.itemError(e),s.manager.itemEnd(e)}function h(){o.removeEventListener("load",u,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",u,!1),o.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),cu.add(`image:${e}`,o),s.manager.itemStart(e),o.src=e,o}}class vk extends Cr{constructor(e){super(e)}load(e,t,n,i){const s=new ny;s.colorSpace=xr;const a=new Fv(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function u(c){a.load(e[c],function(h){s.images[c]=h,o++,o===6&&(s.needsUpdate=!0,t&&t(s))},void 0,i)}for(let c=0;c<e.length;++c)u(c);return s}}class yk extends Cr{constructor(e){super(e)}load(e,t,n,i){const s=this,a=new yl,o=new no(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,function(u){let c;try{c=s.parse(u)}catch(h){if(i!==void 0)i(h);else{h(h);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:Zr,a.wrapT=c.wrapT!==void 0?c.wrapT:Zr,a.magFilter=c.magFilter!==void 0?c.magFilter:Gn,a.minFilter=c.minFilter!==void 0?c.minFilter:Gn,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(a.colorSpace=c.colorSpace),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=Io),c.mipmapCount===1&&(a.minFilter=Gn),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,t&&t(a,c)},n,i),a}}class cy extends Cr{constructor(e){super(e)}load(e,t,n,i){const s=new yi,a=new Fv(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,t!==void 0&&t(s)},n,i),s}}class Xf extends Bn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new dt(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class Z2 extends Xf{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Bn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new dt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const FT=new zt,GD=new ee,HD=new ee;class HM{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ve(512,512),this.mapType=Jr,this.map=null,this.mapPass=null,this.matrix=new zt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new cg,this._frameExtents=new Ve(1,1),this._viewportCount=1,this._viewports=[new ni(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;GD.setFromMatrixPosition(e.matrixWorld),t.position.copy(GD),HD.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(HD),t.updateMatrixWorld(),FT.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(FT,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(FT)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class _k extends HM{constructor(){super(new gs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=Ym*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(n!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class zM extends Xf{constructor(e,t,n=0,i=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Bn.DEFAULT_UP),this.updateMatrix(),this.target=new Bn,this.distance=n,this.angle=i,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new _k}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class xk extends HM{constructor(){super(new gs(90,1,.5,500)),this.isPointLightShadow=!0}}class VM extends Xf{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new xk}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}let kd=class extends ty{constructor(e=-1,t=1,n=1,i=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=n-e,a=n+e,o=i+t,u=i-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=h*this.view.offsetY,u=o-h*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,u,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};class Sk extends HM{constructor(){super(new kd(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class KM extends Xf{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Bn.DEFAULT_UP),this.updateMatrix(),this.target=new Bn,this.shadow=new Sk}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class eB extends Xf{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class tB extends Xf{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class YM{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ee)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*s),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],1.092548*(n*i)),t.addScaledVector(a[5],1.092548*(i*s)),t.addScaledVector(a[6],.315392*(3*s*s-1)),t.addScaledVector(a[7],1.092548*(n*s)),t.addScaledVector(a[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*i),t.addScaledVector(a[2],2*.511664*s),t.addScaledVector(a[3],2*.511664*n),t.addScaledVector(a[4],2*.429043*n*i),t.addScaledVector(a[5],2*.429043*i*s),t.addScaledVector(a[6],.743125*s*s-.247708),t.addScaledVector(a[7],2*.429043*n*s),t.addScaledVector(a[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const n=e.x,i=e.y,s=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-i*i)}}class nB extends Xf{constructor(e=new YM,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class iE extends Cr{constructor(e){super(e),this.textures={}}load(e,t,n,i){const s=this,a=new no(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(u){i?i(u):Nt(u),s.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(s){return t[s]===void 0&&ct("MaterialLoader: Undefined texture",s),t[s]}const i=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new dt().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(i.dispersion=e.dispersion),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(i.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(i.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(i.blendSrc=e.blendSrc),e.blendDst!==void 0&&(i.blendDst=e.blendDst),e.blendEquation!==void 0&&(i.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(i.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(i.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(i.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&i.blendColor!==void 0&&i.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(i.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==void 0&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(i.forceSinglePass=e.forceSinglePass),e.allowOverride!==void 0&&(i.allowOverride=e.allowOverride),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const a=e.uniforms[s];switch(i.uniforms[s]={},a.type){case"t":i.uniforms[s].value=n(a.value);break;case"c":i.uniforms[s].value=new dt().setHex(a.value);break;case"v2":i.uniforms[s].value=new Ve().fromArray(a.value);break;case"v3":i.uniforms[s].value=new ee().fromArray(a.value);break;case"v4":i.uniforms[s].value=new ni().fromArray(a.value);break;case"m3":i.uniforms[s].value=new on().fromArray(a.value);break;case"m4":i.uniforms[s].value=new zt().fromArray(a.value);break;default:i.uniforms[s].value=a.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)i.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(i.lights=e.lights),e.clipping!==void 0&&(i.clipping=e.clipping),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),i.normalScale=new Ve().fromArray(s)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapRotation!==void 0&&i.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new Ve().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(i.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return iE.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:H2,SpriteMaterial:SM,RawShaderMaterial:OM,ShaderMaterial:to,PointsMaterial:zA,MeshPhysicalMaterial:Uo,MeshStandardMaterial:hg,MeshPhongMaterial:z2,MeshToonMaterial:V2,MeshNormalMaterial:K2,MeshLambertMaterial:Y2,MeshDepthMaterial:PM,MeshDistanceMaterial:NM,MeshBasicMaterial:Xa,MeshMatcapMaterial:X2,LineDashedMaterial:q2,LineBasicMaterial:Mr,Material:Rs};return new t[e]}}class wf{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class iB extends en{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class sB extends Cr{constructor(e){super(e)}load(e,t,n,i){const s=this,a=new no(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(u){i?i(u):Nt(u),s.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(y,_){if(t[_]!==void 0)return t[_];const E=y.interleavedBuffers[_],T=s(y,E.buffer),M=Tm(E.type,T),R=new sy(M,E.stride);return R.uuid=E.uuid,t[_]=R,R}function s(y,_){if(n[_]!==void 0)return n[_];const E=y.arrayBuffers[_],T=new Uint32Array(E).buffer;return n[_]=T,T}const a=e.isInstancedBufferGeometry?new iB:new en,o=e.data.index;if(o!==void 0){const y=Tm(o.type,o.array);a.setIndex(new On(y,1))}const u=e.data.attributes;for(const y in u){const _=u[y];let A;if(_.isInterleavedBufferAttribute){const E=i(e.data,_.data);A=new Ff(E,_.itemSize,_.offset,_.normalized)}else{const E=Tm(_.type,_.array),T=_.isInstancedBufferAttribute?Dd:On;A=new T(E,_.itemSize,_.normalized)}_.name!==void 0&&(A.name=_.name),_.usage!==void 0&&A.setUsage(_.usage),a.setAttribute(y,A)}const c=e.data.morphAttributes;if(c)for(const y in c){const _=c[y],A=[];for(let E=0,T=_.length;E<T;E++){const M=_[E];let R;if(M.isInterleavedBufferAttribute){const L=i(e.data,M.data);R=new Ff(L,M.itemSize,M.offset,M.normalized)}else{const L=Tm(M.type,M.array);R=new On(L,M.itemSize,M.normalized)}M.name!==void 0&&(R.name=M.name),A.push(R)}a.morphAttributes[y]=A}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const p=e.data.groups||e.data.drawcalls||e.data.offsets;if(p!==void 0)for(let y=0,_=p.length;y!==_;++y){const A=p[y];a.addGroup(A.start,A.count,A.materialIndex)}const v=e.data.boundingSphere;return v!==void 0&&(a.boundingSphere=new Vs().fromJSON(v)),e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class Ak extends Cr{constructor(e){super(e)}load(e,t,n,i){const s=this,a=this.path===""?wf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new no(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(u){let c=null;try{c=JSON.parse(u)}catch(p){i!==void 0&&i(p),p("ObjectLoader: Can't parse "+e+".",p.message);return}const h=c.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+e)),Nt("ObjectLoader: Can't load "+e);return}s.parse(c,t)},n,i)}async loadAsync(e,t){const n=this,i=this.path===""?wf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const s=new no(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(e,t),o=JSON.parse(a),u=o.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(o)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,function(){t!==void 0&&t(c)}),o=this.parseTextures(e.textures,a),u=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,s,u,o,n),h=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,h),this.bindLightTargets(c),t!==void 0){let p=!1;for(const v in a)if(a[v].data instanceof HTMLImageElement){p=!0;break}p===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),u=this.parseObject(e.object,i,o,a,t),c=this.parseSkeletons(e.skeletons,u);return this.bindSkeletons(u,c),this.bindLightTargets(u),u}parseShapes(e){const t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){const s=new _d().fromJSON(e[n]);t[s.uuid]=s}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(s){s.isBone&&(i[s.uuid]=s)}),e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=new ry().fromJSON(e[s],i);n[o.uuid]=o}return n}parseGeometries(e,t){const n={};if(e!==void 0){const i=new sB;for(let s=0,a=e.length;s<a;s++){let o;const u=e[s];switch(u.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(u);break;default:u.type in kD?o=kD[u.type].fromJSON(u,t):ct(`ObjectLoader: Unsupported geometry type "${u.type}"`)}o.uuid=u.uuid,u.name!==void 0&&(o.name=u.name),u.userData!==void 0&&(o.userData=u.userData),n[u.uuid]=o}}return n}parseMaterials(e,t){const n={},i={};if(e!==void 0){const s=new iE;s.setTextures(t);for(let a=0,o=e.length;a<o;a++){const u=e[a];n[u.uuid]===void 0&&(n[u.uuid]=s.parse(u)),i[u.uuid]=n[u.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const i=e[n],s=jm.parse(i);t[s.uuid]=s}return t}parseImages(e,t){const n=this,i={};let s;function a(u){return n.manager.itemStart(u),s.load(u,function(){n.manager.itemEnd(u)},void 0,function(){n.manager.itemError(u),n.manager.itemEnd(u)})}function o(u){if(typeof u=="string"){const c=u,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return a(h)}else return u.data?{data:Tm(u.type,u.data),width:u.width,height:u.height}:null}if(e!==void 0&&e.length>0){const u=new GM(t);s=new Fv(u),s.setCrossOrigin(this.crossOrigin);for(let c=0,h=e.length;c<h;c++){const p=e[c],v=p.url;if(Array.isArray(v)){const y=[];for(let _=0,A=v.length;_<A;_++){const E=v[_],T=o(E);T!==null&&(T instanceof HTMLImageElement?y.push(T):y.push(new yl(T.data,T.width,T.height)))}i[p.uuid]=new Cf(y)}else{const y=o(p.url);i[p.uuid]=new Cf(y)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function s(a){if(typeof a=="string"){const o=a,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o;return await i.loadAsync(u)}else return a.data?{data:Tm(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){i=new Fv(this.manager),i.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const u=e[a],c=u.url;if(Array.isArray(c)){const h=[];for(let p=0,v=c.length;p<v;p++){const y=c[p],_=await s(y);_!==null&&(_ instanceof HTMLImageElement?h.push(_):h.push(new yl(_.data,_.width,_.height)))}n[u.uuid]=new Cf(h)}else{const h=await s(u.url);n[u.uuid]=new Cf(h)}}}return n}parseTextures(e,t){function n(s,a){return typeof s=="number"?s:(ct("ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const i={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=e[s];o.image===void 0&&ct('ObjectLoader: No "image" specified for',o.uuid),t[o.image]===void 0&&ct("ObjectLoader: Undefined image",o.image);const u=t[o.image],c=u.data;let h;Array.isArray(c)?(h=new ny,c.length===6&&(h.needsUpdate=!0)):(c&&c.data?h=new yl:h=new yi,c&&(h.needsUpdate=!0)),h.source=u,h.uuid=o.uuid,o.name!==void 0&&(h.name=o.name),o.mapping!==void 0&&(h.mapping=n(o.mapping,Ek)),o.channel!==void 0&&(h.channel=o.channel),o.offset!==void 0&&h.offset.fromArray(o.offset),o.repeat!==void 0&&h.repeat.fromArray(o.repeat),o.center!==void 0&&h.center.fromArray(o.center),o.rotation!==void 0&&(h.rotation=o.rotation),o.wrap!==void 0&&(h.wrapS=n(o.wrap[0],zD),h.wrapT=n(o.wrap[1],zD)),o.format!==void 0&&(h.format=o.format),o.internalFormat!==void 0&&(h.internalFormat=o.internalFormat),o.type!==void 0&&(h.type=o.type),o.colorSpace!==void 0&&(h.colorSpace=o.colorSpace),o.minFilter!==void 0&&(h.minFilter=n(o.minFilter,VD)),o.magFilter!==void 0&&(h.magFilter=n(o.magFilter,VD)),o.anisotropy!==void 0&&(h.anisotropy=o.anisotropy),o.flipY!==void 0&&(h.flipY=o.flipY),o.generateMipmaps!==void 0&&(h.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(h.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(h.compareFunction=o.compareFunction),o.userData!==void 0&&(h.userData=o.userData),i[o.uuid]=h}return i}parseObject(e,t,n,i,s){let a;function o(v){return t[v]===void 0&&ct("ObjectLoader: Undefined geometry",v),t[v]}function u(v){if(v!==void 0){if(Array.isArray(v)){const y=[];for(let _=0,A=v.length;_<A;_++){const E=v[_];n[E]===void 0&&ct("ObjectLoader: Undefined material",E),y.push(n[E])}return y}return n[v]===void 0&&ct("ObjectLoader: Undefined material",v),n[v]}}function c(v){return i[v]===void 0&&ct("ObjectLoader: Undefined texture",v),i[v]}let h,p;switch(e.type){case"Scene":a=new iy,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new dt(e.background):a.background=c(e.background)),e.environment!==void 0&&(a.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new kA(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new FA(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new gs(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new kd(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new eB(e.color,e.intensity);break;case"DirectionalLight":a=new KM(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new VM(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new tB(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new zM(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new Z2(e.color,e.groundColor,e.intensity);break;case"LightProbe":const v=new YM().fromArray(e.sh);a=new nB(v,e.intensity);break;case"SkinnedMesh":h=o(e.geometry),p=u(e.material),a=new AM(h,p),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":h=o(e.geometry),p=u(e.material),a=new $i(h,p);break;case"InstancedMesh":h=o(e.geometry),p=u(e.material);const y=e.count,_=e.instanceMatrix,A=e.instanceColor;a=new EM(h,p,y),a.instanceMatrix=new Dd(new Float32Array(_.array),16),A!==void 0&&(a.instanceColor=new Dd(new Float32Array(A.array),A.itemSize));break;case"BatchedMesh":h=o(e.geometry),p=u(e.material),a=new R2(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,p),a.geometry=h,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(E=>{let T=null,M=null;return E.boundingBox!==void 0&&(T=new nr().fromJSON(E.boundingBox)),E.boundingSphere!==void 0&&(M=new Vs().fromJSON(E.boundingSphere)),{...E,boundingBox:T,boundingSphere:M}}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=c(e.matricesTexture.uuid),a._indirectTexture=c(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=c(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(a.boundingSphere=new Vs().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(a.boundingBox=new nr().fromJSON(e.boundingBox));break;case"LOD":a=new C2;break;case"Line":a=new Ec(o(e.geometry),u(e.material));break;case"LineLoop":a=new TM(o(e.geometry),u(e.material));break;case"LineSegments":a=new xl(o(e.geometry),u(e.material));break;case"PointCloud":case"Points":a=new bM(o(e.geometry),u(e.material));break;case"Sprite":a=new M2(u(e.material));break;case"Group":a=new _c;break;case"Bone":a=new GA;break;default:a=new Bn}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const v=e.children;for(let y=0;y<v.length;y++)a.add(this.parseObject(v[y],t,n,i,s))}if(e.animations!==void 0){const v=e.animations;for(let y=0;y<v.length;y++){const _=v[y];a.animations.push(s[_])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const v=e.levels;for(let y=0;y<v.length;y++){const _=v[y],A=a.getObjectByProperty("uuid",_.object);A!==void 0&&a.addLevel(A,_.distance,_.hysteresis)}}return a}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const i=t[n.skeleton];i===void 0?ct("ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,i=e.getObjectByProperty("uuid",n);i!==void 0?t.target=i:t.target=new Bn}})}}const Ek={UVMapping:bA,CubeReflectionMapping:pu,CubeRefractionMapping:Pf,EquirectangularReflectionMapping:Rv,EquirectangularRefractionMapping:Dv,CubeUVReflectionMapping:lg},zD={RepeatWrapping:mu,ClampToEdgeWrapping:Zr,MirroredRepeatWrapping:km},VD={NearestFilter:Ji,NearestMipmapNearestFilter:MA,NearestMipmapLinearFilter:cd,LinearFilter:Gn,LinearMipmapNearestFilter:Dm,LinearMipmapLinearFilter:Io},kT=new WeakMap;class rB extends Cr{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&ct("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&ct("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=cu.get(`image-bitmap:${e}`);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(c=>{if(kT.has(a)===!0)i&&i(kT.get(a)),s.manager.itemError(e),s.manager.itemEnd(e);else return t&&t(c),s.manager.itemEnd(e),c});return}return setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const u=fetch(e,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return cu.add(`image-bitmap:${e}`,c),t&&t(c),s.manager.itemEnd(e),c}).catch(function(c){i&&i(c),kT.set(u,c),cu.remove(`image-bitmap:${e}`),s.manager.itemError(e),s.manager.itemEnd(e)});cu.add(`image-bitmap:${e}`,u),s.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let px;class XM{static getContext(){return px===void 0&&(px=new(window.AudioContext||window.webkitAudioContext)),px}static setContext(e){px=e}}class Tk extends Cr{constructor(e){super(e)}load(e,t,n,i){const s=this,a=new no(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(u){try{const c=u.slice(0);XM.getContext().decodeAudioData(c,function(p){t(p)}).catch(o)}catch(c){o(c)}},n,i);function o(u){i?i(u):Nt(u),s.manager.itemError(e)}}}const KD=new zt,YD=new zt,Yh=new zt;class bk{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new gs,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new gs,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Yh.copy(e.projectionMatrix);const i=t.eyeSep/2,s=i*t.near/t.focus,a=t.near*Math.tan(yd*t.fov*.5)/t.zoom;let o,u;YD.elements[12]=-i,KD.elements[12]=i,o=-a*t.aspect+s,u=a*t.aspect+s,Yh.elements[0]=2*t.near/(u-o),Yh.elements[8]=(u+o)/(u-o),this.cameraL.projectionMatrix.copy(Yh),o=-a*t.aspect-s,u=a*t.aspect-s,Yh.elements[0]=2*t.near/(u-o),Yh.elements[8]=(u+o)/(u-o),this.cameraR.projectionMatrix.copy(Yh)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(YD),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(KD)}}class aB extends gs{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class qM{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const Xh=new ee,GT=new Tr,Mk=new ee,qh=new ee,Wh=new ee;class Ck extends Bn{constructor(){super(),this.type="AudioListener",this.context=XM.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new qM}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Xh,GT,Mk),qh.set(0,0,-1).applyQuaternion(GT),Wh.set(0,1,0).applyQuaternion(GT),t.positionX){const n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Xh.x,n),t.positionY.linearRampToValueAtTime(Xh.y,n),t.positionZ.linearRampToValueAtTime(Xh.z,n),t.forwardX.linearRampToValueAtTime(qh.x,n),t.forwardY.linearRampToValueAtTime(qh.y,n),t.forwardZ.linearRampToValueAtTime(qh.z,n),t.upX.linearRampToValueAtTime(Wh.x,n),t.upY.linearRampToValueAtTime(Wh.y,n),t.upZ.linearRampToValueAtTime(Wh.z,n)}else t.setPosition(Xh.x,Xh.y,Xh.z),t.setOrientation(qh.x,qh.y,qh.z,Wh.x,Wh.y,Wh.z)}}class oB extends Bn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){ct("Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){ct("Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){ct("Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){ct("Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){ct("Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(ct("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){ct("Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(ct("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const jh=new ee,XD=new Tr,Rk=new ee,Jh=new ee;class Dk extends oB{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(jh,XD,Rk),Jh.set(0,0,1).applyQuaternion(XD);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(jh.x,n),t.positionY.linearRampToValueAtTime(jh.y,n),t.positionZ.linearRampToValueAtTime(jh.z,n),t.orientationX.linearRampToValueAtTime(Jh.x,n),t.orientationY.linearRampToValueAtTime(Jh.y,n),t.orientationZ.linearRampToValueAtTime(Jh.z,n)}else t.setPosition(jh.x,jh.y,jh.z),t.setOrientation(Jh.x,Jh.y,Jh.z)}}class Lk{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class lB{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,s,a;switch(t){case"quaternion":i=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,s=e*i+i;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==i;++o)n[s+o]=n[o];a=t}else{a+=t;const o=t/a;this._mixBufferRegion(n,s,0,o,i)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const u=t*this._origIndex;this._mixBufferRegion(n,i,u,1-s,t)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let u=t,c=t+t;u!==c;++u)if(n[u]!==n[u+t]){o.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let s=n,a=i;s!==a;++s)t[s]=t[i+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,s){if(i>=.5)for(let a=0;a!==s;++a)e[t+a]=e[n+a]}_slerp(e,t,n,i){Tr.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,s){const a=this._workIndex*s;Tr.multiplyQuaternionsFlat(e,a,e,t,e,n),Tr.slerpFlat(e,t,e,t,e,a,i)}_lerp(e,t,n,i,s){const a=1-i;for(let o=0;o!==s;++o){const u=t+o;e[u]=e[u]*a+e[n+o]*i}}_lerpAdditive(e,t,n,i,s){for(let a=0;a!==s;++a){const o=t+a;e[o]=e[o]+e[n+a]*i}}}const WM="\\[\\]\\.:\\/",Ik=new RegExp("["+WM+"]","g"),jM="[^"+WM+"]",wk="[^"+WM.replace("\\.","")+"]",Bk=/((?:WC+[\/:])*)/.source.replace("WC",jM),Ok=/(WCOD+)?/.source.replace("WCOD",wk),Pk=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",jM),Nk=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",jM),Uk=new RegExp("^"+Bk+Ok+Pk+Nk+"$"),Fk=["material","materials","bones","map"];class kk{constructor(e,t,n){const i=n||Nn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=n.length;i!==s;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class Nn{constructor(e,t,n){this.path=t,this.parsedPath=n||Nn.parseTrackName(t),this.node=Nn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Nn.Composite(e,t,n):new Nn(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Ik,"")}static parseTrackName(e){const t=Uk.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=n.nodeName.substring(i+1);Fk.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===t||o.uuid===t)return o;const u=n(o.children);if(u)return u}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(e||(e=Nn.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){ct("PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){Nt("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){Nt("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){Nt("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){Nt("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){Nt("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){Nt("PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){Nt("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const a=e[i];if(a===void 0){const c=t.nodeName;Nt("PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let u=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){Nt("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){Nt("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}u=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(u=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(u=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Nn.Composite=kk;Nn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Nn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Nn.prototype.GetterByBindingType=[Nn.prototype._getValue_direct,Nn.prototype._getValue_array,Nn.prototype._getValue_arrayElement,Nn.prototype._getValue_toArray];Nn.prototype.SetterByBindingTypeAndVersioning=[[Nn.prototype._setValue_direct,Nn.prototype._setValue_direct_setNeedsUpdate,Nn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Nn.prototype._setValue_array,Nn.prototype._setValue_array_setNeedsUpdate,Nn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Nn.prototype._setValue_arrayElement,Nn.prototype._setValue_arrayElement_setNeedsUpdate,Nn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Nn.prototype._setValue_fromArray,Nn.prototype._setValue_fromArray_setNeedsUpdate,Nn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Gk{constructor(){this.isAnimationObjectGroup=!0,this.uuid=ja(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,s=this._bindings,a=s.length;let o,u=e.length,c=this.nCachedObjects_;for(let h=0,p=arguments.length;h!==p;++h){const v=arguments[h],y=v.uuid;let _=t[y];if(_===void 0){_=u++,t[y]=_,e.push(v);for(let A=0,E=a;A!==E;++A)s[A].push(new Nn(v,n[A],i[A]))}else if(_<c){o=e[_];const A=--c,E=e[A];t[E.uuid]=_,e[_]=E,t[y]=A,e[A]=v;for(let T=0,M=a;T!==M;++T){const R=s[T],L=R[A];let w=R[_];R[_]=L,w===void 0&&(w=new Nn(v,n[T],i[T])),R[A]=w}}else e[_]!==o&&Nt("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const u=arguments[a],c=u.uuid,h=t[c];if(h!==void 0&&h>=s){const p=s++,v=e[p];t[v.uuid]=h,e[h]=v,t[c]=p,e[p]=u;for(let y=0,_=i;y!==_;++y){const A=n[y],E=A[p],T=A[h];A[h]=E,A[p]=T}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let s=this.nCachedObjects_,a=e.length;for(let o=0,u=arguments.length;o!==u;++o){const c=arguments[o],h=c.uuid,p=t[h];if(p!==void 0)if(delete t[h],p<s){const v=--s,y=e[v],_=--a,A=e[_];t[y.uuid]=p,e[p]=y,t[A.uuid]=v,e[v]=A,e.pop();for(let E=0,T=i;E!==T;++E){const M=n[E],R=M[v],L=M[_];M[p]=R,M[v]=L,M.pop()}}else{const v=--a,y=e[v];v>0&&(t[y.uuid]=p),e[p]=y,e.pop();for(let _=0,A=i;_!==A;++_){const E=n[_];E[p]=E[v],E.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const s=this._bindings;if(i!==void 0)return s[i];const a=this._paths,o=this._parsedPaths,u=this._objects,c=u.length,h=this.nCachedObjects_,p=new Array(c);i=s.length,n[e]=i,a.push(e),o.push(t),s.push(p);for(let v=h,y=u.length;v!==y;++v){const _=u[v];p[v]=new Nn(_,e,t)}return p}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const i=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,u=a[o],c=e[o];t[c]=n,a[n]=u,a.pop(),s[n]=s[o],s.pop(),i[n]=i[o],i.pop()}}}class uB{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const s=t.tracks,a=s.length,o=new Array(a),u={endingStart:fd,endingEnd:fd};for(let c=0;c!==a;++c){const h=s[c].createInterpolant(null);o[c]=h,h.settings=u}this._interpolantSettings=u,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=a2,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),n===!0){const i=this._clip.duration,s=e._clip.duration,a=s/i,o=i/s;e.warp(1,a,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,s=i.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const u=o.parameterPositions,c=o.sampleValues;return u[0]=s,u[1]=s+n,c[0]=e/a,c[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const u=(e-s)*n;u<0||n===0?t=0:(this._startTime=null,t=n*u)}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const u=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case pM:for(let h=0,p=u.length;h!==p;++h)u[h].evaluate(a),c[h].accumulateAdditive(o);break;case BA:default:for(let h=0,p=u.length;h!==p;++h)u[h].evaluate(a),c[h].accumulate(i,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,s=this._loopCount;const a=n===o2;if(e===0)return s===-1?i:a&&(s&1)===1?t-i:i;if(n===r2){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),i>=t||i<0){const o=Math.floor(i/t);i-=t*o,s+=Math.abs(o);const u=this.repetitions-s;if(u<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(u===1){const c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&(s&1)===1)return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=hd,i.endingEnd=hd):(e?i.endingStart=this.zeroSlopeAtStart?hd:fd:i.endingStart=Lv,t?i.endingEnd=this.zeroSlopeAtEnd?hd:fd:i.endingEnd=Lv)}_scheduleFading(e,t,n){const i=this._mixer,s=i.time;let a=this._weightInterpolant;a===null&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,u=a.sampleValues;return o[0]=s,u[0]=t,o[1]=s+e,u[1]=n,this}}const Hk=new Float32Array(1);class zk extends _u{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,s=i.length,a=e._propertyBindings,o=e._interpolants,u=n.uuid,c=this._bindingsByRootAndName;let h=c[u];h===void 0&&(h={},c[u]=h);for(let p=0;p!==s;++p){const v=i[p],y=v.name;let _=h[y];if(_!==void 0)++_.referenceCount,a[p]=_;else{if(_=a[p],_!==void 0){_._cacheIndex===null&&(++_.referenceCount,this._addInactiveBinding(_,u,y));continue}const A=t&&t._propertyBindings[p].binding.parsedPath;_=new lB(Nn.create(n,y,A),v.ValueTypeName,v.getValueSize()),++_.referenceCount,this._addInactiveBinding(_,u,y),a[p]=_}o[p].resultBuffer=_.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,s=this._actionsByClip[i];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,s=this._actionsByClip;let a=s[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,o=a[s],u=o.knownActions,c=u[u.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,u[h]=c,u.pop(),e._byClipCacheIndex=null;const p=o.actionByRoot,v=(e._localRoot||this._root).uuid;delete p[v],u.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,s=this._bindings;let a=i[t];a===void 0&&(a={},i[t]=a),a[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,s=n.path,a=this._bindingsByRootAndName,o=a[i],u=t[t.length-1],c=e._cacheIndex;u._cacheIndex=c,t[c]=u,t.pop(),delete o[s],Object.keys(o).length===0&&delete a[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new FM(new Float32Array(2),new Float32Array(2),1,Hk),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,s=t[i];e.__cacheIndex=i,t[i]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const i=t||this._root,s=i.uuid;let a=typeof e=="string"?jm.findByName(i,e):e;const o=a!==null?a.uuid:e,u=this._actionsByClip[o];let c=null;if(n===void 0&&(a!==null?n=a.blendMode:n=BA),u!==void 0){const p=u.actionByRoot[s];if(p!==void 0&&p.blendMode===n)return p;c=u.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const h=new uB(this,a,t,n);return this._bindAction(h,c),this._addInactiveAction(h,o,s),h}existingAction(e,t){const n=t||this._root,i=n.uuid,s=typeof e=="string"?jm.findByName(n,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(i,e,s,a);const o=this._bindings,u=this._nActiveBindings;for(let c=0;c!==u;++c)o[c].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,s=i[n];if(s!==void 0){const a=s.knownActions;for(let o=0,u=a.length;o!==u;++o){const c=a[o];this._deactivateAction(c);const h=c._cacheIndex,p=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,p._cacheIndex=h,t[h]=p,t.pop(),this._removeInactiveBindingsForAction(c)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const a in n){const o=n[a].actionByRoot,u=o[t];u!==void 0&&(this._deactivateAction(u),this._removeInactiveAction(u))}const i=this._bindingsByRootAndName,s=i[t];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Vk extends vM{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isRenderTarget3D=!0,this.depth=n,this.texture=new UA(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class _r{constructor(e){this.value=e}clone(){return new _r(this.value.clone===void 0?this.value:this.value.clone())}}let Kk=0;class Yk extends _u{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Kk++}),this.name="",this.usage=wv,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++){const s=Array.isArray(t[n])?t[n]:[t[n]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class Xk extends sy{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class qk{constructor(e,t,n,i,s,a=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=s,this.normalized=a,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const qD=new zt;class JM{constructor(e,t,n=0,i=1/0){this.ray=new ug(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new Xm,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):Nt("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return qD.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(qD),this}intersectObject(e,t=!0,n=[]){return u1(e,this,n,t),n.sort(WD),n}intersectObjects(e,t=!0,n=[]){for(let i=0,s=e.length;i<s;i++)u1(e[i],this,n,t);return n.sort(WD),n}}function WD(r,e){return r.distance-e.distance}function u1(r,e,t,n){let i=!0;if(r.layers.test(e.layers)&&r.raycast(e,t)===!1&&(i=!1),i===!0&&n===!0){const s=r.children;for(let a=0,o=s.length;a<o;a++)u1(s[a],e,t,!0)}}class Wk{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=jk.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function jk(){this._document.hidden===!1&&this.reset()}class Jk{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=jt(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(jt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Qk{constructor(e=1,t=0,n=0){this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}class QM{constructor(e,t,n,i){QM.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,i){const s=this.elements;return s[0]=e,s[2]=t,s[1]=n,s[3]=i,this}}const jD=new Ve;class $k{constructor(e=new Ve(1/0,1/0),t=new Ve(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=jD.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,jD).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const JD=new ee,mx=new ee,fm=new ee,hm=new ee,HT=new ee,Zk=new ee,eG=new ee;class tG{constructor(e=new ee,t=new ee){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){JD.subVectors(e,this.start),mx.subVectors(this.end,this.start);const n=mx.dot(mx);let s=mx.dot(JD)/n;return t&&(s=jt(s,0,1)),s}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}distanceSqToLine3(e,t=Zk,n=eG){const i=10000000000000001e-32;let s,a;const o=this.start,u=e.start,c=this.end,h=e.end;fm.subVectors(c,o),hm.subVectors(h,u),HT.subVectors(o,u);const p=fm.dot(fm),v=hm.dot(hm),y=hm.dot(HT);if(p<=i&&v<=i)return t.copy(o),n.copy(u),t.sub(n),t.dot(t);if(p<=i)s=0,a=y/v,a=jt(a,0,1);else{const _=fm.dot(HT);if(v<=i)a=0,s=jt(-_/p,0,1);else{const A=fm.dot(hm),E=p*v-A*A;E!==0?s=jt((A*y-_*v)/E,0,1):s=0,a=(A*s+y)/v,a<0?(a=0,s=jt(-_/p,0,1)):a>1&&(a=1,s=jt((A-_)/p,0,1))}}return t.copy(o).add(fm.multiplyScalar(s)),n.copy(u).add(hm.multiplyScalar(a)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const QD=new ee;class nG extends Bn{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new en,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,u=32;a<u;a++,o++){const c=a/u*Math.PI*2,h=o/u*Math.PI*2;i.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}n.setAttribute("position",new Ct(i,3));const s=new Mr({fog:!1,toneMapped:!1});this.cone=new xl(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),QD.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(QD),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const yf=new ee,gx=new zt,zT=new zt;class iG extends xl{constructor(e){const t=cB(e),n=new en,i=[],s=[];for(let c=0;c<t.length;c++){const h=t[c];h.parent&&h.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(0,0,0),s.push(0,0,0))}n.setAttribute("position",new Ct(i,3)),n.setAttribute("color",new Ct(s,3));const a=new Mr({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,a),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const o=new dt(255),u=new dt(65280);this.setColors(o,u)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");zT.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<t.length;s++){const o=t[s];o.parent&&o.parent.isBone&&(gx.multiplyMatrices(zT,o.matrixWorld),yf.setFromMatrixPosition(gx),i.setXYZ(a,yf.x,yf.y,yf.z),gx.multiplyMatrices(zT,o.parent.matrixWorld),yf.setFromMatrixPosition(gx),i.setXYZ(a+1,yf.x,yf.y,yf.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const i=this.geometry.getAttribute("color");for(let s=0;s<i.count;s+=2)i.setXYZ(s,e.r,e.g,e.b),i.setXYZ(s+1,t.r,t.g,t.b);return i.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function cB(r){const e=[];r.isBone===!0&&e.push(r);for(let t=0;t<r.children.length;t++)e.push(...cB(r.children[t]));return e}class sG extends $i{constructor(e,t,n){const i=new uy(t,4,2),s=new Xa({wireframe:!0,fog:!1,toneMapped:!1});super(i,s),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const rG=new ee,$D=new dt,ZD=new dt;class aG extends Bn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new ly(t);i.rotateY(Math.PI*.5),this.material=new Xa({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=i.getAttribute("position"),a=new Float32Array(s.count*3);i.setAttribute("color",new On(a,3)),this.add(new $i(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");$D.copy(this.light.color),ZD.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){const s=n<i/2?$D:ZD;t.setXYZ(n,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(rG.setFromMatrixPosition(this.light.matrixWorld).negate())}}class oG extends xl{constructor(e=10,t=10,n=4473924,i=8947848){n=new dt(n),i=new dt(i);const s=t/2,a=e/t,o=e/2,u=[],c=[];for(let v=0,y=0,_=-o;v<=t;v++,_+=a){u.push(-o,0,_,o,0,_),u.push(_,0,-o,_,0,o);const A=v===s?n:i;A.toArray(c,y),y+=3,A.toArray(c,y),y+=3,A.toArray(c,y),y+=3,A.toArray(c,y),y+=3}const h=new en;h.setAttribute("position",new Ct(u,3)),h.setAttribute("color",new Ct(c,3));const p=new Mr({vertexColors:!0,toneMapped:!1});super(h,p),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class lG extends xl{constructor(e=10,t=16,n=8,i=64,s=4473924,a=8947848){s=new dt(s),a=new dt(a);const o=[],u=[];if(t>1)for(let p=0;p<t;p++){const v=p/t*(Math.PI*2),y=Math.sin(v)*e,_=Math.cos(v)*e;o.push(0,0,0),o.push(y,0,_);const A=p&1?s:a;u.push(A.r,A.g,A.b),u.push(A.r,A.g,A.b)}for(let p=0;p<n;p++){const v=p&1?s:a,y=e-e/n*p;for(let _=0;_<i;_++){let A=_/i*(Math.PI*2),E=Math.sin(A)*y,T=Math.cos(A)*y;o.push(E,0,T),u.push(v.r,v.g,v.b),A=(_+1)/i*(Math.PI*2),E=Math.sin(A)*y,T=Math.cos(A)*y,o.push(E,0,T),u.push(v.r,v.g,v.b)}}const c=new en;c.setAttribute("position",new Ct(o,3)),c.setAttribute("color",new Ct(u,3));const h=new Mr({vertexColors:!0,toneMapped:!1});super(c,h),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const eL=new ee,vx=new ee,tL=new ee;class uG extends Bn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let i=new en;i.setAttribute("position",new Ct([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new Mr({fog:!1,toneMapped:!1});this.lightPlane=new Ec(i,s),this.add(this.lightPlane),i=new en,i.setAttribute("position",new Ct([0,0,0,0,0,1],3)),this.targetLine=new Ec(i,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),eL.setFromMatrixPosition(this.light.matrixWorld),vx.setFromMatrixPosition(this.light.target.matrixWorld),tL.subVectors(vx,eL),this.lightPlane.lookAt(vx),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(vx),this.targetLine.scale.z=tL.length()}}const yx=new ee,Wi=new ty;class cG extends xl{constructor(e){const t=new en,n=new Mr({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(_,A){u(_),u(A)}function u(_){i.push(0,0,0),s.push(0,0,0),a[_]===void 0&&(a[_]=[]),a[_].push(i.length/3-1)}t.setAttribute("position",new Ct(i,3)),t.setAttribute("color",new Ct(s,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new dt(16755200),h=new dt(16711680),p=new dt(43775),v=new dt(16777215),y=new dt(3355443);this.setColors(c,h,p,v,y)}setColors(e,t,n,i,s){const o=this.geometry.getAttribute("color");return o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,n.r,n.g,n.b),o.setXYZ(33,n.r,n.g,n.b),o.setXYZ(34,n.r,n.g,n.b),o.setXYZ(35,n.r,n.g,n.b),o.setXYZ(36,n.r,n.g,n.b),o.setXYZ(37,n.r,n.g,n.b),o.setXYZ(38,i.r,i.g,i.b),o.setXYZ(39,i.r,i.g,i.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap,n=1,i=1;let s,a;if(Wi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)s=1,a=0;else if(this.camera.coordinateSystem===Ya)s=-1,a=1;else if(this.camera.coordinateSystem===Vm)s=0,a=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);is("c",t,e,Wi,0,0,s),is("t",t,e,Wi,0,0,a),is("n1",t,e,Wi,-n,-i,s),is("n2",t,e,Wi,n,-i,s),is("n3",t,e,Wi,-n,i,s),is("n4",t,e,Wi,n,i,s),is("f1",t,e,Wi,-n,-i,a),is("f2",t,e,Wi,n,-i,a),is("f3",t,e,Wi,-n,i,a),is("f4",t,e,Wi,n,i,a),is("u1",t,e,Wi,n*.7,i*1.1,s),is("u2",t,e,Wi,-n*.7,i*1.1,s),is("u3",t,e,Wi,0,i*2,s),is("cf1",t,e,Wi,-n,0,a),is("cf2",t,e,Wi,n,0,a),is("cf3",t,e,Wi,0,-i,a),is("cf4",t,e,Wi,0,i,a),is("cn1",t,e,Wi,-n,0,s),is("cn2",t,e,Wi,n,0,s),is("cn3",t,e,Wi,0,-i,s),is("cn4",t,e,Wi,0,i,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function is(r,e,t,n,i,s,a){yx.set(i,s,a).unproject(n);const o=e[r];if(o!==void 0){const u=t.getAttribute("position");for(let c=0,h=o.length;c<h;c++)u.setXYZ(o[c],yx.x,yx.y,yx.z)}}const _x=new nr;class fG extends xl{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),s=new en;s.setIndex(new On(n,1)),s.setAttribute("position",new On(i,3)),super(s,new Mr({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&_x.setFromObject(this.object),_x.isEmpty())return;const e=_x.min,t=_x.max,n=this.geometry.attributes.position,i=n.array;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=e.x,i[4]=t.y,i[5]=t.z,i[6]=e.x,i[7]=e.y,i[8]=t.z,i[9]=t.x,i[10]=e.y,i[11]=t.z,i[12]=t.x,i[13]=t.y,i[14]=e.z,i[15]=e.x,i[16]=t.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=t.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class hG extends xl{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new en;s.setIndex(new On(n,1)),s.setAttribute("position",new Ct(i,3)),super(s,new Mr({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class dG extends Ec{constructor(e,t=1,n=16776960){const i=n,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new en;a.setAttribute("position",new Ct(s,3)),a.computeBoundingSphere(),super(a,new Mr({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],u=new en;u.setAttribute("position",new Ct(o,3)),u.computeBoundingSphere(),this.add(new $i(u,new Xa({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const nL=new ee;let xx,VT;class pG extends Bn{constructor(e=new ee(0,0,1),t=new ee(0,0,0),n=1,i=16776960,s=n*.2,a=s*.2){super(),this.type="ArrowHelper",xx===void 0&&(xx=new en,xx.setAttribute("position",new Ct([0,0,0,0,1,0],3)),VT=new oy(.5,1,5,1),VT.translate(0,-.5,0)),this.position.copy(t),this.line=new Ec(xx,new Mr({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new $i(VT,new Xa({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{nL.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(nL,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class mG extends xl{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new en;i.setAttribute("position",new Ct(t,3)),i.setAttribute("color",new Ct(n,3));const s=new Mr({vertexColors:!0,toneMapped:!1});super(i,s),this.type="AxesHelper"}setColors(e,t,n){const i=new dt,s=this.geometry.attributes.color.array;return i.set(e),i.toArray(s,0),i.toArray(s,3),i.set(t),i.toArray(s,6),i.toArray(s,9),i.set(n),i.toArray(s,12),i.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class gG{constructor(){this.type="ShapePath",this.color=new dt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new QS,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,s,a){return this.currentPath.bezierCurveTo(e,t,n,i,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(T){const M=[];for(let R=0,L=T.length;R<L;R++){const w=T[R],N=new _d;N.curves=w.curves,M.push(N)}return M}function n(T,M){const R=M.length;let L=!1;for(let w=R-1,N=0;N<R;w=N++){let O=M[w],F=M[N],B=F.x-O.x,P=F.y-O.y;if(Math.abs(P)>Number.EPSILON){if(P<0&&(O=M[N],B=-B,F=M[w],P=-P),T.y<O.y||T.y>F.y)continue;if(T.y===O.y){if(T.x===O.x)return!0}else{const V=P*(T.x-O.x)-B*(T.y-O.y);if(V===0)return!0;if(V<0)continue;L=!L}}else{if(T.y!==O.y)continue;if(F.x<=T.x&&T.x<=O.x||O.x<=T.x&&T.x<=F.x)return!0}}return L}const i=ml.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,u;const c=[];if(s.length===1)return o=s[0],u=new _d,u.curves=o.curves,c.push(u),c;let h=!i(s[0].getPoints());h=e?!h:h;const p=[],v=[];let y=[],_=0,A;v[_]=void 0,y[_]=[];for(let T=0,M=s.length;T<M;T++)o=s[T],A=o.getPoints(),a=i(A),a=e?!a:a,a?(!h&&v[_]&&_++,v[_]={s:new _d,p:A},v[_].s.curves=o.curves,h&&_++,y[_]=[]):y[_].push({h:o,p:A[0]});if(!v[0])return t(s);if(v.length>1){let T=!1,M=0;for(let R=0,L=v.length;R<L;R++)p[R]=[];for(let R=0,L=v.length;R<L;R++){const w=y[R];for(let N=0;N<w.length;N++){const O=w[N];let F=!0;for(let B=0;B<v.length;B++)n(O.p,v[B].p)&&(R!==B&&M++,F?(F=!1,p[B].push(O)):T=!0);F&&p[R].push(O)}}M>0&&T===!1&&(y=p)}let E;for(let T=0,M=v.length;T<M;T++){u=v[T].s,c.push(u),E=y[T];for(let R=0,L=E.length;R<L;R++)u.holes.push(E[R].h)}return c}}class vG extends _u{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){ct("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function yG(r,e){const t=r.image&&r.image.width?r.image.width/r.image.height:1;return t>e?(r.repeat.x=1,r.repeat.y=t/e,r.offset.x=0,r.offset.y=(1-r.repeat.y)/2):(r.repeat.x=e/t,r.repeat.y=1,r.offset.x=(1-r.repeat.x)/2,r.offset.y=0),r}function _G(r,e){const t=r.image&&r.image.width?r.image.width/r.image.height:1;return t>e?(r.repeat.x=e/t,r.repeat.y=1,r.offset.x=(1-r.repeat.x)/2,r.offset.y=0):(r.repeat.x=1,r.repeat.y=t/e,r.offset.x=0,r.offset.y=(1-r.repeat.y)/2),r}function xG(r){return r.repeat.x=1,r.repeat.y=1,r.offset.x=0,r.offset.y=0,r}function c1(r,e,t,n){const i=SG(n);switch(t){case hM:return r*e;case LA:return r*e/i.components*i.byteLength;case ey:return r*e/i.components*i.byteLength;case Rd:return r*e*2/i.components*i.byteLength;case IA:return r*e*2/i.components*i.byteLength;case dM:return r*e*3/i.components*i.byteLength;case Er:return r*e*4/i.components*i.byteLength;case wA:return r*e*4/i.components*i.byteLength;case dv:case pv:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case mv:case gv:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case mS:case vS:return Math.max(r,16)*Math.max(e,8)/4;case pS:case gS:return Math.max(r,8)*Math.max(e,8)/2;case yS:case _S:case SS:case AS:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case xS:case ES:case TS:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case bS:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case MS:return Math.floor((r+4)/5)*Math.floor((e+3)/4)*16;case CS:return Math.floor((r+4)/5)*Math.floor((e+4)/5)*16;case RS:return Math.floor((r+5)/6)*Math.floor((e+4)/5)*16;case DS:return Math.floor((r+5)/6)*Math.floor((e+5)/6)*16;case LS:return Math.floor((r+7)/8)*Math.floor((e+4)/5)*16;case IS:return Math.floor((r+7)/8)*Math.floor((e+5)/6)*16;case wS:return Math.floor((r+7)/8)*Math.floor((e+7)/8)*16;case BS:return Math.floor((r+9)/10)*Math.floor((e+4)/5)*16;case OS:return Math.floor((r+9)/10)*Math.floor((e+5)/6)*16;case PS:return Math.floor((r+9)/10)*Math.floor((e+7)/8)*16;case NS:return Math.floor((r+9)/10)*Math.floor((e+9)/10)*16;case US:return Math.floor((r+11)/12)*Math.floor((e+9)/10)*16;case FS:return Math.floor((r+11)/12)*Math.floor((e+11)/12)*16;case kS:case GS:case HS:return Math.ceil(r/4)*Math.ceil(e/4)*16;case zS:case VS:return Math.ceil(r/4)*Math.ceil(e/4)*8;case KS:case YS:return Math.ceil(r/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function SG(r){switch(r){case Jr:case lM:return{byteLength:1,components:1};case Cd:case uM:case Za:return{byteLength:2,components:1};case RA:case DA:return{byteLength:2,components:4};case Po:case CA:case Ar:return{byteLength:4,components:1};case cM:case fM:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}class AG{static contain(e,t){return yG(e,t)}static cover(e,t){return _G(e,t)}static fill(e){return xG(e)}static getByteLength(e,t,n,i){return c1(e,t,n,i)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:og}}));typeof window<"u"&&(window.__THREE__?ct("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=og);function fB(){let r=null,e=!1,t=null,n=null;function i(s,a){t(s,a),n=r.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=r.requestAnimationFrame(i),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){r=s}}}function EG(r){const e=new WeakMap;function t(o,u){const c=o.array,h=o.usage,p=c.byteLength,v=r.createBuffer();r.bindBuffer(u,v),r.bufferData(u,c,h),o.onUploadCallback();let y;if(c instanceof Float32Array)y=r.FLOAT;else if(typeof Float16Array<"u"&&c instanceof Float16Array)y=r.HALF_FLOAT;else if(c instanceof Uint16Array)o.isFloat16BufferAttribute?y=r.HALF_FLOAT:y=r.UNSIGNED_SHORT;else if(c instanceof Int16Array)y=r.SHORT;else if(c instanceof Uint32Array)y=r.UNSIGNED_INT;else if(c instanceof Int32Array)y=r.INT;else if(c instanceof Int8Array)y=r.BYTE;else if(c instanceof Uint8Array)y=r.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)y=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:v,type:y,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version,size:p}}function n(o,u,c){const h=u.array,p=u.updateRanges;if(r.bindBuffer(c,o),p.length===0)r.bufferSubData(c,0,h);else{p.sort((y,_)=>y.start-_.start);let v=0;for(let y=1;y<p.length;y++){const _=p[v],A=p[y];A.start<=_.start+_.count+1?_.count=Math.max(_.count,A.start+A.count-_.start):(++v,p[v]=A)}p.length=v+1;for(let y=0,_=p.length;y<_;y++){const A=p[y];r.bufferSubData(c,A.start*h.BYTES_PER_ELEMENT,h,A.start,A.count)}u.clearUpdateRanges()}u.onUploadCallback()}function i(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const u=e.get(o);u&&(r.deleteBuffer(u.buffer),e.delete(o))}function a(o,u){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const h=e.get(o);(!h||h.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const c=e.get(o);if(c===void 0)e.set(o,t(o,u));else if(c.version<o.version){if(c.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(c.buffer,o,u),c.version=o.version}}return{get:i,remove:s,update:a}}var TG=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,bG=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,MG=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,CG=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,RG=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,DG=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,LG=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,IG=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,wG=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,BG=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,OG=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,PG=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,NG=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,UG=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,FG=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,kG=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,GG=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,HG=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,zG=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,VG=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,KG=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,YG=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,XG=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,qG=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,WG=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,jG=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,JG=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,QG=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,$G=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,ZG=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,e4="gl_FragColor = linearToOutputTexel( gl_FragColor );",t4=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,n4=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,i4=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,s4=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,r4=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,a4=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,o4=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,l4=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,u4=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,c4=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,f4=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,h4=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,d4=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,p4=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,m4=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,g4=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,v4=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,y4=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,_4=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,x4=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,S4=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.metalness = metalnessFactor;
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = vec3( 0.04 );
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,A4=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	vec3 diffuseContribution;
	vec3 specularColor;
	vec3 specularColorBlended;
	float roughness;
	float metalness;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
		vec3 iridescenceFresnelDielectric;
		vec3 iridescenceFresnelMetallic;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return v;
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColorBlended;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float rInv = 1.0 / ( roughness + 0.1 );
	float a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;
	float b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;
	float DG = exp( a * dotNV + b );
	return saturate( DG );
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;
	vec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;
	vec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
 
 		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
 
 		float sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
 		float sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );
 
 		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );
 
 		irradiance *= sheenEnergyComp;
 
 	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		diffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectDiffuse += diffuse;
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;
 	#endif
	vec3 singleScatteringDielectric = vec3( 0.0 );
	vec3 multiScatteringDielectric = vec3( 0.0 );
	vec3 singleScatteringMetallic = vec3( 0.0 );
	vec3 multiScatteringMetallic = vec3( 0.0 );
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#endif
	vec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );
	vec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );
	vec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;
	vec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	vec3 indirectSpecular = radiance * singleScattering;
	indirectSpecular += multiScattering * cosineWeightedIrradiance;
	vec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		indirectSpecular *= sheenEnergyComp;
		indirectDiffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectSpecular += indirectSpecular;
	reflectedLight.indirectDiffuse += indirectDiffuse;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,E4=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );
		material.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,T4=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,b4=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,M4=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,C4=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,R4=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,D4=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,L4=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,I4=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,w4=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,B4=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,O4=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,P4=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,N4=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,U4=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,F4=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,k4=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,G4=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,H4=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,z4=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,V4=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,K4=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Y4=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,X4=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,q4=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,W4=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,j4=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,J4=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Q4=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,$4=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Z4=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,eH=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,tH=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,nH=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,iH=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,sH=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,rH=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#else
			uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#endif
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#else
			uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#endif
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#elif defined( SHADOWMAP_TYPE_BASIC )
			uniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#endif
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float interleavedGradientNoise( vec2 position ) {
			return fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );
		}
		vec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {
			const float goldenAngle = 2.399963229728653;
			float r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );
			float theta = float( sampleIndex ) * goldenAngle + phi;
			return vec2( cos( theta ), sin( theta ) ) * r;
		}
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
				float radius = shadowRadius * texelSize.x;
				float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
				shadow = (
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )
				) * 0.2;
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#elif defined( SHADOWMAP_TYPE_VSM )
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;
				float mean = distribution.x;
				float variance = distribution.y * distribution.y;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					float hard_shadow = step( mean, shadowCoord.z );
				#else
					float hard_shadow = step( shadowCoord.z, mean );
				#endif
				if ( hard_shadow == 1.0 ) {
					shadow = 1.0;
				} else {
					variance = max( variance, 0.0000001 );
					float d = shadowCoord.z - mean;
					float p_max = variance / ( variance + d * d );
					p_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );
					shadow = max( hard_shadow, p_max );
				}
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#else
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				float depth = texture2D( shadowMap, shadowCoord.xy ).r;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					shadow = step( depth, shadowCoord.z );
				#else
					shadow = step( shadowCoord.z, depth );
				#endif
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#if defined( SHADOWMAP_TYPE_PCF )
	float getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float texelSize = shadowRadius / shadowMapSize.x;
			vec3 absDir = abs( bd3D );
			vec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );
			tangent = normalize( cross( bd3D, tangent ) );
			vec3 bitangent = cross( bd3D, tangent );
			float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
			shadow = (
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )
			) * 0.2;
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#elif defined( SHADOWMAP_TYPE_BASIC )
	float getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float depth = textureCube( shadowMap, bd3D ).r;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				shadow = step( depth, dp );
			#else
				shadow = step( dp, depth );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#endif
	#endif
#endif`,aH=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,oH=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,lH=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,uH=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,cH=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,fH=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,hH=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,dH=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,pH=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,mH=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,gH=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,vH=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,yH=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,_H=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,xH=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,SH=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,AH=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const EH=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,TH=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,bH=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,MH=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,CH=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,RH=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,DH=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,LH=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,IH=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,wH=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );
}`,BH=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,OH=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,PH=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,NH=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,UH=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,FH=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kH=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,GH=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,HH=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,zH=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,VH=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,KH=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,YH=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,XH=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,qH=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,WH=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
 
		outgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;
 
 	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jH=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,JH=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,QH=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,$H=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,ZH=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ez=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,tz=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,nz=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,hn={alphahash_fragment:TG,alphahash_pars_fragment:bG,alphamap_fragment:MG,alphamap_pars_fragment:CG,alphatest_fragment:RG,alphatest_pars_fragment:DG,aomap_fragment:LG,aomap_pars_fragment:IG,batching_pars_vertex:wG,batching_vertex:BG,begin_vertex:OG,beginnormal_vertex:PG,bsdfs:NG,iridescence_fragment:UG,bumpmap_pars_fragment:FG,clipping_planes_fragment:kG,clipping_planes_pars_fragment:GG,clipping_planes_pars_vertex:HG,clipping_planes_vertex:zG,color_fragment:VG,color_pars_fragment:KG,color_pars_vertex:YG,color_vertex:XG,common:qG,cube_uv_reflection_fragment:WG,defaultnormal_vertex:jG,displacementmap_pars_vertex:JG,displacementmap_vertex:QG,emissivemap_fragment:$G,emissivemap_pars_fragment:ZG,colorspace_fragment:e4,colorspace_pars_fragment:t4,envmap_fragment:n4,envmap_common_pars_fragment:i4,envmap_pars_fragment:s4,envmap_pars_vertex:r4,envmap_physical_pars_fragment:g4,envmap_vertex:a4,fog_vertex:o4,fog_pars_vertex:l4,fog_fragment:u4,fog_pars_fragment:c4,gradientmap_pars_fragment:f4,lightmap_pars_fragment:h4,lights_lambert_fragment:d4,lights_lambert_pars_fragment:p4,lights_pars_begin:m4,lights_toon_fragment:v4,lights_toon_pars_fragment:y4,lights_phong_fragment:_4,lights_phong_pars_fragment:x4,lights_physical_fragment:S4,lights_physical_pars_fragment:A4,lights_fragment_begin:E4,lights_fragment_maps:T4,lights_fragment_end:b4,logdepthbuf_fragment:M4,logdepthbuf_pars_fragment:C4,logdepthbuf_pars_vertex:R4,logdepthbuf_vertex:D4,map_fragment:L4,map_pars_fragment:I4,map_particle_fragment:w4,map_particle_pars_fragment:B4,metalnessmap_fragment:O4,metalnessmap_pars_fragment:P4,morphinstance_vertex:N4,morphcolor_vertex:U4,morphnormal_vertex:F4,morphtarget_pars_vertex:k4,morphtarget_vertex:G4,normal_fragment_begin:H4,normal_fragment_maps:z4,normal_pars_fragment:V4,normal_pars_vertex:K4,normal_vertex:Y4,normalmap_pars_fragment:X4,clearcoat_normal_fragment_begin:q4,clearcoat_normal_fragment_maps:W4,clearcoat_pars_fragment:j4,iridescence_pars_fragment:J4,opaque_fragment:Q4,packing:$4,premultiplied_alpha_fragment:Z4,project_vertex:eH,dithering_fragment:tH,dithering_pars_fragment:nH,roughnessmap_fragment:iH,roughnessmap_pars_fragment:sH,shadowmap_pars_fragment:rH,shadowmap_pars_vertex:aH,shadowmap_vertex:oH,shadowmask_pars_fragment:lH,skinbase_vertex:uH,skinning_pars_vertex:cH,skinning_vertex:fH,skinnormal_vertex:hH,specularmap_fragment:dH,specularmap_pars_fragment:pH,tonemapping_fragment:mH,tonemapping_pars_fragment:gH,transmission_fragment:vH,transmission_pars_fragment:yH,uv_pars_fragment:_H,uv_pars_vertex:xH,uv_vertex:SH,worldpos_vertex:AH,background_vert:EH,background_frag:TH,backgroundCube_vert:bH,backgroundCube_frag:MH,cube_vert:CH,cube_frag:RH,depth_vert:DH,depth_frag:LH,distance_vert:IH,distance_frag:wH,equirect_vert:BH,equirect_frag:OH,linedashed_vert:PH,linedashed_frag:NH,meshbasic_vert:UH,meshbasic_frag:FH,meshlambert_vert:kH,meshlambert_frag:GH,meshmatcap_vert:HH,meshmatcap_frag:zH,meshnormal_vert:VH,meshnormal_frag:KH,meshphong_vert:YH,meshphong_frag:XH,meshphysical_vert:qH,meshphysical_frag:WH,meshtoon_vert:jH,meshtoon_frag:JH,points_vert:QH,points_frag:$H,shadow_vert:ZH,shadow_frag:ez,sprite_vert:tz,sprite_frag:nz},gt={common:{diffuse:{value:new dt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new on},alphaMap:{value:null},alphaMapTransform:{value:new on},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new on}},envmap:{envMap:{value:null},envMapRotation:{value:new on},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new on}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new on}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new on},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new on},normalScale:{value:new Ve(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new on},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new on}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new on}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new on}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new dt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new dt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new on},alphaTest:{value:0},uvTransform:{value:new on}},sprite:{diffuse:{value:new dt(16777215)},opacity:{value:1},center:{value:new Ve(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new on},alphaMap:{value:null},alphaMapTransform:{value:new on},alphaTest:{value:0}}},pl={basic:{uniforms:Wr([gt.common,gt.specularmap,gt.envmap,gt.aomap,gt.lightmap,gt.fog]),vertexShader:hn.meshbasic_vert,fragmentShader:hn.meshbasic_frag},lambert:{uniforms:Wr([gt.common,gt.specularmap,gt.envmap,gt.aomap,gt.lightmap,gt.emissivemap,gt.bumpmap,gt.normalmap,gt.displacementmap,gt.fog,gt.lights,{emissive:{value:new dt(0)}}]),vertexShader:hn.meshlambert_vert,fragmentShader:hn.meshlambert_frag},phong:{uniforms:Wr([gt.common,gt.specularmap,gt.envmap,gt.aomap,gt.lightmap,gt.emissivemap,gt.bumpmap,gt.normalmap,gt.displacementmap,gt.fog,gt.lights,{emissive:{value:new dt(0)},specular:{value:new dt(1118481)},shininess:{value:30}}]),vertexShader:hn.meshphong_vert,fragmentShader:hn.meshphong_frag},standard:{uniforms:Wr([gt.common,gt.envmap,gt.aomap,gt.lightmap,gt.emissivemap,gt.bumpmap,gt.normalmap,gt.displacementmap,gt.roughnessmap,gt.metalnessmap,gt.fog,gt.lights,{emissive:{value:new dt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:hn.meshphysical_vert,fragmentShader:hn.meshphysical_frag},toon:{uniforms:Wr([gt.common,gt.aomap,gt.lightmap,gt.emissivemap,gt.bumpmap,gt.normalmap,gt.displacementmap,gt.gradientmap,gt.fog,gt.lights,{emissive:{value:new dt(0)}}]),vertexShader:hn.meshtoon_vert,fragmentShader:hn.meshtoon_frag},matcap:{uniforms:Wr([gt.common,gt.bumpmap,gt.normalmap,gt.displacementmap,gt.fog,{matcap:{value:null}}]),vertexShader:hn.meshmatcap_vert,fragmentShader:hn.meshmatcap_frag},points:{uniforms:Wr([gt.points,gt.fog]),vertexShader:hn.points_vert,fragmentShader:hn.points_frag},dashed:{uniforms:Wr([gt.common,gt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:hn.linedashed_vert,fragmentShader:hn.linedashed_frag},depth:{uniforms:Wr([gt.common,gt.displacementmap]),vertexShader:hn.depth_vert,fragmentShader:hn.depth_frag},normal:{uniforms:Wr([gt.common,gt.bumpmap,gt.normalmap,gt.displacementmap,{opacity:{value:1}}]),vertexShader:hn.meshnormal_vert,fragmentShader:hn.meshnormal_frag},sprite:{uniforms:Wr([gt.sprite,gt.fog]),vertexShader:hn.sprite_vert,fragmentShader:hn.sprite_frag},background:{uniforms:{uvTransform:{value:new on},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:hn.background_vert,fragmentShader:hn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new on}},vertexShader:hn.backgroundCube_vert,fragmentShader:hn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:hn.cube_vert,fragmentShader:hn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:hn.equirect_vert,fragmentShader:hn.equirect_frag},distance:{uniforms:Wr([gt.common,gt.displacementmap,{referencePosition:{value:new ee},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:hn.distance_vert,fragmentShader:hn.distance_frag},shadow:{uniforms:Wr([gt.lights,gt.fog,{color:{value:new dt(0)},opacity:{value:1}}]),vertexShader:hn.shadow_vert,fragmentShader:hn.shadow_frag}};pl.physical={uniforms:Wr([pl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new on},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new on},clearcoatNormalScale:{value:new Ve(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new on},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new on},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new on},sheen:{value:0},sheenColor:{value:new dt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new on},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new on},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new on},transmissionSamplerSize:{value:new Ve},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new on},attenuationDistance:{value:0},attenuationColor:{value:new dt(0)},specularColor:{value:new dt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new on},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new on},anisotropyVector:{value:new Ve},anisotropyMap:{value:null},anisotropyMapTransform:{value:new on}}]),vertexShader:hn.meshphysical_vert,fragmentShader:hn.meshphysical_frag};const Sx={r:0,b:0,g:0},Qh=new eo,iz=new zt;function sz(r,e,t,n,i,s,a){const o=new dt(0);let u=s===!0?0:1,c,h,p=null,v=0,y=null;function _(R){let L=R.isScene===!0?R.background:null;return L&&L.isTexture&&(L=(R.backgroundBlurriness>0?t:e).get(L)),L}function A(R){let L=!1;const w=_(R);w===null?T(o,u):w&&w.isColor&&(T(w,1),L=!0);const N=r.xr.getEnvironmentBlendMode();N==="additive"?n.buffers.color.setClear(0,0,0,1,a):N==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,a),(r.autoClear||L)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil))}function E(R,L){const w=_(L);w&&(w.isCubeTexture||w.mapping===lg)?(h===void 0&&(h=new $i(new Nd(1,1,1),new to({name:"BackgroundCubeMaterial",uniforms:qm(pl.backgroundCube.uniforms),vertexShader:pl.backgroundCube.vertexShader,fragmentShader:pl.backgroundCube.fragmentShader,side:ta,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(N,O,F){this.matrixWorld.copyPosition(F.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(h)),Qh.copy(L.backgroundRotation),Qh.x*=-1,Qh.y*=-1,Qh.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(Qh.y*=-1,Qh.z*=-1),h.material.uniforms.envMap.value=w,h.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=L.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=L.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(iz.makeRotationFromEuler(Qh)),h.material.toneMapped=Mn.getTransfer(w.colorSpace)!==Qn,(p!==w||v!==w.version||y!==r.toneMapping)&&(h.material.needsUpdate=!0,p=w,v=w.version,y=r.toneMapping),h.layers.enableAll(),R.unshift(h,h.geometry,h.material,0,0,null)):w&&w.isTexture&&(c===void 0&&(c=new $i(new fg(2,2),new to({name:"BackgroundMaterial",uniforms:qm(pl.background.uniforms),vertexShader:pl.background.vertexShader,fragmentShader:pl.background.fragmentShader,side:du,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(c)),c.material.uniforms.t2D.value=w,c.material.uniforms.backgroundIntensity.value=L.backgroundIntensity,c.material.toneMapped=Mn.getTransfer(w.colorSpace)!==Qn,w.matrixAutoUpdate===!0&&w.updateMatrix(),c.material.uniforms.uvTransform.value.copy(w.matrix),(p!==w||v!==w.version||y!==r.toneMapping)&&(c.material.needsUpdate=!0,p=w,v=w.version,y=r.toneMapping),c.layers.enableAll(),R.unshift(c,c.geometry,c.material,0,0,null))}function T(R,L){R.getRGB(Sx,A2(r)),n.buffers.color.setClear(Sx.r,Sx.g,Sx.b,L,a)}function M(){h!==void 0&&(h.geometry.dispose(),h.material.dispose(),h=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return o},setClearColor:function(R,L=1){o.set(R),u=L,T(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(R){u=R,T(o,u)},render:A,addToRenderList:E,dispose:M}}function rz(r,e){const t=r.getParameter(r.MAX_VERTEX_ATTRIBS),n={},i=v(null);let s=i,a=!1;function o(P,V,J,Q,ie){let ne=!1;const k=p(Q,J,V);s!==k&&(s=k,c(s.object)),ne=y(P,Q,J,ie),ne&&_(P,Q,J,ie),ie!==null&&e.update(ie,r.ELEMENT_ARRAY_BUFFER),(ne||a)&&(a=!1,L(P,V,J,Q),ie!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.get(ie).buffer))}function u(){return r.createVertexArray()}function c(P){return r.bindVertexArray(P)}function h(P){return r.deleteVertexArray(P)}function p(P,V,J){const Q=J.wireframe===!0;let ie=n[P.id];ie===void 0&&(ie={},n[P.id]=ie);let ne=ie[V.id];ne===void 0&&(ne={},ie[V.id]=ne);let k=ne[Q];return k===void 0&&(k=v(u()),ne[Q]=k),k}function v(P){const V=[],J=[],Q=[];for(let ie=0;ie<t;ie++)V[ie]=0,J[ie]=0,Q[ie]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:V,enabledAttributes:J,attributeDivisors:Q,object:P,attributes:{},index:null}}function y(P,V,J,Q){const ie=s.attributes,ne=V.attributes;let k=0;const K=J.getAttributes();for(const j in K)if(K[j].location>=0){const oe=ie[j];let Y=ne[j];if(Y===void 0&&(j==="instanceMatrix"&&P.instanceMatrix&&(Y=P.instanceMatrix),j==="instanceColor"&&P.instanceColor&&(Y=P.instanceColor)),oe===void 0||oe.attribute!==Y||Y&&oe.data!==Y.data)return!0;k++}return s.attributesNum!==k||s.index!==Q}function _(P,V,J,Q){const ie={},ne=V.attributes;let k=0;const K=J.getAttributes();for(const j in K)if(K[j].location>=0){let oe=ne[j];oe===void 0&&(j==="instanceMatrix"&&P.instanceMatrix&&(oe=P.instanceMatrix),j==="instanceColor"&&P.instanceColor&&(oe=P.instanceColor));const Y={};Y.attribute=oe,oe&&oe.data&&(Y.data=oe.data),ie[j]=Y,k++}s.attributes=ie,s.attributesNum=k,s.index=Q}function A(){const P=s.newAttributes;for(let V=0,J=P.length;V<J;V++)P[V]=0}function E(P){T(P,0)}function T(P,V){const J=s.newAttributes,Q=s.enabledAttributes,ie=s.attributeDivisors;J[P]=1,Q[P]===0&&(r.enableVertexAttribArray(P),Q[P]=1),ie[P]!==V&&(r.vertexAttribDivisor(P,V),ie[P]=V)}function M(){const P=s.newAttributes,V=s.enabledAttributes;for(let J=0,Q=V.length;J<Q;J++)V[J]!==P[J]&&(r.disableVertexAttribArray(J),V[J]=0)}function R(P,V,J,Q,ie,ne,k){k===!0?r.vertexAttribIPointer(P,V,J,ie,ne):r.vertexAttribPointer(P,V,J,Q,ie,ne)}function L(P,V,J,Q){A();const ie=Q.attributes,ne=J.getAttributes(),k=V.defaultAttributeValues;for(const K in ne){const j=ne[K];if(j.location>=0){let se=ie[K];if(se===void 0&&(K==="instanceMatrix"&&P.instanceMatrix&&(se=P.instanceMatrix),K==="instanceColor"&&P.instanceColor&&(se=P.instanceColor)),se!==void 0){const oe=se.normalized,Y=se.itemSize,Z=e.get(se);if(Z===void 0)continue;const le=Z.buffer,pe=Z.type,Te=Z.bytesPerElement,ce=pe===r.INT||pe===r.UNSIGNED_INT||se.gpuType===CA;if(se.isInterleavedBufferAttribute){const Me=se.data,Xe=Me.stride,nt=se.offset;if(Me.isInstancedInterleavedBuffer){for(let at=0;at<j.locationSize;at++)T(j.location+at,Me.meshPerAttribute);P.isInstancedMesh!==!0&&Q._maxInstanceCount===void 0&&(Q._maxInstanceCount=Me.meshPerAttribute*Me.count)}else for(let at=0;at<j.locationSize;at++)E(j.location+at);r.bindBuffer(r.ARRAY_BUFFER,le);for(let at=0;at<j.locationSize;at++)R(j.location+at,Y/j.locationSize,pe,oe,Xe*Te,(nt+Y/j.locationSize*at)*Te,ce)}else{if(se.isInstancedBufferAttribute){for(let Me=0;Me<j.locationSize;Me++)T(j.location+Me,se.meshPerAttribute);P.isInstancedMesh!==!0&&Q._maxInstanceCount===void 0&&(Q._maxInstanceCount=se.meshPerAttribute*se.count)}else for(let Me=0;Me<j.locationSize;Me++)E(j.location+Me);r.bindBuffer(r.ARRAY_BUFFER,le);for(let Me=0;Me<j.locationSize;Me++)R(j.location+Me,Y/j.locationSize,pe,oe,Y*Te,Y/j.locationSize*Me*Te,ce)}}else if(k!==void 0){const oe=k[K];if(oe!==void 0)switch(oe.length){case 2:r.vertexAttrib2fv(j.location,oe);break;case 3:r.vertexAttrib3fv(j.location,oe);break;case 4:r.vertexAttrib4fv(j.location,oe);break;default:r.vertexAttrib1fv(j.location,oe)}}}}M()}function w(){F();for(const P in n){const V=n[P];for(const J in V){const Q=V[J];for(const ie in Q)h(Q[ie].object),delete Q[ie];delete V[J]}delete n[P]}}function N(P){if(n[P.id]===void 0)return;const V=n[P.id];for(const J in V){const Q=V[J];for(const ie in Q)h(Q[ie].object),delete Q[ie];delete V[J]}delete n[P.id]}function O(P){for(const V in n){const J=n[V];if(J[P.id]===void 0)continue;const Q=J[P.id];for(const ie in Q)h(Q[ie].object),delete Q[ie];delete J[P.id]}}function F(){B(),a=!0,s!==i&&(s=i,c(s.object))}function B(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:o,reset:F,resetDefaultState:B,dispose:w,releaseStatesOfGeometry:N,releaseStatesOfProgram:O,initAttributes:A,enableAttribute:E,disableUnusedAttributes:M}}function az(r,e,t){let n;function i(c){n=c}function s(c,h){r.drawArrays(n,c,h),t.update(h,n,1)}function a(c,h,p){p!==0&&(r.drawArraysInstanced(n,c,h,p),t.update(h,n,p))}function o(c,h,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,c,0,h,0,p);let y=0;for(let _=0;_<p;_++)y+=h[_];t.update(y,n,1)}function u(c,h,p,v){if(p===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let _=0;_<c.length;_++)a(c[_],h[_],v[_]);else{y.multiDrawArraysInstancedWEBGL(n,c,0,h,0,v,0,p);let _=0;for(let A=0;A<p;A++)_+=h[A]*v[A];t.update(_,n,1)}}this.setMode=i,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=u}function oz(r,e,t,n){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const O=e.get("EXT_texture_filter_anisotropic");i=r.getParameter(O.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(O){return!(O!==Er&&n.convert(O)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(O){const F=O===Za&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(O!==Jr&&n.convert(O)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_TYPE)&&O!==Ar&&!F)}function u(O){if(O==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";O="mediump"}return O==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const h=u(c);h!==c&&(ct("WebGLRenderer:",c,"not supported, using",h,"instead."),c=h);const p=t.logarithmicDepthBuffer===!0,v=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),y=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),_=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),A=r.getParameter(r.MAX_TEXTURE_SIZE),E=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),T=r.getParameter(r.MAX_VERTEX_ATTRIBS),M=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),R=r.getParameter(r.MAX_VARYING_VECTORS),L=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),w=r.getParameter(r.MAX_SAMPLES),N=r.getParameter(r.SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:u,textureFormatReadable:a,textureTypeReadable:o,precision:c,logarithmicDepthBuffer:p,reversedDepthBuffer:v,maxTextures:y,maxVertexTextures:_,maxTextureSize:A,maxCubemapSize:E,maxAttributes:T,maxVertexUniforms:M,maxVaryings:R,maxFragmentUniforms:L,maxSamples:w,samples:N}}function lz(r){const e=this;let t=null,n=0,i=!1,s=!1;const a=new pc,o=new on,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(p,v){const y=p.length!==0||v||n!==0||i;return i=v,n=p.length,y},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(p,v){t=h(p,v,0)},this.setState=function(p,v,y){const _=p.clippingPlanes,A=p.clipIntersection,E=p.clipShadows,T=r.get(p);if(!i||_===null||_.length===0||s&&!E)s?h(null):c();else{const M=s?0:n,R=M*4;let L=T.clippingState||null;u.value=L,L=h(_,v,R,y);for(let w=0;w!==R;++w)L[w]=t[w];T.clippingState=L,this.numIntersection=A?this.numPlanes:0,this.numPlanes+=M}};function c(){u.value!==t&&(u.value=t,u.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(p,v,y,_){const A=p!==null?p.length:0;let E=null;if(A!==0){if(E=u.value,_!==!0||E===null){const T=y+A*4,M=v.matrixWorldInverse;o.getNormalMatrix(M),(E===null||E.length<T)&&(E=new Float32Array(T));for(let R=0,L=y;R!==A;++R,L+=4)a.copy(p[R]).applyMatrix4(M,o),a.normal.toArray(E,L),E[L+3]=a.constant}u.value=E,u.needsUpdate=!0}return e.numPlanes=A,e.numIntersection=0,E}}function uz(r){let e=new WeakMap;function t(a,o){return o===Rv?a.mapping=pu:o===Dv&&(a.mapping=Pf),a}function n(a){if(a&&a.isTexture){const o=a.mapping;if(o===Rv||o===Dv)if(e.has(a)){const u=e.get(a).texture;return t(u,a.mapping)}else{const u=a.image;if(u&&u.height>0){const c=new xM(u.height);return c.fromEquirectangularTexture(r,a),e.set(a,c),a.addEventListener("dispose",i),t(c.texture,a.mapping)}else return null}}return a}function i(a){const o=a.target;o.removeEventListener("dispose",i);const u=e.get(o);u!==void 0&&(e.delete(o),u.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}const Rf=4,iL=[.125,.215,.35,.446,.526,.582],ld=20,cz=256,Z0=new kd,sL=new dt;let KT=null,YT=0,XT=0,qT=!1;const fz=new ee;class f1{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,n=.1,i=100,s={}){const{size:a=256,position:o=fz}=s;KT=this._renderer.getRenderTarget(),YT=this._renderer.getActiveCubeFace(),XT=this._renderer.getActiveMipmapLevel(),qT=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const u=this._allocateTargets();return u.depthBuffer=!0,this._sceneToCubeUV(e,n,i,u,o),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=oL(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=aL(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(KT,YT,XT),this._renderer.xr.enabled=qT,e.scissorTest=!1,dm(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===pu||e.mapping===Pf?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),KT=this._renderer.getRenderTarget(),YT=this._renderer.getActiveCubeFace(),XT=this._renderer.getActiveMipmapLevel(),qT=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Gn,minFilter:Gn,generateMipmaps:!1,type:Za,format:Er,colorSpace:Nf,depthBuffer:!1},i=rL(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=rL(e,t,n);const{_lodMax:s}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=hz(s)),this._blurMaterial=pz(s,e,t),this._ggxMaterial=dz(s,e,t)}return i}_compileMaterial(e){const t=new $i(new en,e);this._renderer.compile(t,Z0)}_sceneToCubeUV(e,t,n,i,s){const u=new gs(90,1,t,n),c=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],p=this._renderer,v=p.autoClear,y=p.toneMapping;p.getClearColor(sL),p.toneMapping=Oo,p.autoClear=!1,p.state.buffers.depth.getReversed()&&(p.setRenderTarget(i),p.clearDepth(),p.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new $i(new Nd,new Xa({name:"PMREM.Background",side:ta,depthWrite:!1,depthTest:!1})));const A=this._backgroundBox,E=A.material;let T=!1;const M=e.background;M?M.isColor&&(E.color.copy(M),e.background=null,T=!0):(E.color.copy(sL),T=!0);for(let R=0;R<6;R++){const L=R%3;L===0?(u.up.set(0,c[R],0),u.position.set(s.x,s.y,s.z),u.lookAt(s.x+h[R],s.y,s.z)):L===1?(u.up.set(0,0,c[R]),u.position.set(s.x,s.y,s.z),u.lookAt(s.x,s.y+h[R],s.z)):(u.up.set(0,c[R],0),u.position.set(s.x,s.y,s.z),u.lookAt(s.x,s.y,s.z+h[R]));const w=this._cubeSize;dm(i,L*w,R>2?w:0,w,w),p.setRenderTarget(i),T&&p.render(A,u),p.render(e,u)}p.toneMapping=y,p.autoClear=v,e.background=M}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===pu||e.mapping===Pf;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=oL()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=aL());const s=i?this._cubemapMaterial:this._equirectMaterial,a=this._lodMeshes[0];a.material=s;const o=s.uniforms;o.envMap.value=e;const u=this._cubeSize;dm(t,0,0,3*u,2*u),n.setRenderTarget(t),n.render(a,Z0)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodMeshes.length;for(let s=1;s<i;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=n}_applyGGXFilter(e,t,n){const i=this._renderer,s=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[n];o.material=a;const u=a.uniforms,c=n/(this._lodMeshes.length-1),h=t/(this._lodMeshes.length-1),p=Math.sqrt(c*c-h*h),v=0+c*1.25,y=p*v,{_lodMax:_}=this,A=this._sizeLods[n],E=3*A*(n>_-Rf?n-_+Rf:0),T=4*(this._cubeSize-A);u.envMap.value=e.texture,u.roughness.value=y,u.mipInt.value=_-t,dm(s,E,T,3*A,2*A),i.setRenderTarget(s),i.render(o,Z0),u.envMap.value=s.texture,u.roughness.value=0,u.mipInt.value=_-n,dm(e,E,T,3*A,2*A),i.setRenderTarget(e),i.render(o,Z0)}_blur(e,t,n,i,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",s),this._halfBlur(a,e,n,n,i,"longitudinal",s)}_halfBlur(e,t,n,i,s,a,o){const u=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&Nt("blur direction must be either latitudinal or longitudinal!");const h=3,p=this._lodMeshes[i];p.material=c;const v=c.uniforms,y=this._sizeLods[n]-1,_=isFinite(s)?Math.PI/(2*y):2*Math.PI/(2*ld-1),A=s/_,E=isFinite(s)?1+Math.floor(h*A):ld;E>ld&&ct(`sigmaRadians, ${s}, is too large and will clip, as it requested ${E} samples when the maximum is set to ${ld}`);const T=[];let M=0;for(let O=0;O<ld;++O){const F=O/A,B=Math.exp(-F*F/2);T.push(B),O===0?M+=B:O<E&&(M+=2*B)}for(let O=0;O<T.length;O++)T[O]=T[O]/M;v.envMap.value=e.texture,v.samples.value=E,v.weights.value=T,v.latitudinal.value=a==="latitudinal",o&&(v.poleAxis.value=o);const{_lodMax:R}=this;v.dTheta.value=_,v.mipInt.value=R-n;const L=this._sizeLods[i],w=3*L*(i>R-Rf?i-R+Rf:0),N=4*(this._cubeSize-L);dm(t,w,N,3*L,2*L),u.setRenderTarget(t),u.render(p,Z0)}}function hz(r){const e=[],t=[],n=[];let i=r;const s=r-Rf+1+iL.length;for(let a=0;a<s;a++){const o=Math.pow(2,i);e.push(o);let u=1/o;a>r-Rf?u=iL[a-r+Rf-1]:a===0&&(u=0),t.push(u);const c=1/(o-2),h=-c,p=1+c,v=[h,h,p,h,p,p,h,h,p,p,h,p],y=6,_=6,A=3,E=2,T=1,M=new Float32Array(A*_*y),R=new Float32Array(E*_*y),L=new Float32Array(T*_*y);for(let N=0;N<y;N++){const O=N%3*2/3-1,F=N>2?0:-1,B=[O,F,0,O+2/3,F,0,O+2/3,F+1,0,O,F,0,O+2/3,F+1,0,O,F+1,0];M.set(B,A*_*N),R.set(v,E*_*N);const P=[N,N,N,N,N,N];L.set(P,T*_*N)}const w=new en;w.setAttribute("position",new On(M,A)),w.setAttribute("uv",new On(R,E)),w.setAttribute("faceIndex",new On(L,T)),n.push(new $i(w,null)),i>Rf&&i--}return{lodMeshes:n,sizeLods:e,sigmas:t}}function rL(r,e,t){const n=new tr(r,e,t);return n.texture.mapping=lg,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function dm(r,e,t,n,i){r.viewport.set(e,t,n,i),r.scissor.set(e,t,n,i)}function dz(r,e,t){return new to({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:cz,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:sE(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:vl,depthTest:!1,depthWrite:!1})}function pz(r,e,t){const n=new Float32Array(ld),i=new ee(0,1,0);return new to({name:"SphericalGaussianBlur",defines:{n:ld,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:sE(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:vl,depthTest:!1,depthWrite:!1})}function aL(){return new to({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:sE(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:vl,depthTest:!1,depthWrite:!1})}function oL(){return new to({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:sE(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:vl,depthTest:!1,depthWrite:!1})}function sE(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function mz(r){let e=new WeakMap,t=null;function n(o){if(o&&o.isTexture){const u=o.mapping,c=u===Rv||u===Dv,h=u===pu||u===Pf;if(c||h){let p=e.get(o);const v=p!==void 0?p.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==v)return t===null&&(t=new f1(r)),p=c?t.fromEquirectangular(o,p):t.fromCubemap(o,p),p.texture.pmremVersion=o.pmremVersion,e.set(o,p),p.texture;if(p!==void 0)return p.texture;{const y=o.image;return c&&y&&y.height>0||h&&y&&i(y)?(t===null&&(t=new f1(r)),p=c?t.fromEquirectangular(o):t.fromCubemap(o),p.texture.pmremVersion=o.pmremVersion,e.set(o,p),o.addEventListener("dispose",s),p.texture):null}}}return o}function i(o){let u=0;const c=6;for(let h=0;h<c;h++)o[h]!==void 0&&u++;return u===c}function s(o){const u=o.target;u.removeEventListener("dispose",s);const c=e.get(u);c!==void 0&&(e.delete(u),c.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:a}}function gz(r){const e={};function t(n){if(e[n]!==void 0)return e[n];const i=r.getExtension(n);return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const i=t(n);return i===null&&Km("WebGLRenderer: "+n+" extension not supported."),i}}}function vz(r,e,t,n){const i={},s=new WeakMap;function a(p){const v=p.target;v.index!==null&&e.remove(v.index);for(const _ in v.attributes)e.remove(v.attributes[_]);v.removeEventListener("dispose",a),delete i[v.id];const y=s.get(v);y&&(e.remove(y),s.delete(v)),n.releaseStatesOfGeometry(v),v.isInstancedBufferGeometry===!0&&delete v._maxInstanceCount,t.memory.geometries--}function o(p,v){return i[v.id]===!0||(v.addEventListener("dispose",a),i[v.id]=!0,t.memory.geometries++),v}function u(p){const v=p.attributes;for(const y in v)e.update(v[y],r.ARRAY_BUFFER)}function c(p){const v=[],y=p.index,_=p.attributes.position;let A=0;if(y!==null){const M=y.array;A=y.version;for(let R=0,L=M.length;R<L;R+=3){const w=M[R+0],N=M[R+1],O=M[R+2];v.push(w,N,N,O,O,w)}}else if(_!==void 0){const M=_.array;A=_.version;for(let R=0,L=M.length/3-1;R<L;R+=3){const w=R+0,N=R+1,O=R+2;v.push(w,N,N,O,O,w)}}else return;const E=new(v2(v)?_M:yM)(v,1);E.version=A;const T=s.get(p);T&&e.remove(T),s.set(p,E)}function h(p){const v=s.get(p);if(v){const y=p.index;y!==null&&v.version<y.version&&c(p)}else c(p);return s.get(p)}return{get:o,update:u,getWireframeAttribute:h}}function yz(r,e,t){let n;function i(v){n=v}let s,a;function o(v){s=v.type,a=v.bytesPerElement}function u(v,y){r.drawElements(n,y,s,v*a),t.update(y,n,1)}function c(v,y,_){_!==0&&(r.drawElementsInstanced(n,y,s,v*a,_),t.update(y,n,_))}function h(v,y,_){if(_===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,y,0,s,v,0,_);let E=0;for(let T=0;T<_;T++)E+=y[T];t.update(E,n,1)}function p(v,y,_,A){if(_===0)return;const E=e.get("WEBGL_multi_draw");if(E===null)for(let T=0;T<v.length;T++)c(v[T]/a,y[T],A[T]);else{E.multiDrawElementsInstancedWEBGL(n,y,0,s,v,0,A,0,_);let T=0;for(let M=0;M<_;M++)T+=y[M]*A[M];t.update(T,n,1)}}this.setMode=i,this.setIndex=o,this.render=u,this.renderInstances=c,this.renderMultiDraw=h,this.renderMultiDrawInstances=p}function _z(r){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,a,o){switch(t.calls++,a){case r.TRIANGLES:t.triangles+=o*(s/3);break;case r.LINES:t.lines+=o*(s/2);break;case r.LINE_STRIP:t.lines+=o*(s-1);break;case r.LINE_LOOP:t.lines+=o*s;break;case r.POINTS:t.points+=o*s;break;default:Nt("WebGLInfo: Unknown draw mode:",a);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function xz(r,e,t){const n=new WeakMap,i=new ni;function s(a,o,u){const c=a.morphTargetInfluences,h=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,p=h!==void 0?h.length:0;let v=n.get(o);if(v===void 0||v.count!==p){let P=function(){F.dispose(),n.delete(o),o.removeEventListener("dispose",P)};var y=P;v!==void 0&&v.texture.dispose();const _=o.morphAttributes.position!==void 0,A=o.morphAttributes.normal!==void 0,E=o.morphAttributes.color!==void 0,T=o.morphAttributes.position||[],M=o.morphAttributes.normal||[],R=o.morphAttributes.color||[];let L=0;_===!0&&(L=1),A===!0&&(L=2),E===!0&&(L=3);let w=o.attributes.position.count*L,N=1;w>e.maxTextureSize&&(N=Math.ceil(w/e.maxTextureSize),w=e.maxTextureSize);const O=new Float32Array(w*N*4*p),F=new NA(O,w,N,p);F.type=Ar,F.needsUpdate=!0;const B=L*4;for(let V=0;V<p;V++){const J=T[V],Q=M[V],ie=R[V],ne=w*N*4*V;for(let k=0;k<J.count;k++){const K=k*B;_===!0&&(i.fromBufferAttribute(J,k),O[ne+K+0]=i.x,O[ne+K+1]=i.y,O[ne+K+2]=i.z,O[ne+K+3]=0),A===!0&&(i.fromBufferAttribute(Q,k),O[ne+K+4]=i.x,O[ne+K+5]=i.y,O[ne+K+6]=i.z,O[ne+K+7]=0),E===!0&&(i.fromBufferAttribute(ie,k),O[ne+K+8]=i.x,O[ne+K+9]=i.y,O[ne+K+10]=i.z,O[ne+K+11]=ie.itemSize===4?i.w:1)}}v={count:p,texture:F,size:new Ve(w,N)},n.set(o,v),o.addEventListener("dispose",P)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)u.getUniforms().setValue(r,"morphTexture",a.morphTexture,t);else{let _=0;for(let E=0;E<c.length;E++)_+=c[E];const A=o.morphTargetsRelative?1:1-_;u.getUniforms().setValue(r,"morphTargetBaseInfluence",A),u.getUniforms().setValue(r,"morphTargetInfluences",c)}u.getUniforms().setValue(r,"morphTargetsTexture",v.texture,t),u.getUniforms().setValue(r,"morphTargetsTextureSize",v.size)}return{update:s}}function Sz(r,e,t,n){let i=new WeakMap;function s(u){const c=n.render.frame,h=u.geometry,p=e.get(u,h);if(i.get(p)!==c&&(e.update(p),i.set(p,c)),u.isInstancedMesh&&(u.hasEventListener("dispose",o)===!1&&u.addEventListener("dispose",o),i.get(u)!==c&&(t.update(u.instanceMatrix,r.ARRAY_BUFFER),u.instanceColor!==null&&t.update(u.instanceColor,r.ARRAY_BUFFER),i.set(u,c))),u.isSkinnedMesh){const v=u.skeleton;i.get(v)!==c&&(v.update(),i.set(v,c))}return p}function a(){i=new WeakMap}function o(u){const c=u.target;c.removeEventListener("dispose",o),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:a}}const Az={[nM]:"LINEAR_TONE_MAPPING",[iM]:"REINHARD_TONE_MAPPING",[sM]:"CINEON_TONE_MAPPING",[TA]:"ACES_FILMIC_TONE_MAPPING",[aM]:"AGX_TONE_MAPPING",[oM]:"NEUTRAL_TONE_MAPPING",[rM]:"CUSTOM_TONE_MAPPING"};function Ez(r,e,t,n,i){const s=new tr(e,t,{type:r,depthBuffer:n,stencilBuffer:i}),a=new tr(e,t,{type:Za,depthBuffer:!1,stencilBuffer:!1}),o=new en;o.setAttribute("position",new Ct([-1,3,0,-1,-1,0,3,-1,0],3)),o.setAttribute("uv",new Ct([0,2,0,0,2,0],2));const u=new OM({uniforms:{tDiffuse:{value:null}},vertexShader:`
			precision highp float;

			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}`,fragmentShader:`
			precision highp float;

			uniform sampler2D tDiffuse;

			varying vec2 vUv;

			#include <tonemapping_pars_fragment>
			#include <colorspace_pars_fragment>

			void main() {
				gl_FragColor = texture2D( tDiffuse, vUv );

				#ifdef LINEAR_TONE_MAPPING
					gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );
				#elif defined( REINHARD_TONE_MAPPING )
					gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );
				#elif defined( CINEON_TONE_MAPPING )
					gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );
				#elif defined( ACES_FILMIC_TONE_MAPPING )
					gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );
				#elif defined( AGX_TONE_MAPPING )
					gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );
				#elif defined( NEUTRAL_TONE_MAPPING )
					gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );
				#elif defined( CUSTOM_TONE_MAPPING )
					gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );
				#endif

				#ifdef SRGB_TRANSFER
					gl_FragColor = sRGBTransferOETF( gl_FragColor );
				#endif
			}`,depthTest:!1,depthWrite:!1}),c=new $i(o,u),h=new kd(-1,1,1,-1,0,1);let p=null,v=null,y=!1,_,A=null,E=[],T=!1;this.setSize=function(M,R){s.setSize(M,R),a.setSize(M,R);for(let L=0;L<E.length;L++){const w=E[L];w.setSize&&w.setSize(M,R)}},this.setEffects=function(M){E=M,T=E.length>0&&E[0].isRenderPass===!0;const R=s.width,L=s.height;for(let w=0;w<E.length;w++){const N=E[w];N.setSize&&N.setSize(R,L)}},this.begin=function(M,R){if(y||M.toneMapping===Oo&&E.length===0)return!1;if(A=R,R!==null){const L=R.width,w=R.height;(s.width!==L||s.height!==w)&&this.setSize(L,w)}return T===!1&&M.setRenderTarget(s),_=M.toneMapping,M.toneMapping=Oo,!0},this.hasRenderPass=function(){return T},this.end=function(M,R){M.toneMapping=_,y=!0;let L=s,w=a;for(let N=0;N<E.length;N++){const O=E[N];if(O.enabled!==!1&&(O.render(M,w,L,R),O.needsSwap!==!1)){const F=L;L=w,w=F}}if(p!==M.outputColorSpace||v!==M.toneMapping){p=M.outputColorSpace,v=M.toneMapping,u.defines={},Mn.getTransfer(p)===Qn&&(u.defines.SRGB_TRANSFER="");const N=Az[v];N&&(u.defines[N]=""),u.needsUpdate=!0}u.uniforms.tDiffuse.value=L.texture,M.setRenderTarget(A),M.render(c,h),A=null,y=!1},this.isCompositing=function(){return y},this.dispose=function(){s.dispose(),a.dispose(),o.dispose(),u.dispose()}}const hB=new yi,h1=new kf(1,1),dB=new NA,pB=new UA,mB=new ny,lL=[],uL=[],cL=new Float32Array(16),fL=new Float32Array(9),hL=new Float32Array(4);function pg(r,e,t){const n=r[0];if(n<=0||n>0)return r;const i=e*t;let s=lL[i];if(s===void 0&&(s=new Float32Array(i),lL[i]=s),e!==0){n.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=t,r[a].toArray(s,o)}return s}function Ds(r,e){if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]!==e[t])return!1;return!0}function Ls(r,e){for(let t=0,n=e.length;t<n;t++)r[t]=e[t]}function rE(r,e){let t=uL[e];t===void 0&&(t=new Int32Array(e),uL[e]=t);for(let n=0;n!==e;++n)t[n]=r.allocateTextureUnit();return t}function Tz(r,e){const t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function bz(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ds(t,e))return;r.uniform2fv(this.addr,e),Ls(t,e)}}function Mz(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ds(t,e))return;r.uniform3fv(this.addr,e),Ls(t,e)}}function Cz(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ds(t,e))return;r.uniform4fv(this.addr,e),Ls(t,e)}}function Rz(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ds(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),Ls(t,e)}else{if(Ds(t,n))return;hL.set(n),r.uniformMatrix2fv(this.addr,!1,hL),Ls(t,n)}}function Dz(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ds(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),Ls(t,e)}else{if(Ds(t,n))return;fL.set(n),r.uniformMatrix3fv(this.addr,!1,fL),Ls(t,n)}}function Lz(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ds(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),Ls(t,e)}else{if(Ds(t,n))return;cL.set(n),r.uniformMatrix4fv(this.addr,!1,cL),Ls(t,n)}}function Iz(r,e){const t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function wz(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ds(t,e))return;r.uniform2iv(this.addr,e),Ls(t,e)}}function Bz(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ds(t,e))return;r.uniform3iv(this.addr,e),Ls(t,e)}}function Oz(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ds(t,e))return;r.uniform4iv(this.addr,e),Ls(t,e)}}function Pz(r,e){const t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function Nz(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ds(t,e))return;r.uniform2uiv(this.addr,e),Ls(t,e)}}function Uz(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ds(t,e))return;r.uniform3uiv(this.addr,e),Ls(t,e)}}function Fz(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ds(t,e))return;r.uniform4uiv(this.addr,e),Ls(t,e)}}function kz(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i);let s;this.type===r.SAMPLER_2D_SHADOW?(h1.compareFunction=t.isReversedDepthBuffer()?PA:OA,s=h1):s=hB,t.setTexture2D(e||s,i)}function Gz(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||pB,i)}function Hz(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||mB,i)}function zz(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||dB,i)}function Vz(r){switch(r){case 5126:return Tz;case 35664:return bz;case 35665:return Mz;case 35666:return Cz;case 35674:return Rz;case 35675:return Dz;case 35676:return Lz;case 5124:case 35670:return Iz;case 35667:case 35671:return wz;case 35668:case 35672:return Bz;case 35669:case 35673:return Oz;case 5125:return Pz;case 36294:return Nz;case 36295:return Uz;case 36296:return Fz;case 35678:case 36198:case 36298:case 36306:case 35682:return kz;case 35679:case 36299:case 36307:return Gz;case 35680:case 36300:case 36308:case 36293:return Hz;case 36289:case 36303:case 36311:case 36292:return zz}}function Kz(r,e){r.uniform1fv(this.addr,e)}function Yz(r,e){const t=pg(e,this.size,2);r.uniform2fv(this.addr,t)}function Xz(r,e){const t=pg(e,this.size,3);r.uniform3fv(this.addr,t)}function qz(r,e){const t=pg(e,this.size,4);r.uniform4fv(this.addr,t)}function Wz(r,e){const t=pg(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function jz(r,e){const t=pg(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function Jz(r,e){const t=pg(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function Qz(r,e){r.uniform1iv(this.addr,e)}function $z(r,e){r.uniform2iv(this.addr,e)}function Zz(r,e){r.uniform3iv(this.addr,e)}function e8(r,e){r.uniform4iv(this.addr,e)}function t8(r,e){r.uniform1uiv(this.addr,e)}function n8(r,e){r.uniform2uiv(this.addr,e)}function i8(r,e){r.uniform3uiv(this.addr,e)}function s8(r,e){r.uniform4uiv(this.addr,e)}function r8(r,e,t){const n=this.cache,i=e.length,s=rE(t,i);Ds(n,s)||(r.uniform1iv(this.addr,s),Ls(n,s));let a;this.type===r.SAMPLER_2D_SHADOW?a=h1:a=hB;for(let o=0;o!==i;++o)t.setTexture2D(e[o]||a,s[o])}function a8(r,e,t){const n=this.cache,i=e.length,s=rE(t,i);Ds(n,s)||(r.uniform1iv(this.addr,s),Ls(n,s));for(let a=0;a!==i;++a)t.setTexture3D(e[a]||pB,s[a])}function o8(r,e,t){const n=this.cache,i=e.length,s=rE(t,i);Ds(n,s)||(r.uniform1iv(this.addr,s),Ls(n,s));for(let a=0;a!==i;++a)t.setTextureCube(e[a]||mB,s[a])}function l8(r,e,t){const n=this.cache,i=e.length,s=rE(t,i);Ds(n,s)||(r.uniform1iv(this.addr,s),Ls(n,s));for(let a=0;a!==i;++a)t.setTexture2DArray(e[a]||dB,s[a])}function u8(r){switch(r){case 5126:return Kz;case 35664:return Yz;case 35665:return Xz;case 35666:return qz;case 35674:return Wz;case 35675:return jz;case 35676:return Jz;case 5124:case 35670:return Qz;case 35667:case 35671:return $z;case 35668:case 35672:return Zz;case 35669:case 35673:return e8;case 5125:return t8;case 36294:return n8;case 36295:return i8;case 36296:return s8;case 35678:case 36198:case 36298:case 36306:case 35682:return r8;case 35679:case 36299:case 36307:return a8;case 35680:case 36300:case 36308:case 36293:return o8;case 36289:case 36303:case 36311:case 36292:return l8}}class c8{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=Vz(t.type)}}class f8{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=u8(t.type)}}class h8{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let s=0,a=i.length;s!==a;++s){const o=i[s];o.setValue(e,t[o.id],n)}}}const WT=/(\w+)(\])?(\[|\.)?/g;function dL(r,e){r.seq.push(e),r.map[e.id]=e}function d8(r,e,t){const n=r.name,i=n.length;for(WT.lastIndex=0;;){const s=WT.exec(n),a=WT.lastIndex;let o=s[1];const u=s[2]==="]",c=s[3];if(u&&(o=o|0),c===void 0||c==="["&&a+2===i){dL(t,c===void 0?new c8(o,r,e):new f8(o,r,e));break}else{let p=t.map[o];p===void 0&&(p=new h8(o),dL(t,p)),t=p}}}class Xx{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let a=0;a<n;++a){const o=e.getActiveUniform(t,a),u=e.getUniformLocation(t,o.name);d8(o,u,this)}const i=[],s=[];for(const a of this.seq)a.type===e.SAMPLER_2D_SHADOW||a.type===e.SAMPLER_CUBE_SHADOW||a.type===e.SAMPLER_2D_ARRAY_SHADOW?i.push(a):s.push(a);i.length>0&&(this.seq=i.concat(s))}setValue(e,t,n,i){const s=this.map[t];s!==void 0&&s.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let s=0,a=t.length;s!==a;++s){const o=t[s],u=n[o.id];u.needsUpdate!==!1&&o.setValue(e,u.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,s=e.length;i!==s;++i){const a=e[i];a.id in t&&n.push(a)}return n}}function pL(r,e,t){const n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n}const p8=37297;let m8=0;function g8(r,e){const t=r.split(`
`),n=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=i;a<s;a++){const o=a+1;n.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return n.join(`
`)}const mL=new on;function v8(r){Mn._getMatrix(mL,Mn.workingColorSpace,r);const e=`mat3( ${mL.elements.map(t=>t.toFixed(4))} )`;switch(Mn.getTransfer(r)){case Iv:return[e,"LinearTransferOETF"];case Qn:return[e,"sRGBTransferOETF"];default:return ct("WebGLProgram: Unsupported color space: ",r),[e,"LinearTransferOETF"]}}function gL(r,e,t){const n=r.getShaderParameter(e,r.COMPILE_STATUS),s=(r.getShaderInfoLog(e)||"").trim();if(n&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const o=parseInt(a[1]);return t.toUpperCase()+`

`+s+`

`+g8(r.getShaderSource(e),o)}else return s}function y8(r,e){const t=v8(e);return[`vec4 ${r}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}const _8={[nM]:"Linear",[iM]:"Reinhard",[sM]:"Cineon",[TA]:"ACESFilmic",[aM]:"AgX",[oM]:"Neutral",[rM]:"Custom"};function x8(r,e){const t=_8[e];return t===void 0?(ct("WebGLProgram: Unsupported toneMapping:",e),"vec3 "+r+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Ax=new ee;function S8(){Mn.getLuminanceCoefficients(Ax);const r=Ax.x.toFixed(4),e=Ax.y.toFixed(4),t=Ax.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${r}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function A8(r){return[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",r.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(lv).join(`
`)}function E8(r){const e=[];for(const t in r){const n=r[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function T8(r,e){const t={},n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const s=r.getActiveAttrib(e,i),a=s.name;let o=1;s.type===r.FLOAT_MAT2&&(o=2),s.type===r.FLOAT_MAT3&&(o=3),s.type===r.FLOAT_MAT4&&(o=4),t[a]={type:s.type,location:r.getAttribLocation(e,a),locationSize:o}}return t}function lv(r){return r!==""}function vL(r,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function yL(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const b8=/^[ \t]*#include +<([\w\d./]+)>/gm;function d1(r){return r.replace(b8,C8)}const M8=new Map;function C8(r,e){let t=hn[e];if(t===void 0){const n=M8.get(e);if(n!==void 0)t=hn[n],ct('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return d1(t)}const R8=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function _L(r){return r.replace(R8,D8)}function D8(r,e,t,n){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function xL(r){let e=`precision ${r.precision} float;
	precision ${r.precision} int;
	precision ${r.precision} sampler2D;
	precision ${r.precision} samplerCube;
	precision ${r.precision} sampler3D;
	precision ${r.precision} sampler2DArray;
	precision ${r.precision} sampler2DShadow;
	precision ${r.precision} samplerCubeShadow;
	precision ${r.precision} sampler2DArrayShadow;
	precision ${r.precision} isampler2D;
	precision ${r.precision} isampler3D;
	precision ${r.precision} isamplerCube;
	precision ${r.precision} isampler2DArray;
	precision ${r.precision} usampler2D;
	precision ${r.precision} usampler3D;
	precision ${r.precision} usamplerCube;
	precision ${r.precision} usampler2DArray;
	`;return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}const L8={[Rm]:"SHADOWMAP_TYPE_PCF",[ud]:"SHADOWMAP_TYPE_VSM"};function I8(r){return L8[r.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}const w8={[pu]:"ENVMAP_TYPE_CUBE",[Pf]:"ENVMAP_TYPE_CUBE",[lg]:"ENVMAP_TYPE_CUBE_UV"};function B8(r){return r.envMap===!1?"ENVMAP_TYPE_CUBE":w8[r.envMapMode]||"ENVMAP_TYPE_CUBE"}const O8={[Pf]:"ENVMAP_MODE_REFRACTION"};function P8(r){return r.envMap===!1?"ENVMAP_MODE_REFLECTION":O8[r.envMapMode]||"ENVMAP_MODE_REFLECTION"}const N8={[Zv]:"ENVMAP_BLENDING_MULTIPLY",[n2]:"ENVMAP_BLENDING_MIX",[i2]:"ENVMAP_BLENDING_ADD"};function U8(r){return r.envMap===!1?"ENVMAP_BLENDING_NONE":N8[r.combine]||"ENVMAP_BLENDING_NONE"}function F8(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function k8(r,e,t,n){const i=r.getContext(),s=t.defines;let a=t.vertexShader,o=t.fragmentShader;const u=I8(t),c=B8(t),h=P8(t),p=U8(t),v=F8(t),y=A8(t),_=E8(s),A=i.createProgram();let E,T,M=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(E=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(lv).join(`
`),E.length>0&&(E+=`
`),T=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(lv).join(`
`),T.length>0&&(T+=`
`)):(E=[xL(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(lv).join(`
`),T=[xL(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+p:"",v?"#define CUBEUV_TEXEL_WIDTH "+v.texelWidth:"",v?"#define CUBEUV_TEXEL_HEIGHT "+v.texelHeight:"",v?"#define CUBEUV_MAX_MIP "+v.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Oo?"#define TONE_MAPPING":"",t.toneMapping!==Oo?hn.tonemapping_pars_fragment:"",t.toneMapping!==Oo?x8("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",hn.colorspace_pars_fragment,y8("linearToOutputTexel",t.outputColorSpace),S8(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(lv).join(`
`)),a=d1(a),a=vL(a,t),a=yL(a,t),o=d1(o),o=vL(o,t),o=yL(o,t),a=_L(a),o=_L(o),t.isRawShaderMaterial!==!0&&(M=`#version 300 es
`,E=[y,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+E,T=["#define varying in",t.glslVersion===s1?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===s1?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+T);const R=M+E+a,L=M+T+o,w=pL(i,i.VERTEX_SHADER,R),N=pL(i,i.FRAGMENT_SHADER,L);i.attachShader(A,w),i.attachShader(A,N),t.index0AttributeName!==void 0?i.bindAttribLocation(A,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(A,0,"position"),i.linkProgram(A);function O(V){if(r.debug.checkShaderErrors){const J=i.getProgramInfoLog(A)||"",Q=i.getShaderInfoLog(w)||"",ie=i.getShaderInfoLog(N)||"",ne=J.trim(),k=Q.trim(),K=ie.trim();let j=!0,se=!0;if(i.getProgramParameter(A,i.LINK_STATUS)===!1)if(j=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(i,A,w,N);else{const oe=gL(i,w,"vertex"),Y=gL(i,N,"fragment");Nt("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(A,i.VALIDATE_STATUS)+`

Material Name: `+V.name+`
Material Type: `+V.type+`

Program Info Log: `+ne+`
`+oe+`
`+Y)}else ne!==""?ct("WebGLProgram: Program Info Log:",ne):(k===""||K==="")&&(se=!1);se&&(V.diagnostics={runnable:j,programLog:ne,vertexShader:{log:k,prefix:E},fragmentShader:{log:K,prefix:T}})}i.deleteShader(w),i.deleteShader(N),F=new Xx(i,A),B=T8(i,A)}let F;this.getUniforms=function(){return F===void 0&&O(this),F};let B;this.getAttributes=function(){return B===void 0&&O(this),B};let P=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return P===!1&&(P=i.getProgramParameter(A,p8)),P},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(A),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=m8++,this.cacheKey=e,this.usedTimes=1,this.program=A,this.vertexShader=w,this.fragmentShader=N,this}let G8=0;class H8{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return a.has(i)===!1&&(a.add(i),i.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new z8(e),t.set(e,n)),n}}class z8{constructor(e){this.id=G8++,this.code=e,this.usedTimes=0}}function V8(r,e,t,n,i,s,a){const o=new Xm,u=new H8,c=new Set,h=[],p=new Map,v=i.logarithmicDepthBuffer;let y=i.precision;const _={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function A(B){return c.add(B),B===0?"uv":`uv${B}`}function E(B,P,V,J,Q){const ie=J.fog,ne=Q.geometry,k=B.isMeshStandardMaterial?J.environment:null,K=(B.isMeshStandardMaterial?t:e).get(B.envMap||k),j=K&&K.mapping===lg?K.image.height:null,se=_[B.type];B.precision!==null&&(y=i.getMaxPrecision(B.precision),y!==B.precision&&ct("WebGLProgram.getParameters:",B.precision,"not supported, using",y,"instead."));const oe=ne.morphAttributes.position||ne.morphAttributes.normal||ne.morphAttributes.color,Y=oe!==void 0?oe.length:0;let Z=0;ne.morphAttributes.position!==void 0&&(Z=1),ne.morphAttributes.normal!==void 0&&(Z=2),ne.morphAttributes.color!==void 0&&(Z=3);let le,pe,Te,ce;if(se){const gn=pl[se];le=gn.vertexShader,pe=gn.fragmentShader}else le=B.vertexShader,pe=B.fragmentShader,u.update(B),Te=u.getVertexShaderID(B),ce=u.getFragmentShaderID(B);const Me=r.getRenderTarget(),Xe=r.state.buffers.depth.getReversed(),nt=Q.isInstancedMesh===!0,at=Q.isBatchedMesh===!0,Vt=!!B.map,dn=!!B.matcap,Ut=!!K,Ne=!!B.aoMap,We=!!B.lightMap,Ie=!!B.bumpMap,je=!!B.normalMap,te=!!B.displacementMap,St=!!B.emissiveMap,$e=!!B.metalnessMap,At=!!B.roughnessMap,et=B.anisotropy>0,$=B.clearcoat>0,z=B.dispersion>0,fe=B.iridescence>0,we=B.sheen>0,He=B.transmission>0,Oe=et&&!!B.anisotropyMap,Et=$&&!!B.clearcoatMap,it=$&&!!B.clearcoatNormalMap,vt=$&&!!B.clearcoatRoughnessMap,Ft=fe&&!!B.iridescenceMap,Ye=fe&&!!B.iridescenceThicknessMap,Je=we&&!!B.sheenColorMap,ft=we&&!!B.sheenRoughnessMap,ht=!!B.specularMap,rt=!!B.specularColorMap,Qt=!!B.specularIntensityMap,he=He&&!!B.transmissionMap,lt=He&&!!B.thicknessMap,Ze=!!B.gradientMap,pt=!!B.alphaMap,qe=B.alphaTest>0,ze=!!B.alphaHash,st=!!B.extensions;let Yt=Oo;B.toneMapped&&(Me===null||Me.isXRRenderTarget===!0)&&(Yt=r.toneMapping);const Cn={shaderID:se,shaderType:B.type,shaderName:B.name,vertexShader:le,fragmentShader:pe,defines:B.defines,customVertexShaderID:Te,customFragmentShaderID:ce,isRawShaderMaterial:B.isRawShaderMaterial===!0,glslVersion:B.glslVersion,precision:y,batching:at,batchingColor:at&&Q._colorsTexture!==null,instancing:nt,instancingColor:nt&&Q.instanceColor!==null,instancingMorph:nt&&Q.morphTexture!==null,outputColorSpace:Me===null?r.outputColorSpace:Me.isXRRenderTarget===!0?Me.texture.colorSpace:Nf,alphaToCoverage:!!B.alphaToCoverage,map:Vt,matcap:dn,envMap:Ut,envMapMode:Ut&&K.mapping,envMapCubeUVHeight:j,aoMap:Ne,lightMap:We,bumpMap:Ie,normalMap:je,displacementMap:te,emissiveMap:St,normalMapObjectSpace:je&&B.normalMapType===c2,normalMapTangentSpace:je&&B.normalMapType===Kf,metalnessMap:$e,roughnessMap:At,anisotropy:et,anisotropyMap:Oe,clearcoat:$,clearcoatMap:Et,clearcoatNormalMap:it,clearcoatRoughnessMap:vt,dispersion:z,iridescence:fe,iridescenceMap:Ft,iridescenceThicknessMap:Ye,sheen:we,sheenColorMap:Je,sheenRoughnessMap:ft,specularMap:ht,specularColorMap:rt,specularIntensityMap:Qt,transmission:He,transmissionMap:he,thicknessMap:lt,gradientMap:Ze,opaque:B.transparent===!1&&B.blending===vd&&B.alphaToCoverage===!1,alphaMap:pt,alphaTest:qe,alphaHash:ze,combine:B.combine,mapUv:Vt&&A(B.map.channel),aoMapUv:Ne&&A(B.aoMap.channel),lightMapUv:We&&A(B.lightMap.channel),bumpMapUv:Ie&&A(B.bumpMap.channel),normalMapUv:je&&A(B.normalMap.channel),displacementMapUv:te&&A(B.displacementMap.channel),emissiveMapUv:St&&A(B.emissiveMap.channel),metalnessMapUv:$e&&A(B.metalnessMap.channel),roughnessMapUv:At&&A(B.roughnessMap.channel),anisotropyMapUv:Oe&&A(B.anisotropyMap.channel),clearcoatMapUv:Et&&A(B.clearcoatMap.channel),clearcoatNormalMapUv:it&&A(B.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:vt&&A(B.clearcoatRoughnessMap.channel),iridescenceMapUv:Ft&&A(B.iridescenceMap.channel),iridescenceThicknessMapUv:Ye&&A(B.iridescenceThicknessMap.channel),sheenColorMapUv:Je&&A(B.sheenColorMap.channel),sheenRoughnessMapUv:ft&&A(B.sheenRoughnessMap.channel),specularMapUv:ht&&A(B.specularMap.channel),specularColorMapUv:rt&&A(B.specularColorMap.channel),specularIntensityMapUv:Qt&&A(B.specularIntensityMap.channel),transmissionMapUv:he&&A(B.transmissionMap.channel),thicknessMapUv:lt&&A(B.thicknessMap.channel),alphaMapUv:pt&&A(B.alphaMap.channel),vertexTangents:!!ne.attributes.tangent&&(je||et),vertexColors:B.vertexColors,vertexAlphas:B.vertexColors===!0&&!!ne.attributes.color&&ne.attributes.color.itemSize===4,pointsUvs:Q.isPoints===!0&&!!ne.attributes.uv&&(Vt||pt),fog:!!ie,useFog:B.fog===!0,fogExp2:!!ie&&ie.isFogExp2,flatShading:B.flatShading===!0&&B.wireframe===!1,sizeAttenuation:B.sizeAttenuation===!0,logarithmicDepthBuffer:v,reversedDepthBuffer:Xe,skinning:Q.isSkinnedMesh===!0,morphTargets:ne.morphAttributes.position!==void 0,morphNormals:ne.morphAttributes.normal!==void 0,morphColors:ne.morphAttributes.color!==void 0,morphTargetsCount:Y,morphTextureStride:Z,numDirLights:P.directional.length,numPointLights:P.point.length,numSpotLights:P.spot.length,numSpotLightMaps:P.spotLightMap.length,numRectAreaLights:P.rectArea.length,numHemiLights:P.hemi.length,numDirLightShadows:P.directionalShadowMap.length,numPointLightShadows:P.pointShadowMap.length,numSpotLightShadows:P.spotShadowMap.length,numSpotLightShadowsWithMaps:P.numSpotLightShadowsWithMaps,numLightProbes:P.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:B.dithering,shadowMapEnabled:r.shadowMap.enabled&&V.length>0,shadowMapType:r.shadowMap.type,toneMapping:Yt,decodeVideoTexture:Vt&&B.map.isVideoTexture===!0&&Mn.getTransfer(B.map.colorSpace)===Qn,decodeVideoTextureEmissive:St&&B.emissiveMap.isVideoTexture===!0&&Mn.getTransfer(B.emissiveMap.colorSpace)===Qn,premultipliedAlpha:B.premultipliedAlpha,doubleSided:B.side===Lo,flipSided:B.side===ta,useDepthPacking:B.depthPacking>=0,depthPacking:B.depthPacking||0,index0AttributeName:B.index0AttributeName,extensionClipCullDistance:st&&B.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(st&&B.extensions.multiDraw===!0||at)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:B.customProgramCacheKey()};return Cn.vertexUv1s=c.has(1),Cn.vertexUv2s=c.has(2),Cn.vertexUv3s=c.has(3),c.clear(),Cn}function T(B){const P=[];if(B.shaderID?P.push(B.shaderID):(P.push(B.customVertexShaderID),P.push(B.customFragmentShaderID)),B.defines!==void 0)for(const V in B.defines)P.push(V),P.push(B.defines[V]);return B.isRawShaderMaterial===!1&&(M(P,B),R(P,B),P.push(r.outputColorSpace)),P.push(B.customProgramCacheKey),P.join()}function M(B,P){B.push(P.precision),B.push(P.outputColorSpace),B.push(P.envMapMode),B.push(P.envMapCubeUVHeight),B.push(P.mapUv),B.push(P.alphaMapUv),B.push(P.lightMapUv),B.push(P.aoMapUv),B.push(P.bumpMapUv),B.push(P.normalMapUv),B.push(P.displacementMapUv),B.push(P.emissiveMapUv),B.push(P.metalnessMapUv),B.push(P.roughnessMapUv),B.push(P.anisotropyMapUv),B.push(P.clearcoatMapUv),B.push(P.clearcoatNormalMapUv),B.push(P.clearcoatRoughnessMapUv),B.push(P.iridescenceMapUv),B.push(P.iridescenceThicknessMapUv),B.push(P.sheenColorMapUv),B.push(P.sheenRoughnessMapUv),B.push(P.specularMapUv),B.push(P.specularColorMapUv),B.push(P.specularIntensityMapUv),B.push(P.transmissionMapUv),B.push(P.thicknessMapUv),B.push(P.combine),B.push(P.fogExp2),B.push(P.sizeAttenuation),B.push(P.morphTargetsCount),B.push(P.morphAttributeCount),B.push(P.numDirLights),B.push(P.numPointLights),B.push(P.numSpotLights),B.push(P.numSpotLightMaps),B.push(P.numHemiLights),B.push(P.numRectAreaLights),B.push(P.numDirLightShadows),B.push(P.numPointLightShadows),B.push(P.numSpotLightShadows),B.push(P.numSpotLightShadowsWithMaps),B.push(P.numLightProbes),B.push(P.shadowMapType),B.push(P.toneMapping),B.push(P.numClippingPlanes),B.push(P.numClipIntersection),B.push(P.depthPacking)}function R(B,P){o.disableAll(),P.instancing&&o.enable(0),P.instancingColor&&o.enable(1),P.instancingMorph&&o.enable(2),P.matcap&&o.enable(3),P.envMap&&o.enable(4),P.normalMapObjectSpace&&o.enable(5),P.normalMapTangentSpace&&o.enable(6),P.clearcoat&&o.enable(7),P.iridescence&&o.enable(8),P.alphaTest&&o.enable(9),P.vertexColors&&o.enable(10),P.vertexAlphas&&o.enable(11),P.vertexUv1s&&o.enable(12),P.vertexUv2s&&o.enable(13),P.vertexUv3s&&o.enable(14),P.vertexTangents&&o.enable(15),P.anisotropy&&o.enable(16),P.alphaHash&&o.enable(17),P.batching&&o.enable(18),P.dispersion&&o.enable(19),P.batchingColor&&o.enable(20),P.gradientMap&&o.enable(21),B.push(o.mask),o.disableAll(),P.fog&&o.enable(0),P.useFog&&o.enable(1),P.flatShading&&o.enable(2),P.logarithmicDepthBuffer&&o.enable(3),P.reversedDepthBuffer&&o.enable(4),P.skinning&&o.enable(5),P.morphTargets&&o.enable(6),P.morphNormals&&o.enable(7),P.morphColors&&o.enable(8),P.premultipliedAlpha&&o.enable(9),P.shadowMapEnabled&&o.enable(10),P.doubleSided&&o.enable(11),P.flipSided&&o.enable(12),P.useDepthPacking&&o.enable(13),P.dithering&&o.enable(14),P.transmission&&o.enable(15),P.sheen&&o.enable(16),P.opaque&&o.enable(17),P.pointsUvs&&o.enable(18),P.decodeVideoTexture&&o.enable(19),P.decodeVideoTextureEmissive&&o.enable(20),P.alphaToCoverage&&o.enable(21),B.push(o.mask)}function L(B){const P=_[B.type];let V;if(P){const J=pl[P];V=E2.clone(J.uniforms)}else V=B.uniforms;return V}function w(B,P){let V=p.get(P);return V!==void 0?++V.usedTimes:(V=new k8(r,P,B,s),h.push(V),p.set(P,V)),V}function N(B){if(--B.usedTimes===0){const P=h.indexOf(B);h[P]=h[h.length-1],h.pop(),p.delete(B.cacheKey),B.destroy()}}function O(B){u.remove(B)}function F(){u.dispose()}return{getParameters:E,getProgramCacheKey:T,getUniforms:L,acquireProgram:w,releaseProgram:N,releaseShaderCache:O,programs:h,dispose:F}}function K8(){let r=new WeakMap;function e(a){return r.has(a)}function t(a){let o=r.get(a);return o===void 0&&(o={},r.set(a,o)),o}function n(a){r.delete(a)}function i(a,o,u){r.get(a)[o]=u}function s(){r=new WeakMap}return{has:e,get:t,remove:n,update:i,dispose:s}}function Y8(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function SL(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function AL(){const r=[];let e=0;const t=[],n=[],i=[];function s(){e=0,t.length=0,n.length=0,i.length=0}function a(p,v,y,_,A,E){let T=r[e];return T===void 0?(T={id:p.id,object:p,geometry:v,material:y,groupOrder:_,renderOrder:p.renderOrder,z:A,group:E},r[e]=T):(T.id=p.id,T.object=p,T.geometry=v,T.material=y,T.groupOrder=_,T.renderOrder=p.renderOrder,T.z=A,T.group=E),e++,T}function o(p,v,y,_,A,E){const T=a(p,v,y,_,A,E);y.transmission>0?n.push(T):y.transparent===!0?i.push(T):t.push(T)}function u(p,v,y,_,A,E){const T=a(p,v,y,_,A,E);y.transmission>0?n.unshift(T):y.transparent===!0?i.unshift(T):t.unshift(T)}function c(p,v){t.length>1&&t.sort(p||Y8),n.length>1&&n.sort(v||SL),i.length>1&&i.sort(v||SL)}function h(){for(let p=e,v=r.length;p<v;p++){const y=r[p];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:n,transparent:i,init:s,push:o,unshift:u,finish:h,sort:c}}function X8(){let r=new WeakMap;function e(n,i){const s=r.get(n);let a;return s===void 0?(a=new AL,r.set(n,[a])):i>=s.length?(a=new AL,s.push(a)):a=s[i],a}function t(){r=new WeakMap}return{get:e,dispose:t}}function q8(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new ee,color:new dt};break;case"SpotLight":t={position:new ee,direction:new ee,color:new dt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new ee,color:new dt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new ee,skyColor:new dt,groundColor:new dt};break;case"RectAreaLight":t={color:new dt,position:new ee,halfWidth:new ee,halfHeight:new ee};break}return r[e.id]=t,t}}}function W8(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ve};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ve};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ve,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=t,t}}}let j8=0;function J8(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function Q8(r){const e=new q8,t=W8(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)n.probe.push(new ee);const i=new ee,s=new zt,a=new zt;function o(c){let h=0,p=0,v=0;for(let B=0;B<9;B++)n.probe[B].set(0,0,0);let y=0,_=0,A=0,E=0,T=0,M=0,R=0,L=0,w=0,N=0,O=0;c.sort(J8);for(let B=0,P=c.length;B<P;B++){const V=c[B],J=V.color,Q=V.intensity,ie=V.distance;let ne=null;if(V.shadow&&V.shadow.map&&(V.shadow.map.texture.format===Rd?ne=V.shadow.map.texture:ne=V.shadow.map.depthTexture||V.shadow.map.texture),V.isAmbientLight)h+=J.r*Q,p+=J.g*Q,v+=J.b*Q;else if(V.isLightProbe){for(let k=0;k<9;k++)n.probe[k].addScaledVector(V.sh.coefficients[k],Q);O++}else if(V.isDirectionalLight){const k=e.get(V);if(k.color.copy(V.color).multiplyScalar(V.intensity),V.castShadow){const K=V.shadow,j=t.get(V);j.shadowIntensity=K.intensity,j.shadowBias=K.bias,j.shadowNormalBias=K.normalBias,j.shadowRadius=K.radius,j.shadowMapSize=K.mapSize,n.directionalShadow[y]=j,n.directionalShadowMap[y]=ne,n.directionalShadowMatrix[y]=V.shadow.matrix,M++}n.directional[y]=k,y++}else if(V.isSpotLight){const k=e.get(V);k.position.setFromMatrixPosition(V.matrixWorld),k.color.copy(J).multiplyScalar(Q),k.distance=ie,k.coneCos=Math.cos(V.angle),k.penumbraCos=Math.cos(V.angle*(1-V.penumbra)),k.decay=V.decay,n.spot[A]=k;const K=V.shadow;if(V.map&&(n.spotLightMap[w]=V.map,w++,K.updateMatrices(V),V.castShadow&&N++),n.spotLightMatrix[A]=K.matrix,V.castShadow){const j=t.get(V);j.shadowIntensity=K.intensity,j.shadowBias=K.bias,j.shadowNormalBias=K.normalBias,j.shadowRadius=K.radius,j.shadowMapSize=K.mapSize,n.spotShadow[A]=j,n.spotShadowMap[A]=ne,L++}A++}else if(V.isRectAreaLight){const k=e.get(V);k.color.copy(J).multiplyScalar(Q),k.halfWidth.set(V.width*.5,0,0),k.halfHeight.set(0,V.height*.5,0),n.rectArea[E]=k,E++}else if(V.isPointLight){const k=e.get(V);if(k.color.copy(V.color).multiplyScalar(V.intensity),k.distance=V.distance,k.decay=V.decay,V.castShadow){const K=V.shadow,j=t.get(V);j.shadowIntensity=K.intensity,j.shadowBias=K.bias,j.shadowNormalBias=K.normalBias,j.shadowRadius=K.radius,j.shadowMapSize=K.mapSize,j.shadowCameraNear=K.camera.near,j.shadowCameraFar=K.camera.far,n.pointShadow[_]=j,n.pointShadowMap[_]=ne,n.pointShadowMatrix[_]=V.shadow.matrix,R++}n.point[_]=k,_++}else if(V.isHemisphereLight){const k=e.get(V);k.skyColor.copy(V.color).multiplyScalar(Q),k.groundColor.copy(V.groundColor).multiplyScalar(Q),n.hemi[T]=k,T++}}E>0&&(r.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=gt.LTC_FLOAT_1,n.rectAreaLTC2=gt.LTC_FLOAT_2):(n.rectAreaLTC1=gt.LTC_HALF_1,n.rectAreaLTC2=gt.LTC_HALF_2)),n.ambient[0]=h,n.ambient[1]=p,n.ambient[2]=v;const F=n.hash;(F.directionalLength!==y||F.pointLength!==_||F.spotLength!==A||F.rectAreaLength!==E||F.hemiLength!==T||F.numDirectionalShadows!==M||F.numPointShadows!==R||F.numSpotShadows!==L||F.numSpotMaps!==w||F.numLightProbes!==O)&&(n.directional.length=y,n.spot.length=A,n.rectArea.length=E,n.point.length=_,n.hemi.length=T,n.directionalShadow.length=M,n.directionalShadowMap.length=M,n.pointShadow.length=R,n.pointShadowMap.length=R,n.spotShadow.length=L,n.spotShadowMap.length=L,n.directionalShadowMatrix.length=M,n.pointShadowMatrix.length=R,n.spotLightMatrix.length=L+w-N,n.spotLightMap.length=w,n.numSpotLightShadowsWithMaps=N,n.numLightProbes=O,F.directionalLength=y,F.pointLength=_,F.spotLength=A,F.rectAreaLength=E,F.hemiLength=T,F.numDirectionalShadows=M,F.numPointShadows=R,F.numSpotShadows=L,F.numSpotMaps=w,F.numLightProbes=O,n.version=j8++)}function u(c,h){let p=0,v=0,y=0,_=0,A=0;const E=h.matrixWorldInverse;for(let T=0,M=c.length;T<M;T++){const R=c[T];if(R.isDirectionalLight){const L=n.directional[p];L.direction.setFromMatrixPosition(R.matrixWorld),i.setFromMatrixPosition(R.target.matrixWorld),L.direction.sub(i),L.direction.transformDirection(E),p++}else if(R.isSpotLight){const L=n.spot[y];L.position.setFromMatrixPosition(R.matrixWorld),L.position.applyMatrix4(E),L.direction.setFromMatrixPosition(R.matrixWorld),i.setFromMatrixPosition(R.target.matrixWorld),L.direction.sub(i),L.direction.transformDirection(E),y++}else if(R.isRectAreaLight){const L=n.rectArea[_];L.position.setFromMatrixPosition(R.matrixWorld),L.position.applyMatrix4(E),a.identity(),s.copy(R.matrixWorld),s.premultiply(E),a.extractRotation(s),L.halfWidth.set(R.width*.5,0,0),L.halfHeight.set(0,R.height*.5,0),L.halfWidth.applyMatrix4(a),L.halfHeight.applyMatrix4(a),_++}else if(R.isPointLight){const L=n.point[v];L.position.setFromMatrixPosition(R.matrixWorld),L.position.applyMatrix4(E),v++}else if(R.isHemisphereLight){const L=n.hemi[A];L.direction.setFromMatrixPosition(R.matrixWorld),L.direction.transformDirection(E),A++}}}return{setup:o,setupView:u,state:n}}function EL(r){const e=new Q8(r),t=[],n=[];function i(h){c.camera=h,t.length=0,n.length=0}function s(h){t.push(h)}function a(h){n.push(h)}function o(){e.setup(t)}function u(h){e.setupView(t,h)}const c={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:c,setupLights:o,setupLightsView:u,pushLight:s,pushShadow:a}}function $8(r){let e=new WeakMap;function t(i,s=0){const a=e.get(i);let o;return a===void 0?(o=new EL(r),e.set(i,[o])):s>=a.length?(o=new EL(r),a.push(o)):o=a[s],o}function n(){e=new WeakMap}return{get:t,dispose:n}}const Z8=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,e5=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );
	gl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );
}`,t5=[new ee(1,0,0),new ee(-1,0,0),new ee(0,1,0),new ee(0,-1,0),new ee(0,0,1),new ee(0,0,-1)],n5=[new ee(0,-1,0),new ee(0,-1,0),new ee(0,0,1),new ee(0,0,-1),new ee(0,-1,0),new ee(0,-1,0)],TL=new zt,ev=new ee,jT=new ee;function i5(r,e,t){let n=new cg;const i=new Ve,s=new Ve,a=new ni,o=new PM,u=new NM,c={},h=t.maxTextureSize,p={[du]:ta,[ta]:du,[Lo]:Lo},v=new to({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ve},radius:{value:4}},vertexShader:Z8,fragmentShader:e5}),y=v.clone();y.defines.HORIZONTAL_PASS=1;const _=new en;_.setAttribute("position",new On(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const A=new $i(_,v),E=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Rm;let T=this.type;this.render=function(N,O,F){if(E.enabled===!1||E.autoUpdate===!1&&E.needsUpdate===!1||N.length===0)return;N.type===hv&&(ct("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),N.type=Rm);const B=r.getRenderTarget(),P=r.getActiveCubeFace(),V=r.getActiveMipmapLevel(),J=r.state;J.setBlending(vl),J.buffers.depth.getReversed()===!0?J.buffers.color.setClear(0,0,0,0):J.buffers.color.setClear(1,1,1,1),J.buffers.depth.setTest(!0),J.setScissorTest(!1);const Q=T!==this.type;Q&&O.traverse(function(ie){ie.material&&(Array.isArray(ie.material)?ie.material.forEach(ne=>ne.needsUpdate=!0):ie.material.needsUpdate=!0)});for(let ie=0,ne=N.length;ie<ne;ie++){const k=N[ie],K=k.shadow;if(K===void 0){ct("WebGLShadowMap:",k,"has no shadow.");continue}if(K.autoUpdate===!1&&K.needsUpdate===!1)continue;i.copy(K.mapSize);const j=K.getFrameExtents();if(i.multiply(j),s.copy(K.mapSize),(i.x>h||i.y>h)&&(i.x>h&&(s.x=Math.floor(h/j.x),i.x=s.x*j.x,K.mapSize.x=s.x),i.y>h&&(s.y=Math.floor(h/j.y),i.y=s.y*j.y,K.mapSize.y=s.y)),K.map===null||Q===!0){if(K.map!==null&&(K.map.depthTexture!==null&&(K.map.depthTexture.dispose(),K.map.depthTexture=null),K.map.dispose()),this.type===ud){if(k.isPointLight){ct("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}K.map=new tr(i.x,i.y,{format:Rd,type:Za,minFilter:Gn,magFilter:Gn,generateMipmaps:!1}),K.map.texture.name=k.name+".shadowMap",K.map.depthTexture=new kf(i.x,i.y,Ar),K.map.depthTexture.name=k.name+".shadowMapDepth",K.map.depthTexture.format=_l,K.map.depthTexture.compareFunction=null,K.map.depthTexture.minFilter=Ji,K.map.depthTexture.magFilter=Ji}else{k.isPointLight?(K.map=new xM(i.x),K.map.depthTexture=new D2(i.x,Po)):(K.map=new tr(i.x,i.y),K.map.depthTexture=new kf(i.x,i.y,Po)),K.map.depthTexture.name=k.name+".shadowMap",K.map.depthTexture.format=_l;const oe=r.state.buffers.depth.getReversed();this.type===Rm?(K.map.depthTexture.compareFunction=oe?PA:OA,K.map.depthTexture.minFilter=Gn,K.map.depthTexture.magFilter=Gn):(K.map.depthTexture.compareFunction=null,K.map.depthTexture.minFilter=Ji,K.map.depthTexture.magFilter=Ji)}K.camera.updateProjectionMatrix()}const se=K.map.isWebGLCubeRenderTarget?6:1;for(let oe=0;oe<se;oe++){if(K.map.isWebGLCubeRenderTarget)r.setRenderTarget(K.map,oe),r.clear();else{oe===0&&(r.setRenderTarget(K.map),r.clear());const Y=K.getViewport(oe);a.set(s.x*Y.x,s.y*Y.y,s.x*Y.z,s.y*Y.w),J.viewport(a)}if(k.isPointLight){const Y=K.camera,Z=K.matrix,le=k.distance||Y.far;le!==Y.far&&(Y.far=le,Y.updateProjectionMatrix()),ev.setFromMatrixPosition(k.matrixWorld),Y.position.copy(ev),jT.copy(Y.position),jT.add(t5[oe]),Y.up.copy(n5[oe]),Y.lookAt(jT),Y.updateMatrixWorld(),Z.makeTranslation(-ev.x,-ev.y,-ev.z),TL.multiplyMatrices(Y.projectionMatrix,Y.matrixWorldInverse),K._frustum.setFromProjectionMatrix(TL,Y.coordinateSystem,Y.reversedDepth)}else K.updateMatrices(k);n=K.getFrustum(),L(O,F,K.camera,k,this.type)}K.isPointLightShadow!==!0&&this.type===ud&&M(K,F),K.needsUpdate=!1}T=this.type,E.needsUpdate=!1,r.setRenderTarget(B,P,V)};function M(N,O){const F=e.update(A);v.defines.VSM_SAMPLES!==N.blurSamples&&(v.defines.VSM_SAMPLES=N.blurSamples,y.defines.VSM_SAMPLES=N.blurSamples,v.needsUpdate=!0,y.needsUpdate=!0),N.mapPass===null&&(N.mapPass=new tr(i.x,i.y,{format:Rd,type:Za})),v.uniforms.shadow_pass.value=N.map.depthTexture,v.uniforms.resolution.value=N.mapSize,v.uniforms.radius.value=N.radius,r.setRenderTarget(N.mapPass),r.clear(),r.renderBufferDirect(O,null,F,v,A,null),y.uniforms.shadow_pass.value=N.mapPass.texture,y.uniforms.resolution.value=N.mapSize,y.uniforms.radius.value=N.radius,r.setRenderTarget(N.map),r.clear(),r.renderBufferDirect(O,null,F,y,A,null)}function R(N,O,F,B){let P=null;const V=F.isPointLight===!0?N.customDistanceMaterial:N.customDepthMaterial;if(V!==void 0)P=V;else if(P=F.isPointLight===!0?u:o,r.localClippingEnabled&&O.clipShadows===!0&&Array.isArray(O.clippingPlanes)&&O.clippingPlanes.length!==0||O.displacementMap&&O.displacementScale!==0||O.alphaMap&&O.alphaTest>0||O.map&&O.alphaTest>0||O.alphaToCoverage===!0){const J=P.uuid,Q=O.uuid;let ie=c[J];ie===void 0&&(ie={},c[J]=ie);let ne=ie[Q];ne===void 0&&(ne=P.clone(),ie[Q]=ne,O.addEventListener("dispose",w)),P=ne}if(P.visible=O.visible,P.wireframe=O.wireframe,B===ud?P.side=O.shadowSide!==null?O.shadowSide:O.side:P.side=O.shadowSide!==null?O.shadowSide:p[O.side],P.alphaMap=O.alphaMap,P.alphaTest=O.alphaToCoverage===!0?.5:O.alphaTest,P.map=O.map,P.clipShadows=O.clipShadows,P.clippingPlanes=O.clippingPlanes,P.clipIntersection=O.clipIntersection,P.displacementMap=O.displacementMap,P.displacementScale=O.displacementScale,P.displacementBias=O.displacementBias,P.wireframeLinewidth=O.wireframeLinewidth,P.linewidth=O.linewidth,F.isPointLight===!0&&P.isMeshDistanceMaterial===!0){const J=r.properties.get(P);J.light=F}return P}function L(N,O,F,B,P){if(N.visible===!1)return;if(N.layers.test(O.layers)&&(N.isMesh||N.isLine||N.isPoints)&&(N.castShadow||N.receiveShadow&&P===ud)&&(!N.frustumCulled||n.intersectsObject(N))){N.modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,N.matrixWorld);const Q=e.update(N),ie=N.material;if(Array.isArray(ie)){const ne=Q.groups;for(let k=0,K=ne.length;k<K;k++){const j=ne[k],se=ie[j.materialIndex];if(se&&se.visible){const oe=R(N,se,B,P);N.onBeforeShadow(r,N,O,F,Q,oe,j),r.renderBufferDirect(F,null,Q,oe,N,j),N.onAfterShadow(r,N,O,F,Q,oe,j)}}}else if(ie.visible){const ne=R(N,ie,B,P);N.onBeforeShadow(r,N,O,F,Q,ne,null),r.renderBufferDirect(F,null,Q,ne,N,null),N.onAfterShadow(r,N,O,F,Q,ne,null)}}const J=N.children;for(let Q=0,ie=J.length;Q<ie;Q++)L(J[Q],O,F,B,P)}function w(N){N.target.removeEventListener("dispose",w);for(const F in c){const B=c[F],P=N.target.uuid;P in B&&(B[P].dispose(),delete B[P])}}}const s5={[oS]:lS,[uS]:hS,[cS]:dS,[Md]:fS,[lS]:oS,[hS]:uS,[dS]:cS,[fS]:Md};function r5(r,e){function t(){let he=!1;const lt=new ni;let Ze=null;const pt=new ni(0,0,0,0);return{setMask:function(qe){Ze!==qe&&!he&&(r.colorMask(qe,qe,qe,qe),Ze=qe)},setLocked:function(qe){he=qe},setClear:function(qe,ze,st,Yt,Cn){Cn===!0&&(qe*=Yt,ze*=Yt,st*=Yt),lt.set(qe,ze,st,Yt),pt.equals(lt)===!1&&(r.clearColor(qe,ze,st,Yt),pt.copy(lt))},reset:function(){he=!1,Ze=null,pt.set(-1,0,0,0)}}}function n(){let he=!1,lt=!1,Ze=null,pt=null,qe=null;return{setReversed:function(ze){if(lt!==ze){const st=e.get("EXT_clip_control");ze?st.clipControlEXT(st.LOWER_LEFT_EXT,st.ZERO_TO_ONE_EXT):st.clipControlEXT(st.LOWER_LEFT_EXT,st.NEGATIVE_ONE_TO_ONE_EXT),lt=ze;const Yt=qe;qe=null,this.setClear(Yt)}},getReversed:function(){return lt},setTest:function(ze){ze?Me(r.DEPTH_TEST):Xe(r.DEPTH_TEST)},setMask:function(ze){Ze!==ze&&!he&&(r.depthMask(ze),Ze=ze)},setFunc:function(ze){if(lt&&(ze=s5[ze]),pt!==ze){switch(ze){case oS:r.depthFunc(r.NEVER);break;case lS:r.depthFunc(r.ALWAYS);break;case uS:r.depthFunc(r.LESS);break;case Md:r.depthFunc(r.LEQUAL);break;case cS:r.depthFunc(r.EQUAL);break;case fS:r.depthFunc(r.GEQUAL);break;case hS:r.depthFunc(r.GREATER);break;case dS:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}pt=ze}},setLocked:function(ze){he=ze},setClear:function(ze){qe!==ze&&(lt&&(ze=1-ze),r.clearDepth(ze),qe=ze)},reset:function(){he=!1,Ze=null,pt=null,qe=null,lt=!1}}}function i(){let he=!1,lt=null,Ze=null,pt=null,qe=null,ze=null,st=null,Yt=null,Cn=null;return{setTest:function(gn){he||(gn?Me(r.STENCIL_TEST):Xe(r.STENCIL_TEST))},setMask:function(gn){lt!==gn&&!he&&(r.stencilMask(gn),lt=gn)},setFunc:function(gn,vs,na){(Ze!==gn||pt!==vs||qe!==na)&&(r.stencilFunc(gn,vs,na),Ze=gn,pt=vs,qe=na)},setOp:function(gn,vs,na){(ze!==gn||st!==vs||Yt!==na)&&(r.stencilOp(gn,vs,na),ze=gn,st=vs,Yt=na)},setLocked:function(gn){he=gn},setClear:function(gn){Cn!==gn&&(r.clearStencil(gn),Cn=gn)},reset:function(){he=!1,lt=null,Ze=null,pt=null,qe=null,ze=null,st=null,Yt=null,Cn=null}}}const s=new t,a=new n,o=new i,u=new WeakMap,c=new WeakMap;let h={},p={},v=new WeakMap,y=[],_=null,A=!1,E=null,T=null,M=null,R=null,L=null,w=null,N=null,O=new dt(0,0,0),F=0,B=!1,P=null,V=null,J=null,Q=null,ie=null;const ne=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let k=!1,K=0;const j=r.getParameter(r.VERSION);j.indexOf("WebGL")!==-1?(K=parseFloat(/^WebGL (\d)/.exec(j)[1]),k=K>=1):j.indexOf("OpenGL ES")!==-1&&(K=parseFloat(/^OpenGL ES (\d)/.exec(j)[1]),k=K>=2);let se=null,oe={};const Y=r.getParameter(r.SCISSOR_BOX),Z=r.getParameter(r.VIEWPORT),le=new ni().fromArray(Y),pe=new ni().fromArray(Z);function Te(he,lt,Ze,pt){const qe=new Uint8Array(4),ze=r.createTexture();r.bindTexture(he,ze),r.texParameteri(he,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(he,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let st=0;st<Ze;st++)he===r.TEXTURE_3D||he===r.TEXTURE_2D_ARRAY?r.texImage3D(lt,0,r.RGBA,1,1,pt,0,r.RGBA,r.UNSIGNED_BYTE,qe):r.texImage2D(lt+st,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,qe);return ze}const ce={};ce[r.TEXTURE_2D]=Te(r.TEXTURE_2D,r.TEXTURE_2D,1),ce[r.TEXTURE_CUBE_MAP]=Te(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),ce[r.TEXTURE_2D_ARRAY]=Te(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),ce[r.TEXTURE_3D]=Te(r.TEXTURE_3D,r.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),Me(r.DEPTH_TEST),a.setFunc(Md),Ie(!1),je($b),Me(r.CULL_FACE),Ne(vl);function Me(he){h[he]!==!0&&(r.enable(he),h[he]=!0)}function Xe(he){h[he]!==!1&&(r.disable(he),h[he]=!1)}function nt(he,lt){return p[he]!==lt?(r.bindFramebuffer(he,lt),p[he]=lt,he===r.DRAW_FRAMEBUFFER&&(p[r.FRAMEBUFFER]=lt),he===r.FRAMEBUFFER&&(p[r.DRAW_FRAMEBUFFER]=lt),!0):!1}function at(he,lt){let Ze=y,pt=!1;if(he){Ze=v.get(lt),Ze===void 0&&(Ze=[],v.set(lt,Ze));const qe=he.textures;if(Ze.length!==qe.length||Ze[0]!==r.COLOR_ATTACHMENT0){for(let ze=0,st=qe.length;ze<st;ze++)Ze[ze]=r.COLOR_ATTACHMENT0+ze;Ze.length=qe.length,pt=!0}}else Ze[0]!==r.BACK&&(Ze[0]=r.BACK,pt=!0);pt&&r.drawBuffers(Ze)}function Vt(he){return _!==he?(r.useProgram(he),_=he,!0):!1}const dn={[Tf]:r.FUNC_ADD,[kw]:r.FUNC_SUBTRACT,[Gw]:r.FUNC_REVERSE_SUBTRACT};dn[Hw]=r.MIN,dn[zw]=r.MAX;const Ut={[Vw]:r.ZERO,[Kw]:r.ONE,[Yw]:r.SRC_COLOR,[rS]:r.SRC_ALPHA,[Qw]:r.SRC_ALPHA_SATURATE,[jw]:r.DST_COLOR,[qw]:r.DST_ALPHA,[Xw]:r.ONE_MINUS_SRC_COLOR,[aS]:r.ONE_MINUS_SRC_ALPHA,[Jw]:r.ONE_MINUS_DST_COLOR,[Ww]:r.ONE_MINUS_DST_ALPHA,[$w]:r.CONSTANT_COLOR,[Zw]:r.ONE_MINUS_CONSTANT_COLOR,[e2]:r.CONSTANT_ALPHA,[t2]:r.ONE_MINUS_CONSTANT_ALPHA};function Ne(he,lt,Ze,pt,qe,ze,st,Yt,Cn,gn){if(he===vl){A===!0&&(Xe(r.BLEND),A=!1);return}if(A===!1&&(Me(r.BLEND),A=!0),he!==Fw){if(he!==E||gn!==B){if((T!==Tf||L!==Tf)&&(r.blendEquation(r.FUNC_ADD),T=Tf,L=Tf),gn)switch(he){case vd:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case Zb:r.blendFunc(r.ONE,r.ONE);break;case e1:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case t1:r.blendFuncSeparate(r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ZERO,r.ONE);break;default:Nt("WebGLState: Invalid blending: ",he);break}else switch(he){case vd:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case Zb:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE,r.ONE,r.ONE);break;case e1:Nt("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case t1:Nt("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Nt("WebGLState: Invalid blending: ",he);break}M=null,R=null,w=null,N=null,O.set(0,0,0),F=0,E=he,B=gn}return}qe=qe||lt,ze=ze||Ze,st=st||pt,(lt!==T||qe!==L)&&(r.blendEquationSeparate(dn[lt],dn[qe]),T=lt,L=qe),(Ze!==M||pt!==R||ze!==w||st!==N)&&(r.blendFuncSeparate(Ut[Ze],Ut[pt],Ut[ze],Ut[st]),M=Ze,R=pt,w=ze,N=st),(Yt.equals(O)===!1||Cn!==F)&&(r.blendColor(Yt.r,Yt.g,Yt.b,Cn),O.copy(Yt),F=Cn),E=he,B=!1}function We(he,lt){he.side===Lo?Xe(r.CULL_FACE):Me(r.CULL_FACE);let Ze=he.side===ta;lt&&(Ze=!Ze),Ie(Ze),he.blending===vd&&he.transparent===!1?Ne(vl):Ne(he.blending,he.blendEquation,he.blendSrc,he.blendDst,he.blendEquationAlpha,he.blendSrcAlpha,he.blendDstAlpha,he.blendColor,he.blendAlpha,he.premultipliedAlpha),a.setFunc(he.depthFunc),a.setTest(he.depthTest),a.setMask(he.depthWrite),s.setMask(he.colorWrite);const pt=he.stencilWrite;o.setTest(pt),pt&&(o.setMask(he.stencilWriteMask),o.setFunc(he.stencilFunc,he.stencilRef,he.stencilFuncMask),o.setOp(he.stencilFail,he.stencilZFail,he.stencilZPass)),St(he.polygonOffset,he.polygonOffsetFactor,he.polygonOffsetUnits),he.alphaToCoverage===!0?Me(r.SAMPLE_ALPHA_TO_COVERAGE):Xe(r.SAMPLE_ALPHA_TO_COVERAGE)}function Ie(he){P!==he&&(he?r.frontFace(r.CW):r.frontFace(r.CCW),P=he)}function je(he){he!==Pw?(Me(r.CULL_FACE),he!==V&&(he===$b?r.cullFace(r.BACK):he===Nw?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):Xe(r.CULL_FACE),V=he}function te(he){he!==J&&(k&&r.lineWidth(he),J=he)}function St(he,lt,Ze){he?(Me(r.POLYGON_OFFSET_FILL),(Q!==lt||ie!==Ze)&&(r.polygonOffset(lt,Ze),Q=lt,ie=Ze)):Xe(r.POLYGON_OFFSET_FILL)}function $e(he){he?Me(r.SCISSOR_TEST):Xe(r.SCISSOR_TEST)}function At(he){he===void 0&&(he=r.TEXTURE0+ne-1),se!==he&&(r.activeTexture(he),se=he)}function et(he,lt,Ze){Ze===void 0&&(se===null?Ze=r.TEXTURE0+ne-1:Ze=se);let pt=oe[Ze];pt===void 0&&(pt={type:void 0,texture:void 0},oe[Ze]=pt),(pt.type!==he||pt.texture!==lt)&&(se!==Ze&&(r.activeTexture(Ze),se=Ze),r.bindTexture(he,lt||ce[he]),pt.type=he,pt.texture=lt)}function $(){const he=oe[se];he!==void 0&&he.type!==void 0&&(r.bindTexture(he.type,null),he.type=void 0,he.texture=void 0)}function z(){try{r.compressedTexImage2D(...arguments)}catch(he){Nt("WebGLState:",he)}}function fe(){try{r.compressedTexImage3D(...arguments)}catch(he){Nt("WebGLState:",he)}}function we(){try{r.texSubImage2D(...arguments)}catch(he){Nt("WebGLState:",he)}}function He(){try{r.texSubImage3D(...arguments)}catch(he){Nt("WebGLState:",he)}}function Oe(){try{r.compressedTexSubImage2D(...arguments)}catch(he){Nt("WebGLState:",he)}}function Et(){try{r.compressedTexSubImage3D(...arguments)}catch(he){Nt("WebGLState:",he)}}function it(){try{r.texStorage2D(...arguments)}catch(he){Nt("WebGLState:",he)}}function vt(){try{r.texStorage3D(...arguments)}catch(he){Nt("WebGLState:",he)}}function Ft(){try{r.texImage2D(...arguments)}catch(he){Nt("WebGLState:",he)}}function Ye(){try{r.texImage3D(...arguments)}catch(he){Nt("WebGLState:",he)}}function Je(he){le.equals(he)===!1&&(r.scissor(he.x,he.y,he.z,he.w),le.copy(he))}function ft(he){pe.equals(he)===!1&&(r.viewport(he.x,he.y,he.z,he.w),pe.copy(he))}function ht(he,lt){let Ze=c.get(lt);Ze===void 0&&(Ze=new WeakMap,c.set(lt,Ze));let pt=Ze.get(he);pt===void 0&&(pt=r.getUniformBlockIndex(lt,he.name),Ze.set(he,pt))}function rt(he,lt){const pt=c.get(lt).get(he);u.get(lt)!==pt&&(r.uniformBlockBinding(lt,pt,he.__bindingPointIndex),u.set(lt,pt))}function Qt(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),a.setReversed(!1),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),h={},se=null,oe={},p={},v=new WeakMap,y=[],_=null,A=!1,E=null,T=null,M=null,R=null,L=null,w=null,N=null,O=new dt(0,0,0),F=0,B=!1,P=null,V=null,J=null,Q=null,ie=null,le.set(0,0,r.canvas.width,r.canvas.height),pe.set(0,0,r.canvas.width,r.canvas.height),s.reset(),a.reset(),o.reset()}return{buffers:{color:s,depth:a,stencil:o},enable:Me,disable:Xe,bindFramebuffer:nt,drawBuffers:at,useProgram:Vt,setBlending:Ne,setMaterial:We,setFlipSided:Ie,setCullFace:je,setLineWidth:te,setPolygonOffset:St,setScissorTest:$e,activeTexture:At,bindTexture:et,unbindTexture:$,compressedTexImage2D:z,compressedTexImage3D:fe,texImage2D:Ft,texImage3D:Ye,updateUBOMapping:ht,uniformBlockBinding:rt,texStorage2D:it,texStorage3D:vt,texSubImage2D:we,texSubImage3D:He,compressedTexSubImage2D:Oe,compressedTexSubImage3D:Et,scissor:Je,viewport:ft,reset:Qt}}function a5(r,e,t,n,i,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,u=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new Ve,h=new WeakMap;let p;const v=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function _($,z){return y?new OffscreenCanvas($,z):Bv("canvas")}function A($,z,fe){let we=1;const He=et($);if((He.width>fe||He.height>fe)&&(we=fe/Math.max(He.width,He.height)),we<1)if(typeof HTMLImageElement<"u"&&$ instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&$ instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&$ instanceof ImageBitmap||typeof VideoFrame<"u"&&$ instanceof VideoFrame){const Oe=Math.floor(we*He.width),Et=Math.floor(we*He.height);p===void 0&&(p=_(Oe,Et));const it=z?_(Oe,Et):p;return it.width=Oe,it.height=Et,it.getContext("2d").drawImage($,0,0,Oe,Et),ct("WebGLRenderer: Texture has been resized from ("+He.width+"x"+He.height+") to ("+Oe+"x"+Et+")."),it}else return"data"in $&&ct("WebGLRenderer: Image in DataTexture is too big ("+He.width+"x"+He.height+")."),$;return $}function E($){return $.generateMipmaps}function T($){r.generateMipmap($)}function M($){return $.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:$.isWebGL3DRenderTarget?r.TEXTURE_3D:$.isWebGLArrayRenderTarget||$.isCompressedArrayTexture?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D}function R($,z,fe,we,He=!1){if($!==null){if(r[$]!==void 0)return r[$];ct("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+$+"'")}let Oe=z;if(z===r.RED&&(fe===r.FLOAT&&(Oe=r.R32F),fe===r.HALF_FLOAT&&(Oe=r.R16F),fe===r.UNSIGNED_BYTE&&(Oe=r.R8)),z===r.RED_INTEGER&&(fe===r.UNSIGNED_BYTE&&(Oe=r.R8UI),fe===r.UNSIGNED_SHORT&&(Oe=r.R16UI),fe===r.UNSIGNED_INT&&(Oe=r.R32UI),fe===r.BYTE&&(Oe=r.R8I),fe===r.SHORT&&(Oe=r.R16I),fe===r.INT&&(Oe=r.R32I)),z===r.RG&&(fe===r.FLOAT&&(Oe=r.RG32F),fe===r.HALF_FLOAT&&(Oe=r.RG16F),fe===r.UNSIGNED_BYTE&&(Oe=r.RG8)),z===r.RG_INTEGER&&(fe===r.UNSIGNED_BYTE&&(Oe=r.RG8UI),fe===r.UNSIGNED_SHORT&&(Oe=r.RG16UI),fe===r.UNSIGNED_INT&&(Oe=r.RG32UI),fe===r.BYTE&&(Oe=r.RG8I),fe===r.SHORT&&(Oe=r.RG16I),fe===r.INT&&(Oe=r.RG32I)),z===r.RGB_INTEGER&&(fe===r.UNSIGNED_BYTE&&(Oe=r.RGB8UI),fe===r.UNSIGNED_SHORT&&(Oe=r.RGB16UI),fe===r.UNSIGNED_INT&&(Oe=r.RGB32UI),fe===r.BYTE&&(Oe=r.RGB8I),fe===r.SHORT&&(Oe=r.RGB16I),fe===r.INT&&(Oe=r.RGB32I)),z===r.RGBA_INTEGER&&(fe===r.UNSIGNED_BYTE&&(Oe=r.RGBA8UI),fe===r.UNSIGNED_SHORT&&(Oe=r.RGBA16UI),fe===r.UNSIGNED_INT&&(Oe=r.RGBA32UI),fe===r.BYTE&&(Oe=r.RGBA8I),fe===r.SHORT&&(Oe=r.RGBA16I),fe===r.INT&&(Oe=r.RGBA32I)),z===r.RGB&&(fe===r.UNSIGNED_INT_5_9_9_9_REV&&(Oe=r.RGB9_E5),fe===r.UNSIGNED_INT_10F_11F_11F_REV&&(Oe=r.R11F_G11F_B10F)),z===r.RGBA){const Et=He?Iv:Mn.getTransfer(we);fe===r.FLOAT&&(Oe=r.RGBA32F),fe===r.HALF_FLOAT&&(Oe=r.RGBA16F),fe===r.UNSIGNED_BYTE&&(Oe=Et===Qn?r.SRGB8_ALPHA8:r.RGBA8),fe===r.UNSIGNED_SHORT_4_4_4_4&&(Oe=r.RGBA4),fe===r.UNSIGNED_SHORT_5_5_5_1&&(Oe=r.RGB5_A1)}return(Oe===r.R16F||Oe===r.R32F||Oe===r.RG16F||Oe===r.RG32F||Oe===r.RGBA16F||Oe===r.RGBA32F)&&e.get("EXT_color_buffer_float"),Oe}function L($,z){let fe;return $?z===null||z===Po||z===Gm?fe=r.DEPTH24_STENCIL8:z===Ar?fe=r.DEPTH32F_STENCIL8:z===Cd&&(fe=r.DEPTH24_STENCIL8,ct("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):z===null||z===Po||z===Gm?fe=r.DEPTH_COMPONENT24:z===Ar?fe=r.DEPTH_COMPONENT32F:z===Cd&&(fe=r.DEPTH_COMPONENT16),fe}function w($,z){return E($)===!0||$.isFramebufferTexture&&$.minFilter!==Ji&&$.minFilter!==Gn?Math.log2(Math.max(z.width,z.height))+1:$.mipmaps!==void 0&&$.mipmaps.length>0?$.mipmaps.length:$.isCompressedTexture&&Array.isArray($.image)?z.mipmaps.length:1}function N($){const z=$.target;z.removeEventListener("dispose",N),F(z),z.isVideoTexture&&h.delete(z)}function O($){const z=$.target;z.removeEventListener("dispose",O),P(z)}function F($){const z=n.get($);if(z.__webglInit===void 0)return;const fe=$.source,we=v.get(fe);if(we){const He=we[z.__cacheKey];He.usedTimes--,He.usedTimes===0&&B($),Object.keys(we).length===0&&v.delete(fe)}n.remove($)}function B($){const z=n.get($);r.deleteTexture(z.__webglTexture);const fe=$.source,we=v.get(fe);delete we[z.__cacheKey],a.memory.textures--}function P($){const z=n.get($);if($.depthTexture&&($.depthTexture.dispose(),n.remove($.depthTexture)),$.isWebGLCubeRenderTarget)for(let we=0;we<6;we++){if(Array.isArray(z.__webglFramebuffer[we]))for(let He=0;He<z.__webglFramebuffer[we].length;He++)r.deleteFramebuffer(z.__webglFramebuffer[we][He]);else r.deleteFramebuffer(z.__webglFramebuffer[we]);z.__webglDepthbuffer&&r.deleteRenderbuffer(z.__webglDepthbuffer[we])}else{if(Array.isArray(z.__webglFramebuffer))for(let we=0;we<z.__webglFramebuffer.length;we++)r.deleteFramebuffer(z.__webglFramebuffer[we]);else r.deleteFramebuffer(z.__webglFramebuffer);if(z.__webglDepthbuffer&&r.deleteRenderbuffer(z.__webglDepthbuffer),z.__webglMultisampledFramebuffer&&r.deleteFramebuffer(z.__webglMultisampledFramebuffer),z.__webglColorRenderbuffer)for(let we=0;we<z.__webglColorRenderbuffer.length;we++)z.__webglColorRenderbuffer[we]&&r.deleteRenderbuffer(z.__webglColorRenderbuffer[we]);z.__webglDepthRenderbuffer&&r.deleteRenderbuffer(z.__webglDepthRenderbuffer)}const fe=$.textures;for(let we=0,He=fe.length;we<He;we++){const Oe=n.get(fe[we]);Oe.__webglTexture&&(r.deleteTexture(Oe.__webglTexture),a.memory.textures--),n.remove(fe[we])}n.remove($)}let V=0;function J(){V=0}function Q(){const $=V;return $>=i.maxTextures&&ct("WebGLTextures: Trying to use "+$+" texture units while this GPU supports only "+i.maxTextures),V+=1,$}function ie($){const z=[];return z.push($.wrapS),z.push($.wrapT),z.push($.wrapR||0),z.push($.magFilter),z.push($.minFilter),z.push($.anisotropy),z.push($.internalFormat),z.push($.format),z.push($.type),z.push($.generateMipmaps),z.push($.premultiplyAlpha),z.push($.flipY),z.push($.unpackAlignment),z.push($.colorSpace),z.join()}function ne($,z){const fe=n.get($);if($.isVideoTexture&&$e($),$.isRenderTargetTexture===!1&&$.isExternalTexture!==!0&&$.version>0&&fe.__version!==$.version){const we=$.image;if(we===null)ct("WebGLRenderer: Texture marked for update but no image data found.");else if(we.complete===!1)ct("WebGLRenderer: Texture marked for update but image is incomplete");else{ce(fe,$,z);return}}else $.isExternalTexture&&(fe.__webglTexture=$.sourceTexture?$.sourceTexture:null);t.bindTexture(r.TEXTURE_2D,fe.__webglTexture,r.TEXTURE0+z)}function k($,z){const fe=n.get($);if($.isRenderTargetTexture===!1&&$.version>0&&fe.__version!==$.version){ce(fe,$,z);return}else $.isExternalTexture&&(fe.__webglTexture=$.sourceTexture?$.sourceTexture:null);t.bindTexture(r.TEXTURE_2D_ARRAY,fe.__webglTexture,r.TEXTURE0+z)}function K($,z){const fe=n.get($);if($.isRenderTargetTexture===!1&&$.version>0&&fe.__version!==$.version){ce(fe,$,z);return}t.bindTexture(r.TEXTURE_3D,fe.__webglTexture,r.TEXTURE0+z)}function j($,z){const fe=n.get($);if($.isCubeDepthTexture!==!0&&$.version>0&&fe.__version!==$.version){Me(fe,$,z);return}t.bindTexture(r.TEXTURE_CUBE_MAP,fe.__webglTexture,r.TEXTURE0+z)}const se={[mu]:r.REPEAT,[Zr]:r.CLAMP_TO_EDGE,[km]:r.MIRRORED_REPEAT},oe={[Ji]:r.NEAREST,[MA]:r.NEAREST_MIPMAP_NEAREST,[cd]:r.NEAREST_MIPMAP_LINEAR,[Gn]:r.LINEAR,[Dm]:r.LINEAR_MIPMAP_NEAREST,[Io]:r.LINEAR_MIPMAP_LINEAR},Y={[f2]:r.NEVER,[g2]:r.ALWAYS,[h2]:r.LESS,[OA]:r.LEQUAL,[d2]:r.EQUAL,[PA]:r.GEQUAL,[p2]:r.GREATER,[m2]:r.NOTEQUAL};function Z($,z){if(z.type===Ar&&e.has("OES_texture_float_linear")===!1&&(z.magFilter===Gn||z.magFilter===Dm||z.magFilter===cd||z.magFilter===Io||z.minFilter===Gn||z.minFilter===Dm||z.minFilter===cd||z.minFilter===Io)&&ct("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),r.texParameteri($,r.TEXTURE_WRAP_S,se[z.wrapS]),r.texParameteri($,r.TEXTURE_WRAP_T,se[z.wrapT]),($===r.TEXTURE_3D||$===r.TEXTURE_2D_ARRAY)&&r.texParameteri($,r.TEXTURE_WRAP_R,se[z.wrapR]),r.texParameteri($,r.TEXTURE_MAG_FILTER,oe[z.magFilter]),r.texParameteri($,r.TEXTURE_MIN_FILTER,oe[z.minFilter]),z.compareFunction&&(r.texParameteri($,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri($,r.TEXTURE_COMPARE_FUNC,Y[z.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(z.magFilter===Ji||z.minFilter!==cd&&z.minFilter!==Io||z.type===Ar&&e.has("OES_texture_float_linear")===!1)return;if(z.anisotropy>1||n.get(z).__currentAnisotropy){const fe=e.get("EXT_texture_filter_anisotropic");r.texParameterf($,fe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(z.anisotropy,i.getMaxAnisotropy())),n.get(z).__currentAnisotropy=z.anisotropy}}}function le($,z){let fe=!1;$.__webglInit===void 0&&($.__webglInit=!0,z.addEventListener("dispose",N));const we=z.source;let He=v.get(we);He===void 0&&(He={},v.set(we,He));const Oe=ie(z);if(Oe!==$.__cacheKey){He[Oe]===void 0&&(He[Oe]={texture:r.createTexture(),usedTimes:0},a.memory.textures++,fe=!0),He[Oe].usedTimes++;const Et=He[$.__cacheKey];Et!==void 0&&(He[$.__cacheKey].usedTimes--,Et.usedTimes===0&&B(z)),$.__cacheKey=Oe,$.__webglTexture=He[Oe].texture}return fe}function pe($,z,fe){return Math.floor(Math.floor($/fe)/z)}function Te($,z,fe,we){const Oe=$.updateRanges;if(Oe.length===0)t.texSubImage2D(r.TEXTURE_2D,0,0,0,z.width,z.height,fe,we,z.data);else{Oe.sort((Ye,Je)=>Ye.start-Je.start);let Et=0;for(let Ye=1;Ye<Oe.length;Ye++){const Je=Oe[Et],ft=Oe[Ye],ht=Je.start+Je.count,rt=pe(ft.start,z.width,4),Qt=pe(Je.start,z.width,4);ft.start<=ht+1&&rt===Qt&&pe(ft.start+ft.count-1,z.width,4)===rt?Je.count=Math.max(Je.count,ft.start+ft.count-Je.start):(++Et,Oe[Et]=ft)}Oe.length=Et+1;const it=r.getParameter(r.UNPACK_ROW_LENGTH),vt=r.getParameter(r.UNPACK_SKIP_PIXELS),Ft=r.getParameter(r.UNPACK_SKIP_ROWS);r.pixelStorei(r.UNPACK_ROW_LENGTH,z.width);for(let Ye=0,Je=Oe.length;Ye<Je;Ye++){const ft=Oe[Ye],ht=Math.floor(ft.start/4),rt=Math.ceil(ft.count/4),Qt=ht%z.width,he=Math.floor(ht/z.width),lt=rt,Ze=1;r.pixelStorei(r.UNPACK_SKIP_PIXELS,Qt),r.pixelStorei(r.UNPACK_SKIP_ROWS,he),t.texSubImage2D(r.TEXTURE_2D,0,Qt,he,lt,Ze,fe,we,z.data)}$.clearUpdateRanges(),r.pixelStorei(r.UNPACK_ROW_LENGTH,it),r.pixelStorei(r.UNPACK_SKIP_PIXELS,vt),r.pixelStorei(r.UNPACK_SKIP_ROWS,Ft)}}function ce($,z,fe){let we=r.TEXTURE_2D;(z.isDataArrayTexture||z.isCompressedArrayTexture)&&(we=r.TEXTURE_2D_ARRAY),z.isData3DTexture&&(we=r.TEXTURE_3D);const He=le($,z),Oe=z.source;t.bindTexture(we,$.__webglTexture,r.TEXTURE0+fe);const Et=n.get(Oe);if(Oe.version!==Et.__version||He===!0){t.activeTexture(r.TEXTURE0+fe);const it=Mn.getPrimaries(Mn.workingColorSpace),vt=z.colorSpace===gc?null:Mn.getPrimaries(z.colorSpace),Ft=z.colorSpace===gc||it===vt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,z.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,z.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ft);let Ye=A(z.image,!1,i.maxTextureSize);Ye=At(z,Ye);const Je=s.convert(z.format,z.colorSpace),ft=s.convert(z.type);let ht=R(z.internalFormat,Je,ft,z.colorSpace,z.isVideoTexture);Z(we,z);let rt;const Qt=z.mipmaps,he=z.isVideoTexture!==!0,lt=Et.__version===void 0||He===!0,Ze=Oe.dataReady,pt=w(z,Ye);if(z.isDepthTexture)ht=L(z.format===Mf,z.type),lt&&(he?t.texStorage2D(r.TEXTURE_2D,1,ht,Ye.width,Ye.height):t.texImage2D(r.TEXTURE_2D,0,ht,Ye.width,Ye.height,0,Je,ft,null));else if(z.isDataTexture)if(Qt.length>0){he&&lt&&t.texStorage2D(r.TEXTURE_2D,pt,ht,Qt[0].width,Qt[0].height);for(let qe=0,ze=Qt.length;qe<ze;qe++)rt=Qt[qe],he?Ze&&t.texSubImage2D(r.TEXTURE_2D,qe,0,0,rt.width,rt.height,Je,ft,rt.data):t.texImage2D(r.TEXTURE_2D,qe,ht,rt.width,rt.height,0,Je,ft,rt.data);z.generateMipmaps=!1}else he?(lt&&t.texStorage2D(r.TEXTURE_2D,pt,ht,Ye.width,Ye.height),Ze&&Te(z,Ye,Je,ft)):t.texImage2D(r.TEXTURE_2D,0,ht,Ye.width,Ye.height,0,Je,ft,Ye.data);else if(z.isCompressedTexture)if(z.isCompressedArrayTexture){he&&lt&&t.texStorage3D(r.TEXTURE_2D_ARRAY,pt,ht,Qt[0].width,Qt[0].height,Ye.depth);for(let qe=0,ze=Qt.length;qe<ze;qe++)if(rt=Qt[qe],z.format!==Er)if(Je!==null)if(he){if(Ze)if(z.layerUpdates.size>0){const st=c1(rt.width,rt.height,z.format,z.type);for(const Yt of z.layerUpdates){const Cn=rt.data.subarray(Yt*st/rt.data.BYTES_PER_ELEMENT,(Yt+1)*st/rt.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,qe,0,0,Yt,rt.width,rt.height,1,Je,Cn)}z.clearLayerUpdates()}else t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,qe,0,0,0,rt.width,rt.height,Ye.depth,Je,rt.data)}else t.compressedTexImage3D(r.TEXTURE_2D_ARRAY,qe,ht,rt.width,rt.height,Ye.depth,0,rt.data,0,0);else ct("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else he?Ze&&t.texSubImage3D(r.TEXTURE_2D_ARRAY,qe,0,0,0,rt.width,rt.height,Ye.depth,Je,ft,rt.data):t.texImage3D(r.TEXTURE_2D_ARRAY,qe,ht,rt.width,rt.height,Ye.depth,0,Je,ft,rt.data)}else{he&&lt&&t.texStorage2D(r.TEXTURE_2D,pt,ht,Qt[0].width,Qt[0].height);for(let qe=0,ze=Qt.length;qe<ze;qe++)rt=Qt[qe],z.format!==Er?Je!==null?he?Ze&&t.compressedTexSubImage2D(r.TEXTURE_2D,qe,0,0,rt.width,rt.height,Je,rt.data):t.compressedTexImage2D(r.TEXTURE_2D,qe,ht,rt.width,rt.height,0,rt.data):ct("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):he?Ze&&t.texSubImage2D(r.TEXTURE_2D,qe,0,0,rt.width,rt.height,Je,ft,rt.data):t.texImage2D(r.TEXTURE_2D,qe,ht,rt.width,rt.height,0,Je,ft,rt.data)}else if(z.isDataArrayTexture)if(he){if(lt&&t.texStorage3D(r.TEXTURE_2D_ARRAY,pt,ht,Ye.width,Ye.height,Ye.depth),Ze)if(z.layerUpdates.size>0){const qe=c1(Ye.width,Ye.height,z.format,z.type);for(const ze of z.layerUpdates){const st=Ye.data.subarray(ze*qe/Ye.data.BYTES_PER_ELEMENT,(ze+1)*qe/Ye.data.BYTES_PER_ELEMENT);t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,ze,Ye.width,Ye.height,1,Je,ft,st)}z.clearLayerUpdates()}else t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,Ye.width,Ye.height,Ye.depth,Je,ft,Ye.data)}else t.texImage3D(r.TEXTURE_2D_ARRAY,0,ht,Ye.width,Ye.height,Ye.depth,0,Je,ft,Ye.data);else if(z.isData3DTexture)he?(lt&&t.texStorage3D(r.TEXTURE_3D,pt,ht,Ye.width,Ye.height,Ye.depth),Ze&&t.texSubImage3D(r.TEXTURE_3D,0,0,0,0,Ye.width,Ye.height,Ye.depth,Je,ft,Ye.data)):t.texImage3D(r.TEXTURE_3D,0,ht,Ye.width,Ye.height,Ye.depth,0,Je,ft,Ye.data);else if(z.isFramebufferTexture){if(lt)if(he)t.texStorage2D(r.TEXTURE_2D,pt,ht,Ye.width,Ye.height);else{let qe=Ye.width,ze=Ye.height;for(let st=0;st<pt;st++)t.texImage2D(r.TEXTURE_2D,st,ht,qe,ze,0,Je,ft,null),qe>>=1,ze>>=1}}else if(Qt.length>0){if(he&&lt){const qe=et(Qt[0]);t.texStorage2D(r.TEXTURE_2D,pt,ht,qe.width,qe.height)}for(let qe=0,ze=Qt.length;qe<ze;qe++)rt=Qt[qe],he?Ze&&t.texSubImage2D(r.TEXTURE_2D,qe,0,0,Je,ft,rt):t.texImage2D(r.TEXTURE_2D,qe,ht,Je,ft,rt);z.generateMipmaps=!1}else if(he){if(lt){const qe=et(Ye);t.texStorage2D(r.TEXTURE_2D,pt,ht,qe.width,qe.height)}Ze&&t.texSubImage2D(r.TEXTURE_2D,0,0,0,Je,ft,Ye)}else t.texImage2D(r.TEXTURE_2D,0,ht,Je,ft,Ye);E(z)&&T(we),Et.__version=Oe.version,z.onUpdate&&z.onUpdate(z)}$.__version=z.version}function Me($,z,fe){if(z.image.length!==6)return;const we=le($,z),He=z.source;t.bindTexture(r.TEXTURE_CUBE_MAP,$.__webglTexture,r.TEXTURE0+fe);const Oe=n.get(He);if(He.version!==Oe.__version||we===!0){t.activeTexture(r.TEXTURE0+fe);const Et=Mn.getPrimaries(Mn.workingColorSpace),it=z.colorSpace===gc?null:Mn.getPrimaries(z.colorSpace),vt=z.colorSpace===gc||Et===it?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,z.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,z.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,vt);const Ft=z.isCompressedTexture||z.image[0].isCompressedTexture,Ye=z.image[0]&&z.image[0].isDataTexture,Je=[];for(let ze=0;ze<6;ze++)!Ft&&!Ye?Je[ze]=A(z.image[ze],!0,i.maxCubemapSize):Je[ze]=Ye?z.image[ze].image:z.image[ze],Je[ze]=At(z,Je[ze]);const ft=Je[0],ht=s.convert(z.format,z.colorSpace),rt=s.convert(z.type),Qt=R(z.internalFormat,ht,rt,z.colorSpace),he=z.isVideoTexture!==!0,lt=Oe.__version===void 0||we===!0,Ze=He.dataReady;let pt=w(z,ft);Z(r.TEXTURE_CUBE_MAP,z);let qe;if(Ft){he&&lt&&t.texStorage2D(r.TEXTURE_CUBE_MAP,pt,Qt,ft.width,ft.height);for(let ze=0;ze<6;ze++){qe=Je[ze].mipmaps;for(let st=0;st<qe.length;st++){const Yt=qe[st];z.format!==Er?ht!==null?he?Ze&&t.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ze,st,0,0,Yt.width,Yt.height,ht,Yt.data):t.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ze,st,Qt,Yt.width,Yt.height,0,Yt.data):ct("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):he?Ze&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ze,st,0,0,Yt.width,Yt.height,ht,rt,Yt.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ze,st,Qt,Yt.width,Yt.height,0,ht,rt,Yt.data)}}}else{if(qe=z.mipmaps,he&&lt){qe.length>0&&pt++;const ze=et(Je[0]);t.texStorage2D(r.TEXTURE_CUBE_MAP,pt,Qt,ze.width,ze.height)}for(let ze=0;ze<6;ze++)if(Ye){he?Ze&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,0,0,Je[ze].width,Je[ze].height,ht,rt,Je[ze].data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,Qt,Je[ze].width,Je[ze].height,0,ht,rt,Je[ze].data);for(let st=0;st<qe.length;st++){const Cn=qe[st].image[ze].image;he?Ze&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ze,st+1,0,0,Cn.width,Cn.height,ht,rt,Cn.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ze,st+1,Qt,Cn.width,Cn.height,0,ht,rt,Cn.data)}}else{he?Ze&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,0,0,ht,rt,Je[ze]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,Qt,ht,rt,Je[ze]);for(let st=0;st<qe.length;st++){const Yt=qe[st];he?Ze&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ze,st+1,0,0,ht,rt,Yt.image[ze]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ze,st+1,Qt,ht,rt,Yt.image[ze])}}}E(z)&&T(r.TEXTURE_CUBE_MAP),Oe.__version=He.version,z.onUpdate&&z.onUpdate(z)}$.__version=z.version}function Xe($,z,fe,we,He,Oe){const Et=s.convert(fe.format,fe.colorSpace),it=s.convert(fe.type),vt=R(fe.internalFormat,Et,it,fe.colorSpace),Ft=n.get(z),Ye=n.get(fe);if(Ye.__renderTarget=z,!Ft.__hasExternalTextures){const Je=Math.max(1,z.width>>Oe),ft=Math.max(1,z.height>>Oe);He===r.TEXTURE_3D||He===r.TEXTURE_2D_ARRAY?t.texImage3D(He,Oe,vt,Je,ft,z.depth,0,Et,it,null):t.texImage2D(He,Oe,vt,Je,ft,0,Et,it,null)}t.bindFramebuffer(r.FRAMEBUFFER,$),St(z)?o.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,we,He,Ye.__webglTexture,0,te(z)):(He===r.TEXTURE_2D||He>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&He<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,we,He,Ye.__webglTexture,Oe),t.bindFramebuffer(r.FRAMEBUFFER,null)}function nt($,z,fe){if(r.bindRenderbuffer(r.RENDERBUFFER,$),z.depthBuffer){const we=z.depthTexture,He=we&&we.isDepthTexture?we.type:null,Oe=L(z.stencilBuffer,He),Et=z.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;St(z)?o.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,te(z),Oe,z.width,z.height):fe?r.renderbufferStorageMultisample(r.RENDERBUFFER,te(z),Oe,z.width,z.height):r.renderbufferStorage(r.RENDERBUFFER,Oe,z.width,z.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,Et,r.RENDERBUFFER,$)}else{const we=z.textures;for(let He=0;He<we.length;He++){const Oe=we[He],Et=s.convert(Oe.format,Oe.colorSpace),it=s.convert(Oe.type),vt=R(Oe.internalFormat,Et,it,Oe.colorSpace);St(z)?o.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,te(z),vt,z.width,z.height):fe?r.renderbufferStorageMultisample(r.RENDERBUFFER,te(z),vt,z.width,z.height):r.renderbufferStorage(r.RENDERBUFFER,vt,z.width,z.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function at($,z,fe){const we=z.isWebGLCubeRenderTarget===!0;if(t.bindFramebuffer(r.FRAMEBUFFER,$),!(z.depthTexture&&z.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const He=n.get(z.depthTexture);if(He.__renderTarget=z,(!He.__webglTexture||z.depthTexture.image.width!==z.width||z.depthTexture.image.height!==z.height)&&(z.depthTexture.image.width=z.width,z.depthTexture.image.height=z.height,z.depthTexture.needsUpdate=!0),we){if(He.__webglInit===void 0&&(He.__webglInit=!0,z.depthTexture.addEventListener("dispose",N)),He.__webglTexture===void 0){He.__webglTexture=r.createTexture(),t.bindTexture(r.TEXTURE_CUBE_MAP,He.__webglTexture),Z(r.TEXTURE_CUBE_MAP,z.depthTexture);const Ft=s.convert(z.depthTexture.format),Ye=s.convert(z.depthTexture.type);let Je;z.depthTexture.format===_l?Je=r.DEPTH_COMPONENT24:z.depthTexture.format===Mf&&(Je=r.DEPTH24_STENCIL8);for(let ft=0;ft<6;ft++)r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ft,0,Je,z.width,z.height,0,Ft,Ye,null)}}else ne(z.depthTexture,0);const Oe=He.__webglTexture,Et=te(z),it=we?r.TEXTURE_CUBE_MAP_POSITIVE_X+fe:r.TEXTURE_2D,vt=z.depthTexture.format===Mf?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;if(z.depthTexture.format===_l)St(z)?o.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,vt,it,Oe,0,Et):r.framebufferTexture2D(r.FRAMEBUFFER,vt,it,Oe,0);else if(z.depthTexture.format===Mf)St(z)?o.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,vt,it,Oe,0,Et):r.framebufferTexture2D(r.FRAMEBUFFER,vt,it,Oe,0);else throw new Error("Unknown depthTexture format")}function Vt($){const z=n.get($),fe=$.isWebGLCubeRenderTarget===!0;if(z.__boundDepthTexture!==$.depthTexture){const we=$.depthTexture;if(z.__depthDisposeCallback&&z.__depthDisposeCallback(),we){const He=()=>{delete z.__boundDepthTexture,delete z.__depthDisposeCallback,we.removeEventListener("dispose",He)};we.addEventListener("dispose",He),z.__depthDisposeCallback=He}z.__boundDepthTexture=we}if($.depthTexture&&!z.__autoAllocateDepthBuffer)if(fe)for(let we=0;we<6;we++)at(z.__webglFramebuffer[we],$,we);else{const we=$.texture.mipmaps;we&&we.length>0?at(z.__webglFramebuffer[0],$,0):at(z.__webglFramebuffer,$,0)}else if(fe){z.__webglDepthbuffer=[];for(let we=0;we<6;we++)if(t.bindFramebuffer(r.FRAMEBUFFER,z.__webglFramebuffer[we]),z.__webglDepthbuffer[we]===void 0)z.__webglDepthbuffer[we]=r.createRenderbuffer(),nt(z.__webglDepthbuffer[we],$,!1);else{const He=$.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Oe=z.__webglDepthbuffer[we];r.bindRenderbuffer(r.RENDERBUFFER,Oe),r.framebufferRenderbuffer(r.FRAMEBUFFER,He,r.RENDERBUFFER,Oe)}}else{const we=$.texture.mipmaps;if(we&&we.length>0?t.bindFramebuffer(r.FRAMEBUFFER,z.__webglFramebuffer[0]):t.bindFramebuffer(r.FRAMEBUFFER,z.__webglFramebuffer),z.__webglDepthbuffer===void 0)z.__webglDepthbuffer=r.createRenderbuffer(),nt(z.__webglDepthbuffer,$,!1);else{const He=$.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Oe=z.__webglDepthbuffer;r.bindRenderbuffer(r.RENDERBUFFER,Oe),r.framebufferRenderbuffer(r.FRAMEBUFFER,He,r.RENDERBUFFER,Oe)}}t.bindFramebuffer(r.FRAMEBUFFER,null)}function dn($,z,fe){const we=n.get($);z!==void 0&&Xe(we.__webglFramebuffer,$,$.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),fe!==void 0&&Vt($)}function Ut($){const z=$.texture,fe=n.get($),we=n.get(z);$.addEventListener("dispose",O);const He=$.textures,Oe=$.isWebGLCubeRenderTarget===!0,Et=He.length>1;if(Et||(we.__webglTexture===void 0&&(we.__webglTexture=r.createTexture()),we.__version=z.version,a.memory.textures++),Oe){fe.__webglFramebuffer=[];for(let it=0;it<6;it++)if(z.mipmaps&&z.mipmaps.length>0){fe.__webglFramebuffer[it]=[];for(let vt=0;vt<z.mipmaps.length;vt++)fe.__webglFramebuffer[it][vt]=r.createFramebuffer()}else fe.__webglFramebuffer[it]=r.createFramebuffer()}else{if(z.mipmaps&&z.mipmaps.length>0){fe.__webglFramebuffer=[];for(let it=0;it<z.mipmaps.length;it++)fe.__webglFramebuffer[it]=r.createFramebuffer()}else fe.__webglFramebuffer=r.createFramebuffer();if(Et)for(let it=0,vt=He.length;it<vt;it++){const Ft=n.get(He[it]);Ft.__webglTexture===void 0&&(Ft.__webglTexture=r.createTexture(),a.memory.textures++)}if($.samples>0&&St($)===!1){fe.__webglMultisampledFramebuffer=r.createFramebuffer(),fe.__webglColorRenderbuffer=[],t.bindFramebuffer(r.FRAMEBUFFER,fe.__webglMultisampledFramebuffer);for(let it=0;it<He.length;it++){const vt=He[it];fe.__webglColorRenderbuffer[it]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,fe.__webglColorRenderbuffer[it]);const Ft=s.convert(vt.format,vt.colorSpace),Ye=s.convert(vt.type),Je=R(vt.internalFormat,Ft,Ye,vt.colorSpace,$.isXRRenderTarget===!0),ft=te($);r.renderbufferStorageMultisample(r.RENDERBUFFER,ft,Je,$.width,$.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+it,r.RENDERBUFFER,fe.__webglColorRenderbuffer[it])}r.bindRenderbuffer(r.RENDERBUFFER,null),$.depthBuffer&&(fe.__webglDepthRenderbuffer=r.createRenderbuffer(),nt(fe.__webglDepthRenderbuffer,$,!0)),t.bindFramebuffer(r.FRAMEBUFFER,null)}}if(Oe){t.bindTexture(r.TEXTURE_CUBE_MAP,we.__webglTexture),Z(r.TEXTURE_CUBE_MAP,z);for(let it=0;it<6;it++)if(z.mipmaps&&z.mipmaps.length>0)for(let vt=0;vt<z.mipmaps.length;vt++)Xe(fe.__webglFramebuffer[it][vt],$,z,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+it,vt);else Xe(fe.__webglFramebuffer[it],$,z,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+it,0);E(z)&&T(r.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Et){for(let it=0,vt=He.length;it<vt;it++){const Ft=He[it],Ye=n.get(Ft);let Je=r.TEXTURE_2D;($.isWebGL3DRenderTarget||$.isWebGLArrayRenderTarget)&&(Je=$.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),t.bindTexture(Je,Ye.__webglTexture),Z(Je,Ft),Xe(fe.__webglFramebuffer,$,Ft,r.COLOR_ATTACHMENT0+it,Je,0),E(Ft)&&T(Je)}t.unbindTexture()}else{let it=r.TEXTURE_2D;if(($.isWebGL3DRenderTarget||$.isWebGLArrayRenderTarget)&&(it=$.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),t.bindTexture(it,we.__webglTexture),Z(it,z),z.mipmaps&&z.mipmaps.length>0)for(let vt=0;vt<z.mipmaps.length;vt++)Xe(fe.__webglFramebuffer[vt],$,z,r.COLOR_ATTACHMENT0,it,vt);else Xe(fe.__webglFramebuffer,$,z,r.COLOR_ATTACHMENT0,it,0);E(z)&&T(it),t.unbindTexture()}$.depthBuffer&&Vt($)}function Ne($){const z=$.textures;for(let fe=0,we=z.length;fe<we;fe++){const He=z[fe];if(E(He)){const Oe=M($),Et=n.get(He).__webglTexture;t.bindTexture(Oe,Et),T(Oe),t.unbindTexture()}}}const We=[],Ie=[];function je($){if($.samples>0){if(St($)===!1){const z=$.textures,fe=$.width,we=$.height;let He=r.COLOR_BUFFER_BIT;const Oe=$.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Et=n.get($),it=z.length>1;if(it)for(let Ft=0;Ft<z.length;Ft++)t.bindFramebuffer(r.FRAMEBUFFER,Et.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+Ft,r.RENDERBUFFER,null),t.bindFramebuffer(r.FRAMEBUFFER,Et.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+Ft,r.TEXTURE_2D,null,0);t.bindFramebuffer(r.READ_FRAMEBUFFER,Et.__webglMultisampledFramebuffer);const vt=$.texture.mipmaps;vt&&vt.length>0?t.bindFramebuffer(r.DRAW_FRAMEBUFFER,Et.__webglFramebuffer[0]):t.bindFramebuffer(r.DRAW_FRAMEBUFFER,Et.__webglFramebuffer);for(let Ft=0;Ft<z.length;Ft++){if($.resolveDepthBuffer&&($.depthBuffer&&(He|=r.DEPTH_BUFFER_BIT),$.stencilBuffer&&$.resolveStencilBuffer&&(He|=r.STENCIL_BUFFER_BIT)),it){r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,Et.__webglColorRenderbuffer[Ft]);const Ye=n.get(z[Ft]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,Ye,0)}r.blitFramebuffer(0,0,fe,we,0,0,fe,we,He,r.NEAREST),u===!0&&(We.length=0,Ie.length=0,We.push(r.COLOR_ATTACHMENT0+Ft),$.depthBuffer&&$.resolveDepthBuffer===!1&&(We.push(Oe),Ie.push(Oe),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,Ie)),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,We))}if(t.bindFramebuffer(r.READ_FRAMEBUFFER,null),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),it)for(let Ft=0;Ft<z.length;Ft++){t.bindFramebuffer(r.FRAMEBUFFER,Et.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+Ft,r.RENDERBUFFER,Et.__webglColorRenderbuffer[Ft]);const Ye=n.get(z[Ft]).__webglTexture;t.bindFramebuffer(r.FRAMEBUFFER,Et.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+Ft,r.TEXTURE_2D,Ye,0)}t.bindFramebuffer(r.DRAW_FRAMEBUFFER,Et.__webglMultisampledFramebuffer)}else if($.depthBuffer&&$.resolveDepthBuffer===!1&&u){const z=$.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[z])}}}function te($){return Math.min(i.maxSamples,$.samples)}function St($){const z=n.get($);return $.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&z.__useRenderToTexture!==!1}function $e($){const z=a.render.frame;h.get($)!==z&&(h.set($,z),$.update())}function At($,z){const fe=$.colorSpace,we=$.format,He=$.type;return $.isCompressedTexture===!0||$.isVideoTexture===!0||fe!==Nf&&fe!==gc&&(Mn.getTransfer(fe)===Qn?(we!==Er||He!==Jr)&&ct("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):Nt("WebGLTextures: Unsupported texture color space:",fe)),z}function et($){return typeof HTMLImageElement<"u"&&$ instanceof HTMLImageElement?(c.width=$.naturalWidth||$.width,c.height=$.naturalHeight||$.height):typeof VideoFrame<"u"&&$ instanceof VideoFrame?(c.width=$.displayWidth,c.height=$.displayHeight):(c.width=$.width,c.height=$.height),c}this.allocateTextureUnit=Q,this.resetTextureUnits=J,this.setTexture2D=ne,this.setTexture2DArray=k,this.setTexture3D=K,this.setTextureCube=j,this.rebindTextures=dn,this.setupRenderTarget=Ut,this.updateRenderTargetMipmap=Ne,this.updateMultisampleRenderTarget=je,this.setupDepthRenderbuffer=Vt,this.setupFrameBufferTexture=Xe,this.useMultisampledRTT=St,this.isReversedDepthBuffer=function(){return t.buffers.depth.getReversed()}}function gB(r,e){function t(n,i=gc){let s;const a=Mn.getTransfer(i);if(n===Jr)return r.UNSIGNED_BYTE;if(n===RA)return r.UNSIGNED_SHORT_4_4_4_4;if(n===DA)return r.UNSIGNED_SHORT_5_5_5_1;if(n===cM)return r.UNSIGNED_INT_5_9_9_9_REV;if(n===fM)return r.UNSIGNED_INT_10F_11F_11F_REV;if(n===lM)return r.BYTE;if(n===uM)return r.SHORT;if(n===Cd)return r.UNSIGNED_SHORT;if(n===CA)return r.INT;if(n===Po)return r.UNSIGNED_INT;if(n===Ar)return r.FLOAT;if(n===Za)return r.HALF_FLOAT;if(n===hM)return r.ALPHA;if(n===dM)return r.RGB;if(n===Er)return r.RGBA;if(n===_l)return r.DEPTH_COMPONENT;if(n===Mf)return r.DEPTH_STENCIL;if(n===LA)return r.RED;if(n===ey)return r.RED_INTEGER;if(n===Rd)return r.RG;if(n===IA)return r.RG_INTEGER;if(n===wA)return r.RGBA_INTEGER;if(n===dv||n===pv||n===mv||n===gv)if(a===Qn)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===dv)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===pv)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===mv)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===gv)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===dv)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===pv)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===mv)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===gv)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===pS||n===mS||n===gS||n===vS)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===pS)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===mS)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===gS)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===vS)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===yS||n===_S||n===xS||n===SS||n===AS||n===ES||n===TS)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(n===yS||n===_S)return a===Qn?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===xS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;if(n===SS)return s.COMPRESSED_R11_EAC;if(n===AS)return s.COMPRESSED_SIGNED_R11_EAC;if(n===ES)return s.COMPRESSED_RG11_EAC;if(n===TS)return s.COMPRESSED_SIGNED_RG11_EAC}else return null;if(n===bS||n===MS||n===CS||n===RS||n===DS||n===LS||n===IS||n===wS||n===BS||n===OS||n===PS||n===NS||n===US||n===FS)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(n===bS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===MS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===CS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===RS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===DS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===LS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===IS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===wS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===BS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===OS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===PS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===NS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===US)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===FS)return a===Qn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===kS||n===GS||n===HS)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(n===kS)return a===Qn?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===GS)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===HS)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===zS||n===VS||n===KS||n===YS)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(n===zS)return s.COMPRESSED_RED_RGTC1_EXT;if(n===VS)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===KS)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===YS)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===Gm?r.UNSIGNED_INT_24_8:r[n]!==void 0?r[n]:null}return{convert:t}}const o5=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,l5=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class u5{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const n=new CM(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new to({vertexShader:o5,fragmentShader:l5,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new $i(new fg(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class c5 extends _u{constructor(e,t){super();const n=this;let i=null,s=1,a=null,o="local-floor",u=1,c=null,h=null,p=null,v=null,y=null,_=null;const A=typeof XRWebGLBinding<"u",E=new u5,T={},M=t.getContextAttributes();let R=null,L=null;const w=[],N=[],O=new Ve;let F=null;const B=new gs;B.viewport=new ni;const P=new gs;P.viewport=new ni;const V=[B,P],J=new aB;let Q=null,ie=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ce){let Me=w[ce];return Me===void 0&&(Me=new Yx,w[ce]=Me),Me.getTargetRaySpace()},this.getControllerGrip=function(ce){let Me=w[ce];return Me===void 0&&(Me=new Yx,w[ce]=Me),Me.getGripSpace()},this.getHand=function(ce){let Me=w[ce];return Me===void 0&&(Me=new Yx,w[ce]=Me),Me.getHandSpace()};function ne(ce){const Me=N.indexOf(ce.inputSource);if(Me===-1)return;const Xe=w[Me];Xe!==void 0&&(Xe.update(ce.inputSource,ce.frame,c||a),Xe.dispatchEvent({type:ce.type,data:ce.inputSource}))}function k(){i.removeEventListener("select",ne),i.removeEventListener("selectstart",ne),i.removeEventListener("selectend",ne),i.removeEventListener("squeeze",ne),i.removeEventListener("squeezestart",ne),i.removeEventListener("squeezeend",ne),i.removeEventListener("end",k),i.removeEventListener("inputsourceschange",K);for(let ce=0;ce<w.length;ce++){const Me=N[ce];Me!==null&&(N[ce]=null,w[ce].disconnect(Me))}Q=null,ie=null,E.reset();for(const ce in T)delete T[ce];e.setRenderTarget(R),y=null,v=null,p=null,i=null,L=null,Te.stop(),n.isPresenting=!1,e.setPixelRatio(F),e.setSize(O.width,O.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ce){s=ce,n.isPresenting===!0&&ct("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ce){o=ce,n.isPresenting===!0&&ct("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(ce){c=ce},this.getBaseLayer=function(){return v!==null?v:y},this.getBinding=function(){return p===null&&A&&(p=new XRWebGLBinding(i,t)),p},this.getFrame=function(){return _},this.getSession=function(){return i},this.setSession=async function(ce){if(i=ce,i!==null){if(R=e.getRenderTarget(),i.addEventListener("select",ne),i.addEventListener("selectstart",ne),i.addEventListener("selectend",ne),i.addEventListener("squeeze",ne),i.addEventListener("squeezestart",ne),i.addEventListener("squeezeend",ne),i.addEventListener("end",k),i.addEventListener("inputsourceschange",K),M.xrCompatible!==!0&&await t.makeXRCompatible(),F=e.getPixelRatio(),e.getSize(O),A&&"createProjectionLayer"in XRWebGLBinding.prototype){let Xe=null,nt=null,at=null;M.depth&&(at=M.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Xe=M.stencil?Mf:_l,nt=M.stencil?Gm:Po);const Vt={colorFormat:t.RGBA8,depthFormat:at,scaleFactor:s};p=this.getBinding(),v=p.createProjectionLayer(Vt),i.updateRenderState({layers:[v]}),e.setPixelRatio(1),e.setSize(v.textureWidth,v.textureHeight,!1),L=new tr(v.textureWidth,v.textureHeight,{format:Er,type:Jr,depthTexture:new kf(v.textureWidth,v.textureHeight,nt,void 0,void 0,void 0,void 0,void 0,void 0,Xe),stencilBuffer:M.stencil,colorSpace:e.outputColorSpace,samples:M.antialias?4:0,resolveDepthBuffer:v.ignoreDepthValues===!1,resolveStencilBuffer:v.ignoreDepthValues===!1})}else{const Xe={antialias:M.antialias,alpha:!0,depth:M.depth,stencil:M.stencil,framebufferScaleFactor:s};y=new XRWebGLLayer(i,t,Xe),i.updateRenderState({baseLayer:y}),e.setPixelRatio(1),e.setSize(y.framebufferWidth,y.framebufferHeight,!1),L=new tr(y.framebufferWidth,y.framebufferHeight,{format:Er,type:Jr,colorSpace:e.outputColorSpace,stencilBuffer:M.stencil,resolveDepthBuffer:y.ignoreDepthValues===!1,resolveStencilBuffer:y.ignoreDepthValues===!1})}L.isXRRenderTarget=!0,this.setFoveation(u),c=null,a=await i.requestReferenceSpace(o),Te.setContext(i),Te.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return E.getDepthTexture()};function K(ce){for(let Me=0;Me<ce.removed.length;Me++){const Xe=ce.removed[Me],nt=N.indexOf(Xe);nt>=0&&(N[nt]=null,w[nt].disconnect(Xe))}for(let Me=0;Me<ce.added.length;Me++){const Xe=ce.added[Me];let nt=N.indexOf(Xe);if(nt===-1){for(let Vt=0;Vt<w.length;Vt++)if(Vt>=N.length){N.push(Xe),nt=Vt;break}else if(N[Vt]===null){N[Vt]=Xe,nt=Vt;break}if(nt===-1)break}const at=w[nt];at&&at.connect(Xe)}}const j=new ee,se=new ee;function oe(ce,Me,Xe){j.setFromMatrixPosition(Me.matrixWorld),se.setFromMatrixPosition(Xe.matrixWorld);const nt=j.distanceTo(se),at=Me.projectionMatrix.elements,Vt=Xe.projectionMatrix.elements,dn=at[14]/(at[10]-1),Ut=at[14]/(at[10]+1),Ne=(at[9]+1)/at[5],We=(at[9]-1)/at[5],Ie=(at[8]-1)/at[0],je=(Vt[8]+1)/Vt[0],te=dn*Ie,St=dn*je,$e=nt/(-Ie+je),At=$e*-Ie;if(Me.matrixWorld.decompose(ce.position,ce.quaternion,ce.scale),ce.translateX(At),ce.translateZ($e),ce.matrixWorld.compose(ce.position,ce.quaternion,ce.scale),ce.matrixWorldInverse.copy(ce.matrixWorld).invert(),at[10]===-1)ce.projectionMatrix.copy(Me.projectionMatrix),ce.projectionMatrixInverse.copy(Me.projectionMatrixInverse);else{const et=dn+$e,$=Ut+$e,z=te-At,fe=St+(nt-At),we=Ne*Ut/$*et,He=We*Ut/$*et;ce.projectionMatrix.makePerspective(z,fe,we,He,et,$),ce.projectionMatrixInverse.copy(ce.projectionMatrix).invert()}}function Y(ce,Me){Me===null?ce.matrixWorld.copy(ce.matrix):ce.matrixWorld.multiplyMatrices(Me.matrixWorld,ce.matrix),ce.matrixWorldInverse.copy(ce.matrixWorld).invert()}this.updateCamera=function(ce){if(i===null)return;let Me=ce.near,Xe=ce.far;E.texture!==null&&(E.depthNear>0&&(Me=E.depthNear),E.depthFar>0&&(Xe=E.depthFar)),J.near=P.near=B.near=Me,J.far=P.far=B.far=Xe,(Q!==J.near||ie!==J.far)&&(i.updateRenderState({depthNear:J.near,depthFar:J.far}),Q=J.near,ie=J.far),J.layers.mask=ce.layers.mask|6,B.layers.mask=J.layers.mask&3,P.layers.mask=J.layers.mask&5;const nt=ce.parent,at=J.cameras;Y(J,nt);for(let Vt=0;Vt<at.length;Vt++)Y(at[Vt],nt);at.length===2?oe(J,B,P):J.projectionMatrix.copy(B.projectionMatrix),Z(ce,J,nt)};function Z(ce,Me,Xe){Xe===null?ce.matrix.copy(Me.matrixWorld):(ce.matrix.copy(Xe.matrixWorld),ce.matrix.invert(),ce.matrix.multiply(Me.matrixWorld)),ce.matrix.decompose(ce.position,ce.quaternion,ce.scale),ce.updateMatrixWorld(!0),ce.projectionMatrix.copy(Me.projectionMatrix),ce.projectionMatrixInverse.copy(Me.projectionMatrixInverse),ce.isPerspectiveCamera&&(ce.fov=Ym*2*Math.atan(1/ce.projectionMatrix.elements[5]),ce.zoom=1)}this.getCamera=function(){return J},this.getFoveation=function(){if(!(v===null&&y===null))return u},this.setFoveation=function(ce){u=ce,v!==null&&(v.fixedFoveation=ce),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=ce)},this.hasDepthSensing=function(){return E.texture!==null},this.getDepthSensingMesh=function(){return E.getMesh(J)},this.getCameraTexture=function(ce){return T[ce]};let le=null;function pe(ce,Me){if(h=Me.getViewerPose(c||a),_=Me,h!==null){const Xe=h.views;y!==null&&(e.setRenderTargetFramebuffer(L,y.framebuffer),e.setRenderTarget(L));let nt=!1;Xe.length!==J.cameras.length&&(J.cameras.length=0,nt=!0);for(let Ut=0;Ut<Xe.length;Ut++){const Ne=Xe[Ut];let We=null;if(y!==null)We=y.getViewport(Ne);else{const je=p.getViewSubImage(v,Ne);We=je.viewport,Ut===0&&(e.setRenderTargetTextures(L,je.colorTexture,je.depthStencilTexture),e.setRenderTarget(L))}let Ie=V[Ut];Ie===void 0&&(Ie=new gs,Ie.layers.enable(Ut),Ie.viewport=new ni,V[Ut]=Ie),Ie.matrix.fromArray(Ne.transform.matrix),Ie.matrix.decompose(Ie.position,Ie.quaternion,Ie.scale),Ie.projectionMatrix.fromArray(Ne.projectionMatrix),Ie.projectionMatrixInverse.copy(Ie.projectionMatrix).invert(),Ie.viewport.set(We.x,We.y,We.width,We.height),Ut===0&&(J.matrix.copy(Ie.matrix),J.matrix.decompose(J.position,J.quaternion,J.scale)),nt===!0&&J.cameras.push(Ie)}const at=i.enabledFeatures;if(at&&at.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&A){p=n.getBinding();const Ut=p.getDepthInformation(Xe[0]);Ut&&Ut.isValid&&Ut.texture&&E.init(Ut,i.renderState)}if(at&&at.includes("camera-access")&&A){e.state.unbindTexture(),p=n.getBinding();for(let Ut=0;Ut<Xe.length;Ut++){const Ne=Xe[Ut].camera;if(Ne){let We=T[Ne];We||(We=new CM,T[Ne]=We);const Ie=p.getCameraImage(Ne);We.sourceTexture=Ie}}}}for(let Xe=0;Xe<w.length;Xe++){const nt=N[Xe],at=w[Xe];nt!==null&&at!==void 0&&at.update(nt,Me,c||a)}le&&le(ce,Me),Me.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Me}),_=null}const Te=new fB;Te.setAnimationLoop(pe),this.setAnimationLoop=function(ce){le=ce},this.dispose=function(){}}}const $h=new eo,f5=new zt;function h5(r,e){function t(E,T){E.matrixAutoUpdate===!0&&E.updateMatrix(),T.value.copy(E.matrix)}function n(E,T){T.color.getRGB(E.fogColor.value,A2(r)),T.isFog?(E.fogNear.value=T.near,E.fogFar.value=T.far):T.isFogExp2&&(E.fogDensity.value=T.density)}function i(E,T,M,R,L){T.isMeshBasicMaterial||T.isMeshLambertMaterial?s(E,T):T.isMeshToonMaterial?(s(E,T),p(E,T)):T.isMeshPhongMaterial?(s(E,T),h(E,T)):T.isMeshStandardMaterial?(s(E,T),v(E,T),T.isMeshPhysicalMaterial&&y(E,T,L)):T.isMeshMatcapMaterial?(s(E,T),_(E,T)):T.isMeshDepthMaterial?s(E,T):T.isMeshDistanceMaterial?(s(E,T),A(E,T)):T.isMeshNormalMaterial?s(E,T):T.isLineBasicMaterial?(a(E,T),T.isLineDashedMaterial&&o(E,T)):T.isPointsMaterial?u(E,T,M,R):T.isSpriteMaterial?c(E,T):T.isShadowMaterial?(E.color.value.copy(T.color),E.opacity.value=T.opacity):T.isShaderMaterial&&(T.uniformsNeedUpdate=!1)}function s(E,T){E.opacity.value=T.opacity,T.color&&E.diffuse.value.copy(T.color),T.emissive&&E.emissive.value.copy(T.emissive).multiplyScalar(T.emissiveIntensity),T.map&&(E.map.value=T.map,t(T.map,E.mapTransform)),T.alphaMap&&(E.alphaMap.value=T.alphaMap,t(T.alphaMap,E.alphaMapTransform)),T.bumpMap&&(E.bumpMap.value=T.bumpMap,t(T.bumpMap,E.bumpMapTransform),E.bumpScale.value=T.bumpScale,T.side===ta&&(E.bumpScale.value*=-1)),T.normalMap&&(E.normalMap.value=T.normalMap,t(T.normalMap,E.normalMapTransform),E.normalScale.value.copy(T.normalScale),T.side===ta&&E.normalScale.value.negate()),T.displacementMap&&(E.displacementMap.value=T.displacementMap,t(T.displacementMap,E.displacementMapTransform),E.displacementScale.value=T.displacementScale,E.displacementBias.value=T.displacementBias),T.emissiveMap&&(E.emissiveMap.value=T.emissiveMap,t(T.emissiveMap,E.emissiveMapTransform)),T.specularMap&&(E.specularMap.value=T.specularMap,t(T.specularMap,E.specularMapTransform)),T.alphaTest>0&&(E.alphaTest.value=T.alphaTest);const M=e.get(T),R=M.envMap,L=M.envMapRotation;R&&(E.envMap.value=R,$h.copy(L),$h.x*=-1,$h.y*=-1,$h.z*=-1,R.isCubeTexture&&R.isRenderTargetTexture===!1&&($h.y*=-1,$h.z*=-1),E.envMapRotation.value.setFromMatrix4(f5.makeRotationFromEuler($h)),E.flipEnvMap.value=R.isCubeTexture&&R.isRenderTargetTexture===!1?-1:1,E.reflectivity.value=T.reflectivity,E.ior.value=T.ior,E.refractionRatio.value=T.refractionRatio),T.lightMap&&(E.lightMap.value=T.lightMap,E.lightMapIntensity.value=T.lightMapIntensity,t(T.lightMap,E.lightMapTransform)),T.aoMap&&(E.aoMap.value=T.aoMap,E.aoMapIntensity.value=T.aoMapIntensity,t(T.aoMap,E.aoMapTransform))}function a(E,T){E.diffuse.value.copy(T.color),E.opacity.value=T.opacity,T.map&&(E.map.value=T.map,t(T.map,E.mapTransform))}function o(E,T){E.dashSize.value=T.dashSize,E.totalSize.value=T.dashSize+T.gapSize,E.scale.value=T.scale}function u(E,T,M,R){E.diffuse.value.copy(T.color),E.opacity.value=T.opacity,E.size.value=T.size*M,E.scale.value=R*.5,T.map&&(E.map.value=T.map,t(T.map,E.uvTransform)),T.alphaMap&&(E.alphaMap.value=T.alphaMap,t(T.alphaMap,E.alphaMapTransform)),T.alphaTest>0&&(E.alphaTest.value=T.alphaTest)}function c(E,T){E.diffuse.value.copy(T.color),E.opacity.value=T.opacity,E.rotation.value=T.rotation,T.map&&(E.map.value=T.map,t(T.map,E.mapTransform)),T.alphaMap&&(E.alphaMap.value=T.alphaMap,t(T.alphaMap,E.alphaMapTransform)),T.alphaTest>0&&(E.alphaTest.value=T.alphaTest)}function h(E,T){E.specular.value.copy(T.specular),E.shininess.value=Math.max(T.shininess,1e-4)}function p(E,T){T.gradientMap&&(E.gradientMap.value=T.gradientMap)}function v(E,T){E.metalness.value=T.metalness,T.metalnessMap&&(E.metalnessMap.value=T.metalnessMap,t(T.metalnessMap,E.metalnessMapTransform)),E.roughness.value=T.roughness,T.roughnessMap&&(E.roughnessMap.value=T.roughnessMap,t(T.roughnessMap,E.roughnessMapTransform)),T.envMap&&(E.envMapIntensity.value=T.envMapIntensity)}function y(E,T,M){E.ior.value=T.ior,T.sheen>0&&(E.sheenColor.value.copy(T.sheenColor).multiplyScalar(T.sheen),E.sheenRoughness.value=T.sheenRoughness,T.sheenColorMap&&(E.sheenColorMap.value=T.sheenColorMap,t(T.sheenColorMap,E.sheenColorMapTransform)),T.sheenRoughnessMap&&(E.sheenRoughnessMap.value=T.sheenRoughnessMap,t(T.sheenRoughnessMap,E.sheenRoughnessMapTransform))),T.clearcoat>0&&(E.clearcoat.value=T.clearcoat,E.clearcoatRoughness.value=T.clearcoatRoughness,T.clearcoatMap&&(E.clearcoatMap.value=T.clearcoatMap,t(T.clearcoatMap,E.clearcoatMapTransform)),T.clearcoatRoughnessMap&&(E.clearcoatRoughnessMap.value=T.clearcoatRoughnessMap,t(T.clearcoatRoughnessMap,E.clearcoatRoughnessMapTransform)),T.clearcoatNormalMap&&(E.clearcoatNormalMap.value=T.clearcoatNormalMap,t(T.clearcoatNormalMap,E.clearcoatNormalMapTransform),E.clearcoatNormalScale.value.copy(T.clearcoatNormalScale),T.side===ta&&E.clearcoatNormalScale.value.negate())),T.dispersion>0&&(E.dispersion.value=T.dispersion),T.iridescence>0&&(E.iridescence.value=T.iridescence,E.iridescenceIOR.value=T.iridescenceIOR,E.iridescenceThicknessMinimum.value=T.iridescenceThicknessRange[0],E.iridescenceThicknessMaximum.value=T.iridescenceThicknessRange[1],T.iridescenceMap&&(E.iridescenceMap.value=T.iridescenceMap,t(T.iridescenceMap,E.iridescenceMapTransform)),T.iridescenceThicknessMap&&(E.iridescenceThicknessMap.value=T.iridescenceThicknessMap,t(T.iridescenceThicknessMap,E.iridescenceThicknessMapTransform))),T.transmission>0&&(E.transmission.value=T.transmission,E.transmissionSamplerMap.value=M.texture,E.transmissionSamplerSize.value.set(M.width,M.height),T.transmissionMap&&(E.transmissionMap.value=T.transmissionMap,t(T.transmissionMap,E.transmissionMapTransform)),E.thickness.value=T.thickness,T.thicknessMap&&(E.thicknessMap.value=T.thicknessMap,t(T.thicknessMap,E.thicknessMapTransform)),E.attenuationDistance.value=T.attenuationDistance,E.attenuationColor.value.copy(T.attenuationColor)),T.anisotropy>0&&(E.anisotropyVector.value.set(T.anisotropy*Math.cos(T.anisotropyRotation),T.anisotropy*Math.sin(T.anisotropyRotation)),T.anisotropyMap&&(E.anisotropyMap.value=T.anisotropyMap,t(T.anisotropyMap,E.anisotropyMapTransform))),E.specularIntensity.value=T.specularIntensity,E.specularColor.value.copy(T.specularColor),T.specularColorMap&&(E.specularColorMap.value=T.specularColorMap,t(T.specularColorMap,E.specularColorMapTransform)),T.specularIntensityMap&&(E.specularIntensityMap.value=T.specularIntensityMap,t(T.specularIntensityMap,E.specularIntensityMapTransform))}function _(E,T){T.matcap&&(E.matcap.value=T.matcap)}function A(E,T){const M=e.get(T).light;E.referencePosition.value.setFromMatrixPosition(M.matrixWorld),E.nearDistance.value=M.shadow.camera.near,E.farDistance.value=M.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function d5(r,e,t,n){let i={},s={},a=[];const o=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS);function u(M,R){const L=R.program;n.uniformBlockBinding(M,L)}function c(M,R){let L=i[M.id];L===void 0&&(_(M),L=h(M),i[M.id]=L,M.addEventListener("dispose",E));const w=R.program;n.updateUBOMapping(M,w);const N=e.render.frame;s[M.id]!==N&&(v(M),s[M.id]=N)}function h(M){const R=p();M.__bindingPointIndex=R;const L=r.createBuffer(),w=M.__size,N=M.usage;return r.bindBuffer(r.UNIFORM_BUFFER,L),r.bufferData(r.UNIFORM_BUFFER,w,N),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,R,L),L}function p(){for(let M=0;M<o;M++)if(a.indexOf(M)===-1)return a.push(M),M;return Nt("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function v(M){const R=i[M.id],L=M.uniforms,w=M.__cache;r.bindBuffer(r.UNIFORM_BUFFER,R);for(let N=0,O=L.length;N<O;N++){const F=Array.isArray(L[N])?L[N]:[L[N]];for(let B=0,P=F.length;B<P;B++){const V=F[B];if(y(V,N,B,w)===!0){const J=V.__offset,Q=Array.isArray(V.value)?V.value:[V.value];let ie=0;for(let ne=0;ne<Q.length;ne++){const k=Q[ne],K=A(k);typeof k=="number"||typeof k=="boolean"?(V.__data[0]=k,r.bufferSubData(r.UNIFORM_BUFFER,J+ie,V.__data)):k.isMatrix3?(V.__data[0]=k.elements[0],V.__data[1]=k.elements[1],V.__data[2]=k.elements[2],V.__data[3]=0,V.__data[4]=k.elements[3],V.__data[5]=k.elements[4],V.__data[6]=k.elements[5],V.__data[7]=0,V.__data[8]=k.elements[6],V.__data[9]=k.elements[7],V.__data[10]=k.elements[8],V.__data[11]=0):(k.toArray(V.__data,ie),ie+=K.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,J,V.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function y(M,R,L,w){const N=M.value,O=R+"_"+L;if(w[O]===void 0)return typeof N=="number"||typeof N=="boolean"?w[O]=N:w[O]=N.clone(),!0;{const F=w[O];if(typeof N=="number"||typeof N=="boolean"){if(F!==N)return w[O]=N,!0}else if(F.equals(N)===!1)return F.copy(N),!0}return!1}function _(M){const R=M.uniforms;let L=0;const w=16;for(let O=0,F=R.length;O<F;O++){const B=Array.isArray(R[O])?R[O]:[R[O]];for(let P=0,V=B.length;P<V;P++){const J=B[P],Q=Array.isArray(J.value)?J.value:[J.value];for(let ie=0,ne=Q.length;ie<ne;ie++){const k=Q[ie],K=A(k),j=L%w,se=j%K.boundary,oe=j+se;L+=se,oe!==0&&w-oe<K.storage&&(L+=w-oe),J.__data=new Float32Array(K.storage/Float32Array.BYTES_PER_ELEMENT),J.__offset=L,L+=K.storage}}}const N=L%w;return N>0&&(L+=w-N),M.__size=L,M.__cache={},this}function A(M){const R={boundary:0,storage:0};return typeof M=="number"||typeof M=="boolean"?(R.boundary=4,R.storage=4):M.isVector2?(R.boundary=8,R.storage=8):M.isVector3||M.isColor?(R.boundary=16,R.storage=12):M.isVector4?(R.boundary=16,R.storage=16):M.isMatrix3?(R.boundary=48,R.storage=48):M.isMatrix4?(R.boundary=64,R.storage=64):M.isTexture?ct("WebGLRenderer: Texture samplers can not be part of an uniforms group."):ct("WebGLRenderer: Unsupported uniform value type.",M),R}function E(M){const R=M.target;R.removeEventListener("dispose",E);const L=a.indexOf(R.__bindingPointIndex);a.splice(L,1),r.deleteBuffer(i[R.id]),delete i[R.id],delete s[R.id]}function T(){for(const M in i)r.deleteBuffer(i[M]);a=[],i={},s={}}return{bind:u,update:c,dispose:T}}const p5=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let iu=null;function m5(){return iu===null&&(iu=new yl(p5,16,16,Rd,Za),iu.name="DFG_LUT",iu.minFilter=Gn,iu.magFilter=Gn,iu.wrapS=Zr,iu.wrapT=Zr,iu.generateMipmaps=!1,iu.needsUpdate=!0),iu}class vB{constructor(e={}){const{canvas:t=_2(),context:n=null,depth:i=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:u=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:p=!1,reversedDepthBuffer:v=!1,outputBufferType:y=Jr}=e;this.isWebGLRenderer=!0;let _;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");_=n.getContextAttributes().alpha}else _=a;const A=y,E=new Set([wA,IA,ey]),T=new Set([Jr,Po,Cd,Gm,RA,DA]),M=new Uint32Array(4),R=new Int32Array(4);let L=null,w=null;const N=[],O=[];let F=null;this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Oo,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const B=this;let P=!1;this._outputColorSpace=xr;let V=0,J=0,Q=null,ie=-1,ne=null;const k=new ni,K=new ni;let j=null;const se=new dt(0);let oe=0,Y=t.width,Z=t.height,le=1,pe=null,Te=null;const ce=new ni(0,0,Y,Z),Me=new ni(0,0,Y,Z);let Xe=!1;const nt=new cg;let at=!1,Vt=!1;const dn=new zt,Ut=new ee,Ne=new ni,We={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ie=!1;function je(){return Q===null?le:1}let te=n;function St(X,de){return t.getContext(X,de)}try{const X={alpha:!0,depth:i,stencil:s,antialias:o,premultipliedAlpha:u,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:p};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${og}`),t.addEventListener("webglcontextlost",Yt,!1),t.addEventListener("webglcontextrestored",Cn,!1),t.addEventListener("webglcontextcreationerror",gn,!1),te===null){const de="webgl2";if(te=St(de,X),te===null)throw St(de)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(X){throw Nt("WebGLRenderer: "+X.message),X}let $e,At,et,$,z,fe,we,He,Oe,Et,it,vt,Ft,Ye,Je,ft,ht,rt,Qt,he,lt,Ze,pt,qe;function ze(){$e=new gz(te),$e.init(),Ze=new gB(te,$e),At=new oz(te,$e,e,Ze),et=new r5(te,$e),At.reversedDepthBuffer&&v&&et.buffers.depth.setReversed(!0),$=new _z(te),z=new K8,fe=new a5(te,$e,et,z,At,Ze,$),we=new uz(B),He=new mz(B),Oe=new EG(te),pt=new rz(te,Oe),Et=new vz(te,Oe,$,pt),it=new Sz(te,Et,Oe,$),Qt=new xz(te,At,fe),ft=new lz(z),vt=new V8(B,we,He,$e,At,pt,ft),Ft=new h5(B,z),Ye=new X8,Je=new $8($e),rt=new sz(B,we,He,et,it,_,u),ht=new i5(B,it,At),qe=new d5(te,$,At,et),he=new az(te,$e,$),lt=new yz(te,$e,$),$.programs=vt.programs,B.capabilities=At,B.extensions=$e,B.properties=z,B.renderLists=Ye,B.shadowMap=ht,B.state=et,B.info=$}ze(),A!==Jr&&(F=new Ez(A,t.width,t.height,i,s));const st=new c5(B,te);this.xr=st,this.getContext=function(){return te},this.getContextAttributes=function(){return te.getContextAttributes()},this.forceContextLoss=function(){const X=$e.get("WEBGL_lose_context");X&&X.loseContext()},this.forceContextRestore=function(){const X=$e.get("WEBGL_lose_context");X&&X.restoreContext()},this.getPixelRatio=function(){return le},this.setPixelRatio=function(X){X!==void 0&&(le=X,this.setSize(Y,Z,!1))},this.getSize=function(X){return X.set(Y,Z)},this.setSize=function(X,de,De=!0){if(st.isPresenting){ct("WebGLRenderer: Can't change size while VR device is presenting.");return}Y=X,Z=de,t.width=Math.floor(X*le),t.height=Math.floor(de*le),De===!0&&(t.style.width=X+"px",t.style.height=de+"px"),F!==null&&F.setSize(t.width,t.height),this.setViewport(0,0,X,de)},this.getDrawingBufferSize=function(X){return X.set(Y*le,Z*le).floor()},this.setDrawingBufferSize=function(X,de,De){Y=X,Z=de,le=De,t.width=Math.floor(X*De),t.height=Math.floor(de*De),this.setViewport(0,0,X,de)},this.setEffects=function(X){if(A===Jr){console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.");return}if(X){for(let de=0;de<X.length;de++)if(X[de].isOutputPass===!0){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}}F.setEffects(X||[])},this.getCurrentViewport=function(X){return X.copy(k)},this.getViewport=function(X){return X.copy(ce)},this.setViewport=function(X,de,De,be){X.isVector4?ce.set(X.x,X.y,X.z,X.w):ce.set(X,de,De,be),et.viewport(k.copy(ce).multiplyScalar(le).round())},this.getScissor=function(X){return X.copy(Me)},this.setScissor=function(X,de,De,be){X.isVector4?Me.set(X.x,X.y,X.z,X.w):Me.set(X,de,De,be),et.scissor(K.copy(Me).multiplyScalar(le).round())},this.getScissorTest=function(){return Xe},this.setScissorTest=function(X){et.setScissorTest(Xe=X)},this.setOpaqueSort=function(X){pe=X},this.setTransparentSort=function(X){Te=X},this.getClearColor=function(X){return X.copy(rt.getClearColor())},this.setClearColor=function(){rt.setClearColor(...arguments)},this.getClearAlpha=function(){return rt.getClearAlpha()},this.setClearAlpha=function(){rt.setClearAlpha(...arguments)},this.clear=function(X=!0,de=!0,De=!0){let be=0;if(X){let _e=!1;if(Q!==null){const ot=Q.texture.format;_e=E.has(ot)}if(_e){const ot=Q.texture.type,xt=T.has(ot),ut=rt.getClearColor(),bt=rt.getClearAlpha(),Rt=ut.r,kt=ut.g,Mt=ut.b;xt?(M[0]=Rt,M[1]=kt,M[2]=Mt,M[3]=bt,te.clearBufferuiv(te.COLOR,0,M)):(R[0]=Rt,R[1]=kt,R[2]=Mt,R[3]=bt,te.clearBufferiv(te.COLOR,0,R))}else be|=te.COLOR_BUFFER_BIT}de&&(be|=te.DEPTH_BUFFER_BIT),De&&(be|=te.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),te.clear(be)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Yt,!1),t.removeEventListener("webglcontextrestored",Cn,!1),t.removeEventListener("webglcontextcreationerror",gn,!1),rt.dispose(),Ye.dispose(),Je.dispose(),z.dispose(),we.dispose(),He.dispose(),it.dispose(),pt.dispose(),qe.dispose(),vt.dispose(),st.dispose(),st.removeEventListener("sessionstart",Su),st.removeEventListener("sessionend",sa),as.stop()};function Yt(X){X.preventDefault(),Ov("WebGLRenderer: Context Lost."),P=!0}function Cn(){Ov("WebGLRenderer: Context Restored."),P=!1;const X=$.autoReset,de=ht.enabled,De=ht.autoUpdate,be=ht.needsUpdate,_e=ht.type;ze(),$.autoReset=X,ht.enabled=de,ht.autoUpdate=De,ht.needsUpdate=be,ht.type=_e}function gn(X){Nt("WebGLRenderer: A WebGL context could not be created. Reason: ",X.statusMessage)}function vs(X){const de=X.target;de.removeEventListener("dispose",vs),na(de)}function na(X){jf(X),z.remove(X)}function jf(X){const de=z.get(X).programs;de!==void 0&&(de.forEach(function(De){vt.releaseProgram(De)}),X.isShaderMaterial&&vt.releaseShaderCache(X))}this.renderBufferDirect=function(X,de,De,be,_e,ot){de===null&&(de=We);const xt=_e.isMesh&&_e.matrixWorld.determinant()<0,ut=Go(X,de,De,be,_e);et.setMaterial(be,xt);let bt=De.index,Rt=1;if(be.wireframe===!0){if(bt=Et.getWireframeAttribute(De),bt===void 0)return;Rt=2}const kt=De.drawRange,Mt=De.attributes.position;let Ht=kt.start*Rt,Un=(kt.start+kt.count)*Rt;ot!==null&&(Ht=Math.max(Ht,ot.start*Rt),Un=Math.min(Un,(ot.start+ot.count)*Rt)),bt!==null?(Ht=Math.max(Ht,0),Un=Math.min(Un,bt.count)):Mt!=null&&(Ht=Math.max(Ht,0),Un=Math.min(Un,Mt.count));const ui=Un-Ht;if(ui<0||ui===1/0)return;pt.setup(_e,be,ut,De,bt);let Zn,Fn=he;if(bt!==null&&(Zn=Oe.get(bt),Fn=lt,Fn.setIndex(Zn)),_e.isMesh)be.wireframe===!0?(et.setLineWidth(be.wireframeLinewidth*je()),Fn.setMode(te.LINES)):Fn.setMode(te.TRIANGLES);else if(_e.isLine){let It=be.linewidth;It===void 0&&(It=1),et.setLineWidth(It*je()),_e.isLineSegments?Fn.setMode(te.LINES):_e.isLineLoop?Fn.setMode(te.LINE_LOOP):Fn.setMode(te.LINE_STRIP)}else _e.isPoints?Fn.setMode(te.POINTS):_e.isSprite&&Fn.setMode(te.TRIANGLES);if(_e.isBatchedMesh)if(_e._multiDrawInstances!==null)Km("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Fn.renderMultiDrawInstances(_e._multiDrawStarts,_e._multiDrawCounts,_e._multiDrawCount,_e._multiDrawInstances);else if($e.get("WEBGL_multi_draw"))Fn.renderMultiDraw(_e._multiDrawStarts,_e._multiDrawCounts,_e._multiDrawCount);else{const It=_e._multiDrawStarts,Pn=_e._multiDrawCounts,Jt=_e._multiDrawCount,os=bt?Oe.get(bt).bytesPerElement:1,ro=z.get(be).currentProgram.getUniforms();for(let ls=0;ls<Jt;ls++)ro.setValue(te,"_gl_DrawID",ls),Fn.render(It[ls]/os,Pn[ls])}else if(_e.isInstancedMesh)Fn.renderInstances(Ht,ui,_e.count);else if(De.isInstancedBufferGeometry){const It=De._maxInstanceCount!==void 0?De._maxInstanceCount:1/0,Pn=Math.min(De.instanceCount,It);Fn.renderInstances(Ht,ui,Pn)}else Fn.render(Ht,ui)};function xu(X,de,De){X.transparent===!0&&X.side===Lo&&X.forceSinglePass===!1?(X.side=ta,X.needsUpdate=!0,Eu(X,de,De),X.side=du,X.needsUpdate=!0,Eu(X,de,De),X.side=Lo):Eu(X,de,De)}this.compile=function(X,de,De=null){De===null&&(De=X),w=Je.get(De),w.init(de),O.push(w),De.traverseVisible(function(_e){_e.isLight&&_e.layers.test(de.layers)&&(w.pushLight(_e),_e.castShadow&&w.pushShadow(_e))}),X!==De&&X.traverseVisible(function(_e){_e.isLight&&_e.layers.test(de.layers)&&(w.pushLight(_e),_e.castShadow&&w.pushShadow(_e))}),w.setupLights();const be=new Set;return X.traverse(function(_e){if(!(_e.isMesh||_e.isPoints||_e.isLine||_e.isSprite))return;const ot=_e.material;if(ot)if(Array.isArray(ot))for(let xt=0;xt<ot.length;xt++){const ut=ot[xt];xu(ut,De,_e),be.add(ut)}else xu(ot,De,_e),be.add(ot)}),w=O.pop(),be},this.compileAsync=function(X,de,De=null){const be=this.compile(X,de,De);return new Promise(_e=>{function ot(){if(be.forEach(function(xt){z.get(xt).currentProgram.isReady()&&be.delete(xt)}),be.size===0){_e(X);return}setTimeout(ot,10)}$e.get("KHR_parallel_shader_compile")!==null?ot():setTimeout(ot,10)})};let Al=null;function ia(X){Al&&Al(X)}function Su(){as.stop()}function sa(){as.start()}const as=new fB;as.setAnimationLoop(ia),typeof self<"u"&&as.setContext(self),this.setAnimationLoop=function(X){Al=X,st.setAnimationLoop(X),X===null?as.stop():as.start()},st.addEventListener("sessionstart",Su),st.addEventListener("sessionend",sa),this.render=function(X,de){if(de!==void 0&&de.isCamera!==!0){Nt("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(P===!0)return;const De=st.enabled===!0&&st.isPresenting===!0,be=F!==null&&(Q===null||De)&&F.begin(B,Q);if(X.matrixWorldAutoUpdate===!0&&X.updateMatrixWorld(),de.parent===null&&de.matrixWorldAutoUpdate===!0&&de.updateMatrixWorld(),st.enabled===!0&&st.isPresenting===!0&&(F===null||F.isCompositing()===!1)&&(st.cameraAutoUpdate===!0&&st.updateCamera(de),de=st.getCamera()),X.isScene===!0&&X.onBeforeRender(B,X,de,Q),w=Je.get(X,O.length),w.init(de),O.push(w),dn.multiplyMatrices(de.projectionMatrix,de.matrixWorldInverse),nt.setFromProjectionMatrix(dn,Ya,de.reversedDepth),Vt=this.localClippingEnabled,at=ft.init(this.clippingPlanes,Vt),L=Ye.get(X,N.length),L.init(),N.push(L),st.enabled===!0&&st.isPresenting===!0){const xt=B.xr.getDepthSensingMesh();xt!==null&&Ys(xt,de,-1/0,B.sortObjects)}Ys(X,de,0,B.sortObjects),L.finish(),B.sortObjects===!0&&L.sort(pe,Te),Ie=st.enabled===!1||st.isPresenting===!1||st.hasDepthSensing()===!1,Ie&&rt.addToRenderList(L,X),this.info.render.frame++,at===!0&&ft.beginShadows();const _e=w.state.shadowsArray;if(ht.render(_e,X,de),at===!0&&ft.endShadows(),this.info.autoReset===!0&&this.info.reset(),(be&&F.hasRenderPass())===!1){const xt=L.opaque,ut=L.transmissive;if(w.setupLights(),de.isArrayCamera){const bt=de.cameras;if(ut.length>0)for(let Rt=0,kt=bt.length;Rt<kt;Rt++){const Mt=bt[Rt];Zi(xt,ut,X,Mt)}Ie&&rt.render(X);for(let Rt=0,kt=bt.length;Rt<kt;Rt++){const Mt=bt[Rt];ln(L,X,Mt,Mt.viewport)}}else ut.length>0&&Zi(xt,ut,X,de),Ie&&rt.render(X),ln(L,X,de)}Q!==null&&J===0&&(fe.updateMultisampleRenderTarget(Q),fe.updateRenderTargetMipmap(Q)),be&&F.end(B),X.isScene===!0&&X.onAfterRender(B,X,de),pt.resetDefaultState(),ie=-1,ne=null,O.pop(),O.length>0?(w=O[O.length-1],at===!0&&ft.setGlobalState(B.clippingPlanes,w.state.camera)):w=null,N.pop(),N.length>0?L=N[N.length-1]:L=null};function Ys(X,de,De,be){if(X.visible===!1)return;if(X.layers.test(de.layers)){if(X.isGroup)De=X.renderOrder;else if(X.isLOD)X.autoUpdate===!0&&X.update(de);else if(X.isLight)w.pushLight(X),X.castShadow&&w.pushShadow(X);else if(X.isSprite){if(!X.frustumCulled||nt.intersectsSprite(X)){be&&Ne.setFromMatrixPosition(X.matrixWorld).applyMatrix4(dn);const xt=it.update(X),ut=X.material;ut.visible&&L.push(X,xt,ut,De,Ne.z,null)}}else if((X.isMesh||X.isLine||X.isPoints)&&(!X.frustumCulled||nt.intersectsObject(X))){const xt=it.update(X),ut=X.material;if(be&&(X.boundingSphere!==void 0?(X.boundingSphere===null&&X.computeBoundingSphere(),Ne.copy(X.boundingSphere.center)):(xt.boundingSphere===null&&xt.computeBoundingSphere(),Ne.copy(xt.boundingSphere.center)),Ne.applyMatrix4(X.matrixWorld).applyMatrix4(dn)),Array.isArray(ut)){const bt=xt.groups;for(let Rt=0,kt=bt.length;Rt<kt;Rt++){const Mt=bt[Rt],Ht=ut[Mt.materialIndex];Ht&&Ht.visible&&L.push(X,xt,Ht,De,Ne.z,Mt)}}else ut.visible&&L.push(X,xt,ut,De,Ne.z,null)}}const ot=X.children;for(let xt=0,ut=ot.length;xt<ut;xt++)Ys(ot[xt],de,De,be)}function ln(X,de,De,be){const{opaque:_e,transmissive:ot,transparent:xt}=X;w.setupLightsView(De),at===!0&&ft.setGlobalState(B.clippingPlanes,De),be&&et.viewport(k.copy(be)),_e.length>0&&Rr(_e,de,De),ot.length>0&&Rr(ot,de,De),xt.length>0&&Rr(xt,de,De),et.buffers.depth.setTest(!0),et.buffers.depth.setMask(!0),et.buffers.color.setMask(!0),et.setPolygonOffset(!1)}function Zi(X,de,De,be){if((De.isScene===!0?De.overrideMaterial:null)!==null)return;if(w.state.transmissionRenderTarget[be.id]===void 0){const Ht=$e.has("EXT_color_buffer_half_float")||$e.has("EXT_color_buffer_float");w.state.transmissionRenderTarget[be.id]=new tr(1,1,{generateMipmaps:!0,type:Ht?Za:Jr,minFilter:Io,samples:At.samples,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Mn.workingColorSpace})}const ot=w.state.transmissionRenderTarget[be.id],xt=be.viewport||k;ot.setSize(xt.z*B.transmissionResolutionScale,xt.w*B.transmissionResolutionScale);const ut=B.getRenderTarget(),bt=B.getActiveCubeFace(),Rt=B.getActiveMipmapLevel();B.setRenderTarget(ot),B.getClearColor(se),oe=B.getClearAlpha(),oe<1&&B.setClearColor(16777215,.5),B.clear(),Ie&&rt.render(De);const kt=B.toneMapping;B.toneMapping=Oo;const Mt=be.viewport;if(be.viewport!==void 0&&(be.viewport=void 0),w.setupLightsView(be),at===!0&&ft.setGlobalState(B.clippingPlanes,be),Rr(X,De,be),fe.updateMultisampleRenderTarget(ot),fe.updateRenderTargetMipmap(ot),$e.has("WEBGL_multisampled_render_to_texture")===!1){let Ht=!1;for(let Un=0,ui=de.length;Un<ui;Un++){const Zn=de[Un],{object:Fn,geometry:It,material:Pn,group:Jt}=Zn;if(Pn.side===Lo&&Fn.layers.test(be.layers)){const os=Pn.side;Pn.side=ta,Pn.needsUpdate=!0,Au(Fn,De,be,It,Pn,Jt),Pn.side=os,Pn.needsUpdate=!0,Ht=!0}}Ht===!0&&(fe.updateMultisampleRenderTarget(ot),fe.updateRenderTargetMipmap(ot))}B.setRenderTarget(ut,bt,Rt),B.setClearColor(se,oe),Mt!==void 0&&(be.viewport=Mt),B.toneMapping=kt}function Rr(X,de,De){const be=de.isScene===!0?de.overrideMaterial:null;for(let _e=0,ot=X.length;_e<ot;_e++){const xt=X[_e],{object:ut,geometry:bt,group:Rt}=xt;let kt=xt.material;kt.allowOverride===!0&&be!==null&&(kt=be),ut.layers.test(De.layers)&&Au(ut,de,De,bt,kt,Rt)}}function Au(X,de,De,be,_e,ot){X.onBeforeRender(B,de,De,be,_e,ot),X.modelViewMatrix.multiplyMatrices(De.matrixWorldInverse,X.matrixWorld),X.normalMatrix.getNormalMatrix(X.modelViewMatrix),_e.onBeforeRender(B,de,De,be,X,ot),_e.transparent===!0&&_e.side===Lo&&_e.forceSinglePass===!1?(_e.side=ta,_e.needsUpdate=!0,B.renderBufferDirect(De,de,be,_e,X,ot),_e.side=du,_e.needsUpdate=!0,B.renderBufferDirect(De,de,be,_e,X,ot),_e.side=Lo):B.renderBufferDirect(De,de,be,_e,X,ot),X.onAfterRender(B,de,De,be,_e,ot)}function Eu(X,de,De){de.isScene!==!0&&(de=We);const be=z.get(X),_e=w.state.lights,ot=w.state.shadowsArray,xt=_e.state.version,ut=vt.getParameters(X,_e.state,ot,de,De),bt=vt.getProgramCacheKey(ut);let Rt=be.programs;be.environment=X.isMeshStandardMaterial?de.environment:null,be.fog=de.fog,be.envMap=(X.isMeshStandardMaterial?He:we).get(X.envMap||be.environment),be.envMapRotation=be.environment!==null&&X.envMap===null?de.environmentRotation:X.envMapRotation,Rt===void 0&&(X.addEventListener("dispose",vs),Rt=new Map,be.programs=Rt);let kt=Rt.get(bt);if(kt!==void 0){if(be.currentProgram===kt&&be.lightsStateVersion===xt)return Tu(X,ut),kt}else ut.uniforms=vt.getUniforms(X),X.onBeforeCompile(ut,B),kt=vt.acquireProgram(ut,bt),Rt.set(bt,kt),be.uniforms=ut.uniforms;const Mt=be.uniforms;return(!X.isShaderMaterial&&!X.isRawShaderMaterial||X.clipping===!0)&&(Mt.clippingPlanes=ft.uniform),Tu(X,ut),be.needsLights=wi(X),be.lightsStateVersion=xt,be.needsLights&&(Mt.ambientLightColor.value=_e.state.ambient,Mt.lightProbe.value=_e.state.probe,Mt.directionalLights.value=_e.state.directional,Mt.directionalLightShadows.value=_e.state.directionalShadow,Mt.spotLights.value=_e.state.spot,Mt.spotLightShadows.value=_e.state.spotShadow,Mt.rectAreaLights.value=_e.state.rectArea,Mt.ltc_1.value=_e.state.rectAreaLTC1,Mt.ltc_2.value=_e.state.rectAreaLTC2,Mt.pointLights.value=_e.state.point,Mt.pointLightShadows.value=_e.state.pointShadow,Mt.hemisphereLights.value=_e.state.hemi,Mt.directionalShadowMap.value=_e.state.directionalShadowMap,Mt.directionalShadowMatrix.value=_e.state.directionalShadowMatrix,Mt.spotShadowMap.value=_e.state.spotShadowMap,Mt.spotLightMatrix.value=_e.state.spotLightMatrix,Mt.spotLightMap.value=_e.state.spotLightMap,Mt.pointShadowMap.value=_e.state.pointShadowMap,Mt.pointShadowMatrix.value=_e.state.pointShadowMatrix),be.currentProgram=kt,be.uniformsList=null,kt}function Hd(X){if(X.uniformsList===null){const de=X.currentProgram.getUniforms();X.uniformsList=Xx.seqWithValue(de.seq,X.uniforms)}return X.uniformsList}function Tu(X,de){const De=z.get(X);De.outputColorSpace=de.outputColorSpace,De.batching=de.batching,De.batchingColor=de.batchingColor,De.instancing=de.instancing,De.instancingColor=de.instancingColor,De.instancingMorph=de.instancingMorph,De.skinning=de.skinning,De.morphTargets=de.morphTargets,De.morphNormals=de.morphNormals,De.morphColors=de.morphColors,De.morphTargetsCount=de.morphTargetsCount,De.numClippingPlanes=de.numClippingPlanes,De.numIntersection=de.numClipIntersection,De.vertexAlphas=de.vertexAlphas,De.vertexTangents=de.vertexTangents,De.toneMapping=de.toneMapping}function Go(X,de,De,be,_e){de.isScene!==!0&&(de=We),fe.resetTextureUnits();const ot=de.fog,xt=be.isMeshStandardMaterial?de.environment:null,ut=Q===null?B.outputColorSpace:Q.isXRRenderTarget===!0?Q.texture.colorSpace:Nf,bt=(be.isMeshStandardMaterial?He:we).get(be.envMap||xt),Rt=be.vertexColors===!0&&!!De.attributes.color&&De.attributes.color.itemSize===4,kt=!!De.attributes.tangent&&(!!be.normalMap||be.anisotropy>0),Mt=!!De.morphAttributes.position,Ht=!!De.morphAttributes.normal,Un=!!De.morphAttributes.color;let ui=Oo;be.toneMapped&&(Q===null||Q.isXRRenderTarget===!0)&&(ui=B.toneMapping);const Zn=De.morphAttributes.position||De.morphAttributes.normal||De.morphAttributes.color,Fn=Zn!==void 0?Zn.length:0,It=z.get(be),Pn=w.state.lights;if(at===!0&&(Vt===!0||X!==ne)){const Vi=X===ne&&be.id===ie;ft.setState(be,X,Vi)}let Jt=!1;be.version===It.__version?(It.needsLights&&It.lightsStateVersion!==Pn.state.version||It.outputColorSpace!==ut||_e.isBatchedMesh&&It.batching===!1||!_e.isBatchedMesh&&It.batching===!0||_e.isBatchedMesh&&It.batchingColor===!0&&_e.colorTexture===null||_e.isBatchedMesh&&It.batchingColor===!1&&_e.colorTexture!==null||_e.isInstancedMesh&&It.instancing===!1||!_e.isInstancedMesh&&It.instancing===!0||_e.isSkinnedMesh&&It.skinning===!1||!_e.isSkinnedMesh&&It.skinning===!0||_e.isInstancedMesh&&It.instancingColor===!0&&_e.instanceColor===null||_e.isInstancedMesh&&It.instancingColor===!1&&_e.instanceColor!==null||_e.isInstancedMesh&&It.instancingMorph===!0&&_e.morphTexture===null||_e.isInstancedMesh&&It.instancingMorph===!1&&_e.morphTexture!==null||It.envMap!==bt||be.fog===!0&&It.fog!==ot||It.numClippingPlanes!==void 0&&(It.numClippingPlanes!==ft.numPlanes||It.numIntersection!==ft.numIntersection)||It.vertexAlphas!==Rt||It.vertexTangents!==kt||It.morphTargets!==Mt||It.morphNormals!==Ht||It.morphColors!==Un||It.toneMapping!==ui||It.morphTargetsCount!==Fn)&&(Jt=!0):(Jt=!0,It.__version=be.version);let os=It.currentProgram;Jt===!0&&(os=Eu(be,de,_e));let ro=!1,ls=!1,ra=!1;const Hn=os.getUniforms(),Si=It.uniforms;if(et.useProgram(os.program)&&(ro=!0,ls=!0,ra=!0),be.id!==ie&&(ie=be.id,ls=!0),ro||ne!==X){et.buffers.depth.getReversed()&&X.reversedDepth!==!0&&(X._reversedDepth=!0,X.updateProjectionMatrix()),Hn.setValue(te,"projectionMatrix",X.projectionMatrix),Hn.setValue(te,"viewMatrix",X.matrixWorldInverse);const Ki=Hn.map.cameraPosition;Ki!==void 0&&Ki.setValue(te,Ut.setFromMatrixPosition(X.matrixWorld)),At.logarithmicDepthBuffer&&Hn.setValue(te,"logDepthBufFC",2/(Math.log(X.far+1)/Math.LN2)),(be.isMeshPhongMaterial||be.isMeshToonMaterial||be.isMeshLambertMaterial||be.isMeshBasicMaterial||be.isMeshStandardMaterial||be.isShaderMaterial)&&Hn.setValue(te,"isOrthographic",X.isOrthographicCamera===!0),ne!==X&&(ne=X,ls=!0,ra=!0)}if(It.needsLights&&(Pn.state.directionalShadowMap.length>0&&Hn.setValue(te,"directionalShadowMap",Pn.state.directionalShadowMap,fe),Pn.state.spotShadowMap.length>0&&Hn.setValue(te,"spotShadowMap",Pn.state.spotShadowMap,fe),Pn.state.pointShadowMap.length>0&&Hn.setValue(te,"pointShadowMap",Pn.state.pointShadowMap,fe)),_e.isSkinnedMesh){Hn.setOptional(te,_e,"bindMatrix"),Hn.setOptional(te,_e,"bindMatrixInverse");const Vi=_e.skeleton;Vi&&(Vi.boneTexture===null&&Vi.computeBoneTexture(),Hn.setValue(te,"boneTexture",Vi.boneTexture,fe))}_e.isBatchedMesh&&(Hn.setOptional(te,_e,"batchingTexture"),Hn.setValue(te,"batchingTexture",_e._matricesTexture,fe),Hn.setOptional(te,_e,"batchingIdTexture"),Hn.setValue(te,"batchingIdTexture",_e._indirectTexture,fe),Hn.setOptional(te,_e,"batchingColorTexture"),_e._colorsTexture!==null&&Hn.setValue(te,"batchingColorTexture",_e._colorsTexture,fe));const zi=De.morphAttributes;if((zi.position!==void 0||zi.normal!==void 0||zi.color!==void 0)&&Qt.update(_e,De,os),(ls||It.receiveShadow!==_e.receiveShadow)&&(It.receiveShadow=_e.receiveShadow,Hn.setValue(te,"receiveShadow",_e.receiveShadow)),be.isMeshGouraudMaterial&&be.envMap!==null&&(Si.envMap.value=bt,Si.flipEnvMap.value=bt.isCubeTexture&&bt.isRenderTargetTexture===!1?-1:1),be.isMeshStandardMaterial&&be.envMap===null&&de.environment!==null&&(Si.envMapIntensity.value=de.environmentIntensity),Si.dfgLUT!==void 0&&(Si.dfgLUT.value=m5()),ls&&(Hn.setValue(te,"toneMappingExposure",B.toneMappingExposure),It.needsLights&&bu(Si,ra),ot&&be.fog===!0&&Ft.refreshFogUniforms(Si,ot),Ft.refreshMaterialUniforms(Si,be,le,Z,w.state.transmissionRenderTarget[X.id]),Xx.upload(te,Hd(It),Si,fe)),be.isShaderMaterial&&be.uniformsNeedUpdate===!0&&(Xx.upload(te,Hd(It),Si,fe),be.uniformsNeedUpdate=!1),be.isSpriteMaterial&&Hn.setValue(te,"center",_e.center),Hn.setValue(te,"modelViewMatrix",_e.modelViewMatrix),Hn.setValue(te,"normalMatrix",_e.normalMatrix),Hn.setValue(te,"modelMatrix",_e.matrixWorld),be.isShaderMaterial||be.isRawShaderMaterial){const Vi=be.uniformsGroups;for(let Ki=0,Mu=Vi.length;Ki<Mu;Ki++){const Dr=Vi[Ki];qe.update(Dr,os),qe.bind(Dr,os)}}return os}function bu(X,de){X.ambientLightColor.needsUpdate=de,X.lightProbe.needsUpdate=de,X.directionalLights.needsUpdate=de,X.directionalLightShadows.needsUpdate=de,X.pointLights.needsUpdate=de,X.pointLightShadows.needsUpdate=de,X.spotLights.needsUpdate=de,X.spotLightShadows.needsUpdate=de,X.rectAreaLights.needsUpdate=de,X.hemisphereLights.needsUpdate=de}function wi(X){return X.isMeshLambertMaterial||X.isMeshToonMaterial||X.isMeshPhongMaterial||X.isMeshStandardMaterial||X.isShadowMaterial||X.isShaderMaterial&&X.lights===!0}this.getActiveCubeFace=function(){return V},this.getActiveMipmapLevel=function(){return J},this.getRenderTarget=function(){return Q},this.setRenderTargetTextures=function(X,de,De){const be=z.get(X);be.__autoAllocateDepthBuffer=X.resolveDepthBuffer===!1,be.__autoAllocateDepthBuffer===!1&&(be.__useRenderToTexture=!1),z.get(X.texture).__webglTexture=de,z.get(X.depthTexture).__webglTexture=be.__autoAllocateDepthBuffer?void 0:De,be.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(X,de){const De=z.get(X);De.__webglFramebuffer=de,De.__useDefaultFramebuffer=de===void 0};const $n=te.createFramebuffer();this.setRenderTarget=function(X,de=0,De=0){Q=X,V=de,J=De;let be=null,_e=!1,ot=!1;if(X){const ut=z.get(X);if(ut.__useDefaultFramebuffer!==void 0){et.bindFramebuffer(te.FRAMEBUFFER,ut.__webglFramebuffer),k.copy(X.viewport),K.copy(X.scissor),j=X.scissorTest,et.viewport(k),et.scissor(K),et.setScissorTest(j),ie=-1;return}else if(ut.__webglFramebuffer===void 0)fe.setupRenderTarget(X);else if(ut.__hasExternalTextures)fe.rebindTextures(X,z.get(X.texture).__webglTexture,z.get(X.depthTexture).__webglTexture);else if(X.depthBuffer){const kt=X.depthTexture;if(ut.__boundDepthTexture!==kt){if(kt!==null&&z.has(kt)&&(X.width!==kt.image.width||X.height!==kt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");fe.setupDepthRenderbuffer(X)}}const bt=X.texture;(bt.isData3DTexture||bt.isDataArrayTexture||bt.isCompressedArrayTexture)&&(ot=!0);const Rt=z.get(X).__webglFramebuffer;X.isWebGLCubeRenderTarget?(Array.isArray(Rt[de])?be=Rt[de][De]:be=Rt[de],_e=!0):X.samples>0&&fe.useMultisampledRTT(X)===!1?be=z.get(X).__webglMultisampledFramebuffer:Array.isArray(Rt)?be=Rt[De]:be=Rt,k.copy(X.viewport),K.copy(X.scissor),j=X.scissorTest}else k.copy(ce).multiplyScalar(le).floor(),K.copy(Me).multiplyScalar(le).floor(),j=Xe;if(De!==0&&(be=$n),et.bindFramebuffer(te.FRAMEBUFFER,be)&&et.drawBuffers(X,be),et.viewport(k),et.scissor(K),et.setScissorTest(j),_e){const ut=z.get(X.texture);te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_CUBE_MAP_POSITIVE_X+de,ut.__webglTexture,De)}else if(ot){const ut=de;for(let bt=0;bt<X.textures.length;bt++){const Rt=z.get(X.textures[bt]);te.framebufferTextureLayer(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0+bt,Rt.__webglTexture,De,ut)}}else if(X!==null&&De!==0){const ut=z.get(X.texture);te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,ut.__webglTexture,De)}ie=-1},this.readRenderTargetPixels=function(X,de,De,be,_e,ot,xt,ut=0){if(!(X&&X.isWebGLRenderTarget)){Nt("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let bt=z.get(X).__webglFramebuffer;if(X.isWebGLCubeRenderTarget&&xt!==void 0&&(bt=bt[xt]),bt){et.bindFramebuffer(te.FRAMEBUFFER,bt);try{const Rt=X.textures[ut],kt=Rt.format,Mt=Rt.type;if(!At.textureFormatReadable(kt)){Nt("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!At.textureTypeReadable(Mt)){Nt("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}de>=0&&de<=X.width-be&&De>=0&&De<=X.height-_e&&(X.textures.length>1&&te.readBuffer(te.COLOR_ATTACHMENT0+ut),te.readPixels(de,De,be,_e,Ze.convert(kt),Ze.convert(Mt),ot))}finally{const Rt=Q!==null?z.get(Q).__webglFramebuffer:null;et.bindFramebuffer(te.FRAMEBUFFER,Rt)}}},this.readRenderTargetPixelsAsync=async function(X,de,De,be,_e,ot,xt,ut=0){if(!(X&&X.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let bt=z.get(X).__webglFramebuffer;if(X.isWebGLCubeRenderTarget&&xt!==void 0&&(bt=bt[xt]),bt)if(de>=0&&de<=X.width-be&&De>=0&&De<=X.height-_e){et.bindFramebuffer(te.FRAMEBUFFER,bt);const Rt=X.textures[ut],kt=Rt.format,Mt=Rt.type;if(!At.textureFormatReadable(kt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!At.textureTypeReadable(Mt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Ht=te.createBuffer();te.bindBuffer(te.PIXEL_PACK_BUFFER,Ht),te.bufferData(te.PIXEL_PACK_BUFFER,ot.byteLength,te.STREAM_READ),X.textures.length>1&&te.readBuffer(te.COLOR_ATTACHMENT0+ut),te.readPixels(de,De,be,_e,Ze.convert(kt),Ze.convert(Mt),0);const Un=Q!==null?z.get(Q).__webglFramebuffer:null;et.bindFramebuffer(te.FRAMEBUFFER,Un);const ui=te.fenceSync(te.SYNC_GPU_COMMANDS_COMPLETE,0);return te.flush(),await MU(te,ui,4),te.bindBuffer(te.PIXEL_PACK_BUFFER,Ht),te.getBufferSubData(te.PIXEL_PACK_BUFFER,0,ot),te.deleteBuffer(Ht),te.deleteSync(ui),ot}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(X,de=null,De=0){const be=Math.pow(2,-De),_e=Math.floor(X.image.width*be),ot=Math.floor(X.image.height*be),xt=de!==null?de.x:0,ut=de!==null?de.y:0;fe.setTexture2D(X,0),te.copyTexSubImage2D(te.TEXTURE_2D,De,0,0,xt,ut,_e,ot),et.unbindTexture()};const Ma=te.createFramebuffer(),Ca=te.createFramebuffer();this.copyTextureToTexture=function(X,de,De=null,be=null,_e=0,ot=null){ot===null&&(_e!==0?(Km("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ot=_e,_e=0):ot=0);let xt,ut,bt,Rt,kt,Mt,Ht,Un,ui;const Zn=X.isCompressedTexture?X.mipmaps[ot]:X.image;if(De!==null)xt=De.max.x-De.min.x,ut=De.max.y-De.min.y,bt=De.isBox3?De.max.z-De.min.z:1,Rt=De.min.x,kt=De.min.y,Mt=De.isBox3?De.min.z:0;else{const zi=Math.pow(2,-_e);xt=Math.floor(Zn.width*zi),ut=Math.floor(Zn.height*zi),X.isDataArrayTexture?bt=Zn.depth:X.isData3DTexture?bt=Math.floor(Zn.depth*zi):bt=1,Rt=0,kt=0,Mt=0}be!==null?(Ht=be.x,Un=be.y,ui=be.z):(Ht=0,Un=0,ui=0);const Fn=Ze.convert(de.format),It=Ze.convert(de.type);let Pn;de.isData3DTexture?(fe.setTexture3D(de,0),Pn=te.TEXTURE_3D):de.isDataArrayTexture||de.isCompressedArrayTexture?(fe.setTexture2DArray(de,0),Pn=te.TEXTURE_2D_ARRAY):(fe.setTexture2D(de,0),Pn=te.TEXTURE_2D),te.pixelStorei(te.UNPACK_FLIP_Y_WEBGL,de.flipY),te.pixelStorei(te.UNPACK_PREMULTIPLY_ALPHA_WEBGL,de.premultiplyAlpha),te.pixelStorei(te.UNPACK_ALIGNMENT,de.unpackAlignment);const Jt=te.getParameter(te.UNPACK_ROW_LENGTH),os=te.getParameter(te.UNPACK_IMAGE_HEIGHT),ro=te.getParameter(te.UNPACK_SKIP_PIXELS),ls=te.getParameter(te.UNPACK_SKIP_ROWS),ra=te.getParameter(te.UNPACK_SKIP_IMAGES);te.pixelStorei(te.UNPACK_ROW_LENGTH,Zn.width),te.pixelStorei(te.UNPACK_IMAGE_HEIGHT,Zn.height),te.pixelStorei(te.UNPACK_SKIP_PIXELS,Rt),te.pixelStorei(te.UNPACK_SKIP_ROWS,kt),te.pixelStorei(te.UNPACK_SKIP_IMAGES,Mt);const Hn=X.isDataArrayTexture||X.isData3DTexture,Si=de.isDataArrayTexture||de.isData3DTexture;if(X.isDepthTexture){const zi=z.get(X),Vi=z.get(de),Ki=z.get(zi.__renderTarget),Mu=z.get(Vi.__renderTarget);et.bindFramebuffer(te.READ_FRAMEBUFFER,Ki.__webglFramebuffer),et.bindFramebuffer(te.DRAW_FRAMEBUFFER,Mu.__webglFramebuffer);for(let Dr=0;Dr<bt;Dr++)Hn&&(te.framebufferTextureLayer(te.READ_FRAMEBUFFER,te.COLOR_ATTACHMENT0,z.get(X).__webglTexture,_e,Mt+Dr),te.framebufferTextureLayer(te.DRAW_FRAMEBUFFER,te.COLOR_ATTACHMENT0,z.get(de).__webglTexture,ot,ui+Dr)),te.blitFramebuffer(Rt,kt,xt,ut,Ht,Un,xt,ut,te.DEPTH_BUFFER_BIT,te.NEAREST);et.bindFramebuffer(te.READ_FRAMEBUFFER,null),et.bindFramebuffer(te.DRAW_FRAMEBUFFER,null)}else if(_e!==0||X.isRenderTargetTexture||z.has(X)){const zi=z.get(X),Vi=z.get(de);et.bindFramebuffer(te.READ_FRAMEBUFFER,Ma),et.bindFramebuffer(te.DRAW_FRAMEBUFFER,Ca);for(let Ki=0;Ki<bt;Ki++)Hn?te.framebufferTextureLayer(te.READ_FRAMEBUFFER,te.COLOR_ATTACHMENT0,zi.__webglTexture,_e,Mt+Ki):te.framebufferTexture2D(te.READ_FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,zi.__webglTexture,_e),Si?te.framebufferTextureLayer(te.DRAW_FRAMEBUFFER,te.COLOR_ATTACHMENT0,Vi.__webglTexture,ot,ui+Ki):te.framebufferTexture2D(te.DRAW_FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,Vi.__webglTexture,ot),_e!==0?te.blitFramebuffer(Rt,kt,xt,ut,Ht,Un,xt,ut,te.COLOR_BUFFER_BIT,te.NEAREST):Si?te.copyTexSubImage3D(Pn,ot,Ht,Un,ui+Ki,Rt,kt,xt,ut):te.copyTexSubImage2D(Pn,ot,Ht,Un,Rt,kt,xt,ut);et.bindFramebuffer(te.READ_FRAMEBUFFER,null),et.bindFramebuffer(te.DRAW_FRAMEBUFFER,null)}else Si?X.isDataTexture||X.isData3DTexture?te.texSubImage3D(Pn,ot,Ht,Un,ui,xt,ut,bt,Fn,It,Zn.data):de.isCompressedArrayTexture?te.compressedTexSubImage3D(Pn,ot,Ht,Un,ui,xt,ut,bt,Fn,Zn.data):te.texSubImage3D(Pn,ot,Ht,Un,ui,xt,ut,bt,Fn,It,Zn):X.isDataTexture?te.texSubImage2D(te.TEXTURE_2D,ot,Ht,Un,xt,ut,Fn,It,Zn.data):X.isCompressedTexture?te.compressedTexSubImage2D(te.TEXTURE_2D,ot,Ht,Un,Zn.width,Zn.height,Fn,Zn.data):te.texSubImage2D(te.TEXTURE_2D,ot,Ht,Un,xt,ut,Fn,It,Zn);te.pixelStorei(te.UNPACK_ROW_LENGTH,Jt),te.pixelStorei(te.UNPACK_IMAGE_HEIGHT,os),te.pixelStorei(te.UNPACK_SKIP_PIXELS,ro),te.pixelStorei(te.UNPACK_SKIP_ROWS,ls),te.pixelStorei(te.UNPACK_SKIP_IMAGES,ra),ot===0&&de.generateMipmaps&&te.generateMipmap(Pn),et.unbindTexture()},this.initRenderTarget=function(X){z.get(X).__webglFramebuffer===void 0&&fe.setupRenderTarget(X)},this.initTexture=function(X){X.isCubeTexture?fe.setTextureCube(X,0):X.isData3DTexture?fe.setTexture3D(X,0):X.isDataArrayTexture||X.isCompressedArrayTexture?fe.setTexture2DArray(X,0):fe.setTexture2D(X,0),et.unbindTexture()},this.resetState=function(){V=0,J=0,Q=null,et.reset(),pt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ya}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Mn._getDrawingBufferColorSpace(e),t.unpackColorSpace=Mn._getUnpackColorSpace()}}const g5=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:TA,AddEquation:Tf,AddOperation:i2,AdditiveAnimationBlendMode:pM,AdditiveBlending:Zb,AgXToneMapping:aM,AlphaFormat:hM,AlwaysCompare:g2,AlwaysDepth:lS,AlwaysStencilFunc:i1,AmbientLight:eB,AnimationAction:uB,AnimationClip:jm,AnimationLoader:mk,AnimationMixer:zk,AnimationObjectGroup:Gk,AnimationUtils:fk,ArcCurve:I2,ArrayCamera:aB,ArrowHelper:pG,AttachedBindMode:n1,Audio:oB,AudioAnalyser:Lk,AudioContext:XM,AudioListener:Ck,AudioLoader:Tk,AxesHelper:mG,BackSide:ta,BasicDepthPacking:u2,BasicShadowMap:Uw,BatchedMesh:R2,Bone:GA,BooleanKeyframeTrack:Ud,Box2:$k,Box3:nr,Box3Helper:hG,BoxGeometry:Nd,BoxHelper:fG,BufferAttribute:On,BufferGeometry:en,BufferGeometryLoader:sB,ByteType:lM,Cache:cu,Camera:ty,CameraHelper:cG,CanvasTexture:OF,CapsuleGeometry:KA,CatmullRomCurve3:w2,CineonToneMapping:sM,CircleGeometry:YA,ClampToEdgeWrapping:Zr,Clock:qM,Color:dt,ColorKeyframeTrack:kM,ColorManagement:Mn,CompressedArrayTexture:wF,CompressedCubeTexture:BF,CompressedTexture:VA,CompressedTextureLoader:gk,ConeGeometry:oy,ConstantAlphaFactor:e2,ConstantColorFactor:$w,Controls:vG,CubeCamera:T2,CubeDepthTexture:D2,CubeReflectionMapping:pu,CubeRefractionMapping:Pf,CubeTexture:ny,CubeTextureLoader:vk,CubeUVReflectionMapping:lg,CubicBezierCurve:DM,CubicBezierCurve3:B2,CubicInterpolant:j2,CullFaceBack:$b,CullFaceFront:Nw,CullFaceFrontBack:kN,CullFaceNone:Pw,Curve:Sl,CurvePath:P2,CustomBlending:Fw,CustomToneMapping:rM,CylinderGeometry:ay,Cylindrical:Qk,Data3DTexture:UA,DataArrayTexture:NA,DataTexture:yl,DataTextureLoader:yk,DataUtils:iF,DecrementStencilOp:eU,DecrementWrapStencilOp:nU,DefaultLoadingManager:$2,DepthFormat:_l,DepthStencilFormat:Mf,DepthTexture:kf,DetachedBindMode:s2,DirectionalLight:KM,DirectionalLightHelper:uG,DiscreteInterpolant:J2,DodecahedronGeometry:XA,DoubleSide:Lo,DstAlphaFactor:qw,DstColorFactor:jw,DynamicCopyUsage:vU,DynamicDrawUsage:fU,DynamicReadUsage:pU,EdgesGeometry:L2,EllipseCurve:qA,EqualCompare:d2,EqualDepth:cS,EqualStencilFunc:aU,EquirectangularReflectionMapping:Rv,EquirectangularRefractionMapping:Dv,Euler:eo,EventDispatcher:_u,ExternalTexture:CM,ExtrudeGeometry:WA,FileLoader:no,Float16BufferAttribute:cF,Float32BufferAttribute:Ct,FloatType:Ar,Fog:kA,FogExp2:FA,FramebufferTexture:IF,FrontSide:du,Frustum:cg,FrustumArray:HA,GLBufferAttribute:qk,GLSL1:_U,GLSL3:s1,GreaterCompare:p2,GreaterDepth:hS,GreaterEqualCompare:PA,GreaterEqualDepth:fS,GreaterEqualStencilFunc:cU,GreaterStencilFunc:lU,GridHelper:oG,Group:_c,HalfFloatType:Za,HemisphereLight:Z2,HemisphereLightHelper:aG,IcosahedronGeometry:jA,ImageBitmapLoader:rB,ImageLoader:Fv,ImageUtils:x2,IncrementStencilOp:ZN,IncrementWrapStencilOp:tU,InstancedBufferAttribute:Dd,InstancedBufferGeometry:iB,InstancedInterleavedBuffer:Xk,InstancedMesh:EM,Int16BufferAttribute:lF,Int32BufferAttribute:uF,Int8BufferAttribute:rF,IntType:CA,InterleavedBuffer:sy,InterleavedBufferAttribute:Ff,Interpolant:dg,InterpolateDiscrete:Hm,InterpolateLinear:zm,InterpolateSmooth:Kx,InterpolationSamplingMode:AU,InterpolationSamplingType:SU,InvertStencilOp:iU,KeepStencilOp:sd,KeyframeTrack:Fo,LOD:C2,LatheGeometry:JA,Layers:Xm,LessCompare:h2,LessDepth:uS,LessEqualCompare:OA,LessEqualDepth:Md,LessEqualStencilFunc:oU,LessStencilFunc:rU,Light:Xf,LightProbe:nB,Line:Ec,Line3:tG,LineBasicMaterial:Mr,LineCurve:LM,LineCurve3:O2,LineDashedMaterial:q2,LineLoop:TM,LineSegments:xl,LinearFilter:Gn,LinearInterpolant:FM,LinearMipMapLinearFilter:VN,LinearMipMapNearestFilter:zN,LinearMipmapLinearFilter:Io,LinearMipmapNearestFilter:Dm,LinearSRGBColorSpace:Nf,LinearToneMapping:nM,LinearTransfer:Iv,Loader:Cr,LoaderUtils:wf,LoadingManager:GM,LoopOnce:r2,LoopPingPong:o2,LoopRepeat:a2,MOUSE:UN,Material:Rs,MaterialLoader:iE,MathUtils:qS,Matrix2:QM,Matrix3:on,Matrix4:zt,MaxEquation:zw,Mesh:$i,MeshBasicMaterial:Xa,MeshDepthMaterial:PM,MeshDistanceMaterial:NM,MeshLambertMaterial:Y2,MeshMatcapMaterial:X2,MeshNormalMaterial:K2,MeshPhongMaterial:z2,MeshPhysicalMaterial:Uo,MeshStandardMaterial:hg,MeshToonMaterial:V2,MinEquation:Hw,MirroredRepeatWrapping:km,MixOperation:n2,MultiplyBlending:t1,MultiplyOperation:Zv,NearestFilter:Ji,NearestMipMapLinearFilter:HN,NearestMipMapNearestFilter:GN,NearestMipmapLinearFilter:cd,NearestMipmapNearestFilter:MA,NeutralToneMapping:oM,NeverCompare:f2,NeverDepth:oS,NeverStencilFunc:sU,NoBlending:vl,NoColorSpace:gc,NoNormalPacking:WN,NoToneMapping:Oo,NormalAnimationBlendMode:BA,NormalBlending:vd,NormalGAPacking:JN,NormalRGPacking:jN,NotEqualCompare:m2,NotEqualDepth:dS,NotEqualStencilFunc:uU,NumberKeyframeTrack:Id,Object3D:Bn,ObjectLoader:Ak,ObjectSpaceNormalMap:c2,OctahedronGeometry:ly,OneFactor:Kw,OneMinusConstantAlphaFactor:t2,OneMinusConstantColorFactor:Zw,OneMinusDstAlphaFactor:Ww,OneMinusDstColorFactor:Jw,OneMinusSrcAlphaFactor:aS,OneMinusSrcColorFactor:Xw,OrthographicCamera:kd,PCFShadowMap:Rm,PCFSoftShadowMap:hv,PMREMGenerator:f1,Path:QS,PerspectiveCamera:gs,Plane:pc,PlaneGeometry:fg,PlaneHelper:dG,PointLight:VM,PointLightHelper:sG,Points:bM,PointsMaterial:zA,PolarGridHelper:lG,PolyhedronGeometry:Yf,PositionalAudio:Dk,PropertyBinding:Nn,PropertyMixer:lB,QuadraticBezierCurve:IM,QuadraticBezierCurve3:wM,Quaternion:Tr,QuaternionKeyframeTrack:wd,QuaternionLinearInterpolant:Q2,R11_EAC_Format:SS,RED_GREEN_RGTC2_Format:KS,RED_RGTC1_Format:zS,REVISION:og,RG11_EAC_Format:ES,RGBADepthPacking:YN,RGBAFormat:Er,RGBAIntegerFormat:wA,RGBA_ASTC_10x10_Format:NS,RGBA_ASTC_10x5_Format:BS,RGBA_ASTC_10x6_Format:OS,RGBA_ASTC_10x8_Format:PS,RGBA_ASTC_12x10_Format:US,RGBA_ASTC_12x12_Format:FS,RGBA_ASTC_4x4_Format:bS,RGBA_ASTC_5x4_Format:MS,RGBA_ASTC_5x5_Format:CS,RGBA_ASTC_6x5_Format:RS,RGBA_ASTC_6x6_Format:DS,RGBA_ASTC_8x5_Format:LS,RGBA_ASTC_8x6_Format:IS,RGBA_ASTC_8x8_Format:wS,RGBA_BPTC_Format:kS,RGBA_ETC2_EAC_Format:xS,RGBA_PVRTC_2BPPV1_Format:vS,RGBA_PVRTC_4BPPV1_Format:gS,RGBA_S3TC_DXT1_Format:pv,RGBA_S3TC_DXT3_Format:mv,RGBA_S3TC_DXT5_Format:gv,RGBDepthPacking:XN,RGBFormat:dM,RGBIntegerFormat:KN,RGB_BPTC_SIGNED_Format:GS,RGB_BPTC_UNSIGNED_Format:HS,RGB_ETC1_Format:yS,RGB_ETC2_Format:_S,RGB_PVRTC_2BPPV1_Format:mS,RGB_PVRTC_4BPPV1_Format:pS,RGB_S3TC_DXT1_Format:dv,RGDepthPacking:qN,RGFormat:Rd,RGIntegerFormat:IA,RawShaderMaterial:OM,Ray:ug,Raycaster:JM,RectAreaLight:tB,RedFormat:LA,RedIntegerFormat:ey,ReinhardToneMapping:iM,RenderTarget:vM,RenderTarget3D:Vk,RepeatWrapping:mu,ReplaceStencilOp:$N,ReverseSubtractEquation:Gw,RingGeometry:QA,SIGNED_R11_EAC_Format:AS,SIGNED_RED_GREEN_RGTC2_Format:YS,SIGNED_RED_RGTC1_Format:VS,SIGNED_RG11_EAC_Format:TS,SRGBColorSpace:xr,SRGBTransfer:Qn,Scene:iy,ShaderChunk:hn,ShaderLib:pl,ShaderMaterial:to,ShadowMaterial:H2,Shape:_d,ShapeGeometry:$A,ShapePath:gG,ShapeUtils:ml,ShortType:uM,Skeleton:ry,SkeletonHelper:iG,SkinnedMesh:AM,Source:Cf,Sphere:Vs,SphereGeometry:uy,Spherical:Jk,SphericalHarmonics3:YM,SplineCurve:BM,SpotLight:zM,SpotLightHelper:nG,Sprite:M2,SpriteMaterial:SM,SrcAlphaFactor:rS,SrcAlphaSaturateFactor:Qw,SrcColorFactor:Yw,StaticCopyUsage:gU,StaticDrawUsage:wv,StaticReadUsage:dU,StereoCamera:bk,StreamCopyUsage:yU,StreamDrawUsage:hU,StreamReadUsage:mU,StringKeyframeTrack:Fd,SubtractEquation:kw,SubtractiveBlending:e1,TOUCH:FN,TangentSpaceNormalMap:Kf,TetrahedronGeometry:ZA,Texture:yi,TextureLoader:cy,TextureUtils:AG,Timer:Wk,TimestampQuery:xU,TorusGeometry:eE,TorusKnotGeometry:tE,Triangle:_a,TriangleFanDrawMode:XS,TriangleStripDrawMode:mM,TrianglesDrawMode:l2,TubeGeometry:nE,UVMapping:bA,Uint16BufferAttribute:yM,Uint32BufferAttribute:_M,Uint8BufferAttribute:aF,Uint8ClampedBufferAttribute:oF,Uniform:_r,UniformsGroup:Yk,UniformsLib:gt,UniformsUtils:E2,UnsignedByteType:Jr,UnsignedInt101111Type:fM,UnsignedInt248Type:Gm,UnsignedInt5999Type:cM,UnsignedIntType:Po,UnsignedShort4444Type:RA,UnsignedShort5551Type:DA,UnsignedShortType:Cd,VSMShadowMap:ud,Vector2:Ve,Vector3:ee,Vector4:ni,VectorKeyframeTrack:Bd,VideoFrameTexture:LF,VideoTexture:MM,WebGL3DRenderTarget:qU,WebGLArrayRenderTarget:XU,WebGLCoordinateSystem:Ya,WebGLCubeRenderTarget:xM,WebGLRenderTarget:tr,WebGLRenderer:vB,WebGLUtils:gB,WebGPUCoordinateSystem:Vm,WebXRController:Yx,WireframeGeometry:G2,WrapAroundEnding:Lv,ZeroCurvatureEnding:fd,ZeroFactor:Vw,ZeroSlopeEnding:hd,ZeroStencilOp:QN,createCanvasElement:_2,error:Nt,getConsoleFunction:bU,log:Ov,setConsoleFunction:TU,warn:ct,warnOnce:Km},Symbol.toStringTag,{value:"Module"}));var JT={exports:{}},QT={},$T={exports:{}},ZT={};var bL;function v5(){if(bL)return ZT;bL=1;var r=ag();function e(p,v){return p===v&&(p!==0||1/p===1/v)||p!==p&&v!==v}var t=typeof Object.is=="function"?Object.is:e,n=r.useState,i=r.useEffect,s=r.useLayoutEffect,a=r.useDebugValue;function o(p,v){var y=v(),_=n({inst:{value:y,getSnapshot:v}}),A=_[0].inst,E=_[1];return s(function(){A.value=y,A.getSnapshot=v,u(A)&&E({inst:A})},[p,y,v]),i(function(){return u(A)&&E({inst:A}),p(function(){u(A)&&E({inst:A})})},[p]),a(y),y}function u(p){var v=p.getSnapshot;p=p.value;try{var y=v();return!t(p,y)}catch{return!0}}function c(p,v){return v()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:o;return ZT.useSyncExternalStore=r.useSyncExternalStore!==void 0?r.useSyncExternalStore:h,ZT}var ML;function y5(){return ML||(ML=1,$T.exports=v5()),$T.exports}var CL;function _5(){if(CL)return QT;CL=1;var r=ag(),e=y5();function t(c,h){return c===h&&(c!==0||1/c===1/h)||c!==c&&h!==h}var n=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,s=r.useRef,a=r.useEffect,o=r.useMemo,u=r.useDebugValue;return QT.useSyncExternalStoreWithSelector=function(c,h,p,v,y){var _=s(null);if(_.current===null){var A={hasValue:!1,value:null};_.current=A}else A=_.current;_=o(function(){function T(N){if(!M){if(M=!0,R=N,N=v(N),y!==void 0&&A.hasValue){var O=A.value;if(y(O,N))return L=O}return L=N}if(O=L,n(R,N))return O;var F=v(N);return y!==void 0&&y(O,F)?(R=N,O):(R=N,L=F)}var M=!1,R,L,w=p===void 0?null:p;return[function(){return T(h())},w===null?void 0:function(){return T(w())}]},[h,p,v,y]);var E=i(c,_[0],_[1]);return a(function(){A.hasValue=!0,A.value=E},[E]),u(E),E},QT}var RL;function x5(){return RL||(RL=1,JT.exports=_5()),JT.exports}var S5=x5();const A5=EA(S5),DL=r=>{let e;const t=new Set,n=(c,h)=>{const p=typeof c=="function"?c(e):c;if(!Object.is(p,e)){const v=e;e=h??(typeof p!="object"||p===null)?p:Object.assign({},e,p),t.forEach(y=>y(e,v))}},i=()=>e,o={setState:n,getState:i,getInitialState:()=>u,subscribe:c=>(t.add(c),()=>t.delete(c))},u=e=r(n,i,o);return o},E5=(r=>r?DL(r):DL),{useSyncExternalStoreWithSelector:T5}=A5,b5=r=>r;function M5(r,e=b5,t){const n=T5(r.subscribe,r.getState,r.getInitialState,e,t);return Ow.useDebugValue(n),n}const LL=(r,e)=>{const t=E5(r),n=(i,s=e)=>M5(t,i,s);return Object.assign(n,t),n},yB=((r,e)=>r?LL(r,e):LL),C5=r=>typeof r=="object"&&typeof r.then=="function",pd=[];function _B(r,e,t=(n,i)=>n===i){if(r===e)return!0;if(!r||!e)return!1;const n=r.length;if(e.length!==n)return!1;for(let i=0;i<n;i++)if(!t(r[i],e[i]))return!1;return!0}function xB(r,e=null,t=!1,n={}){e===null&&(e=[r]);for(const s of pd)if(_B(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return n.lifespan&&n.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,n.lifespan)),s.response;if(!t)throw s.promise}const i={keys:e,equal:n.equal,remove:()=>{const s=pd.indexOf(i);s!==-1&&pd.splice(s,1)},promise:(C5(r)?r:r(...e)).then(s=>{i.response=s,n.lifespan&&n.lifespan>0&&(i.timeout=setTimeout(i.remove,n.lifespan))}).catch(s=>i.error=s)};if(pd.push(i),!t)throw i.promise}const SB=(r,e,t)=>xB(r,e,!1,t),R5=(r,e,t)=>{xB(r,e,!0,t)},D5=r=>{if(r===void 0||r.length===0)pd.splice(0,pd.length);else{const e=pd.find(t=>_B(r,t.keys,t.equal));e&&e.remove()}};var eb={exports:{}},tb={exports:{}},nb={exports:{}},ib={};var IL;function L5(){return IL||(IL=1,(function(r){function e(k,K){var j=k.length;k.push(K);e:for(;0<j;){var se=j-1>>>1,oe=k[se];if(0<i(oe,K))k[se]=K,k[j]=oe,j=se;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var K=k[0],j=k.pop();if(j!==K){k[0]=j;e:for(var se=0,oe=k.length,Y=oe>>>1;se<Y;){var Z=2*(se+1)-1,le=k[Z],pe=Z+1,Te=k[pe];if(0>i(le,j))pe<oe&&0>i(Te,le)?(k[se]=Te,k[pe]=j,se=pe):(k[se]=le,k[Z]=j,se=Z);else if(pe<oe&&0>i(Te,j))k[se]=Te,k[pe]=j,se=pe;else break e}}return K}function i(k,K){var j=k.sortIndex-K.sortIndex;return j!==0?j:k.id-K.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();r.unstable_now=function(){return a.now()-o}}var u=[],c=[],h=1,p=null,v=3,y=!1,_=!1,A=!1,E=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function R(k){for(var K=t(c);K!==null;){if(K.callback===null)n(c);else if(K.startTime<=k)n(c),K.sortIndex=K.expirationTime,e(u,K);else break;K=t(c)}}function L(k){if(A=!1,R(k),!_)if(t(u)!==null)_=!0,ie();else{var K=t(c);K!==null&&ne(L,K.startTime-k)}}var w=!1,N=-1,O=5,F=-1;function B(){return!(r.unstable_now()-F<O)}function P(){if(w){var k=r.unstable_now();F=k;var K=!0;try{e:{_=!1,A&&(A=!1,T(N),N=-1),y=!0;var j=v;try{t:{for(R(k),p=t(u);p!==null&&!(p.expirationTime>k&&B());){var se=p.callback;if(typeof se=="function"){p.callback=null,v=p.priorityLevel;var oe=se(p.expirationTime<=k);if(k=r.unstable_now(),typeof oe=="function"){p.callback=oe,R(k),K=!0;break t}p===t(u)&&n(u),R(k)}else n(u);p=t(u)}if(p!==null)K=!0;else{var Y=t(c);Y!==null&&ne(L,Y.startTime-k),K=!1}}break e}finally{p=null,v=j,y=!1}K=void 0}}finally{K?V():w=!1}}}var V;if(typeof M=="function")V=function(){M(P)};else if(typeof MessageChannel<"u"){var J=new MessageChannel,Q=J.port2;J.port1.onmessage=P,V=function(){Q.postMessage(null)}}else V=function(){E(P,0)};function ie(){w||(w=!0,V())}function ne(k,K){N=E(function(){k(r.unstable_now())},K)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(k){k.callback=null},r.unstable_continueExecution=function(){_||y||(_=!0,ie())},r.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<k?Math.floor(1e3/k):5},r.unstable_getCurrentPriorityLevel=function(){return v},r.unstable_getFirstCallbackNode=function(){return t(u)},r.unstable_next=function(k){switch(v){case 1:case 2:case 3:var K=3;break;default:K=v}var j=v;v=K;try{return k()}finally{v=j}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(k,K){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var j=v;v=k;try{return K()}finally{v=j}},r.unstable_scheduleCallback=function(k,K,j){var se=r.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?se+j:se):j=se,k){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=j+oe,k={id:h++,callback:K,priorityLevel:k,startTime:j,expirationTime:oe,sortIndex:-1},j>se?(k.sortIndex=j,e(c,k),t(u)===null&&k===t(c)&&(A?(T(N),N=-1):A=!0,ne(L,j-se))):(k.sortIndex=oe,e(u,k),_||y||(_=!0,ie())),k},r.unstable_shouldYield=B,r.unstable_wrapCallback=function(k){var K=v;return function(){var j=v;v=K;try{return k.apply(this,arguments)}finally{v=j}}}})(ib)),ib}var wL;function I5(){return wL||(wL=1,nb.exports=L5()),nb.exports}var BL;function w5(){return BL||(BL=1,(function(r){r.exports=function(e){function t(d,m,S,C){return new Hg(d,m,S,C)}function n(){}function i(d){var m="https://react.dev/errors/"+d;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var S=2;S<arguments.length;S++)m+="&args[]="+encodeURIComponent(arguments[S])}return"Minified React error #"+d+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(d){return d===null||typeof d!="object"?null:(d=Wg&&d[Wg]||d["@@iterator"],typeof d=="function"?d:null)}function a(d){if(d==null)return null;if(typeof d=="function")return d.$$typeof===Gu?null:d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case zc:return"Fragment";case Ia:return"Portal";case qg:return"Profiler";case Xg:return"StrictMode";case dp:return"Suspense";case Hl:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case po:return(d.displayName||"Context")+".Provider";case Gl:return(d._context.displayName||"Context")+".Consumer";case Vc:var m=d.render;return d=d.displayName,d||(d=m.displayName||m.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case mh:return m=d.displayName||null,m!==null?m:a(d.type)||"Memo";case wa:m=d._payload,d=d._init;try{return a(d(m))}catch{}}return null}function o(d){if(pp===void 0)try{throw Error()}catch(S){var m=S.stack.trim().match(/\n( *(at )?)/);pp=m&&m[1]||"",jg=-1<S.stack.indexOf(`
    at`)?" (<anonymous>)":-1<S.stack.indexOf("@")?"@unknown:0:0":""}return`
`+pp+d+jg}function u(d,m){if(!d||zl)return"";zl=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var C={DetermineComponentFrameRoot:function(){try{if(m){var mt=function(){throw Error()};if(Object.defineProperty(mt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(mt,[])}catch($t){var _t=$t}Reflect.construct(d,[],mt)}else{try{mt.call()}catch($t){_t=$t}d.call(mt.prototype)}}else{try{throw Error()}catch($t){_t=$t}(mt=d())&&typeof mt.catch=="function"&&mt.catch(function(){})}}catch($t){if($t&&_t&&typeof $t.stack=="string")return[$t.stack,_t.stack]}return[null,null]}};C.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var I=Object.getOwnPropertyDescriptor(C.DetermineComponentFrameRoot,"name");I&&I.configurable&&Object.defineProperty(C.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var U=C.DetermineComponentFrameRoot(),W=U[0],re=U[1];if(W&&re){var ve=W.split(`
`),Fe=re.split(`
`);for(I=C=0;C<ve.length&&!ve[C].includes("DetermineComponentFrameRoot");)C++;for(;I<Fe.length&&!Fe[I].includes("DetermineComponentFrameRoot");)I++;if(C===ve.length||I===Fe.length)for(C=ve.length-1,I=Fe.length-1;1<=C&&0<=I&&ve[C]!==Fe[I];)I--;for(;1<=C&&0<=I;C--,I--)if(ve[C]!==Fe[I]){if(C!==1||I!==1)do if(C--,I--,0>I||ve[C]!==Fe[I]){var tt=`
`+ve[C].replace(" at new "," at ");return d.displayName&&tt.includes("<anonymous>")&&(tt=tt.replace("<anonymous>",d.displayName)),tt}while(1<=C&&0<=I);break}}}finally{zl=!1,Error.prepareStackTrace=S}return(S=d?d.displayName||d.name:"")?o(S):""}function c(d){switch(d.tag){case 26:case 27:case 5:return o(d.type);case 16:return o("Lazy");case 13:return o("Suspense");case 19:return o("SuspenseList");case 0:case 15:return d=u(d.type,!1),d;case 11:return d=u(d.type.render,!1),d;case 1:return d=u(d.type,!0),d;default:return""}}function h(d){try{var m="";do m+=c(d),d=d.return;while(d);return m}catch(S){return`
Error generating stack: `+S.message+`
`+S.stack}}function p(d){var m=d,S=d;if(d.alternate)for(;m.return;)m=m.return;else{d=m;do m=d,(m.flags&4098)!==0&&(S=m.return),d=m.return;while(d)}return m.tag===3?S:null}function v(d){if(p(d)!==d)throw Error(i(188))}function y(d){var m=d.alternate;if(!m){if(m=p(d),m===null)throw Error(i(188));return m!==d?null:d}for(var S=d,C=m;;){var I=S.return;if(I===null)break;var U=I.alternate;if(U===null){if(C=I.return,C!==null){S=C;continue}break}if(I.child===U.child){for(U=I.child;U;){if(U===S)return v(I),d;if(U===C)return v(I),m;U=U.sibling}throw Error(i(188))}if(S.return!==C.return)S=I,C=U;else{for(var W=!1,re=I.child;re;){if(re===S){W=!0,S=I,C=U;break}if(re===C){W=!0,C=I,S=U;break}re=re.sibling}if(!W){for(re=U.child;re;){if(re===S){W=!0,S=U,C=I;break}if(re===C){W=!0,C=U,S=I;break}re=re.sibling}if(!W)throw Error(i(189))}}if(S.alternate!==C)throw Error(i(190))}if(S.tag!==3)throw Error(i(188));return S.stateNode.current===S?d:m}function _(d){var m=d.tag;if(m===5||m===26||m===27||m===6)return d;for(d=d.child;d!==null;){if(m=_(d),m!==null)return m;d=d.sibling}return null}function A(d){var m=d.tag;if(m===5||m===26||m===27||m===6)return d;for(d=d.child;d!==null;){if(d.tag!==4&&(m=A(d),m!==null))return m;d=d.sibling}return null}function E(d){return{current:d}}function T(d){0>el||(d.current=Th[el],Th[el]=null,el--)}function M(d,m){el++,Th[el]=d.current,d.current=m}function R(d){return d>>>=0,d===0?32:31-(bh(d)/o_|0)|0}function L(d){var m=d&42;if(m!==0)return m;switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return d&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return d}}function w(d,m){var S=d.pendingLanes;if(S===0)return 0;var C=0,I=d.suspendedLanes,U=d.pingedLanes,W=d.warmLanes;d=d.finishedLanes!==0;var re=S&134217727;return re!==0?(S=re&~I,S!==0?C=L(S):(U&=re,U!==0?C=L(U):d||(W=re&~W,W!==0&&(C=L(W))))):(re=S&~I,re!==0?C=L(re):U!==0?C=L(U):d||(W=S&~W,W!==0&&(C=L(W)))),C===0?0:m!==0&&m!==C&&(m&I)===0&&(I=C&-C,W=m&-m,I>=W||I===32&&(W&4194176)!==0)?m:C}function N(d,m){return(d.pendingLanes&~(d.suspendedLanes&~d.pingedLanes)&m)===0}function O(d,m){switch(d){case 1:case 2:case 4:case 8:return m+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function F(){var d=qc;return qc<<=1,(qc&4194176)===0&&(qc=128),d}function B(){var d=Mh;return Mh<<=1,(Mh&62914560)===0&&(Mh=4194304),d}function P(d){for(var m=[],S=0;31>S;S++)m.push(d);return m}function V(d,m){d.pendingLanes|=m,m!==268435456&&(d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0)}function J(d,m,S,C,I,U){var W=d.pendingLanes;d.pendingLanes=S,d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0,d.expiredLanes&=S,d.entangledLanes&=S,d.errorRecoveryDisabledLanes&=S,d.shellSuspendCounter=0;var re=d.entanglements,ve=d.expirationTimes,Fe=d.hiddenUpdates;for(S=W&~S;0<S;){var tt=31-lr(S),mt=1<<tt;re[tt]=0,ve[tt]=-1;var _t=Fe[tt];if(_t!==null)for(Fe[tt]=null,tt=0;tt<_t.length;tt++){var $t=_t[tt];$t!==null&&($t.lane&=-536870913)}S&=~mt}C!==0&&Q(d,C,0),U!==0&&I===0&&d.tag!==0&&(d.suspendedLanes|=U&~(W&~m))}function Q(d,m,S){d.pendingLanes|=m,d.suspendedLanes&=~m;var C=31-lr(m);d.entangledLanes|=m,d.entanglements[C]=d.entanglements[C]|1073741824|S&4194218}function ie(d,m){var S=d.entangledLanes|=m;for(d=d.entanglements;S;){var C=31-lr(S),I=1<<C;I&m|d[C]&m&&(d[C]|=m),S&=~I}}function ne(d){return d&=-d,2<d?8<d?(d&134217727)!==0?32:268435456:8:2}function k(d){if(ur&&typeof ur.onCommitFiberRoot=="function")try{ur.onCommitFiberRoot(jc,d,void 0,(d.current.flags&128)===128)}catch{}}function K(d){if(typeof f_=="function"&&M0(d),ur&&typeof ur.setStrictMode=="function")try{ur.setStrictMode(jc,d)}catch{}}function j(d,m){return d===m&&(d!==0||1/d===1/m)||d!==d&&m!==m}function se(d,m){if(typeof d=="object"&&d!==null){var S=Ip.get(d);return S!==void 0?S:(m={value:d,source:m,stack:h(m)},Ip.set(d,m),m)}return{value:d,source:m,stack:h(m)}}function oe(d,m){hi[Ti++]=Dh,hi[Ti++]=Rh,Rh=d,Dh=m}function Y(d,m,S){Ur[Fr++]=_o,Ur[Fr++]=la,Ur[Fr++]=Ba,Ba=d;var C=_o;d=la;var I=32-lr(C)-1;C&=~(1<<I),S+=1;var U=32-lr(m)+I;if(30<U){var W=I-I%5;U=(C&(1<<W)-1).toString(32),C>>=W,I-=W,_o=1<<32-lr(m)+I|S<<I|C,la=U+d}else _o=1<<U|S<<I|C,la=d}function Z(d){d.return!==null&&(oe(d,1),Y(d,1,0))}function le(d){for(;d===Rh;)Rh=hi[--Ti],hi[Ti]=null,Dh=hi[--Ti],hi[Ti]=null;for(;d===Ba;)Ba=Ur[--Fr],Ur[Fr]=null,la=Ur[--Fr],Ur[Fr]=null,_o=Ur[--Fr],Ur[Fr]=null}function pe(d,m){M(Oa,m),M(Lh,d),M(ds,null),d=Hu(m),T(ds),M(ds,d)}function Te(){T(ds),T(Lh),T(Oa)}function ce(d){d.memoizedState!==null&&M(Jc,d);var m=ds.current,S=Gy(m,d.type);m!==S&&(M(Lh,d),M(ds,S))}function Me(d){Lh.current===d&&(T(ds),T(Lh)),Jc.current===d&&(T(Jc),go?qt._currentValue=or:qt._currentValue2=or)}function Xe(d){var m=Error(i(418,""));throw Ut(se(m,d)),Ih}function nt(d,m){if(!js)throw Error(i(175));EE(d.stateNode,d.type,d.memoizedProps,m,d)||Xe(d)}function at(d){for(Ns=d.return;Ns;)switch(Ns.tag){case 3:case 27:ua=!0;return;case 5:case 13:ua=!1;return;default:Ns=Ns.return}}function Vt(d){if(!js||d!==Ns)return!1;if(!Rn)return at(d),Rn=!0,!1;var m=!1;if(As?d.tag!==3&&d.tag!==27&&(d.tag!==5||n_(d.type)&&!Yl(d.type,d.memoizedProps))&&(m=!0):d.tag!==3&&(d.tag!==5||n_(d.type)&&!Yl(d.type,d.memoizedProps))&&(m=!0),m&&Ts&&Xe(d),at(d),d.tag===13){if(!js)throw Error(i(316));if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(i(317));Ts=e_(d)}else Ts=Ns?d0(d.stateNode):null;return!0}function dn(){js&&(Ts=Ns=null,Rn=!1)}function Ut(d){kr===null?kr=[d]:kr.push(d)}function Ne(){for(var d=ql,m=Qc=ql=0;m<d;){var S=Gr[m];Gr[m++]=null;var C=Gr[m];Gr[m++]=null;var I=Gr[m];Gr[m++]=null;var U=Gr[m];if(Gr[m++]=null,C!==null&&I!==null){var W=C.pending;W===null?I.next=I:(I.next=W.next,W.next=I),C.pending=I}U!==0&&te(S,I,U)}}function We(d,m,S,C){Gr[ql++]=d,Gr[ql++]=m,Gr[ql++]=S,Gr[ql++]=C,Qc|=C,d.lanes|=C,d=d.alternate,d!==null&&(d.lanes|=C)}function Ie(d,m,S,C){return We(d,m,S,C),St(d)}function je(d,m){return We(d,null,null,m),St(d)}function te(d,m,S){d.lanes|=S;var C=d.alternate;C!==null&&(C.lanes|=S);for(var I=!1,U=d.return;U!==null;)U.childLanes|=S,C=U.alternate,C!==null&&(C.childLanes|=S),U.tag===22&&(d=U.stateNode,d===null||d._visibility&1||(I=!0)),d=U,U=U.return;I&&m!==null&&d.tag===3&&(U=d.stateNode,I=31-lr(S),U=U.hiddenUpdates,d=U[I],d===null?U[I]=[m]:d.push(m),m.lane=S|536870912)}function St(d){if(50<$u)throw $u=0,$s=null,Error(i(185));for(var m=d.return;m!==null;)d=m,m=d.return;return d.tag===3?d.stateNode:null}function $e(d){d!==Yu&&d.next===null&&(Yu===null?$c=Yu=d:Yu=Yu.next=d),Bh=!0,wh||(wh=!0,we(et))}function At(d,m){if(!Pa&&Bh){Pa=!0;do for(var S=!1,C=$c;C!==null;){if(d!==0){var I=C.pendingLanes;if(I===0)var U=0;else{var W=C.suspendedLanes,re=C.pingedLanes;U=(1<<31-lr(42|d)+1)-1,U&=I&~(W&~re),U=U&201326677?U&201326677|1:U?U|2:0}U!==0&&(S=!0,fe(C,U))}else U=cn,U=w(C,C===pn?U:0),(U&3)===0||N(C,U)||(S=!0,fe(C,U));C=C.next}while(S);Pa=!1}}function et(){Bh=wh=!1;var d=0;Wl!==0&&(Xl()&&(d=Wl),Wl=0);for(var m=Es(),S=null,C=$c;C!==null;){var I=C.next,U=$(C,m);U===0?(C.next=null,S===null?$c=I:S.next=I,I===null&&(Yu=S)):(S=C,(d!==0||(U&3)!==0)&&(Bh=!0)),C=I}At(d)}function $(d,m){for(var S=d.suspendedLanes,C=d.pingedLanes,I=d.expirationTimes,U=d.pendingLanes&-62914561;0<U;){var W=31-lr(U),re=1<<W,ve=I[W];ve===-1?((re&S)===0||(re&C)!==0)&&(I[W]=O(re,m)):ve<=m&&(d.expiredLanes|=re),U&=~re}if(m=pn,S=cn,S=w(d,d===m?S:0),C=d.callbackNode,S===0||d===m&&Jn===2||d.cancelPendingCommit!==null)return C!==null&&C!==null&&Ch(C),d.callbackNode=null,d.callbackPriority=0;if((S&3)===0||N(d,S)){if(m=S&-S,m===d.callbackPriority)return m;switch(C!==null&&Ch(C),ne(S)){case 2:case 8:S=c_;break;case 32:S=Dp;break;case 268435456:S=Lp;break;default:S=Dp}return C=z.bind(null,d),S=Wc(S,C),d.callbackPriority=m,d.callbackNode=S,m}return C!==null&&C!==null&&Ch(C),d.callbackPriority=2,d.callbackNode=null,2}function z(d,m){var S=d.callbackNode;if(fs()&&d.callbackNode!==S)return null;var C=cn;return C=w(d,d===pn?C:0),C===0?null:(ch(d,C,m),$(d,Es()),d.callbackNode!=null&&d.callbackNode===S?z.bind(null,d):null)}function fe(d,m){if(fs())return null;ch(d,m,!0)}function we(d){Yi?yp(function(){(Pt&6)!==0?Wc(b0,d):d()}):Wc(b0,d)}function He(){return Wl===0&&(Wl=F()),Wl}function Oe(d,m){if(Oh===null){var S=Oh=[];wp=0,cr=He(),jl={status:"pending",value:void 0,then:function(C){S.push(C)}}}return wp++,m.then(Et,Et),m}function Et(){if(--wp===0&&Oh!==null){jl!==null&&(jl.status="fulfilled");var d=Oh;Oh=null,cr=0,jl=null;for(var m=0;m<d.length;m++)(0,d[m])()}}function it(d,m){var S=[],C={status:"pending",value:null,reason:null,then:function(I){S.push(I)}};return d.then(function(){C.status="fulfilled",C.value=m;for(var I=0;I<S.length;I++)(0,S[I])(m)},function(I){for(C.status="rejected",C.reason=I,I=0;I<S.length;I++)(0,S[I])(void 0)}),C}function vt(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ft(d,m){d=d.updateQueue,m.updateQueue===d&&(m.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,callbacks:null})}function Ye(d){return{lane:d,tag:0,payload:null,callback:null,next:null}}function Je(d,m,S){var C=d.updateQueue;if(C===null)return null;if(C=C.shared,(Pt&2)!==0){var I=C.pending;return I===null?m.next=m:(m.next=I.next,I.next=m),C.pending=m,m=St(d),te(d,null,S),m}return We(d,C,m,S),St(d)}function ft(d,m,S){if(m=m.updateQueue,m!==null&&(m=m.shared,(S&4194176)!==0)){var C=m.lanes;C&=d.pendingLanes,S|=C,m.lanes=S,ie(d,S)}}function ht(d,m){var S=d.updateQueue,C=d.alternate;if(C!==null&&(C=C.updateQueue,S===C)){var I=null,U=null;if(S=S.firstBaseUpdate,S!==null){do{var W={lane:S.lane,tag:S.tag,payload:S.payload,callback:null,next:null};U===null?I=U=W:U=U.next=W,S=S.next}while(S!==null);U===null?I=U=m:U=U.next=m}else I=U=m;S={baseState:C.baseState,firstBaseUpdate:I,lastBaseUpdate:U,shared:C.shared,callbacks:C.callbacks},d.updateQueue=S;return}d=S.lastBaseUpdate,d===null?S.firstBaseUpdate=m:d.next=m,S.lastBaseUpdate=m}function rt(){if(Zc){var d=jl;if(d!==null)throw d}}function Qt(d,m,S,C){Zc=!1;var I=d.updateQueue;tl=!1;var U=I.firstBaseUpdate,W=I.lastBaseUpdate,re=I.shared.pending;if(re!==null){I.shared.pending=null;var ve=re,Fe=ve.next;ve.next=null,W===null?U=Fe:W.next=Fe,W=ve;var tt=d.alternate;tt!==null&&(tt=tt.updateQueue,re=tt.lastBaseUpdate,re!==W&&(re===null?tt.firstBaseUpdate=Fe:re.next=Fe,tt.lastBaseUpdate=ve))}if(U!==null){var mt=I.baseState;W=0,tt=Fe=ve=null,re=U;do{var _t=re.lane&-536870913,$t=_t!==re.lane;if($t?(cn&_t)===_t:(C&_t)===_t){_t!==0&&_t===cr&&(Zc=!0),tt!==null&&(tt=tt.next={lane:0,tag:re.tag,payload:re.payload,callback:null,next:null});e:{var pr=d,Fh=re;_t=m;var Zu=S;switch(Fh.tag){case 1:if(pr=Fh.payload,typeof pr=="function"){mt=pr.call(Zu,mt,_t);break e}mt=pr;break e;case 3:pr.flags=pr.flags&-65537|128;case 0:if(pr=Fh.payload,_t=typeof pr=="function"?pr.call(Zu,mt,_t):pr,_t==null)break e;mt=ku({},mt,_t);break e;case 2:tl=!0}}_t=re.callback,_t!==null&&(d.flags|=64,$t&&(d.flags|=8192),$t=I.callbacks,$t===null?I.callbacks=[_t]:$t.push(_t))}else $t={lane:_t,tag:re.tag,payload:re.payload,callback:re.callback,next:null},tt===null?(Fe=tt=$t,ve=mt):tt=tt.next=$t,W|=_t;if(re=re.next,re===null){if(re=I.shared.pending,re===null)break;$t=re,re=$t.next,$t.next=null,I.lastBaseUpdate=$t,I.shared.pending=null}}while(!0);tt===null&&(ve=mt),I.baseState=ve,I.firstBaseUpdate=Fe,I.lastBaseUpdate=tt,U===null&&(I.shared.lanes=0),Kr|=W,d.lanes=W,d.memoizedState=mt}}function he(d,m){if(typeof d!="function")throw Error(i(191,d));d.call(m)}function lt(d,m){var S=d.callbacks;if(S!==null)for(d.callbacks=null,d=0;d<S.length;d++)he(S[d],m)}function Ze(d,m){if(Nr(d,m))return!0;if(typeof d!="object"||d===null||typeof m!="object"||m===null)return!1;var S=Object.keys(d),C=Object.keys(m);if(S.length!==C.length)return!1;for(C=0;C<S.length;C++){var I=S[C];if(!Ph.call(m,I)||!Nr(d[I],m[I]))return!1}return!0}function pt(d){return d=d.status,d==="fulfilled"||d==="rejected"}function qe(){}function ze(d,m,S){switch(S=d[S],S===void 0?d.push(m):S!==m&&(m.then(qe,qe),m=S),m.status){case"fulfilled":return m.value;case"rejected":throw d=m.reason,d===Wn?Error(i(483)):d;default:if(typeof m.status=="string")m.then(qe,qe);else{if(d=pn,d!==null&&100<d.shellSuspendCounter)throw Error(i(482));d=m,d.status="pending",d.then(function(C){if(m.status==="pending"){var I=m;I.status="fulfilled",I.value=C}},function(C){if(m.status==="pending"){var I=m;I.status="rejected",I.reason=C}})}switch(m.status){case"fulfilled":return m.value;case"rejected":throw d=m.reason,d===Wn?Error(i(483)):d}throw Xu=m,Wn}}function st(){if(Xu===null)throw Error(i(459));var d=Xu;return Xu=null,d}function Yt(d){var m=ca;return ca+=1,xo===null&&(xo=[]),ze(xo,d,m)}function Cn(d,m){m=m.props.ref,d.ref=m!==void 0?m:null}function gn(d,m){throw m.$$typeof===Yg?Error(i(525)):(d=Object.prototype.toString.call(m),Error(i(31,d==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":d)))}function vs(d){var m=d._init;return m(d._payload)}function na(d){function m(Ce,me){if(d){var Le=Ce.deletions;Le===null?(Ce.deletions=[me],Ce.flags|=16):Le.push(me)}}function S(Ce,me){if(!d)return null;for(;me!==null;)m(Ce,me),me=me.sibling;return null}function C(Ce){for(var me=new Map;Ce!==null;)Ce.key!==null?me.set(Ce.key,Ce):me.set(Ce.index,Ce),Ce=Ce.sibling;return me}function I(Ce,me){return Ce=Os(Ce,me),Ce.index=0,Ce.sibling=null,Ce}function U(Ce,me,Le){return Ce.index=Le,d?(Le=Ce.alternate,Le!==null?(Le=Le.index,Le<me?(Ce.flags|=33554434,me):Le):(Ce.flags|=33554434,me)):(Ce.flags|=1048576,me)}function W(Ce){return d&&Ce.alternate===null&&(Ce.flags|=33554434),Ce}function re(Ce,me,Le,Qe){return me===null||me.tag!==6?(me=kl(Le,Ce.mode,Qe),me.return=Ce,me):(me=I(me,Le),me.return=Ce,me)}function ve(Ce,me,Le,Qe){var Bt=Le.type;return Bt===zc?tt(Ce,me,Le.props.children,Qe,Le.key):me!==null&&(me.elementType===Bt||typeof Bt=="object"&&Bt!==null&&Bt.$$typeof===wa&&vs(Bt)===me.type)?(me=I(me,Le.props),Cn(me,Le),me.return=Ce,me):(me=aa(Le.type,Le.key,Le.props,null,Ce.mode,Qe),Cn(me,Le),me.return=Ce,me)}function Fe(Ce,me,Le,Qe){return me===null||me.tag!==4||me.stateNode.containerInfo!==Le.containerInfo||me.stateNode.implementation!==Le.implementation?(me=Hc(Le,Ce.mode,Qe),me.return=Ce,me):(me=I(me,Le.children||[]),me.return=Ce,me)}function tt(Ce,me,Le,Qe,Bt){return me===null||me.tag!==7?(me=jo(Le,Ce.mode,Qe,Bt),me.return=Ce,me):(me=I(me,Le),me.return=Ce,me)}function mt(Ce,me,Le){if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return me=kl(""+me,Ce.mode,Le),me.return=Ce,me;if(typeof me=="object"&&me!==null){switch(me.$$typeof){case Jo:return Le=aa(me.type,me.key,me.props,null,Ce.mode,Le),Cn(Le,me),Le.return=Ce,Le;case Ia:return me=Hc(me,Ce.mode,Le),me.return=Ce,me;case wa:var Qe=me._init;return me=Qe(me._payload),mt(Ce,me,Le)}if(Vl(me)||s(me))return me=jo(me,Ce.mode,Le,null),me.return=Ce,me;if(typeof me.then=="function")return mt(Ce,Yt(me),Le);if(me.$$typeof===po)return mt(Ce,rh(Ce,me),Le);gn(Ce,me)}return null}function _t(Ce,me,Le,Qe){var Bt=me!==null?me.key:null;if(typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint")return Bt!==null?null:re(Ce,me,""+Le,Qe);if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case Jo:return Le.key===Bt?ve(Ce,me,Le,Qe):null;case Ia:return Le.key===Bt?Fe(Ce,me,Le,Qe):null;case wa:return Bt=Le._init,Le=Bt(Le._payload),_t(Ce,me,Le,Qe)}if(Vl(Le)||s(Le))return Bt!==null?null:tt(Ce,me,Le,Qe,null);if(typeof Le.then=="function")return _t(Ce,me,Yt(Le),Qe);if(Le.$$typeof===po)return _t(Ce,me,rh(Ce,Le),Qe);gn(Ce,Le)}return null}function $t(Ce,me,Le,Qe,Bt){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number"||typeof Qe=="bigint")return Ce=Ce.get(Le)||null,re(me,Ce,""+Qe,Bt);if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case Jo:return Ce=Ce.get(Qe.key===null?Le:Qe.key)||null,ve(me,Ce,Qe,Bt);case Ia:return Ce=Ce.get(Qe.key===null?Le:Qe.key)||null,Fe(me,Ce,Qe,Bt);case wa:var ri=Qe._init;return Qe=ri(Qe._payload),$t(Ce,me,Le,Qe,Bt)}if(Vl(Qe)||s(Qe))return Ce=Ce.get(Le)||null,tt(me,Ce,Qe,Bt,null);if(typeof Qe.then=="function")return $t(Ce,me,Le,Yt(Qe),Bt);if(Qe.$$typeof===po)return $t(Ce,me,Le,rh(me,Qe),Bt);gn(me,Qe)}return null}function pr(Ce,me,Le,Qe){for(var Bt=null,ri=null,Wt=me,Ln=me=0,ns=null;Wt!==null&&Ln<Le.length;Ln++){Wt.index>Ln?(ns=Wt,Wt=null):ns=Wt.sibling;var In=_t(Ce,Wt,Le[Ln],Qe);if(In===null){Wt===null&&(Wt=ns);break}d&&Wt&&In.alternate===null&&m(Ce,Wt),me=U(In,me,Ln),ri===null?Bt=In:ri.sibling=In,ri=In,Wt=ns}if(Ln===Le.length)return S(Ce,Wt),Rn&&oe(Ce,Ln),Bt;if(Wt===null){for(;Ln<Le.length;Ln++)Wt=mt(Ce,Le[Ln],Qe),Wt!==null&&(me=U(Wt,me,Ln),ri===null?Bt=Wt:ri.sibling=Wt,ri=Wt);return Rn&&oe(Ce,Ln),Bt}for(Wt=C(Wt);Ln<Le.length;Ln++)ns=$t(Wt,Ce,Ln,Le[Ln],Qe),ns!==null&&(d&&ns.alternate!==null&&Wt.delete(ns.key===null?Ln:ns.key),me=U(ns,me,Ln),ri===null?Bt=ns:ri.sibling=ns,ri=ns);return d&&Wt.forEach(function(ll){return m(Ce,ll)}),Rn&&oe(Ce,Ln),Bt}function Fh(Ce,me,Le,Qe){if(Le==null)throw Error(i(151));for(var Bt=null,ri=null,Wt=me,Ln=me=0,ns=null,In=Le.next();Wt!==null&&!In.done;Ln++,In=Le.next()){Wt.index>Ln?(ns=Wt,Wt=null):ns=Wt.sibling;var ll=_t(Ce,Wt,In.value,Qe);if(ll===null){Wt===null&&(Wt=ns);break}d&&Wt&&ll.alternate===null&&m(Ce,Wt),me=U(ll,me,Ln),ri===null?Bt=ll:ri.sibling=ll,ri=ll,Wt=ns}if(In.done)return S(Ce,Wt),Rn&&oe(Ce,Ln),Bt;if(Wt===null){for(;!In.done;Ln++,In=Le.next())In=mt(Ce,In.value,Qe),In!==null&&(me=U(In,me,Ln),ri===null?Bt=In:ri.sibling=In,ri=In);return Rn&&oe(Ce,Ln),Bt}for(Wt=C(Wt);!In.done;Ln++,In=Le.next())In=$t(Wt,Ce,Ln,In.value,Qe),In!==null&&(d&&In.alternate!==null&&Wt.delete(In.key===null?Ln:In.key),me=U(In,me,Ln),ri===null?Bt=In:ri.sibling=In,ri=In);return d&&Wt.forEach(function(Hp){return m(Ce,Hp)}),Rn&&oe(Ce,Ln),Bt}function Zu(Ce,me,Le,Qe){if(typeof Le=="object"&&Le!==null&&Le.type===zc&&Le.key===null&&(Le=Le.props.children),typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case Jo:e:{for(var Bt=Le.key;me!==null;){if(me.key===Bt){if(Bt=Le.type,Bt===zc){if(me.tag===7){S(Ce,me.sibling),Qe=I(me,Le.props.children),Qe.return=Ce,Ce=Qe;break e}}else if(me.elementType===Bt||typeof Bt=="object"&&Bt!==null&&Bt.$$typeof===wa&&vs(Bt)===me.type){S(Ce,me.sibling),Qe=I(me,Le.props),Cn(Qe,Le),Qe.return=Ce,Ce=Qe;break e}S(Ce,me);break}else m(Ce,me);me=me.sibling}Le.type===zc?(Qe=jo(Le.props.children,Ce.mode,Qe,Le.key),Qe.return=Ce,Ce=Qe):(Qe=aa(Le.type,Le.key,Le.props,null,Ce.mode,Qe),Cn(Qe,Le),Qe.return=Ce,Ce=Qe)}return W(Ce);case Ia:e:{for(Bt=Le.key;me!==null;){if(me.key===Bt)if(me.tag===4&&me.stateNode.containerInfo===Le.containerInfo&&me.stateNode.implementation===Le.implementation){S(Ce,me.sibling),Qe=I(me,Le.children||[]),Qe.return=Ce,Ce=Qe;break e}else{S(Ce,me);break}else m(Ce,me);me=me.sibling}Qe=Hc(Le,Ce.mode,Qe),Qe.return=Ce,Ce=Qe}return W(Ce);case wa:return Bt=Le._init,Le=Bt(Le._payload),Zu(Ce,me,Le,Qe)}if(Vl(Le))return pr(Ce,me,Le,Qe);if(s(Le)){if(Bt=s(Le),typeof Bt!="function")throw Error(i(150));return Le=Bt.call(Le),Fh(Ce,me,Le,Qe)}if(typeof Le.then=="function")return Zu(Ce,me,Yt(Le),Qe);if(Le.$$typeof===po)return Zu(Ce,me,rh(Ce,Le),Qe);gn(Ce,Le)}return typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint"?(Le=""+Le,me!==null&&me.tag===6?(S(Ce,me.sibling),Qe=I(me,Le),Qe.return=Ce,Ce=Qe):(S(Ce,me),Qe=kl(Le,Ce.mode,Qe),Qe.return=Ce,Ce=Qe),W(Ce)):S(Ce,me)}return function(Ce,me,Le,Qe){try{ca=0;var Bt=Zu(Ce,me,Le,Qe);return xo=null,Bt}catch(Wt){if(Wt===Wn)throw Wt;var ri=t(29,Wt,null,Ce.mode);return ri.lanes=Qe,ri.return=Ce,ri}}}function jf(d,m){d=Na,M(Hr,d),M(So,m),Na=d|m.baseLanes}function xu(){M(Hr,Na),M(So,So.current)}function Al(){Na=Hr.current,T(So),T(Hr)}function ia(d){var m=d.alternate;M(Xi,Xi.current&1),M(zr,d),fa===null&&(m===null||So.current!==null||m.memoizedState!==null)&&(fa=d)}function Su(d){if(d.tag===22){if(M(Xi,Xi.current),M(zr,d),fa===null){var m=d.alternate;m!==null&&m.memoizedState!==null&&(fa=d)}}else sa()}function sa(){M(Xi,Xi.current),M(zr,zr.current)}function as(d){T(zr),fa===d&&(fa=null),T(Xi)}function Ys(d){for(var m=d;m!==null;){if(m.tag===13){var S=m.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||Ep(S)||Eh(S)))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}function ln(){throw Error(i(321))}function Zi(d,m){if(m===null)return!1;for(var S=0;S<m.length&&S<d.length;S++)if(!Nr(d[S],m[S]))return!1;return!0}function Rr(d,m,S,C,I,U){return Ao=U,rn=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,Kt.H=d===null||d.memoizedState===null?qi:Us,nl=!1,U=S(C,I),nl=!1,di&&(U=Eu(m,S,C,I)),Au(d),U}function Au(d){Kt.H=Dn;var m=kn!==null&&kn.next!==null;if(Ao=0,Oi=kn=rn=null,ha=!1,bi=0,ef=null,m)throw Error(i(300));d===null||Pi||(d=d.dependencies,d!==null&&Rl(d)&&(Pi=!0))}function Eu(d,m,S,C){rn=d;var I=0;do{if(di&&(ef=null),bi=0,di=!1,25<=I)throw Error(i(301));if(I+=1,Oi=kn=null,d.updateQueue!=null){var U=d.updateQueue;U.lastEffect=null,U.events=null,U.stores=null,U.memoCache!=null&&(U.memoCache.index=0)}Kt.H=Ql,U=m(S,C)}while(di);return U}function Hd(){var d=Kt.H,m=d.useState()[0];return m=typeof m.then=="function"?Ma(m):m,d=d.useState()[0],(kn!==null?kn.memoizedState:null)!==d&&(rn.flags|=1024),m}function Tu(){var d=Nh!==0;return Nh=0,d}function Go(d,m,S){m.updateQueue=d.updateQueue,m.flags&=-2053,d.lanes&=~S}function bu(d){if(ha){for(d=d.memoizedState;d!==null;){var m=d.queue;m!==null&&(m.pending=null),d=d.next}ha=!1}Ao=0,Oi=kn=rn=null,di=!1,bi=Nh=0,ef=null}function wi(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Oi===null?rn.memoizedState=Oi=d:Oi=Oi.next=d,Oi}function $n(){if(kn===null){var d=rn.alternate;d=d!==null?d.memoizedState:null}else d=kn.next;var m=Oi===null?rn.memoizedState:Oi.next;if(m!==null)Oi=m,kn=d;else{if(d===null)throw rn.alternate===null?Error(i(467)):Error(i(310));kn=d,d={memoizedState:kn.memoizedState,baseState:kn.baseState,baseQueue:kn.baseQueue,queue:kn.queue,next:null},Oi===null?rn.memoizedState=Oi=d:Oi=Oi.next=d}return Oi}function Ma(d){var m=bi;return bi+=1,ef===null&&(ef=[]),d=ze(ef,d,m),m=rn,(Oi===null?m.memoizedState:Oi.next)===null&&(m=m.alternate,Kt.H=m===null||m.memoizedState===null?qi:Us),d}function Ca(d){if(d!==null&&typeof d=="object"){if(typeof d.then=="function")return Ma(d);if(d.$$typeof===po)return _s(d)}throw Error(i(438,String(d)))}function X(d){var m=null,S=rn.updateQueue;if(S!==null&&(m=S.memoCache),m==null){var C=rn.alternate;C!==null&&(C=C.updateQueue,C!==null&&(C=C.memoCache,C!=null&&(m={data:C.data.map(function(I){return I.slice()}),index:0})))}if(m==null&&(m={data:[],index:0}),S===null&&(S=Op(),rn.updateQueue=S),S.memoCache=m,S=m.data[m.index],S===void 0)for(S=m.data[m.index]=Array(d),C=0;C<d;C++)S[C]=ky;return m.index++,S}function de(d,m){return typeof m=="function"?m(d):m}function De(d){var m=$n();return be(m,kn,d)}function be(d,m,S){var C=d.queue;if(C===null)throw Error(i(311));C.lastRenderedReducer=S;var I=d.baseQueue,U=C.pending;if(U!==null){if(I!==null){var W=I.next;I.next=U.next,U.next=W}m.baseQueue=I=U,C.pending=null}if(U=d.baseState,I===null)d.memoizedState=U;else{m=I.next;var re=W=null,ve=null,Fe=m,tt=!1;do{var mt=Fe.lane&-536870913;if(mt!==Fe.lane?(cn&mt)===mt:(Ao&mt)===mt){var _t=Fe.revertLane;if(_t===0)ve!==null&&(ve=ve.next={lane:0,revertLane:0,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null}),mt===cr&&(tt=!0);else if((Ao&_t)===_t){Fe=Fe.next,_t===cr&&(tt=!0);continue}else mt={lane:0,revertLane:Fe.revertLane,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null},ve===null?(re=ve=mt,W=U):ve=ve.next=mt,rn.lanes|=_t,Kr|=_t;mt=Fe.action,nl&&S(U,mt),U=Fe.hasEagerState?Fe.eagerState:S(U,mt)}else _t={lane:mt,revertLane:Fe.revertLane,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null},ve===null?(re=ve=_t,W=U):ve=ve.next=_t,rn.lanes|=mt,Kr|=mt;Fe=Fe.next}while(Fe!==null&&Fe!==m);if(ve===null?W=U:ve.next=re,!Nr(U,d.memoizedState)&&(Pi=!0,tt&&(S=jl,S!==null)))throw S;d.memoizedState=U,d.baseState=W,d.baseQueue=ve,C.lastRenderedState=U}return I===null&&(C.lanes=0),[d.memoizedState,C.dispatch]}function _e(d){var m=$n(),S=m.queue;if(S===null)throw Error(i(311));S.lastRenderedReducer=d;var C=S.dispatch,I=S.pending,U=m.memoizedState;if(I!==null){S.pending=null;var W=I=I.next;do U=d(U,W.action),W=W.next;while(W!==I);Nr(U,m.memoizedState)||(Pi=!0),m.memoizedState=U,m.baseQueue===null&&(m.baseState=U),S.lastRenderedState=U}return[U,C]}function ot(d,m,S){var C=rn,I=$n(),U=Rn;if(U){if(S===void 0)throw Error(i(407));S=S()}else S=m();var W=!Nr((kn||I).memoizedState,S);if(W&&(I.memoizedState=S,Pi=!0),I=I.queue,Dr(bt.bind(null,C,I,d),[d]),I.getSnapshot!==m||W||Oi!==null&&Oi.memoizedState.tag&1){if(C.flags|=2048,Si(9,ut.bind(null,C,I,S,m),{destroy:void 0},null),pn===null)throw Error(i(349));U||(Ao&60)!==0||xt(C,m,S)}return S}function xt(d,m,S){d.flags|=16384,d={getSnapshot:m,value:S},m=rn.updateQueue,m===null?(m=Op(),rn.updateQueue=m,m.stores=[d]):(S=m.stores,S===null?m.stores=[d]:S.push(d))}function ut(d,m,S,C){m.value=S,m.getSnapshot=C,Rt(m)&&kt(d)}function bt(d,m,S){return S(function(){Rt(m)&&kt(d)})}function Rt(d){var m=d.getSnapshot;d=d.value;try{var S=m();return!Nr(d,S)}catch{return!0}}function kt(d){var m=je(d,2);m!==null&&Bs(m,d,2)}function Mt(d){var m=wi();if(typeof d=="function"){var S=d;if(d=S(),nl){K(!0);try{S()}finally{K(!1)}}}return m.memoizedState=m.baseState=d,m.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:de,lastRenderedState:d},m}function Ht(d,m,S,C){return d.baseState=S,be(d,kn,typeof C=="function"?C:de)}function Un(d,m,S,C,I){if(Du(d))throw Error(i(485));if(d=m.action,d!==null){var U={payload:I,action:d,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(W){U.listeners.push(W)}};Kt.T!==null?S(!0):U.isTransition=!1,C(U),S=m.pending,S===null?(U.next=m.pending=U,ui(m,U)):(U.next=S.next,m.pending=S.next=U)}}function ui(d,m){var S=m.action,C=m.payload,I=d.state;if(m.isTransition){var U=Kt.T,W={};Kt.T=W;try{var re=S(I,C),ve=Kt.S;ve!==null&&ve(W,re),Zn(d,m,re)}catch(Fe){It(d,m,Fe)}finally{Kt.T=U}}else try{U=S(I,C),Zn(d,m,U)}catch(Fe){It(d,m,Fe)}}function Zn(d,m,S){S!==null&&typeof S=="object"&&typeof S.then=="function"?S.then(function(C){Fn(d,m,C)},function(C){return It(d,m,C)}):Fn(d,m,S)}function Fn(d,m,S){m.status="fulfilled",m.value=S,Pn(m),d.state=S,m=d.pending,m!==null&&(S=m.next,S===m?d.pending=null:(S=S.next,m.next=S,ui(d,S)))}function It(d,m,S){var C=d.pending;if(d.pending=null,C!==null){C=C.next;do m.status="rejected",m.reason=S,Pn(m),m=m.next;while(m!==C)}d.action=null}function Pn(d){d=d.listeners;for(var m=0;m<d.length;m++)(0,d[m])()}function Jt(d,m){return m}function os(d,m){if(Rn){var S=pn.formState;if(S!==null){e:{var C=rn;if(Rn){if(Ts){var I=Xy(Ts,ua);if(I){Ts=d0(I),C=qy(I);break e}}Xe(C)}C=!1}C&&(m=S[0])}}S=wi(),S.memoizedState=S.baseState=m,C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jt,lastRenderedState:m},S.queue=C,S=Yd.bind(null,rn,C),C.dispatch=S,C=Mt(!1);var U=Xd.bind(null,rn,!1,C.queue);return C=wi(),I={state:m,dispatch:null,action:d,pending:null},C.queue=I,S=Un.bind(null,rn,I,U,S),I.dispatch=S,C.memoizedState=d,[m,S,!1]}function ro(d){var m=$n();return ls(m,kn,d)}function ls(d,m,S){m=be(d,m,Jt)[0],d=De(de)[0],m=typeof m=="object"&&m!==null&&typeof m.then=="function"?Ma(m):m;var C=$n(),I=C.queue,U=I.dispatch;return S!==C.memoizedState&&(rn.flags|=2048,Si(9,ra.bind(null,I,S),{destroy:void 0},null)),[m,U,d]}function ra(d,m){d.action=m}function Hn(d){var m=$n(),S=kn;if(S!==null)return ls(m,S,d);$n(),m=m.memoizedState,S=$n();var C=S.queue.dispatch;return S.memoizedState=d,[m,C,!1]}function Si(d,m,S,C){return d={tag:d,create:m,inst:S,deps:C,next:null},m=rn.updateQueue,m===null&&(m=Op(),rn.updateQueue=m),S=m.lastEffect,S===null?m.lastEffect=d.next=d:(C=S.next,S.next=d,d.next=C,m.lastEffect=d),d}function zi(){return $n().memoizedState}function Vi(d,m,S,C){var I=wi();rn.flags|=d,I.memoizedState=Si(1|m,S,{destroy:void 0},C===void 0?null:C)}function Ki(d,m,S,C){var I=$n();C=C===void 0?null:C;var U=I.memoizedState.inst;kn!==null&&C!==null&&Zi(C,kn.memoizedState.deps)?I.memoizedState=Si(m,S,U,C):(rn.flags|=d,I.memoizedState=Si(1|m,S,U,C))}function Mu(d,m){Vi(8390656,8,d,m)}function Dr(d,m){Ki(2048,8,d,m)}function py(d,m){return Ki(4,2,d,m)}function my(d,m){return Ki(4,4,d,m)}function Jf(d,m){if(typeof m=="function"){d=d();var S=m(d);return function(){typeof S=="function"?S():m(null)}}if(m!=null)return d=d(),m.current=d,function(){m.current=null}}function ao(d,m,S){S=S!=null?S.concat([d]):null,Ki(4,4,Jf.bind(null,m,d),S)}function Qf(){}function zd(d,m){var S=$n();m=m===void 0?null:m;var C=S.memoizedState;return m!==null&&Zi(m,C[1])?C[0]:(S.memoizedState=[d,m],d)}function Cu(d,m){var S=$n();m=m===void 0?null:m;var C=S.memoizedState;if(m!==null&&Zi(m,C[1]))return C[0];if(C=d(),nl){K(!0);try{d()}finally{K(!1)}}return S.memoizedState=[C,m],C}function El(d,m,S){return S===void 0||(Ao&1073741824)!==0?d.memoizedState=m:(d.memoizedState=S,d=uo(),rn.lanes|=d,Kr|=d,S)}function vg(d,m,S,C){return Nr(S,m)?S:So.current!==null?(d=El(d,S,C),Nr(d,m)||(Pi=!0),d):(Ao&42)===0?(Pi=!0,d.memoizedState=S):(d=uo(),rn.lanes|=d,Kr|=d,m)}function Vd(d,m,S,C,I){var U=es();Ps(U!==0&&8>U?U:8);var W=Kt.T,re={};Kt.T=re,Xd(d,!1,m,S);try{var ve=I(),Fe=Kt.S;if(Fe!==null&&Fe(re,ve),ve!==null&&typeof ve=="object"&&typeof ve.then=="function"){var tt=it(ve,C);bl(d,m,tt,Ws(d))}else bl(d,m,C,Ws(d))}catch(mt){bl(d,m,{then:function(){},status:"rejected",reason:mt},Ws())}finally{Ps(U),Kt.T=W}}function yg(d){var m=d.memoizedState;if(m!==null)return m;m={memoizedState:or,baseState:or,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:de,lastRenderedState:or},next:null};var S={};return m.next={memoizedState:S,baseState:S,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:de,lastRenderedState:S},next:null},d.memoizedState=m,d=d.alternate,d!==null&&(d.memoizedState=m),m}function Ru(){return _s(qt)}function oo(){return $n().memoizedState}function Kd(){return $n().memoizedState}function $f(d){for(var m=d.return;m!==null;){switch(m.tag){case 24:case 3:var S=Ws();d=Ye(S);var C=Je(m,d,S);C!==null&&(Bs(C,m,S),ft(C,m,S)),m={cache:Qd()},d.payload=m;return}m=m.return}}function Tl(d,m,S){var C=Ws();S={lane:C,revertLane:0,action:S,hasEagerState:!1,eagerState:null,next:null},Du(d)?Zf(m,S):(S=Ie(d,m,S,C),S!==null&&(Bs(S,d,C),_g(S,m,C)))}function Yd(d,m,S){var C=Ws();bl(d,m,S,C)}function bl(d,m,S,C){var I={lane:C,revertLane:0,action:S,hasEagerState:!1,eagerState:null,next:null};if(Du(d))Zf(m,I);else{var U=d.alternate;if(d.lanes===0&&(U===null||U.lanes===0)&&(U=m.lastRenderedReducer,U!==null))try{var W=m.lastRenderedState,re=U(W,S);if(I.hasEagerState=!0,I.eagerState=re,Nr(re,W))return We(d,m,I,0),pn===null&&Ne(),!1}catch{}if(S=Ie(d,m,I,C),S!==null)return Bs(S,d,C),_g(S,m,C),!0}return!1}function Xd(d,m,S,C){if(C={lane:2,revertLane:He(),action:C,hasEagerState:!1,eagerState:null,next:null},Du(d)){if(m)throw Error(i(479))}else m=Ie(d,S,C,2),m!==null&&Bs(m,d,2)}function Du(d){var m=d.alternate;return d===rn||m!==null&&m===rn}function Zf(d,m){di=ha=!0;var S=d.pending;S===null?m.next=m:(m.next=S.next,S.next=m),d.pending=m}function _g(d,m,S){if((S&4194176)!==0){var C=m.lanes;C&=d.pendingLanes,S|=C,m.lanes=S,ie(d,S)}}function Is(d,m,S,C){m=d.memoizedState,S=S(C,m),S=S==null?m:ku({},m,S),d.memoizedState=S,d.lanes===0&&(d.updateQueue.baseState=S)}function Ml(d,m,S,C,I,U,W){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(C,U,W):m.prototype&&m.prototype.isPureReactComponent?!Ze(S,C)||!Ze(I,U):!0}function eh(d,m,S,C){d=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(S,C),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(S,C),m.state!==d&&Pp.enqueueReplaceState(m,m.state,null)}function Ra(d,m){var S=m;if("ref"in m){S={};for(var C in m)C!=="ref"&&(S[C]=m[C])}if(d=d.defaultProps){S===m&&(S=ku({},S));for(var I in d)S[I]===void 0&&(S[I]=d[I])}return S}function qd(d,m){try{var S=d.onUncaughtError;S(m.value,{componentStack:m.stack})}catch(C){setTimeout(function(){throw C})}}function Wd(d,m,S){try{var C=d.onCaughtError;C(S.value,{componentStack:S.stack,errorBoundary:m.tag===1?m.stateNode:null})}catch(I){setTimeout(function(){throw I})}}function th(d,m,S){return S=Ye(S),S.tag=3,S.payload={element:null},S.callback=function(){qd(d,m)},S}function Cc(d){return d=Ye(d),d.tag=3,d}function nh(d,m,S,C){var I=S.type.getDerivedStateFromError;if(typeof I=="function"){var U=C.value;d.payload=function(){return I(U)},d.callback=function(){Wd(m,S,C)}}var W=S.stateNode;W!==null&&typeof W.componentDidCatch=="function"&&(d.callback=function(){Wd(m,S,C),typeof I!="function"&&(Xr===null?Xr=new Set([this]):Xr.add(this));var re=C.stack;this.componentDidCatch(C.value,{componentStack:re!==null?re:""})})}function gy(d,m,S,C,I){if(S.flags|=32768,C!==null&&typeof C=="object"&&typeof C.then=="function"){if(m=S.alternate,m!==null&&Lu(m,S,I,!0),S=zr.current,S!==null){switch(S.tag){case 13:return fa===null?ar():S.alternate===null&&Tn===0&&(Tn=3),S.flags&=-257,S.flags|=65536,S.lanes=I,C===Bp?S.flags|=16384:(m=S.updateQueue,m===null?S.updateQueue=new Set([C]):m.add(C),fp(d,C,I)),!1;case 22:return S.flags|=65536,C===Bp?S.flags|=16384:(m=S.updateQueue,m===null?(m={transitions:null,markerInstances:null,retryQueue:new Set([C])},S.updateQueue=m):(S=m.retryQueue,S===null?m.retryQueue=new Set([C]):S.add(C)),fp(d,C,I)),!1}throw Error(i(435,S.tag))}return fp(d,C,I),ar(),!1}if(Rn)return m=zr.current,m!==null?((m.flags&65536)===0&&(m.flags|=256),m.flags|=65536,m.lanes=I,C!==Ih&&(d=Error(i(422),{cause:C}),Ut(se(d,S)))):(C!==Ih&&(m=Error(i(423),{cause:C}),Ut(se(m,S))),d=d.current.alternate,d.flags|=65536,I&=-I,d.lanes|=I,C=se(C,S),I=th(d.stateNode,C,I),ht(d,I),Tn!==4&&(Tn=2)),!1;var U=Error(i(520),{cause:C});if(U=se(U,S),nf===null?nf=[U]:nf.push(U),Tn!==4&&(Tn=2),m===null)return!0;C=se(C,S),S=m;do{switch(S.tag){case 3:return S.flags|=65536,d=I&-I,S.lanes|=d,d=th(S.stateNode,C,d),ht(S,d),!1;case 1:if(m=S.type,U=S.stateNode,(S.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(Xr===null||!Xr.has(U))))return S.flags|=65536,I&=-I,S.lanes|=I,I=Cc(I),nh(I,d,S,C),ht(S,I),!1}S=S.return}while(S!==null);return!1}function ys(d,m,S,C){m.child=d===null?R0(m,null,S,C):Jl(m,d.child,S,C)}function vy(d,m,S,C,I){S=S.render;var U=m.ref;if("ref"in C){var W={};for(var re in C)re!=="ref"&&(W[re]=C[re])}else W=C;return Iu(m),C=Rr(d,m,S,W,U,I),re=Tu(),d!==null&&!Pi?(Go(d,m,I),Ho(d,m,I)):(Rn&&re&&Z(m),m.flags|=1,ys(d,m,C,I),m.child)}function yy(d,m,S,C,I){if(d===null){var U=S.type;return typeof U=="function"&&!qo(U)&&U.defaultProps===void 0&&S.compare===null?(m.tag=15,m.type=U,jd(d,m,U,C,I)):(d=aa(S.type,null,C,m,m.mode,I),d.ref=m.ref,d.return=m,m.child=d)}if(U=d.child,!Mg(d,I)){var W=U.memoizedProps;if(S=S.compare,S=S!==null?S:Ze,S(W,C)&&d.ref===m.ref)return Ho(d,m,I)}return m.flags|=1,d=Os(U,C),d.ref=m.ref,d.return=m,m.child=d}function jd(d,m,S,C,I){if(d!==null){var U=d.memoizedProps;if(Ze(U,C)&&d.ref===m.ref)if(Pi=!1,m.pendingProps=C=U,Mg(d,I))(d.flags&131072)!==0&&(Pi=!0);else return m.lanes=d.lanes,Ho(d,m,I)}return xg(d,m,S,C,I)}function _y(d,m,S){var C=m.pendingProps,I=C.children,U=(m.stateNode._pendingVisibility&2)!==0,W=d!==null?d.memoizedState:null;if(ih(d,m),C.mode==="hidden"||U){if((m.flags&128)!==0){if(C=W!==null?W.baseLanes|S:S,d!==null){for(I=m.child=d.child,U=0;I!==null;)U=U|I.lanes|I.childLanes,I=I.sibling;m.childLanes=U&~C}else m.childLanes=0,m.child=null;return xy(d,m,C,S)}if((S&536870912)!==0)m.memoizedState={baseLanes:0,cachePool:null},d!==null&&$d(m,W!==null?W.cachePool:null),W!==null?jf(m,W):xu(),Su(m);else return m.lanes=m.childLanes=536870912,xy(d,m,W!==null?W.baseLanes|S:S,S)}else W!==null?($d(m,W.cachePool),jf(m,W),sa(),m.memoizedState=null):(d!==null&&$d(m,null),xu(),sa());return ys(d,m,I,S),m.child}function xy(d,m,S,C){var I=Dl();return I=I===null?null:{parent:go?zn._currentValue:zn._currentValue2,pool:I},m.memoizedState={baseLanes:S,cachePool:I},d!==null&&$d(m,null),xu(),Su(m),d!==null&&Lu(d,m,C,!0),null}function ih(d,m){var S=m.ref;if(S===null)d!==null&&d.ref!==null&&(m.flags|=2097664);else{if(typeof S!="function"&&typeof S!="object")throw Error(i(284));(d===null||d.ref!==S)&&(m.flags|=2097664)}}function xg(d,m,S,C,I){return Iu(m),S=Rr(d,m,S,C,void 0,I),C=Tu(),d!==null&&!Pi?(Go(d,m,I),Ho(d,m,I)):(Rn&&C&&Z(m),m.flags|=1,ys(d,m,S,I),m.child)}function Sy(d,m,S,C,I,U){return Iu(m),m.updateQueue=null,S=Eu(m,C,S,I),Au(d),C=Tu(),d!==null&&!Pi?(Go(d,m,U),Ho(d,m,U)):(Rn&&C&&Z(m),m.flags|=1,ys(d,m,S,U),m.child)}function Sg(d,m,S,C,I){if(Iu(m),m.stateNode===null){var U=Ku,W=S.contextType;typeof W=="object"&&W!==null&&(U=_s(W)),U=new S(C,U),m.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,U.updater=Pp,m.stateNode=U,U._reactInternals=m,U=m.stateNode,U.props=C,U.state=m.memoizedState,U.refs={},vt(m),W=S.contextType,U.context=typeof W=="object"&&W!==null?_s(W):Ku,U.state=m.memoizedState,W=S.getDerivedStateFromProps,typeof W=="function"&&(Is(m,S,W,C),U.state=m.memoizedState),typeof S.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(W=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),W!==U.state&&Pp.enqueueReplaceState(U,U.state,null),Qt(m,C,U,I),rt(),U.state=m.memoizedState),typeof U.componentDidMount=="function"&&(m.flags|=4194308),C=!0}else if(d===null){U=m.stateNode;var re=m.memoizedProps,ve=Ra(S,re);U.props=ve;var Fe=U.context,tt=S.contextType;W=Ku,typeof tt=="object"&&tt!==null&&(W=_s(tt));var mt=S.getDerivedStateFromProps;tt=typeof mt=="function"||typeof U.getSnapshotBeforeUpdate=="function",re=m.pendingProps!==re,tt||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(re||Fe!==W)&&eh(m,U,C,W),tl=!1;var _t=m.memoizedState;U.state=_t,Qt(m,C,U,I),rt(),Fe=m.memoizedState,re||_t!==Fe||tl?(typeof mt=="function"&&(Is(m,S,mt,C),Fe=m.memoizedState),(ve=tl||Ml(m,S,ve,C,_t,Fe,W))?(tt||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount()),typeof U.componentDidMount=="function"&&(m.flags|=4194308)):(typeof U.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=C,m.memoizedState=Fe),U.props=C,U.state=Fe,U.context=W,C=ve):(typeof U.componentDidMount=="function"&&(m.flags|=4194308),C=!1)}else{U=m.stateNode,Ft(d,m),W=m.memoizedProps,tt=Ra(S,W),U.props=tt,mt=m.pendingProps,_t=U.context,Fe=S.contextType,ve=Ku,typeof Fe=="object"&&Fe!==null&&(ve=_s(Fe)),re=S.getDerivedStateFromProps,(Fe=typeof re=="function"||typeof U.getSnapshotBeforeUpdate=="function")||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(W!==mt||_t!==ve)&&eh(m,U,C,ve),tl=!1,_t=m.memoizedState,U.state=_t,Qt(m,C,U,I),rt();var $t=m.memoizedState;W!==mt||_t!==$t||tl||d!==null&&d.dependencies!==null&&Rl(d.dependencies)?(typeof re=="function"&&(Is(m,S,re,C),$t=m.memoizedState),(tt=tl||Ml(m,S,tt,C,_t,$t,ve)||d!==null&&d.dependencies!==null&&Rl(d.dependencies))?(Fe||typeof U.UNSAFE_componentWillUpdate!="function"&&typeof U.componentWillUpdate!="function"||(typeof U.componentWillUpdate=="function"&&U.componentWillUpdate(C,$t,ve),typeof U.UNSAFE_componentWillUpdate=="function"&&U.UNSAFE_componentWillUpdate(C,$t,ve)),typeof U.componentDidUpdate=="function"&&(m.flags|=4),typeof U.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof U.componentDidUpdate!="function"||W===d.memoizedProps&&_t===d.memoizedState||(m.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||W===d.memoizedProps&&_t===d.memoizedState||(m.flags|=1024),m.memoizedProps=C,m.memoizedState=$t),U.props=C,U.state=$t,U.context=ve,C=tt):(typeof U.componentDidUpdate!="function"||W===d.memoizedProps&&_t===d.memoizedState||(m.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||W===d.memoizedProps&&_t===d.memoizedState||(m.flags|=1024),C=!1)}return U=C,ih(d,m),C=(m.flags&128)!==0,U||C?(U=m.stateNode,S=C&&typeof S.getDerivedStateFromError!="function"?null:U.render(),m.flags|=1,d!==null&&C?(m.child=Jl(m,d.child,null,I),m.child=Jl(m,null,S,I)):ys(d,m,S,I),m.memoizedState=U.state,d=m.child):d=Ho(d,m,I),d}function Ay(d,m,S,C){return dn(),m.flags|=256,ys(d,m,S,C),m.child}function Ag(d){return{baseLanes:d,cachePool:Cy()}}function Eg(d,m,S){return d=d!==null?d.childLanes&~S:0,m&&(d|=dr),d}function Ey(d,m,S){var C=m.pendingProps,I=!1,U=(m.flags&128)!==0,W;if((W=U)||(W=d!==null&&d.memoizedState===null?!1:(Xi.current&2)!==0),W&&(I=!0,m.flags&=-129),W=(m.flags&32)!==0,m.flags&=-33,d===null){if(Rn){if(I?ia(m):sa(),Rn){var re=Ts,ve;(ve=re)&&(re=$y(re,ua),re!==null?(m.memoizedState={dehydrated:re,treeContext:Ba!==null?{id:_o,overflow:la}:null,retryLane:536870912},ve=t(18,null,null,0),ve.stateNode=re,ve.return=m,m.child=ve,Ns=m,Ts=null,ve=!0):ve=!1),ve||Xe(m)}if(re=m.memoizedState,re!==null&&(re=re.dehydrated,re!==null))return Eh(re)?m.lanes=16:m.lanes=536870912,null;as(m)}return re=C.children,C=C.fallback,I?(sa(),I=m.mode,re=Tg({mode:"hidden",children:re},I),C=jo(C,I,S,null),re.return=m,C.return=m,re.sibling=C,m.child=re,I=m.child,I.memoizedState=Ag(S),I.childLanes=Eg(d,W,S),m.memoizedState=Fs,C):(ia(m),sh(m,re))}if(ve=d.memoizedState,ve!==null&&(re=ve.dehydrated,re!==null)){if(U)m.flags&256?(ia(m),m.flags&=-257,m=bg(d,m,S)):m.memoizedState!==null?(sa(),m.child=d.child,m.flags|=128,m=null):(sa(),I=C.fallback,re=m.mode,C=Tg({mode:"visible",children:C.children},re),I=jo(I,re,S,null),I.flags|=2,C.return=m,I.return=m,C.sibling=I,m.child=C,Jl(m,d.child,null,S),C=m.child,C.memoizedState=Ag(S),C.childLanes=Eg(d,W,S),m.memoizedState=Fs,m=I);else if(ia(m),Eh(re))W=Yy(re).digest,C=Error(i(419)),C.stack="",C.digest=W,Ut({value:C,source:null,stack:null}),m=bg(d,m,S);else if(Pi||Lu(d,m,S,!1),W=(S&d.childLanes)!==0,Pi||W){if(W=pn,W!==null){if(C=S&-S,(C&42)!==0)C=1;else switch(C){case 2:C=1;break;case 8:C=4;break;case 32:C=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:C=64;break;case 268435456:C=134217728;break;default:C=0}if(C=(C&(W.suspendedLanes|S))!==0?0:C,C!==0&&C!==ve.retryLane)throw ve.retryLane=C,je(d,C),Bs(W,d,C),d_}Ep(re)||ar(),m=bg(d,m,S)}else Ep(re)?(m.flags|=128,m.child=d.child,m=Uu.bind(null,d),AE(re,m),m=null):(d=ve.treeContext,js&&(Ts=jy(re),Ns=m,Rn=!0,kr=null,ua=!1,d!==null&&(Ur[Fr++]=_o,Ur[Fr++]=la,Ur[Fr++]=Ba,_o=d.id,la=d.overflow,Ba=m)),m=sh(m,C.children),m.flags|=4096);return m}return I?(sa(),I=C.fallback,re=m.mode,ve=d.child,U=ve.sibling,C=Os(ve,{mode:"hidden",children:C.children}),C.subtreeFlags=ve.subtreeFlags&31457280,U!==null?I=Os(U,I):(I=jo(I,re,S,null),I.flags|=2),I.return=m,C.return=m,C.sibling=I,m.child=C,C=I,I=m.child,re=d.child.memoizedState,re===null?re=Ag(S):(ve=re.cachePool,ve!==null?(U=go?zn._currentValue:zn._currentValue2,ve=ve.parent!==U?{parent:U,pool:U}:ve):ve=Cy(),re={baseLanes:re.baseLanes|S,cachePool:ve}),I.memoizedState=re,I.childLanes=Eg(d,W,S),m.memoizedState=Fs,C):(ia(m),S=d.child,d=S.sibling,S=Os(S,{mode:"visible",children:C.children}),S.return=m,S.sibling=null,d!==null&&(W=m.deletions,W===null?(m.deletions=[d],m.flags|=16):W.push(d)),m.child=S,m.memoizedState=null,S)}function sh(d,m){return m=Tg({mode:"visible",children:m},d.mode),m.return=d,d.child=m}function Tg(d,m){return hp(d,m,0,null)}function bg(d,m,S){return Jl(m,d.child,null,S),d=sh(m,m.pendingProps.children),d.flags|=2,m.memoizedState=null,d}function Ty(d,m,S){d.lanes|=m;var C=d.alternate;C!==null&&(C.lanes|=m),Cg(d.return,m,S)}function Jd(d,m,S,C,I){var U=d.memoizedState;U===null?d.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:C,tail:S,tailMode:I}:(U.isBackwards=m,U.rendering=null,U.renderingStartTime=0,U.last=C,U.tail=S,U.tailMode=I)}function by(d,m,S){var C=m.pendingProps,I=C.revealOrder,U=C.tail;if(ys(d,m,C.children,S),C=Xi.current,(C&2)!==0)C=C&1|2,m.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=m.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&Ty(d,S,m);else if(d.tag===19)Ty(d,S,m);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===m)break e;for(;d.sibling===null;){if(d.return===null||d.return===m)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}C&=1}switch(M(Xi,C),I){case"forwards":for(S=m.child,I=null;S!==null;)d=S.alternate,d!==null&&Ys(d)===null&&(I=S),S=S.sibling;S=I,S===null?(I=m.child,m.child=null):(I=S.sibling,S.sibling=null),Jd(m,!1,I,S,U);break;case"backwards":for(S=null,I=m.child,m.child=null;I!==null;){if(d=I.alternate,d!==null&&Ys(d)===null){m.child=I;break}d=I.sibling,I.sibling=S,S=I,I=d}Jd(m,!0,S,null,U);break;case"together":Jd(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function Ho(d,m,S){if(d!==null&&(m.dependencies=d.dependencies),Kr|=m.lanes,(S&m.childLanes)===0)if(d!==null){if(Lu(d,m,S,!1),(S&m.childLanes)===0)return null}else return null;if(d!==null&&m.child!==d.child)throw Error(i(153));if(m.child!==null){for(d=m.child,S=Os(d,d.pendingProps),m.child=S,S.return=m;d.sibling!==null;)d=d.sibling,S=S.sibling=Os(d,d.pendingProps),S.return=m;S.sibling=null}return m.child}function Mg(d,m){return(d.lanes&m)!==0?!0:(d=d.dependencies,!!(d!==null&&Rl(d)))}function _E(d,m,S){switch(m.tag){case 3:pe(m,m.stateNode.containerInfo),Cl(m,zn,d.memoizedState.cache),dn();break;case 27:case 5:ce(m);break;case 4:pe(m,m.stateNode.containerInfo);break;case 10:Cl(m,m.type,m.memoizedProps.value);break;case 13:var C=m.memoizedState;if(C!==null)return C.dehydrated!==null?(ia(m),m.flags|=128,null):(S&m.child.childLanes)!==0?Ey(d,m,S):(ia(m),d=Ho(d,m,S),d!==null?d.sibling:null);ia(m);break;case 19:var I=(d.flags&128)!==0;if(C=(S&m.childLanes)!==0,C||(Lu(d,m,S,!1),C=(S&m.childLanes)!==0),I){if(C)return by(d,m,S);m.flags|=128}if(I=m.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),M(Xi,Xi.current),C)break;return null;case 22:case 23:return m.lanes=0,_y(d,m,S);case 24:Cl(m,zn,d.memoizedState.cache)}return Ho(d,m,S)}function My(d,m,S){if(d!==null)if(d.memoizedProps!==m.pendingProps)Pi=!0;else{if(!Mg(d,S)&&(m.flags&128)===0)return Pi=!1,_E(d,m,S);Pi=(d.flags&131072)!==0}else Pi=!1,Rn&&(m.flags&1048576)!==0&&Y(m,Dh,m.index);switch(m.lanes=0,m.tag){case 16:e:{d=m.pendingProps;var C=m.elementType,I=C._init;if(C=I(C._payload),m.type=C,typeof C=="function")qo(C)?(d=Ra(C,d),m.tag=1,m=Sg(null,m,C,d,S)):(m.tag=0,m=xg(null,m,C,d,S));else{if(C!=null){if(I=C.$$typeof,I===Vc){m.tag=11,m=vy(null,m,C,d,S);break e}else if(I===mh){m.tag=14,m=yy(null,m,C,d,S);break e}}throw m=a(C)||C,Error(i(306,m,""))}}return m;case 0:return xg(d,m,m.type,m.pendingProps,S);case 1:return C=m.type,I=Ra(C,m.pendingProps),Sg(d,m,C,I,S);case 3:e:{if(pe(m,m.stateNode.containerInfo),d===null)throw Error(i(387));var U=m.pendingProps;I=m.memoizedState,C=I.element,Ft(d,m),Qt(m,U,null,S);var W=m.memoizedState;if(U=W.cache,Cl(m,zn,U),U!==I.cache&&Rg(m,[zn],S,!0),rt(),U=W.element,js&&I.isDehydrated)if(I={element:U,isDehydrated:!1,cache:W.cache},m.updateQueue.baseState=I,m.memoizedState=I,m.flags&256){m=Ay(d,m,U,S);break e}else if(U!==C){C=se(Error(i(424)),m),Ut(C),m=Ay(d,m,U,S);break e}else for(js&&(Ts=Wy(m.stateNode.containerInfo),Ns=m,Rn=!0,kr=null,ua=!0),S=R0(m,null,U,S),m.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(dn(),U===C){m=Ho(d,m,S);break e}ys(d,m,U,S)}m=m.child}return m;case 26:if(Pr)return ih(d,m),d===null?(S=Rp(m.type,null,m.pendingProps,null))?m.memoizedState=S:Rn||(m.stateNode=TE(m.type,m.pendingProps,Oa.current,m)):m.memoizedState=Rp(m.type,d.memoizedProps,m.pendingProps,d.memoizedState),null;case 27:if(As)return ce(m),d===null&&As&&Rn&&(C=m.stateNode=T0(m.type,m.pendingProps,Oa.current,ds.current,!1),Ns=m,ua=!0,Ts=Tp(C)),C=m.pendingProps.children,d!==null||Rn?ys(d,m,C,S):m.child=Jl(m,null,C,S),ih(d,m),m.child;case 5:return d===null&&Rn&&(i_(m.type,m.pendingProps,ds.current),(I=C=Ts)&&(C=Jy(C,m.type,m.pendingProps,ua),C!==null?(m.stateNode=C,Ns=m,Ts=Tp(C),ua=!1,I=!0):I=!1),I||Xe(m)),ce(m),I=m.type,U=m.pendingProps,W=d!==null?d.memoizedProps:null,C=U.children,Yl(I,U)?C=null:W!==null&&Yl(I,W)&&(m.flags|=32),m.memoizedState!==null&&(I=Rr(d,m,Hd,null,null,S),go?qt._currentValue=I:qt._currentValue2=I),ih(d,m),ys(d,m,C,S),m.child;case 6:return d===null&&Rn&&(s_(m.pendingProps,ds.current),(d=S=Ts)&&(S=Qy(S,m.pendingProps,ua),S!==null?(m.stateNode=S,Ns=m,Ts=null,d=!0):d=!1),d||Xe(m)),null;case 13:return Ey(d,m,S);case 4:return pe(m,m.stateNode.containerInfo),C=m.pendingProps,d===null?m.child=Jl(m,null,C,S):ys(d,m,C,S),m.child;case 11:return vy(d,m,m.type,m.pendingProps,S);case 7:return ys(d,m,m.pendingProps,S),m.child;case 8:return ys(d,m,m.pendingProps.children,S),m.child;case 12:return ys(d,m,m.pendingProps.children,S),m.child;case 10:return C=m.pendingProps,Cl(m,m.type,C.value),ys(d,m,C.children,S),m.child;case 9:return I=m.type._context,C=m.pendingProps.children,Iu(m),I=_s(I),C=C(I),m.flags|=1,ys(d,m,C,S),m.child;case 14:return yy(d,m,m.type,m.pendingProps,S);case 15:return jd(d,m,m.type,m.pendingProps,S);case 19:return by(d,m,S);case 22:return _y(d,m,S);case 24:return Iu(m),C=_s(zn),d===null?(I=Dl(),I===null&&(I=pn,U=Qd(),I.pooledCache=U,U.refCount++,U!==null&&(I.pooledCacheLanes|=S),I=U),m.memoizedState={parent:C,cache:I},vt(m),Cl(m,zn,I)):((d.lanes&S)!==0&&(Ft(d,m),Qt(m,null,null,S),rt()),I=d.memoizedState,U=m.memoizedState,I.parent!==C?(I={parent:C,cache:C},m.memoizedState=I,m.lanes===0&&(m.memoizedState=m.updateQueue.baseState=I),Cl(m,zn,C)):(C=U.cache,Cl(m,zn,C),C!==I.cache&&Rg(m,[zn],S,!0))),ys(d,m,m.pendingProps.children,S),m.child;case 29:throw m.pendingProps}throw Error(i(156,m.tag))}function Cl(d,m,S){go?(M(fr,m._currentValue),m._currentValue=S):(M(fr,m._currentValue2),m._currentValue2=S)}function zo(d){var m=fr.current;go?d._currentValue=m:d._currentValue2=m,T(fr)}function Cg(d,m,S){for(;d!==null;){var C=d.alternate;if((d.childLanes&m)!==m?(d.childLanes|=m,C!==null&&(C.childLanes|=m)):C!==null&&(C.childLanes&m)!==m&&(C.childLanes|=m),d===S)break;d=d.return}}function Rg(d,m,S,C){var I=d.child;for(I!==null&&(I.return=d);I!==null;){var U=I.dependencies;if(U!==null){var W=I.child;U=U.firstContext;e:for(;U!==null;){var re=U;U=I;for(var ve=0;ve<m.length;ve++)if(re.context===m[ve]){U.lanes|=S,re=U.alternate,re!==null&&(re.lanes|=S),Cg(U.return,S,d),C||(W=null);break e}U=re.next}}else if(I.tag===18){if(W=I.return,W===null)throw Error(i(341));W.lanes|=S,U=W.alternate,U!==null&&(U.lanes|=S),Cg(W,S,d),W=null}else W=I.child;if(W!==null)W.return=I;else for(W=I;W!==null;){if(W===d){W=null;break}if(I=W.sibling,I!==null){I.return=W.return,W=I;break}W=W.return}I=W}}function Lu(d,m,S,C){d=null;for(var I=m,U=!1;I!==null;){if(!U){if((I.flags&524288)!==0)U=!0;else if((I.flags&262144)!==0)break}if(I.tag===10){var W=I.alternate;if(W===null)throw Error(i(387));if(W=W.memoizedProps,W!==null){var re=I.type;Nr(I.pendingProps.value,W.value)||(d!==null?d.push(re):d=[re])}}else if(I===Jc.current){if(W=I.alternate,W===null)throw Error(i(387));W.memoizedState.memoizedState!==I.memoizedState.memoizedState&&(d!==null?d.push(qt):d=[qt])}I=I.return}d!==null&&Rg(m,d,S,C),m.flags|=262144}function Rl(d){for(d=d.firstContext;d!==null;){var m=d.context;if(!Nr(go?m._currentValue:m._currentValue2,d.memoizedValue))return!0;d=d.next}return!1}function Iu(d){$l=d,Mi=null,d=d.dependencies,d!==null&&(d.firstContext=null)}function _s(d){return Dg($l,d)}function rh(d,m){return $l===null&&Iu(d),Dg(d,m)}function Dg(d,m){var S=go?m._currentValue:m._currentValue2;if(m={context:m,memoizedValue:S,next:null},Mi===null){if(d===null)throw Error(i(308));Mi=m,d.dependencies={lanes:0,firstContext:m},d.flags|=524288}else Mi=Mi.next=m;return S}function Qd(){return{controller:new p_,data:new Map,refCount:0}}function Rc(d){d.refCount--,d.refCount===0&&il(qu,function(){d.controller.abort()})}function Dl(){var d=sl.current;return d!==null?d:pn.pooledCache}function $d(d,m){m===null?M(sl,sl.current):M(sl,m.pool)}function Cy(){var d=Dl();return d===null?null:{parent:go?zn._currentValue:zn._currentValue2,pool:d}}function Lr(d){d.flags|=4}function Lg(d,m){if(d!==null&&d.child===m.child)return!1;if((m.flags&16)!==0)return!0;for(d=m.child;d!==null;){if((d.flags&13878)!==0||(d.subtreeFlags&13878)!==0)return!0;d=d.sibling}return!1}function Zd(d,m,S,C){if(Ss)for(S=m.child;S!==null;){if(S.tag===5||S.tag===6)mo(d,S.stateNode);else if(!(S.tag===4||As&&S.tag===27)&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===m)break;for(;S.sibling===null;){if(S.return===null||S.return===m)return;S=S.return}S.sibling.return=S.return,S=S.sibling}else if(Br)for(var I=m.child;I!==null;){if(I.tag===5){var U=I.stateNode;S&&C&&(U=f0(U,I.type,I.memoizedProps)),mo(d,U)}else if(I.tag===6)U=I.stateNode,S&&C&&(U=h0(U,I.memoizedProps)),mo(d,U);else if(I.tag!==4){if(I.tag===22&&I.memoizedState!==null)U=I.child,U!==null&&(U.return=I),Zd(d,I,!0,!0);else if(I.child!==null){I.child.return=I,I=I.child;continue}}if(I===m)break;for(;I.sibling===null;){if(I.return===null||I.return===m)return;I=I.return}I.sibling.return=I.return,I=I.sibling}}function Dc(d,m,S,C){if(Br)for(var I=m.child;I!==null;){if(I.tag===5){var U=I.stateNode;S&&C&&(U=f0(U,I.type,I.memoizedProps)),u0(d,U)}else if(I.tag===6)U=I.stateNode,S&&C&&(U=h0(U,I.memoizedProps)),u0(d,U);else if(I.tag!==4){if(I.tag===22&&I.memoizedState!==null)U=I.child,U!==null&&(U.return=I),Dc(d,I,!(I.memoizedProps!==null&&I.memoizedProps.mode==="manual"),!0);else if(I.child!==null){I.child.return=I,I=I.child;continue}}if(I===m)break;for(;I.sibling===null;){if(I.return===null||I.return===m)return;I=I.return}I.sibling.return=I.return,I=I.sibling}}function Lc(d,m){if(Br&&Lg(d,m)){d=m.stateNode;var S=d.containerInfo,C=Ap();Dc(C,m,!1,!1),d.pendingChildren=C,Lr(m),Ky(S,C)}}function Ig(d,m,S,C){if(Ss)d.memoizedProps!==C&&Lr(m);else if(Br){var I=d.stateNode,U=d.memoizedProps;if((d=Lg(d,m))||U!==C){var W=ds.current;U=l0(I,S,U,C,!d,null),U===I?m.stateNode=I:(Qo(U,S,C,W)&&Lr(m),m.stateNode=U,d?Zd(U,m,!1,!1):Lr(m))}else m.stateNode=I}}function Ic(d,m,S){if(Hy(m,S)){if(d.flags|=16777216,!$o(m,S))if(fh())d.flags|=8192;else throw Xu=Bp,C0}else d.flags&=-16777217}function wg(d,m){if(r_(m)){if(d.flags|=16777216,!A0(m))if(fh())d.flags|=8192;else throw Xu=Bp,C0}else d.flags&=-16777217}function ah(d,m){m!==null&&(d.flags|=4),d.flags&16384&&(m=d.tag!==22?B():536870912,d.lanes|=m,al|=m)}function wu(d,m){if(!Rn)switch(d.tailMode){case"hidden":m=d.tail;for(var S=null;m!==null;)m.alternate!==null&&(S=m),m=m.sibling;S===null?d.tail=null:S.sibling=null;break;case"collapsed":S=d.tail;for(var C=null;S!==null;)S.alternate!==null&&(C=S),S=S.sibling;C===null?m||d.tail===null?d.tail=null:d.tail.sibling=null:C.sibling=null}}function ci(d){var m=d.alternate!==null&&d.alternate.child===d.child,S=0,C=0;if(m)for(var I=d.child;I!==null;)S|=I.lanes|I.childLanes,C|=I.subtreeFlags&31457280,C|=I.flags&31457280,I.return=d,I=I.sibling;else for(I=d.child;I!==null;)S|=I.lanes|I.childLanes,C|=I.subtreeFlags,C|=I.flags,I.return=d,I=I.sibling;return d.subtreeFlags|=C,d.childLanes=S,m}function Ry(d,m,S){var C=m.pendingProps;switch(le(m),m.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ci(m),null;case 1:return ci(m),null;case 3:return S=m.stateNode,C=null,d!==null&&(C=d.memoizedState.cache),m.memoizedState.cache!==C&&(m.flags|=2048),zo(zn),Te(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(d===null||d.child===null)&&(Vt(m)?Lr(m):d===null||d.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,kr!==null&&(Ko(kr),kr=null))),Lc(d,m),ci(m),null;case 26:if(Pr){S=m.type;var I=m.memoizedState;return d===null?(Lr(m),I!==null?(ci(m),wg(m,I)):(ci(m),Ic(m,S,C))):I?I!==d.memoizedState?(Lr(m),ci(m),wg(m,I)):(ci(m),m.flags&=-16777217):(Ss?d.memoizedProps!==C&&Lr(m):Ig(d,m,S,C),ci(m),Ic(m,S,C)),null}case 27:if(As){if(Me(m),S=Oa.current,I=m.type,d!==null&&m.stateNode!=null)Ss?d.memoizedProps!==C&&Lr(m):Ig(d,m,I,C);else{if(!C){if(m.stateNode===null)throw Error(i(166));return ci(m),null}d=ds.current,Vt(m)?nt(m,d):(d=T0(I,C,S,d,!0),m.stateNode=d,Lr(m))}return ci(m),null}case 5:if(Me(m),S=m.type,d!==null&&m.stateNode!=null)Ig(d,m,S,C);else{if(!C){if(m.stateNode===null)throw Error(i(166));return ci(m),null}d=ds.current,Vt(m)?nt(m,d):(I=Qg(S,C,Oa.current,d,m),Zd(I,m,!1,!1),m.stateNode=I,Qo(I,S,C,d)&&Lr(m))}return ci(m),Ic(m,m.type,m.pendingProps),null;case 6:if(d&&m.stateNode!=null)S=d.memoizedProps,Ss?S!==C&&Lr(m):Br&&(S!==C?(m.stateNode=gp(C,Oa.current,ds.current,m),Lr(m)):m.stateNode=d.stateNode);else{if(typeof C!="string"&&m.stateNode===null)throw Error(i(166));if(d=Oa.current,S=ds.current,Vt(m)){if(!js)throw Error(i(176));if(d=m.stateNode,S=m.memoizedProps,C=null,I=Ns,I!==null)switch(I.tag){case 27:case 5:C=I.memoizedProps}Zy(d,S,m,C)||Xe(m)}else m.stateNode=gp(C,d,S,m)}return ci(m),null;case 13:if(C=m.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(I=Vt(m),C!==null&&C.dehydrated!==null){if(d===null){if(!I)throw Error(i(318));if(!js)throw Error(i(344));if(I=m.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(i(317));Yc(I,m)}else dn(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;ci(m),I=!1}else kr!==null&&(Ko(kr),kr=null),I=!0;if(!I)return m.flags&256?(as(m),m):(as(m),null)}if(as(m),(m.flags&128)!==0)return m.lanes=S,m;if(S=C!==null,d=d!==null&&d.memoizedState!==null,S){C=m.child,I=null,C.alternate!==null&&C.alternate.memoizedState!==null&&C.alternate.memoizedState.cachePool!==null&&(I=C.alternate.memoizedState.cachePool.pool);var U=null;C.memoizedState!==null&&C.memoizedState.cachePool!==null&&(U=C.memoizedState.cachePool.pool),U!==I&&(C.flags|=2048)}return S!==d&&S&&(m.child.flags|=8192),ah(m,m.updateQueue),ci(m),null;case 4:return Te(),Lc(d,m),d===null&&e0(m.stateNode.containerInfo),ci(m),null;case 10:return zo(m.type),ci(m),null;case 19:if(T(Xi),I=m.memoizedState,I===null)return ci(m),null;if(C=(m.flags&128)!==0,U=I.rendering,U===null)if(C)wu(I,!1);else{if(Tn!==0||d!==null&&(d.flags&128)!==0)for(d=m.child;d!==null;){if(U=Ys(d),U!==null){for(m.flags|=128,wu(I,!1),d=U.updateQueue,m.updateQueue=d,ah(m,d),m.subtreeFlags=0,d=S,S=m.child;S!==null;)Wo(S,d),S=S.sibling;return M(Xi,Xi.current&1|2),m.child}d=d.sibling}I.tail!==null&&Es()>xi&&(m.flags|=128,C=!0,wu(I,!1),m.lanes=4194304)}else{if(!C)if(d=Ys(U),d!==null){if(m.flags|=128,C=!0,d=d.updateQueue,m.updateQueue=d,ah(m,d),wu(I,!0),I.tail===null&&I.tailMode==="hidden"&&!U.alternate&&!Rn)return ci(m),null}else 2*Es()-I.renderingStartTime>xi&&S!==536870912&&(m.flags|=128,C=!0,wu(I,!1),m.lanes=4194304);I.isBackwards?(U.sibling=m.child,m.child=U):(d=I.last,d!==null?d.sibling=U:m.child=U,I.last=U)}return I.tail!==null?(m=I.tail,I.rendering=m,I.tail=m.sibling,I.renderingStartTime=Es(),m.sibling=null,d=Xi.current,M(Xi,C?d&1|2:d&1),m):(ci(m),null);case 22:case 23:return as(m),Al(),C=m.memoizedState!==null,d!==null?d.memoizedState!==null!==C&&(m.flags|=8192):C&&(m.flags|=8192),C?(S&536870912)!==0&&(m.flags&128)===0&&(ci(m),m.subtreeFlags&6&&(m.flags|=8192)):ci(m),S=m.updateQueue,S!==null&&ah(m,S.retryQueue),S=null,d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(S=d.memoizedState.cachePool.pool),C=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(C=m.memoizedState.cachePool.pool),C!==S&&(m.flags|=2048),d!==null&&T(sl),null;case 24:return S=null,d!==null&&(S=d.memoizedState.cache),m.memoizedState.cache!==S&&(m.flags|=2048),zo(zn),ci(m),null;case 25:return null}throw Error(i(156,m.tag))}function Dy(d,m){switch(le(m),m.tag){case 1:return d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 3:return zo(zn),Te(),d=m.flags,(d&65536)!==0&&(d&128)===0?(m.flags=d&-65537|128,m):null;case 26:case 27:case 5:return Me(m),null;case 13:if(as(m),d=m.memoizedState,d!==null&&d.dehydrated!==null){if(m.alternate===null)throw Error(i(340));dn()}return d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 19:return T(Xi),null;case 4:return Te(),null;case 10:return zo(m.type),null;case 22:case 23:return as(m),Al(),d!==null&&T(sl),d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 24:return zo(zn),null;case 25:return null;default:return null}}function Bg(d,m){switch(le(m),m.tag){case 3:zo(zn),Te();break;case 26:case 27:case 5:Me(m);break;case 4:Te();break;case 13:as(m);break;case 19:T(Xi);break;case 10:zo(m.type);break;case 22:case 23:as(m),Al(),d!==null&&T(sl);break;case 24:zo(zn)}}function oh(d,m){try{var S=m.updateQueue,C=S!==null?S.lastEffect:null;if(C!==null){var I=C.next;S=I;do{if((S.tag&d)===d){C=void 0;var U=S.create,W=S.inst;C=U(),W.destroy=C}S=S.next}while(S!==I)}}catch(re){vn(m,m.return,re)}}function Ll(d,m,S){try{var C=m.updateQueue,I=C!==null?C.lastEffect:null;if(I!==null){var U=I.next;C=U;do{if((C.tag&d)===d){var W=C.inst,re=W.destroy;if(re!==void 0){W.destroy=void 0,I=m;var ve=S;try{re()}catch(Fe){vn(I,ve,Fe)}}}C=C.next}while(C!==U)}}catch(Fe){vn(m,m.return,Fe)}}function Ly(d){var m=d.updateQueue;if(m!==null){var S=d.stateNode;try{lt(m,S)}catch(C){vn(d,d.return,C)}}}function Iy(d,m,S){S.props=Ra(d.type,d.memoizedProps),S.state=d.memoizedState;try{S.componentWillUnmount()}catch(C){vn(d,m,C)}}function Bu(d,m){try{var S=d.ref;if(S!==null){var C=d.stateNode;switch(d.tag){case 26:case 27:case 5:var I=Kc(C);break;default:I=C}typeof S=="function"?d.refCleanup=S(I):S.current=I}}catch(U){vn(d,m,U)}}function fi(d,m){var S=d.ref,C=d.refCleanup;if(S!==null)if(typeof C=="function")try{C()}catch(I){vn(d,m,I)}finally{d.refCleanup=null,d=d.alternate,d!=null&&(d.refCleanup=null)}else if(typeof S=="function")try{S(null)}catch(I){vn(d,m,I)}else S.current=null}function wc(d){var m=d.type,S=d.memoizedProps,C=d.stateNode;try{SE(C,m,S,d)}catch(I){vn(d,d.return,I)}}function Og(d,m,S){try{s0(d.stateNode,d.type,S,m,d)}catch(C){vn(d,d.return,C)}}function Pg(d){return d.tag===5||d.tag===3||(Pr?d.tag===26:!1)||(As?d.tag===27:!1)||d.tag===4}function ep(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||Pg(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&(!As||d.tag!==27)&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function tp(d,m,S){var C=d.tag;if(C===5||C===6)d=d.stateNode,m?a0(S,d,m):zy(S,d);else if(!(C===4||As&&C===27)&&(d=d.child,d!==null))for(tp(d,m,S),d=d.sibling;d!==null;)tp(d,m,S),d=d.sibling}function Bc(d,m,S){var C=d.tag;if(C===5||C===6)d=d.stateNode,m?r0(S,d,m):i0(S,d);else if(!(C===4||As&&C===27)&&(d=d.child,d!==null))for(Bc(d,m,S),d=d.sibling;d!==null;)Bc(d,m,S),d=d.sibling}function wy(d,m,S){d=d.containerInfo;try{c0(d,S)}catch(C){vn(m,m.return,C)}}function Oc(d,m){for(Kl(d.containerInfo),Ci=m;Ci!==null;)if(d=Ci,m=d.child,(d.subtreeFlags&1028)!==0&&m!==null)m.return=d,Ci=m;else for(;Ci!==null;){d=Ci;var S=d.alternate;switch(m=d.flags,d.tag){case 0:break;case 11:case 15:break;case 1:if((m&1024)!==0&&S!==null){m=void 0;var C=d,I=S.memoizedProps;S=S.memoizedState;var U=C.stateNode;try{var W=Ra(C.type,I,C.elementType===C.type);m=U.getSnapshotBeforeUpdate(W,S),U.__reactInternalSnapshotBeforeUpdate=m}catch(re){vn(C,C.return,re)}}break;case 3:(m&1024)!==0&&Ss&&Sp(d.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((m&1024)!==0)throw Error(i(163))}if(m=d.sibling,m!==null){m.return=d.return,Ci=m;break}Ci=d.return}return W=Wu,Wu=!1,W}function np(d,m,S){var C=S.flags;switch(S.tag){case 0:case 11:case 15:lo(d,S),C&4&&oh(5,S);break;case 1:if(lo(d,S),C&4)if(d=S.stateNode,m===null)try{d.componentDidMount()}catch(re){vn(S,S.return,re)}else{var I=Ra(S.type,m.memoizedProps);m=m.memoizedState;try{d.componentDidUpdate(I,m,d.__reactInternalSnapshotBeforeUpdate)}catch(re){vn(S,S.return,re)}}C&64&&Ly(S),C&512&&Bu(S,S.return);break;case 3:if(lo(d,S),C&64&&(C=S.updateQueue,C!==null)){if(d=null,S.child!==null)switch(S.child.tag){case 27:case 5:d=Kc(S.child.stateNode);break;case 1:d=S.child.stateNode}try{lt(C,d)}catch(re){vn(S,S.return,re)}}break;case 26:if(Pr){lo(d,S),C&512&&Bu(S,S.return);break}case 27:case 5:lo(d,S),m===null&&C&4&&wc(S),C&512&&Bu(S,S.return);break;case 12:lo(d,S);break;case 13:lo(d,S),C&4&&Il(d,S);break;case 22:if(I=S.memoizedState!==null||ts,!I){m=m!==null&&m.memoizedState!==null||_i;var U=ts,W=_i;ts=I,(_i=m)&&!W?Bl(d,S,(S.subtreeFlags&8772)!==0):lo(d,S),ts=U,_i=W}C&512&&(S.memoizedProps.mode==="manual"?Bu(S,S.return):fi(S,S.return));break;default:lo(d,S)}}function Pc(d){var m=d.alternate;m!==null&&(d.alternate=null,Pc(m)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(m=d.stateNode,m!==null&&t0(m)),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function Ir(d,m,S){for(S=S.child;S!==null;)ip(d,m,S),S=S.sibling}function ip(d,m,S){if(ur&&typeof ur.onCommitFiberUnmount=="function")try{ur.onCommitFiberUnmount(jc,S)}catch{}switch(S.tag){case 26:if(Pr){_i||fi(S,m),Ir(d,m,S),S.memoizedState?v0(S.memoizedState):S.stateNode&&x0(S.stateNode);break}case 27:if(As){_i||fi(S,m);var C=Ni,I=hr;Ni=S.stateNode,Ir(d,m,S),a_(S.stateNode),Ni=C,hr=I;break}case 5:_i||fi(S,m);case 6:if(Ss){if(C=Ni,I=hr,Ni=null,Ir(d,m,S),Ni=C,hr=I,Ni!==null)if(hr)try{Bi(Ni,S.stateNode)}catch(U){vn(S,m,U)}else try{Js(Ni,S.stateNode)}catch(U){vn(S,m,U)}}else Ir(d,m,S);break;case 18:Ss&&Ni!==null&&(hr?p0(Ni,S.stateNode):t_(Ni,S.stateNode));break;case 4:Ss?(C=Ni,I=hr,Ni=S.stateNode.containerInfo,hr=!0,Ir(d,m,S),Ni=C,hr=I):(Br&&wy(S.stateNode,S,Ap()),Ir(d,m,S));break;case 0:case 11:case 14:case 15:_i||Ll(2,S,m),_i||Ll(4,S,m),Ir(d,m,S);break;case 1:_i||(fi(S,m),C=S.stateNode,typeof C.componentWillUnmount=="function"&&Iy(S,m,C)),Ir(d,m,S);break;case 21:Ir(d,m,S);break;case 22:_i||fi(S,m),_i=(C=_i)||S.memoizedState!==null,Ir(d,m,S),_i=C;break;default:Ir(d,m,S)}}function Il(d,m){if(js&&m.memoizedState===null&&(d=m.alternate,d!==null&&(d=d.memoizedState,d!==null&&(d=d.dehydrated,d!==null))))try{Mp(d)}catch(S){vn(m,m.return,S)}}function Nc(d){switch(d.tag){case 13:case 19:var m=d.stateNode;return m===null&&(m=d.stateNode=new tf),m;case 22:return d=d.stateNode,m=d._retryCache,m===null&&(m=d._retryCache=new tf),m;default:throw Error(i(435,d.tag))}}function lh(d,m){var S=Nc(d);m.forEach(function(C){var I=Gg.bind(null,d,C);S.has(C)||(S.add(C),C.then(I,I))})}function Xs(d,m){var S=m.deletions;if(S!==null)for(var C=0;C<S.length;C++){var I=S[C],U=d,W=m;if(Ss){var re=W;e:for(;re!==null;){switch(re.tag){case 27:case 5:Ni=re.stateNode,hr=!1;break e;case 3:Ni=re.stateNode.containerInfo,hr=!0;break e;case 4:Ni=re.stateNode.containerInfo,hr=!0;break e}re=re.return}if(Ni===null)throw Error(i(160));ip(U,W,I),Ni=null,hr=!1}else ip(U,W,I);U=I.alternate,U!==null&&(U.return=null),I.return=null}if(m.subtreeFlags&13878)for(m=m.child;m!==null;)wl(m,d),m=m.sibling}function wl(d,m){var S=d.alternate,C=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:Xs(m,d),sr(d),C&4&&(Ll(3,d,d.return),oh(3,d),Ll(5,d,d.return));break;case 1:Xs(m,d),sr(d),C&512&&(_i||S===null||fi(S,S.return)),C&64&&ts&&(d=d.updateQueue,d!==null&&(C=d.callbacks,C!==null&&(S=d.shared.hiddenCallbacks,d.shared.hiddenCallbacks=S===null?C:S.concat(C))));break;case 26:if(Pr){var I=Qs;Xs(m,d),sr(d),C&512&&(_i||S===null||fi(S,S.return)),C&4&&(C=S!==null?S.memoizedState:null,m=d.memoizedState,S===null?m===null?d.stateNode===null?d.stateNode=y0(I,d.type,d.memoizedProps,d):_0(I,d.type,d.stateNode):d.stateNode=g0(I,m,d.memoizedProps):C!==m?(C===null?S.stateNode!==null&&x0(S.stateNode):v0(C),m===null?_0(I,d.type,d.stateNode):g0(I,m,d.memoizedProps)):m===null&&d.stateNode!==null&&Og(d,d.memoizedProps,S.memoizedProps));break}case 27:if(As&&C&4&&d.alternate===null){I=d.stateNode;var U=d.memoizedProps;try{bE(I),ME(d.type,U,I,d)}catch(tt){vn(d,d.return,tt)}}case 5:if(Xs(m,d),sr(d),C&512&&(_i||S===null||fi(S,S.return)),Ss){if(d.flags&32){m=d.stateNode;try{Sh(m)}catch(tt){vn(d,d.return,tt)}}C&4&&d.stateNode!=null&&(m=d.memoizedProps,Og(d,m,S!==null?S.memoizedProps:m)),C&1024&&(Zl=!0)}break;case 6:if(Xs(m,d),sr(d),C&4&&Ss){if(d.stateNode===null)throw Error(i(162));C=d.memoizedProps,S=S!==null?S.memoizedProps:C,m=d.stateNode;try{Vy(m,S,C)}catch(tt){vn(d,d.return,tt)}}break;case 3:if(Pr?(S0(),I=Qs,Qs=Cp(m.containerInfo),Xs(m,d),Qs=I):Xs(m,d),sr(d),C&4){if(Ss&&js&&S!==null&&S.memoizedState.isDehydrated)try{bp(m.containerInfo)}catch(tt){vn(d,d.return,tt)}if(Br){C=m.containerInfo,S=m.pendingChildren;try{c0(C,S)}catch(tt){vn(d,d.return,tt)}}}Zl&&(Zl=!1,Ng(d));break;case 4:Pr?(S=Qs,Qs=Cp(d.stateNode.containerInfo),Xs(m,d),sr(d),Qs=S):(Xs(m,d),sr(d)),C&4&&Br&&wy(d.stateNode,d,d.stateNode.pendingChildren);break;case 12:Xs(m,d),sr(d);break;case 13:Xs(m,d),sr(d),d.child.flags&8192&&d.memoizedState!==null!=(S!==null&&S.memoizedState!==null)&&(Eo=Es()),C&4&&(C=d.updateQueue,C!==null&&(d.updateQueue=null,lh(d,C)));break;case 22:C&512&&(_i||S===null||fi(S,S.return)),I=d.memoizedState!==null;var W=S!==null&&S.memoizedState!==null,re=ts,ve=_i;if(ts=re||I,_i=ve||W,Xs(m,d),_i=ve,ts=re,sr(d),m=d.stateNode,m._current=d,m._visibility&=-3,m._visibility|=m._pendingVisibility&2,C&8192&&(m._visibility=I?m._visibility&-2:m._visibility|1,I&&(m=ts||_i,S===null||W||m||Uc(d)),Ss&&(d.memoizedProps===null||d.memoizedProps.mode!=="manual"))){e:if(S=null,Ss)for(m=d;;){if(m.tag===5||Pr&&m.tag===26||As&&m.tag===27){if(S===null){W=S=m;try{U=W.stateNode,I?Ah(U):o0(W.stateNode,W.memoizedProps)}catch(tt){vn(W,W.return,tt)}}}else if(m.tag===6){if(S===null){W=m;try{var Fe=W.stateNode;I?xp(Fe):Zo(Fe,W.memoizedProps)}catch(tt){vn(W,W.return,tt)}}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===d)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===d)break e;for(;m.sibling===null;){if(m.return===null||m.return===d)break e;S===m&&(S=null),m=m.return}S===m&&(S=null),m.sibling.return=m.return,m=m.sibling}}C&4&&(C=d.updateQueue,C!==null&&(S=C.retryQueue,S!==null&&(C.retryQueue=null,lh(d,S))));break;case 19:Xs(m,d),sr(d),C&4&&(C=d.updateQueue,C!==null&&(d.updateQueue=null,lh(d,C)));break;case 21:break;default:Xs(m,d),sr(d)}}function sr(d){var m=d.flags;if(m&2){try{if(Ss&&(!As||d.tag!==27)){e:{for(var S=d.return;S!==null;){if(Pg(S)){var C=S;break e}S=S.return}throw Error(i(160))}switch(C.tag){case 27:if(As){var I=C.stateNode,U=ep(d);Bc(d,U,I);break}case 5:var W=C.stateNode;C.flags&32&&(Sh(W),C.flags&=-33);var re=ep(d);Bc(d,re,W);break;case 3:case 4:var ve=C.stateNode.containerInfo,Fe=ep(d);tp(d,Fe,ve);break;default:throw Error(i(161))}}}catch(tt){vn(d,d.return,tt)}d.flags&=-3}m&4096&&(d.flags&=-4097)}function Ng(d){if(d.subtreeFlags&1024)for(d=d.child;d!==null;){var m=d;Ng(m),m.tag===5&&m.flags&1024&&jn(m.stateNode),d=d.sibling}}function lo(d,m){if(m.subtreeFlags&8772)for(m=m.child;m!==null;)np(d,m.alternate,m),m=m.sibling}function Uc(d){for(d=d.child;d!==null;){var m=d;switch(m.tag){case 0:case 11:case 14:case 15:Ll(4,m,m.return),Uc(m);break;case 1:fi(m,m.return);var S=m.stateNode;typeof S.componentWillUnmount=="function"&&Iy(m,m.return,S),Uc(m);break;case 26:case 27:case 5:fi(m,m.return),Uc(m);break;case 22:fi(m,m.return),m.memoizedState===null&&Uc(m);break;default:Uc(m)}d=d.sibling}}function Bl(d,m,S){for(S=S&&(m.subtreeFlags&8772)!==0,m=m.child;m!==null;){var C=m.alternate,I=d,U=m,W=U.flags;switch(U.tag){case 0:case 11:case 15:Bl(I,U,S),oh(4,U);break;case 1:if(Bl(I,U,S),C=U,I=C.stateNode,typeof I.componentDidMount=="function")try{I.componentDidMount()}catch(Fe){vn(C,C.return,Fe)}if(C=U,I=C.updateQueue,I!==null){var re=C.stateNode;try{var ve=I.shared.hiddenCallbacks;if(ve!==null)for(I.shared.hiddenCallbacks=null,I=0;I<ve.length;I++)he(ve[I],re)}catch(Fe){vn(C,C.return,Fe)}}S&&W&64&&Ly(U),Bu(U,U.return);break;case 26:case 27:case 5:Bl(I,U,S),S&&C===null&&W&4&&wc(U),Bu(U,U.return);break;case 12:Bl(I,U,S);break;case 13:Bl(I,U,S),S&&W&4&&Il(I,U);break;case 22:U.memoizedState===null&&Bl(I,U,S),Bu(U,U.return);break;default:Bl(I,U,S)}m=m.sibling}}function Ug(d,m){var S=null;d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(S=d.memoizedState.cachePool.pool),d=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(d=m.memoizedState.cachePool.pool),d!==S&&(d!=null&&d.refCount++,S!=null&&Rc(S))}function sp(d,m){d=null,m.alternate!==null&&(d=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==d&&(m.refCount++,d!=null&&Rc(d))}function Vo(d,m,S,C){if(m.subtreeFlags&10256)for(m=m.child;m!==null;)rp(d,m,S,C),m=m.sibling}function rp(d,m,S,C){var I=m.flags;switch(m.tag){case 0:case 11:case 15:Vo(d,m,S,C),I&2048&&oh(9,m);break;case 3:Vo(d,m,S,C),I&2048&&(d=null,m.alternate!==null&&(d=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==d&&(m.refCount++,d!=null&&Rc(d)));break;case 12:if(I&2048){Vo(d,m,S,C),d=m.stateNode;try{var U=m.memoizedProps,W=U.id,re=U.onPostCommit;typeof re=="function"&&re(W,m.alternate===null?"mount":"update",d.passiveEffectDuration,-0)}catch(ve){vn(m,m.return,ve)}}else Vo(d,m,S,C);break;case 23:break;case 22:U=m.stateNode,m.memoizedState!==null?U._visibility&4?Vo(d,m,S,C):Ol(d,m):U._visibility&4?Vo(d,m,S,C):(U._visibility|=4,ws(d,m,S,C,(m.subtreeFlags&10256)!==0)),I&2048&&Ug(m.alternate,m);break;case 24:Vo(d,m,S,C),I&2048&&sp(m.alternate,m);break;default:Vo(d,m,S,C)}}function ws(d,m,S,C,I){for(I=I&&(m.subtreeFlags&10256)!==0,m=m.child;m!==null;){var U=d,W=m,re=S,ve=C,Fe=W.flags;switch(W.tag){case 0:case 11:case 15:ws(U,W,re,ve,I),oh(8,W);break;case 23:break;case 22:var tt=W.stateNode;W.memoizedState!==null?tt._visibility&4?ws(U,W,re,ve,I):Ol(U,W):(tt._visibility|=4,ws(U,W,re,ve,I)),I&&Fe&2048&&Ug(W.alternate,W);break;case 24:ws(U,W,re,ve,I),I&&Fe&2048&&sp(W.alternate,W);break;default:ws(U,W,re,ve,I)}m=m.sibling}}function Ol(d,m){if(m.subtreeFlags&10256)for(m=m.child;m!==null;){var S=d,C=m,I=C.flags;switch(C.tag){case 22:Ol(S,C),I&2048&&Ug(C.alternate,C);break;case 24:Ol(S,C),I&2048&&sp(C.alternate,C);break;default:Ol(S,C)}m=m.sibling}}function us(d){if(d.subtreeFlags&ju)for(d=d.child;d!==null;)Ou(d),d=d.sibling}function Ou(d){switch(d.tag){case 26:us(d),d.flags&ju&&(d.memoizedState!==null?E0(Qs,d.memoizedState,d.memoizedProps):Ai(d.type,d.memoizedProps));break;case 5:us(d),d.flags&ju&&Ai(d.type,d.memoizedProps);break;case 3:case 4:if(Pr){var m=Qs;Qs=Cp(d.stateNode.containerInfo),us(d),Qs=m}else us(d);break;case 22:d.memoizedState===null&&(m=d.alternate,m!==null&&m.memoizedState!==null?(m=ju,ju=16777216,us(d),ju=m):us(d));break;default:us(d)}}function ap(d){var m=d.alternate;if(m!==null&&(d=m.child,d!==null)){m.child=null;do m=d.sibling,d.sibling=null,d=m;while(d!==null)}}function Pl(d){var m=d.deletions;if((d.flags&16)!==0){if(m!==null)for(var S=0;S<m.length;S++){var C=m[S];Ci=C,Nl(C,d)}ap(d)}if(d.subtreeFlags&10256)for(d=d.child;d!==null;)uh(d),d=d.sibling}function uh(d){switch(d.tag){case 0:case 11:case 15:Pl(d),d.flags&2048&&Ll(9,d,d.return);break;case 3:Pl(d);break;case 12:Pl(d);break;case 22:var m=d.stateNode;d.memoizedState!==null&&m._visibility&4&&(d.return===null||d.return.tag!==13)?(m._visibility&=-5,Fc(d)):Pl(d);break;default:Pl(d)}}function Fc(d){var m=d.deletions;if((d.flags&16)!==0){if(m!==null)for(var S=0;S<m.length;S++){var C=m[S];Ci=C,Nl(C,d)}ap(d)}for(d=d.child;d!==null;){switch(m=d,m.tag){case 0:case 11:case 15:Ll(8,m,m.return),Fc(m);break;case 22:S=m.stateNode,S._visibility&4&&(S._visibility&=-5,Fc(m));break;default:Fc(m)}d=d.sibling}}function Nl(d,m){for(;Ci!==null;){var S=Ci;switch(S.tag){case 0:case 11:case 15:Ll(8,S,m);break;case 23:case 22:if(S.memoizedState!==null&&S.memoizedState.cachePool!==null){var C=S.memoizedState.cachePool.pool;C!=null&&C.refCount++}break;case 24:Rc(S.memoizedState.cache)}if(C=S.child,C!==null)C.return=S,Ci=C;else e:for(S=d;Ci!==null;){C=Ci;var I=C.sibling,U=C.return;if(Pc(C),C===S){Ci=null;break e}if(I!==null){I.return=U,Ci=I;break e}Ci=U}}}function op(d){var m=Zg(d);if(m!=null){if(typeof m.memoizedProps["data-testname"]!="string")throw Error(i(364));return m}if(d=Vu(d),d===null)throw Error(i(362));return d.stateNode.current}function kc(d,m){var S=d.tag;switch(m.$$typeof){case Uh:if(d.type===m.value)return!0;break;case Fp:e:{for(m=m.value,d=[d,0],S=0;S<d.length;){var C=d[S++],I=C.tag,U=d[S++],W=m[U];if(I!==5&&I!==26&&I!==27||!yo(C)){for(;W!=null&&kc(C,W);)U++,W=m[U];if(U===m.length){m=!0;break e}else for(C=C.child;C!==null;)d.push(C,U),C=C.sibling}}m=!1}return m;case kp:if((S===5||S===26||S===27)&&xE(d.stateNode,m.value))return!0;break;case Vn:if((S===5||S===6||S===26||S===27)&&(d=xh(d),d!==null&&0<=d.indexOf(m.value)))return!0;break;case En:if((S===5||S===26||S===27)&&(d=d.memoizedProps["data-testname"],typeof d=="string"&&d.toLowerCase()===m.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function Ul(d){switch(d.$$typeof){case Uh:return"<"+(a(d.value)||"Unknown")+">";case Fp:return":has("+(Ul(d)||"")+")";case kp:return'[role="'+d.value+'"]';case Vn:return'"'+d.value+'"';case En:return'[data-testname="'+d.value+'"]';default:throw Error(i(365))}}function By(d,m){var S=[];d=[d,0];for(var C=0;C<d.length;){var I=d[C++],U=I.tag,W=d[C++],re=m[W];if(U!==5&&U!==26&&U!==27||!yo(I)){for(;re!=null&&kc(I,re);)W++,re=m[W];if(W===m.length)S.push(I);else for(I=I.child;I!==null;)d.push(I,W),I=I.sibling}}return S}function qs(d,m){if(!vo)throw Error(i(363));d=op(d),d=By(d,m),m=[],d=Array.from(d);for(var S=0;S<d.length;){var C=d[S++],I=C.tag;if(I===5||I===26||I===27)yo(C)||m.push(C.stateNode);else for(C=C.child;C!==null;)d.push(C),C=C.sibling}return m}function Ws(){if((Pt&2)!==0&&cn!==0)return cn&-cn;if(Kt.T!==null){var d=cr;return d!==0?d:He()}return oa()}function uo(){dr===0&&(dr=(cn&536870912)===0||Rn?F():536870912);var d=zr.current;return d!==null&&(d.flags|=32),dr}function Bs(d,m,S){(d===pn&&Jn===2||d.cancelPendingCommit!==null)&&(La(d,0),Da(d,cn,dr,!1)),V(d,S),((Pt&2)===0||d!==pn)&&(d===pn&&((Pt&2)===0&&(Ua|=S),Tn===4&&Da(d,cn,dr,!1)),$e(d))}function ch(d,m,S){if((Pt&6)!==0)throw Error(i(327));var C=!S&&(m&60)===0&&(m&d.expiredLanes)===0||N(d,m),I=C?ho(d,m):co(d,m,!0),U=C;do{if(I===0){Vr&&!C&&Da(d,m,0,!1);break}else if(I===6)Da(d,m,0,!Kn);else{if(S=d.current.alternate,U&&!Oy(S)){I=co(d,m,!1),U=!1;continue}if(I===2){if(U=m,d.errorRecoveryDisabledLanes&U)var W=0;else W=d.pendingLanes&-536870913,W=W!==0?W:W&536870912?536870912:0;if(W!==0){m=W;e:{var re=d;I=nf;var ve=js&&re.current.memoizedState.isDehydrated;if(ve&&(La(re,W).flags|=256),W=co(re,W,!1),W!==2){if(rl&&!ve){re.errorRecoveryDisabledLanes|=U,Ua|=U,I=4;break e}U=Yr,Yr=I,U!==null&&Ko(U)}I=W}if(U=!1,I!==2)continue}}if(I===1){La(d,0),Da(d,m,0,!0);break}e:{switch(C=d,I){case 0:case 1:throw Error(i(345));case 4:if((m&4194176)===m){Da(C,m,dr,!Kn);break e}break;case 2:Yr=null;break;case 3:case 5:break;default:throw Error(i(329))}if(C.finishedWork=S,C.finishedLanes=m,(m&62914560)===m&&(U=Eo+300-Es(),10<U)){if(Da(C,m,dr,!Kn),w(C,0)!==0)break e;C.timeoutHandle=$g(lp.bind(null,C,S,Yr,Fa,sf,m,dr,Ua,al,Kn,2,-0,0),U);break e}lp(C,S,Yr,Fa,sf,m,dr,Ua,al,Kn,0,-0,0)}}break}while(!0);$e(d)}function Ko(d){Yr===null?Yr=d:Yr.push.apply(Yr,d)}function lp(d,m,S,C,I,U,W,re,ve,Fe,tt,mt,_t){var $t=m.subtreeFlags;if(($t&8192||($t&16785408)===16785408)&&(Or(),Ou(m),m=vp(),m!==null)){d.cancelPendingCommit=m(si.bind(null,d,S,C,I,W,re,ve,1,mt,_t)),Da(d,U,W,!Fe);return}si(d,S,C,I,W,re,ve,tt,mt,_t)}function Oy(d){for(var m=d;;){var S=m.tag;if((S===0||S===11||S===15)&&m.flags&16384&&(S=m.updateQueue,S!==null&&(S=S.stores,S!==null)))for(var C=0;C<S.length;C++){var I=S[C],U=I.getSnapshot;I=I.value;try{if(!Nr(U(),I))return!1}catch{return!1}}if(S=m.child,m.subtreeFlags&16384&&S!==null)S.return=m,m=S;else{if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function Da(d,m,S,C){m&=~ks,m&=~Ua,d.suspendedLanes|=m,d.pingedLanes&=~m,C&&(d.warmLanes|=m),C=d.expirationTimes;for(var I=m;0<I;){var U=31-lr(I),W=1<<U;C[U]=-1,I&=~W}S!==0&&Q(d,S,m)}function Fg(){return(Pt&6)===0?(At(0),!1):!0}function rr(){if(tn!==null){if(Jn===0)var d=tn.return;else d=tn,Mi=$l=null,bu(d),xo=null,ca=0,d=tn;for(;d!==null;)Bg(d.alternate,d),d=d.return;tn=null}}function La(d,m){d.finishedWork=null,d.finishedLanes=0;var S=d.timeoutHandle;S!==zu&&(d.timeoutHandle=zu,_h(S)),S=d.cancelPendingCommit,S!==null&&(d.cancelPendingCommit=null,S()),rr(),pn=d,tn=S=Os(d.current,null),cn=m,Jn=0,Ui=null,Kn=!1,Vr=N(d,m),rl=!1,al=dr=ks=Ua=Kr=Tn=0,Yr=nf=null,sf=!1,(m&8)!==0&&(m|=m&32);var C=d.entangledLanes;if(C!==0)for(d=d.entanglements,C&=m;0<C;){var I=31-lr(C),U=1<<I;m|=d[I],C&=~U}return Na=m,Ne(),S}function Pu(d,m){rn=null,Kt.H=Dn,m===Wn?(m=st(),Jn=3):m===C0?(m=st(),Jn=4):Jn=m===d_?8:m!==null&&typeof m=="object"&&typeof m.then=="function"?6:1,Ui=m,tn===null&&(Tn=1,qd(d,se(m,d.current)))}function fh(){var d=zr.current;return d===null?!0:(cn&4194176)===cn?fa===null:(cn&62914560)===cn||(cn&536870912)!==0?d===fa:!1}function Gc(){var d=Kt.H;return Kt.H=Dn,d===null?Dn:d}function wr(){var d=Kt.A;return Kt.A=Up,d}function ar(){Tn=4,Kn||(cn&4194176)!==cn&&zr.current!==null||(Vr=!0),(Kr&134217727)===0&&(Ua&134217727)===0||pn===null||Da(pn,cn,dr,!1)}function co(d,m,S){var C=Pt;Pt|=2;var I=Gc(),U=wr();(pn!==d||cn!==m)&&(Fa=null,La(d,m)),m=!1;var W=Tn;e:do try{if(Jn!==0&&tn!==null){var re=tn,ve=Ui;switch(Jn){case 8:rr(),W=6;break e;case 3:case 2:case 6:zr.current===null&&(m=!0);var Fe=Jn;if(Jn=0,Ui=null,Fl(d,re,ve,Fe),S&&Vr){W=0;break e}break;default:Fe=Jn,Jn=0,Ui=null,Fl(d,re,ve,Fe)}}fo(),W=Tn;break}catch(tt){Pu(d,tt)}while(!0);return m&&d.shellSuspendCounter++,Mi=$l=null,Pt=C,Kt.H=I,Kt.A=U,tn===null&&(pn=null,cn=0,Ne()),W}function fo(){for(;tn!==null;)kg(tn)}function ho(d,m){var S=Pt;Pt|=2;var C=Gc(),I=wr();pn!==d||cn!==m?(Fa=null,xi=Es()+500,La(d,m)):Vr=N(d,m);e:do try{if(Jn!==0&&tn!==null){m=tn;var U=Ui;t:switch(Jn){case 1:Jn=0,Ui=null,Fl(d,m,U,1);break;case 2:if(pt(U)){Jn=0,Ui=null,up(m);break}m=function(){Jn===2&&pn===d&&(Jn=7),$e(d)},U.then(m,m);break e;case 3:Jn=7;break e;case 4:Jn=5;break e;case 7:pt(U)?(Jn=0,Ui=null,up(m)):(Jn=0,Ui=null,Fl(d,m,U,7));break;case 5:var W=null;switch(tn.tag){case 26:W=tn.memoizedState;case 5:case 27:var re=tn,ve=re.type,Fe=re.pendingProps;if(W?A0(W):$o(ve,Fe)){Jn=0,Ui=null;var tt=re.sibling;if(tt!==null)tn=tt;else{var mt=re.return;mt!==null?(tn=mt,hh(mt)):tn=null}break t}}Jn=0,Ui=null,Fl(d,m,U,5);break;case 6:Jn=0,Ui=null,Fl(d,m,U,6);break;case 8:rr(),Tn=6;break e;default:throw Error(i(462))}}Yo();break}catch(_t){Pu(d,_t)}while(!0);return Mi=$l=null,Kt.H=C,Kt.A=I,Pt=S,tn!==null?0:(pn=null,cn=0,Ne(),Tn)}function Yo(){for(;tn!==null&&!l_();)kg(tn)}function kg(d){var m=My(d.alternate,d,Na);d.memoizedProps=d.pendingProps,m===null?hh(d):tn=m}function up(d){var m=d,S=m.alternate;switch(m.tag){case 15:case 0:m=Sy(S,m,m.pendingProps,m.type,void 0,cn);break;case 11:m=Sy(S,m,m.pendingProps,m.type.render,m.ref,cn);break;case 5:bu(m);default:Bg(S,m),m=tn=Wo(m,Na),m=My(S,m,Na)}d.memoizedProps=d.pendingProps,m===null?hh(d):tn=m}function Fl(d,m,S,C){Mi=$l=null,bu(m),xo=null,ca=0;var I=m.return;try{if(gy(d,I,m,S,cn)){Tn=1,qd(d,se(S,d.current)),tn=null;return}}catch(U){if(I!==null)throw tn=I,U;Tn=1,qd(d,se(S,d.current)),tn=null;return}m.flags&32768?(Rn||C===1?d=!0:Vr||(cn&536870912)!==0?d=!1:(Kn=d=!0,(C===2||C===3||C===6)&&(C=zr.current,C!==null&&C.tag===13&&(C.flags|=16384))),cs(m,d)):hh(m)}function hh(d){var m=d;do{if((m.flags&32768)!==0){cs(m,Kn);return}d=m.return;var S=Ry(m.alternate,m,Na);if(S!==null){tn=S;return}if(m=m.sibling,m!==null){tn=m;return}tn=m=d}while(m!==null);Tn===0&&(Tn=5)}function cs(d,m){do{var S=Dy(d.alternate,d);if(S!==null){S.flags&=32767,tn=S;return}if(S=d.return,S!==null&&(S.flags|=32768,S.subtreeFlags=0,S.deletions=null),!m&&(d=d.sibling,d!==null)){tn=d;return}tn=d=S}while(d!==null);Tn=6,tn=null}function si(d,m,S,C,I,U,W,re,ve,Fe){var tt=Kt.T,mt=es();try{Ps(2),Kt.T=null,xn(d,m,S,C,mt,I,U,W,re,ve,Fe)}finally{Kt.T=tt,Ps(mt)}}function xn(d,m,S,C,I,U,W,re){do fs();while(ol!==null);if((Pt&6)!==0)throw Error(i(327));var ve=d.finishedWork;if(C=d.finishedLanes,ve===null)return null;if(d.finishedWork=null,d.finishedLanes=0,ve===d.current)throw Error(i(177));d.callbackNode=null,d.callbackPriority=0,d.cancelPendingCommit=null;var Fe=ve.lanes|ve.childLanes;if(Fe|=Qc,J(d,C,Fe,U,W,re),d===pn&&(tn=pn=null,cn=0),(ve.subtreeFlags&10256)===0&&(ve.flags&10256)===0||da||(da=!0,Gp=Fe,Qu=S,dh(Dp,function(){return fs(),null})),S=(ve.flags&15990)!==0,(ve.subtreeFlags&15990)!==0||S?(S=Kt.T,Kt.T=null,U=es(),Ps(2),W=Pt,Pt|=4,Oc(d,ve),wl(ve,d),Jg(d.containerInfo),d.current=ve,np(d,ve.alternate,ve),u_(),Pt=W,Ps(U),Kt.T=S):d.current=ve,da?(da=!1,ol=d,Ju=C):Xo(d,Fe),Fe=d.pendingLanes,Fe===0&&(Xr=null),k(ve.stateNode),$e(d),m!==null)for(I=d.onRecoverableError,ve=0;ve<m.length;ve++)Fe=m[ve],I(Fe.value,{componentStack:Fe.stack});return(Ju&3)!==0&&fs(),Fe=d.pendingLanes,(C&4194218)!==0&&(Fe&42)!==0?d===$s?$u++:($u=0,$s=d):$u=0,At(0),null}function Xo(d,m){(d.pooledCacheLanes&=m)===0&&(m=d.pooledCache,m!=null&&(d.pooledCache=null,Rc(m)))}function fs(){if(ol!==null){var d=ol,m=Gp;Gp=0;var S=ne(Ju),C=32>S?32:S;S=Kt.T;var I=es();try{if(Ps(C),Kt.T=null,ol===null)var U=!1;else{C=Qu,Qu=null;var W=ol,re=Ju;if(ol=null,Ju=0,(Pt&6)!==0)throw Error(i(331));var ve=Pt;if(Pt|=4,uh(W.current),rp(W,W.current,re,C),Pt=ve,At(0,!1),ur&&typeof ur.onPostCommitFiberRoot=="function")try{ur.onPostCommitFiberRoot(jc,W)}catch{}U=!0}return U}finally{Ps(I),Kt.T=S,Xo(d,m)}}return!1}function cp(d,m,S){m=se(S,m),m=th(d.stateNode,m,2),d=Je(d,m,2),d!==null&&(V(d,2),$e(d))}function vn(d,m,S){if(d.tag===3)cp(d,d,S);else for(;m!==null;){if(m.tag===3){cp(m,d,S);break}else if(m.tag===1){var C=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(Xr===null||!Xr.has(C))){d=se(S,d),S=Cc(2),C=Je(m,S,2),C!==null&&(nh(S,C,m,d),V(C,2),$e(C));break}}m=m.return}}function fp(d,m,S){var C=d.pingCache;if(C===null){C=d.pingCache=new yn;var I=new Set;C.set(m,I)}else I=C.get(m),I===void 0&&(I=new Set,C.set(m,I));I.has(S)||(rl=!0,I.add(S),d=Py.bind(null,d,m,S),m.then(d,d))}function Py(d,m,S){var C=d.pingCache;C!==null&&C.delete(m),d.pingedLanes|=d.suspendedLanes&S,d.warmLanes&=~S,pn===d&&(cn&S)===S&&(Tn===4||Tn===3&&(cn&62914560)===cn&&300>Es()-Eo?(Pt&2)===0&&La(d,0):ks|=S,al===cn&&(al=0)),$e(d)}function Nu(d,m){m===0&&(m=B()),d=je(d,m),d!==null&&(V(d,m),$e(d))}function Uu(d){var m=d.memoizedState,S=0;m!==null&&(S=m.retryLane),Nu(d,S)}function Gg(d,m){var S=0;switch(d.tag){case 13:var C=d.stateNode,I=d.memoizedState;I!==null&&(S=I.retryLane);break;case 19:C=d.stateNode;break;case 22:C=d.stateNode._retryCache;break;default:throw Error(i(314))}C!==null&&C.delete(m),Nu(d,S)}function dh(d,m){return Wc(d,m)}function Hg(d,m,S,C){this.tag=d,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qo(d){return d=d.prototype,!(!d||!d.isReactComponent)}function Os(d,m){var S=d.alternate;return S===null?(S=t(d.tag,m,d.key,d.mode),S.elementType=d.elementType,S.type=d.type,S.stateNode=d.stateNode,S.alternate=d,d.alternate=S):(S.pendingProps=m,S.type=d.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=d.flags&31457280,S.childLanes=d.childLanes,S.lanes=d.lanes,S.child=d.child,S.memoizedProps=d.memoizedProps,S.memoizedState=d.memoizedState,S.updateQueue=d.updateQueue,m=d.dependencies,S.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},S.sibling=d.sibling,S.index=d.index,S.ref=d.ref,S.refCleanup=d.refCleanup,S}function Wo(d,m){d.flags&=31457282;var S=d.alternate;return S===null?(d.childLanes=0,d.lanes=m,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=S.childLanes,d.lanes=S.lanes,d.child=S.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=S.memoizedProps,d.memoizedState=S.memoizedState,d.updateQueue=S.updateQueue,d.type=S.type,m=S.dependencies,d.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),d}function aa(d,m,S,C,I,U){var W=0;if(C=d,typeof d=="function")qo(d)&&(W=1);else if(typeof d=="string")W=Pr&&As?m0(d,S,ds.current)?26:Xc(d)?27:5:Pr?m0(d,S,ds.current)?26:5:As&&Xc(d)?27:5;else e:switch(d){case zc:return jo(S.children,I,U,m);case Xg:W=8,I|=24;break;case qg:return d=t(12,S,m,I|2),d.elementType=qg,d.lanes=U,d;case dp:return d=t(13,S,m,I),d.elementType=dp,d.lanes=U,d;case Hl:return d=t(19,S,m,I),d.elementType=Hl,d.lanes=U,d;case gh:return hp(S,I,U,m);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case Fy:case po:W=10;break e;case Gl:W=9;break e;case Vc:W=11;break e;case mh:W=14;break e;case wa:W=16,C=null;break e}W=29,S=Error(i(130,d===null?"null":typeof d,"")),C=null}return m=t(W,S,m,I),m.elementType=d,m.type=C,m.lanes=U,m}function jo(d,m,S,C){return d=t(7,d,C,m),d.lanes=S,d}function hp(d,m,S,C){d=t(22,d,C,m),d.elementType=gh,d.lanes=S;var I={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var U=I._current;if(U===null)throw Error(i(456));if((I._pendingVisibility&2)===0){var W=je(U,2);W!==null&&(I._pendingVisibility|=2,Bs(W,U,2))}},attach:function(){var U=I._current;if(U===null)throw Error(i(456));if((I._pendingVisibility&2)!==0){var W=je(U,2);W!==null&&(I._pendingVisibility&=-3,Bs(W,U,2))}}};return d.stateNode=I,d}function kl(d,m,S){return d=t(6,d,null,m),d.lanes=S,d}function Hc(d,m,S){return m=t(4,d.children!==null?d.children:[],d.key,m),m.lanes=S,m.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},m}function Fu(d,m,S,C,I,U,W,re){this.tag=1,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=zu,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=P(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=P(0),this.hiddenUpdates=P(null),this.identifierPrefix=C,this.onUncaughtError=I,this.onCaughtError=U,this.onRecoverableError=W,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=re,this.incompleteTransitions=new Map}function hs(d,m,S,C,I,U,W,re,ve,Fe,tt,mt){return d=new Fu(d,m,S,W,re,ve,Fe,mt),m=1,U===!0&&(m|=24),U=t(3,null,null,m),d.current=U,U.stateNode=d,m=Qd(),m.refCount++,d.pooledCache=m,m.refCount++,U.memoizedState={element:C,isDehydrated:S,cache:m},vt(U),d}function ph(d){return d?(d=Ku,d):Ku}function zg(d){var m=d._reactInternals;if(m===void 0)throw typeof d.render=="function"?Error(i(188)):(d=Object.keys(d).join(","),Error(i(268,d)));return d=y(m),d=d!==null?_(d):null,d===null?null:Kc(d.stateNode)}function Ny(d,m,S,C,I,U){I=ph(I),C.context===null?C.context=I:C.pendingContext=I,C=Ye(m),C.payload={element:S},U=U===void 0?null:U,U!==null&&(C.callback=U),S=Je(d,C,m),S!==null&&(Bs(S,d,m),ft(S,d,m))}function Uy(d,m){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var S=d.retryLane;d.retryLane=S!==0&&S<m?S:m}}function Vg(d,m){Uy(d,m),(d=d.alternate)&&Uy(d,m)}var Ot={},Kg=ag(),xs=I5(),ku=Object.assign,Yg=Symbol.for("react.element"),Jo=Symbol.for("react.transitional.element"),Ia=Symbol.for("react.portal"),zc=Symbol.for("react.fragment"),Xg=Symbol.for("react.strict_mode"),qg=Symbol.for("react.profiler"),Fy=Symbol.for("react.provider"),Gl=Symbol.for("react.consumer"),po=Symbol.for("react.context"),Vc=Symbol.for("react.forward_ref"),dp=Symbol.for("react.suspense"),Hl=Symbol.for("react.suspense_list"),mh=Symbol.for("react.memo"),wa=Symbol.for("react.lazy"),gh=Symbol.for("react.offscreen"),ky=Symbol.for("react.memo_cache_sentinel"),Wg=Symbol.iterator,Gu=Symbol.for("react.client.reference"),Kt=Kg.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,pp,jg,zl=!1,Vl=Array.isArray,mp=e.rendererVersion,vh=e.rendererPackageName,yh=e.extraDevToolsConfig,Kc=e.getPublicInstance,Hu=e.getRootHostContext,Gy=e.getChildHostContext,Kl=e.prepareForCommit,Jg=e.resetAfterCommit,Qg=e.createInstance,mo=e.appendInitialChild,Qo=e.finalizeInitialChildren,Yl=e.shouldSetTextContent,gp=e.createTextInstance,$g=e.scheduleTimeout,_h=e.cancelTimeout,zu=e.noTimeout,go=e.isPrimaryRenderer;e.warnsIfNotActing;var Ss=e.supportsMutation,Br=e.supportsPersistence,js=e.supportsHydration,Zg=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var e0=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var Ps=e.setCurrentUpdatePriority,es=e.getCurrentUpdatePriority,oa=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var Xl=e.shouldAttemptEagerTransition,t0=e.detachDeletedInstance;e.requestPostPaintCallback;var Hy=e.maySuspendCommit,$o=e.preloadInstance,Or=e.startSuspendingCommit,Ai=e.suspendInstance,vp=e.waitForCommitToBeReady,or=e.NotPendingTransition,qt=e.HostTransitionContext,jn=e.resetFormInstance;e.bindToConsole;var Yi=e.supportsMicrotasks,yp=e.scheduleMicrotask,vo=e.supportsTestSelectors,Vu=e.findFiberRoot,_p=e.getBoundingRect,xh=e.getTextContent,yo=e.isHiddenSubtree,xE=e.matchAccessibilityRole,Ei=e.setFocusIfFocusable,n0=e.setupIntersectionObserver,i0=e.appendChild,zy=e.appendChildToContainer,Vy=e.commitTextUpdate,SE=e.commitMount,s0=e.commitUpdate,r0=e.insertBefore,a0=e.insertInContainerBefore,Js=e.removeChild,Bi=e.removeChildFromContainer,Sh=e.resetTextContent,Ah=e.hideInstance,xp=e.hideTextInstance,o0=e.unhideInstance,Zo=e.unhideTextInstance,Sp=e.clearContainer,l0=e.cloneInstance,Ap=e.createContainerChildSet,u0=e.appendChildToContainerChildSet,Ky=e.finalizeContainerChildren,c0=e.replaceContainerChildren,f0=e.cloneHiddenInstance,h0=e.cloneHiddenTextInstance,Ep=e.isSuspenseInstancePending,Eh=e.isSuspenseInstanceFallback,Yy=e.getSuspenseInstanceFallbackErrorDetails,AE=e.registerSuspenseInstanceRetry,Xy=e.canHydrateFormStateMarker,qy=e.isFormStateMarkerMatching,d0=e.getNextHydratableSibling,Tp=e.getFirstHydratableChild,Wy=e.getFirstHydratableChildWithinContainer,jy=e.getFirstHydratableChildWithinSuspenseInstance,Jy=e.canHydrateInstance,Qy=e.canHydrateTextInstance,$y=e.canHydrateSuspenseInstance,EE=e.hydrateInstance,Zy=e.hydrateTextInstance,Yc=e.hydrateSuspenseInstance,e_=e.getNextHydratableInstanceAfterSuspenseInstance,bp=e.commitHydratedContainer,Mp=e.commitHydratedSuspenseInstance,t_=e.clearSuspenseBoundary,p0=e.clearSuspenseBoundaryFromContainer,n_=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var i_=e.validateHydratableInstance,s_=e.validateHydratableTextInstance,Pr=e.supportsResources,m0=e.isHostHoistableType,Cp=e.getHoistableRoot,Rp=e.getResource,g0=e.acquireResource,v0=e.releaseResource,y0=e.hydrateHoistable,_0=e.mountHoistable,x0=e.unmountHoistable,TE=e.createHoistableInstance,S0=e.prepareToCommitHoistables,r_=e.mayResourceSuspendCommit,A0=e.preloadResource,E0=e.suspendResource,As=e.supportsSingletons,T0=e.resolveSingletonInstance,bE=e.clearSingleton,ME=e.acquireSingletonInstance,a_=e.releaseSingletonInstance,Xc=e.isHostSingletonType,Th=[],el=-1,Ku={},lr=Math.clz32?Math.clz32:R,bh=Math.log,o_=Math.LN2,qc=128,Mh=4194304,Wc=xs.unstable_scheduleCallback,Ch=xs.unstable_cancelCallback,l_=xs.unstable_shouldYield,u_=xs.unstable_requestPaint,Es=xs.unstable_now,b0=xs.unstable_ImmediatePriority,c_=xs.unstable_UserBlockingPriority,Dp=xs.unstable_NormalPriority,Lp=xs.unstable_IdlePriority,f_=xs.log,M0=xs.unstable_setDisableYieldValue,jc=null,ur=null,Nr=typeof Object.is=="function"?Object.is:j,Ip=new WeakMap,hi=[],Ti=0,Rh=null,Dh=0,Ur=[],Fr=0,Ba=null,_o=1,la="",ds=E(null),Lh=E(null),Oa=E(null),Jc=E(null),Ns=null,Ts=null,Rn=!1,kr=null,ua=!1,Ih=Error(i(519)),Gr=[],ql=0,Qc=0,$c=null,Yu=null,wh=!1,Bh=!1,Pa=!1,Wl=0,Oh=null,wp=0,cr=0,jl=null,tl=!1,Zc=!1,Ph=Object.prototype.hasOwnProperty,Wn=Error(i(460)),C0=Error(i(474)),Bp={then:function(){}},Xu=null,xo=null,ca=0,Jl=na(!0),R0=na(!1),So=E(null),Hr=E(0),zr=E(null),fa=null,Xi=E(0),Ao=0,rn=null,kn=null,Oi=null,ha=!1,di=!1,nl=!1,Nh=0,bi=0,ef=null,h_=0,Op=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},Dn={readContext:_s,use:Ca,useCallback:ln,useContext:ln,useEffect:ln,useImperativeHandle:ln,useLayoutEffect:ln,useInsertionEffect:ln,useMemo:ln,useReducer:ln,useRef:ln,useState:ln,useDebugValue:ln,useDeferredValue:ln,useTransition:ln,useSyncExternalStore:ln,useId:ln};Dn.useCacheRefresh=ln,Dn.useMemoCache=ln,Dn.useHostTransitionStatus=ln,Dn.useFormState=ln,Dn.useActionState=ln,Dn.useOptimistic=ln;var qi={readContext:_s,use:Ca,useCallback:function(d,m){return wi().memoizedState=[d,m===void 0?null:m],d},useContext:_s,useEffect:Mu,useImperativeHandle:function(d,m,S){S=S!=null?S.concat([d]):null,Vi(4194308,4,Jf.bind(null,m,d),S)},useLayoutEffect:function(d,m){return Vi(4194308,4,d,m)},useInsertionEffect:function(d,m){Vi(4,2,d,m)},useMemo:function(d,m){var S=wi();m=m===void 0?null:m;var C=d();if(nl){K(!0);try{d()}finally{K(!1)}}return S.memoizedState=[C,m],C},useReducer:function(d,m,S){var C=wi();if(S!==void 0){var I=S(m);if(nl){K(!0);try{S(m)}finally{K(!1)}}}else I=m;return C.memoizedState=C.baseState=I,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:I},C.queue=d,d=d.dispatch=Tl.bind(null,rn,d),[C.memoizedState,d]},useRef:function(d){var m=wi();return d={current:d},m.memoizedState=d},useState:function(d){d=Mt(d);var m=d.queue,S=Yd.bind(null,rn,m);return m.dispatch=S,[d.memoizedState,S]},useDebugValue:Qf,useDeferredValue:function(d,m){var S=wi();return El(S,d,m)},useTransition:function(){var d=Mt(!1);return d=Vd.bind(null,rn,d.queue,!0,!1),wi().memoizedState=d,[!1,d]},useSyncExternalStore:function(d,m,S){var C=rn,I=wi();if(Rn){if(S===void 0)throw Error(i(407));S=S()}else{if(S=m(),pn===null)throw Error(i(349));(cn&60)!==0||xt(C,m,S)}I.memoizedState=S;var U={value:S,getSnapshot:m};return I.queue=U,Mu(bt.bind(null,C,U,d),[d]),C.flags|=2048,Si(9,ut.bind(null,C,U,S,m),{destroy:void 0},null),S},useId:function(){var d=wi(),m=pn.identifierPrefix;if(Rn){var S=la,C=_o;S=(C&~(1<<32-lr(C)-1)).toString(32)+S,m=":"+m+"R"+S,S=Nh++,0<S&&(m+="H"+S.toString(32)),m+=":"}else S=h_++,m=":"+m+"r"+S.toString(32)+":";return d.memoizedState=m},useCacheRefresh:function(){return wi().memoizedState=$f.bind(null,rn)}};qi.useMemoCache=X,qi.useHostTransitionStatus=Ru,qi.useFormState=os,qi.useActionState=os,qi.useOptimistic=function(d){var m=wi();m.memoizedState=m.baseState=d;var S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return m.queue=S,m=Xd.bind(null,rn,!0,S),S.dispatch=m,[d,m]};var Us={readContext:_s,use:Ca,useCallback:zd,useContext:_s,useEffect:Dr,useImperativeHandle:ao,useInsertionEffect:py,useLayoutEffect:my,useMemo:Cu,useReducer:De,useRef:zi,useState:function(){return De(de)},useDebugValue:Qf,useDeferredValue:function(d,m){var S=$n();return vg(S,kn.memoizedState,d,m)},useTransition:function(){var d=De(de)[0],m=$n().memoizedState;return[typeof d=="boolean"?d:Ma(d),m]},useSyncExternalStore:ot,useId:oo};Us.useCacheRefresh=Kd,Us.useMemoCache=X,Us.useHostTransitionStatus=Ru,Us.useFormState=ro,Us.useActionState=ro,Us.useOptimistic=function(d,m){var S=$n();return Ht(S,kn,d,m)};var Ql={readContext:_s,use:Ca,useCallback:zd,useContext:_s,useEffect:Dr,useImperativeHandle:ao,useInsertionEffect:py,useLayoutEffect:my,useMemo:Cu,useReducer:_e,useRef:zi,useState:function(){return _e(de)},useDebugValue:Qf,useDeferredValue:function(d,m){var S=$n();return kn===null?El(S,d,m):vg(S,kn.memoizedState,d,m)},useTransition:function(){var d=_e(de)[0],m=$n().memoizedState;return[typeof d=="boolean"?d:Ma(d),m]},useSyncExternalStore:ot,useId:oo};Ql.useCacheRefresh=Kd,Ql.useMemoCache=X,Ql.useHostTransitionStatus=Ru,Ql.useFormState=Hn,Ql.useActionState=Hn,Ql.useOptimistic=function(d,m){var S=$n();return kn!==null?Ht(S,kn,d,m):(S.baseState=d,[d,S.queue.dispatch])};var Pp={isMounted:function(d){return(d=d._reactInternals)?p(d)===d:!1},enqueueSetState:function(d,m,S){d=d._reactInternals;var C=Ws(),I=Ye(C);I.payload=m,S!=null&&(I.callback=S),m=Je(d,I,C),m!==null&&(Bs(m,d,C),ft(m,d,C))},enqueueReplaceState:function(d,m,S){d=d._reactInternals;var C=Ws(),I=Ye(C);I.tag=1,I.payload=m,S!=null&&(I.callback=S),m=Je(d,I,C),m!==null&&(Bs(m,d,C),ft(m,d,C))},enqueueForceUpdate:function(d,m){d=d._reactInternals;var S=Ws(),C=Ye(S);C.tag=2,m!=null&&(C.callback=m),m=Je(d,C,S),m!==null&&(Bs(m,d,S),ft(m,d,S))}},D0=typeof reportError=="function"?reportError:function(d){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var m=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof d=="object"&&d!==null&&typeof d.message=="string"?String(d.message):String(d),error:d});if(!window.dispatchEvent(m))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",d);return}console.error(d)},d_=Error(i(461)),Pi=!1,Fs={dehydrated:null,treeContext:null,retryLane:0},fr=E(null),$l=null,Mi=null,p_=typeof AbortController<"u"?AbortController:function(){var d=[],m=this.signal={aborted:!1,addEventListener:function(S,C){d.push(C)}};this.abort=function(){m.aborted=!0,d.forEach(function(S){return S()})}},il=xs.unstable_scheduleCallback,qu=xs.unstable_NormalPriority,zn={$$typeof:po,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},Np=Kt.S;Kt.S=function(d,m){typeof m=="object"&&m!==null&&typeof m.then=="function"&&Oe(d,m),Np!==null&&Np(d,m)};var sl=E(null),ts=!1,_i=!1,Zl=!1,tf=typeof WeakSet=="function"?WeakSet:Set,Ci=null,Wu=!1,Ni=null,hr=!1,Qs=null,ju=8192,Up={getCacheForType:function(d){var m=_s(zn),S=m.data.get(d);return S===void 0&&(S=d(),m.data.set(d,S)),S}},Uh=0,Fp=1,kp=2,En=3,Vn=4;if(typeof Symbol=="function"&&Symbol.for){var an=Symbol.for;Uh=an("selector.component"),Fp=an("selector.has_pseudo_class"),kp=an("selector.role"),En=an("selector.test_id"),Vn=an("selector.text")}var yn=typeof WeakMap=="function"?WeakMap:Map,Pt=0,pn=null,tn=null,cn=0,Jn=0,Ui=null,Kn=!1,Vr=!1,rl=!1,Na=0,Tn=0,Kr=0,Ua=0,ks=0,dr=0,al=0,nf=null,Yr=null,sf=!1,Eo=0,xi=1/0,Fa=null,Xr=null,da=!1,ol=null,Ju=0,Gp=0,Qu=null,$u=0,$s=null;return Ot.attemptContinuousHydration=function(d){if(d.tag===13){var m=je(d,67108864);m!==null&&Bs(m,d,67108864),Vg(d,67108864)}},Ot.attemptHydrationAtCurrentPriority=function(d){if(d.tag===13){var m=Ws(),S=je(d,m);S!==null&&Bs(S,d,m),Vg(d,m)}},Ot.attemptSynchronousHydration=function(d){switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var m=L(d.pendingLanes);if(m!==0){for(d.pendingLanes|=2,d.entangledLanes|=2;m;){var S=1<<31-lr(m);d.entanglements[1]|=S,m&=~S}$e(d),(Pt&6)===0&&(xi=Es()+500,At(0))}}break;case 13:m=je(d,2),m!==null&&Bs(m,d,2),Fg(),Vg(d,2)}},Ot.batchedUpdates=function(d,m){return d(m)},Ot.createComponentSelector=function(d){return{$$typeof:Uh,value:d}},Ot.createContainer=function(d,m,S,C,I,U,W,re,ve,Fe){return hs(d,m,!1,null,S,C,U,W,re,ve,Fe,null)},Ot.createHasPseudoClassSelector=function(d){return{$$typeof:Fp,value:d}},Ot.createHydrationContainer=function(d,m,S,C,I,U,W,re,ve,Fe,tt,mt,_t){return d=hs(S,C,!0,d,I,U,re,ve,Fe,tt,mt,_t),d.context=ph(null),S=d.current,C=Ws(),I=Ye(C),I.callback=m??null,Je(S,I,C),d.current.lanes=C,V(d,C),$e(d),d},Ot.createPortal=function(d,m,S){var C=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ia,key:C==null?null:""+C,children:d,containerInfo:m,implementation:S}},Ot.createRoleSelector=function(d){return{$$typeof:kp,value:d}},Ot.createTestNameSelector=function(d){return{$$typeof:En,value:d}},Ot.createTextSelector=function(d){return{$$typeof:Vn,value:d}},Ot.defaultOnCaughtError=function(d){console.error(d)},Ot.defaultOnRecoverableError=function(d){D0(d)},Ot.defaultOnUncaughtError=function(d){D0(d)},Ot.deferredUpdates=function(d){var m=Kt.T,S=es();try{return Ps(32),Kt.T=null,d()}finally{Ps(S),Kt.T=m}},Ot.discreteUpdates=function(d,m,S,C,I){var U=Kt.T,W=es();try{return Ps(2),Kt.T=null,d(m,S,C,I)}finally{Ps(W),Kt.T=U,Pt===0&&(xi=Es()+500)}},Ot.findAllNodes=qs,Ot.findBoundingRects=function(d,m){if(!vo)throw Error(i(363));m=qs(d,m),d=[];for(var S=0;S<m.length;S++)d.push(_p(m[S]));for(m=d.length-1;0<m;m--){S=d[m];for(var C=S.x,I=C+S.width,U=S.y,W=U+S.height,re=m-1;0<=re;re--)if(m!==re){var ve=d[re],Fe=ve.x,tt=Fe+ve.width,mt=ve.y,_t=mt+ve.height;if(C>=Fe&&U>=mt&&I<=tt&&W<=_t){d.splice(m,1);break}else if(C!==Fe||S.width!==ve.width||_t<U||mt>W){if(!(U!==mt||S.height!==ve.height||tt<C||Fe>I)){Fe>C&&(ve.width+=Fe-C,ve.x=C),tt<I&&(ve.width=I-Fe),d.splice(m,1);break}}else{mt>U&&(ve.height+=mt-U,ve.y=U),_t<W&&(ve.height=W-mt),d.splice(m,1);break}}}return d},Ot.findHostInstance=zg,Ot.findHostInstanceWithNoPortals=function(d){return d=y(d),d=d!==null?A(d):null,d===null?null:Kc(d.stateNode)},Ot.findHostInstanceWithWarning=function(d){return zg(d)},Ot.flushPassiveEffects=fs,Ot.flushSyncFromReconciler=function(d){var m=Pt;Pt|=1;var S=Kt.T,C=es();try{if(Ps(2),Kt.T=null,d)return d()}finally{Ps(C),Kt.T=S,Pt=m,(Pt&6)===0&&At(0)}},Ot.flushSyncWork=Fg,Ot.focusWithin=function(d,m){if(!vo)throw Error(i(363));for(d=op(d),m=By(d,m),m=Array.from(m),d=0;d<m.length;){var S=m[d++],C=S.tag;if(!yo(S)){if((C===5||C===26||C===27)&&Ei(S.stateNode))return!0;for(S=S.child;S!==null;)m.push(S),S=S.sibling}}return!1},Ot.getFindAllNodesFailureDescription=function(d,m){if(!vo)throw Error(i(363));var S=0,C=[];d=[op(d),0];for(var I=0;I<d.length;){var U=d[I++],W=U.tag,re=d[I++],ve=m[re];if((W!==5&&W!==26&&W!==27||!yo(U))&&(kc(U,ve)&&(C.push(Ul(ve)),re++,re>S&&(S=re)),re<m.length))for(U=U.child;U!==null;)d.push(U,re),U=U.sibling}if(S<m.length){for(d=[];S<m.length;S++)d.push(Ul(m[S]));return`findAllNodes was able to match part of the selector:
  `+(C.join(" > ")+`

No matching component was found for:
  `)+d.join(" > ")}return null},Ot.getPublicRootInstance=function(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 27:case 5:return Kc(d.child.stateNode);default:return d.child.stateNode}},Ot.injectIntoDevTools=function(){var d={bundleType:0,version:mp,rendererPackageName:vh,currentDispatcherRef:Kt,findFiberByHostInstance:Zg,reconcilerVersion:"19.0.0"};if(yh!==null&&(d.rendererConfig=yh),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")d=!1;else{var m=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(m.isDisabled||!m.supportsFiber)d=!0;else{try{jc=m.inject(d),ur=m}catch{}d=!!m.checkDCE}}return d},Ot.isAlreadyRendering=function(){return!1},Ot.observeVisibleRects=function(d,m,S,C){if(!vo)throw Error(i(363));d=qs(d,m);var I=n0(d,S,C).disconnect;return{disconnect:function(){I()}}},Ot.shouldError=function(){return null},Ot.shouldSuspend=function(){return!1},Ot.startHostTransition=function(d,m,S,C){if(d.tag!==5)throw Error(i(476));var I=yg(d).queue;Vd(d,I,m,or,S===null?n:function(){var U=yg(d).next.queue;return bl(d,U,{},Ws()),S(C)})},Ot.updateContainer=function(d,m,S,C){var I=m.current,U=Ws();return Ny(I,U,d,m,S,C),U},Ot.updateContainerSync=function(d,m,S,C){return m.tag===0&&fs(),Ny(m.current,2,d,m,S,C),2},Ot},r.exports.default=r.exports,Object.defineProperty(r.exports,"__esModule",{value:!0})})(tb)),tb.exports}var OL;function B5(){return OL||(OL=1,eb.exports=w5()),eb.exports}var O5=B5();const P5=EA(O5);var sb={exports:{}},rb={};var PL;function N5(){return PL||(PL=1,(function(r){function e(k,K){var j=k.length;k.push(K);e:for(;0<j;){var se=j-1>>>1,oe=k[se];if(0<i(oe,K))k[se]=K,k[j]=oe,j=se;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var K=k[0],j=k.pop();if(j!==K){k[0]=j;e:for(var se=0,oe=k.length,Y=oe>>>1;se<Y;){var Z=2*(se+1)-1,le=k[Z],pe=Z+1,Te=k[pe];if(0>i(le,j))pe<oe&&0>i(Te,le)?(k[se]=Te,k[pe]=j,se=pe):(k[se]=le,k[Z]=j,se=Z);else if(pe<oe&&0>i(Te,j))k[se]=Te,k[pe]=j,se=pe;else break e}}return K}function i(k,K){var j=k.sortIndex-K.sortIndex;return j!==0?j:k.id-K.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();r.unstable_now=function(){return a.now()-o}}var u=[],c=[],h=1,p=null,v=3,y=!1,_=!1,A=!1,E=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function R(k){for(var K=t(c);K!==null;){if(K.callback===null)n(c);else if(K.startTime<=k)n(c),K.sortIndex=K.expirationTime,e(u,K);else break;K=t(c)}}function L(k){if(A=!1,R(k),!_)if(t(u)!==null)_=!0,ie();else{var K=t(c);K!==null&&ne(L,K.startTime-k)}}var w=!1,N=-1,O=5,F=-1;function B(){return!(r.unstable_now()-F<O)}function P(){if(w){var k=r.unstable_now();F=k;var K=!0;try{e:{_=!1,A&&(A=!1,T(N),N=-1),y=!0;var j=v;try{t:{for(R(k),p=t(u);p!==null&&!(p.expirationTime>k&&B());){var se=p.callback;if(typeof se=="function"){p.callback=null,v=p.priorityLevel;var oe=se(p.expirationTime<=k);if(k=r.unstable_now(),typeof oe=="function"){p.callback=oe,R(k),K=!0;break t}p===t(u)&&n(u),R(k)}else n(u);p=t(u)}if(p!==null)K=!0;else{var Y=t(c);Y!==null&&ne(L,Y.startTime-k),K=!1}}break e}finally{p=null,v=j,y=!1}K=void 0}}finally{K?V():w=!1}}}var V;if(typeof M=="function")V=function(){M(P)};else if(typeof MessageChannel<"u"){var J=new MessageChannel,Q=J.port2;J.port1.onmessage=P,V=function(){Q.postMessage(null)}}else V=function(){E(P,0)};function ie(){w||(w=!0,V())}function ne(k,K){N=E(function(){k(r.unstable_now())},K)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(k){k.callback=null},r.unstable_continueExecution=function(){_||y||(_=!0,ie())},r.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<k?Math.floor(1e3/k):5},r.unstable_getCurrentPriorityLevel=function(){return v},r.unstable_getFirstCallbackNode=function(){return t(u)},r.unstable_next=function(k){switch(v){case 1:case 2:case 3:var K=3;break;default:K=v}var j=v;v=K;try{return k()}finally{v=j}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(k,K){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var j=v;v=k;try{return K()}finally{v=j}},r.unstable_scheduleCallback=function(k,K,j){var se=r.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?se+j:se):j=se,k){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=j+oe,k={id:h++,callback:K,priorityLevel:k,startTime:j,expirationTime:oe,sortIndex:-1},j>se?(k.sortIndex=j,e(c,k),t(u)===null&&k===t(c)&&(A?(T(N),N=-1):A=!0,ne(L,j-se))):(k.sortIndex=oe,e(u,k),_||y||(_=!0,ie())),k},r.unstable_shouldYield=B,r.unstable_wrapCallback=function(k){var K=v;return function(){var j=v;v=K;try{return k.apply(this,arguments)}finally{v=j}}}})(rb)),rb}var NL;function U5(){return NL||(NL=1,sb.exports=N5()),sb.exports}var UL=U5();function $M(r,e,t){if(!r)return;if(t(r)===!0)return r;let n=e?r.return:r.child;for(;n;){const i=$M(n,e,t);if(i)return i;n=e?null:n.sibling}}function AB(r){try{return Object.defineProperties(r,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return r}}const ZM=AB(Ue.createContext(null));class EB extends Ue.Component{render(){return Ue.createElement(ZM.Provider,{value:this._reactInternals},this.props.children)}}function TB(){const r=Ue.useContext(ZM);if(r===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=Ue.useId();return Ue.useMemo(()=>{for(const t of[r,r?.alternate]){if(!t)continue;const n=$M(t,!1,i=>{let s=i.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(n)return n}},[r,e])}const F5=Symbol.for("react.context"),k5=r=>r!==null&&typeof r=="object"&&"$$typeof"in r&&r.$$typeof===F5;function G5(){const r=TB(),[e]=Ue.useState(()=>new Map);e.clear();let t=r;for(;t;){const n=t.type;k5(n)&&n!==ZM&&!e.has(n)&&e.set(n,Ue.use(AB(n))),t=t.return}return e}function H5(){const r=G5();return Ue.useMemo(()=>Array.from(r.keys()).reduce((e,t)=>n=>Ue.createElement(e,null,Ue.createElement(t.Provider,{...n,value:r.get(t)})),e=>Ue.createElement(EB,{...e})),[r])}function bB(r){let e=r.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const MB=r=>r&&r.isOrthographicCamera,z5=r=>r&&r.hasOwnProperty("current"),V5=r=>r!=null&&(typeof r=="string"||typeof r=="number"||r.isColor),fy=((r,e)=>typeof window<"u"&&(((r=window.document)==null?void 0:r.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?Ue.useLayoutEffect:Ue.useEffect;function eC(r){const e=Ue.useRef(r);return fy(()=>{e.current=r},[r]),e}function K5(){const r=TB(),e=H5();return Ue.useMemo(()=>({children:t})=>{const i=!!$M(r,!0,s=>s.type===Ue.StrictMode)?Ue.StrictMode:Ue.Fragment;return ye.jsx(i,{children:ye.jsx(e,{children:t})})},[r,e])}function Y5({set:r}){return fy(()=>(r(new Promise(()=>null)),()=>r(!1)),[r]),null}const X5=(r=>(r=class extends Ue.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}},r.getDerivedStateFromError=()=>({error:!0}),r))();function CB(r){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(r)?Math.min(Math.max(r[0],t),r[1]):r}function pm(r){var e;return(e=r.__r3f)==null?void 0:e.root.getState()}const Di={obj:r=>r===Object(r)&&!Di.arr(r)&&typeof r!="function",fun:r=>typeof r=="function",str:r=>typeof r=="string",num:r=>typeof r=="number",boo:r=>typeof r=="boolean",und:r=>r===void 0,nul:r=>r===null,arr:r=>Array.isArray(r),equ(r,e,{arrays:t="shallow",objects:n="reference",strict:i=!0}={}){if(typeof r!=typeof e||!!r!=!!e)return!1;if(Di.str(r)||Di.num(r)||Di.boo(r))return r===e;const s=Di.obj(r);if(s&&n==="reference")return r===e;const a=Di.arr(r);if(a&&t==="reference")return r===e;if((a||s)&&r===e)return!0;let o;for(o in r)if(!(o in e))return!1;if(s&&t==="shallow"&&n==="shallow"){for(o in i?e:r)if(!Di.equ(r[o],e[o],{strict:i,objects:"reference"}))return!1}else for(o in i?e:r)if(r[o]!==e[o])return!1;if(Di.und(o)){if(a&&r.length===0&&e.length===0||s&&Object.keys(r).length===0&&Object.keys(e).length===0)return!0;if(r!==e)return!1}return!0}};function q5(r){const e={nodes:{},materials:{},meshes:{}};return r&&r.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material),t.isMesh&&!e.meshes[t.name]&&(e.meshes[t.name]=t)}),e}function W5(r){r.type!=="Scene"&&(r.dispose==null||r.dispose());for(const e in r){const t=r[e];t?.type!=="Scene"&&(t==null||t.dispose==null||t.dispose())}}const RB=["children","key","ref"];function j5(r){const e={};for(const t in r)RB.includes(t)||(e[t]=r[t]);return e}function $S(r,e,t,n){const i=r;let s=i?.__r3f;return s||(s={root:e,type:t,parent:null,children:[],props:j5(n),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=s)),s}function kv(r,e){if(!e.includes("-"))return{root:r,key:e,target:r[e]};if(e in r)return{root:r,key:e,target:r[e]};let t=r;const n=e.split("-");for(const i of n){if(typeof t!="object"||t===null){if(t!==void 0){const s=n.slice(n.indexOf(i)).join("-");return{root:t,key:s,target:void 0}}return{root:r,key:e,target:void 0}}e=i,r=t,t=t[e]}return{root:r,key:e,target:t}}const FL=/-\d+$/;function ZS(r,e){if(Di.str(e.props.attach)){if(FL.test(e.props.attach)){const i=e.props.attach.replace(FL,""),{root:s,key:a}=kv(r.object,i);Array.isArray(s[a])||(s[a]=[])}const{root:t,key:n}=kv(r.object,e.props.attach);e.previousAttach=t[n],t[n]=e.object}else Di.fun(e.props.attach)&&(e.previousAttach=e.props.attach(r.object,e.object))}function eA(r,e){if(Di.str(e.props.attach)){const{root:t,key:n}=kv(r.object,e.props.attach),i=e.previousAttach;i===void 0?delete t[n]:t[n]=i}else e.previousAttach==null||e.previousAttach(r.object,e.object);delete e.previousAttach}const p1=[...RB,"args","dispose","attach","object","onUpdate","dispose"],kL=new Map;function J5(r){let e=kL.get(r.constructor);try{e||(e=new r.constructor,kL.set(r.constructor,e))}catch{}return e}function Q5(r,e){const t={};for(const n in e)if(!p1.includes(n)&&!Di.equ(e[n],r.props[n])){t[n]=e[n];for(const i in e)i.startsWith(`${n}-`)&&(t[i]=e[i])}for(const n in r.props){if(p1.includes(n)||e.hasOwnProperty(n))continue;const{root:i,key:s}=kv(r.object,n);if(i.constructor&&i.constructor.length===0){const a=J5(i);Di.und(a)||(t[s]=a[s])}else t[s]=0}return t}const $5=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],Z5=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function bf(r,e){var t;const n=r.__r3f,i=n&&bB(n).getState(),s=n?.eventCount;for(const o in e){let u=e[o];if(p1.includes(o))continue;if(n&&Z5.test(o)){typeof u=="function"?n.handlers[o]=u:delete n.handlers[o],n.eventCount=Object.keys(n.handlers).length;continue}if(u===void 0)continue;let{root:c,key:h,target:p}=kv(r,o);if(p===void 0&&(typeof c!="object"||c===null))throw Error(`R3F: Cannot set "${o}". Ensure it is an object before setting "${h}".`);if(p instanceof Xm&&u instanceof Xm)p.mask=u.mask;else if(p instanceof dt&&V5(u))p.set(u);else if(p!==null&&typeof p=="object"&&typeof p.set=="function"&&typeof p.copy=="function"&&u!=null&&u.constructor&&p.constructor===u.constructor)p.copy(u);else if(p!==null&&typeof p=="object"&&typeof p.set=="function"&&Array.isArray(u))typeof p.fromArray=="function"?p.fromArray(u):p.set(...u);else if(p!==null&&typeof p=="object"&&typeof p.set=="function"&&typeof u=="number")typeof p.setScalar=="function"?p.setScalar(u):p.set(u);else{var a;c[h]=u,i&&!i.linear&&$5.includes(h)&&(a=c[h])!=null&&a.isTexture&&c[h].format===Er&&c[h].type===Jr&&(c[h].colorSpace=xr)}}if(n!=null&&n.parent&&i!=null&&i.internal&&(t=n.object)!=null&&t.isObject3D&&s!==n.eventCount){const o=n.object,u=i.internal.interaction.indexOf(o);u>-1&&i.internal.interaction.splice(u,1),n.eventCount&&o.raycast!==null&&i.internal.interaction.push(o)}return n&&n.props.attach===void 0&&(n.object.isBufferGeometry?n.props.attach="geometry":n.object.isMaterial&&(n.props.attach="material")),n&&mg(n),r}function mg(r){var e;if(!r.parent)return;r.props.onUpdate==null||r.props.onUpdate(r.object);const t=(e=r.root)==null||e.getState==null?void 0:e.getState();t&&t.internal.frames===0&&t.invalidate()}function DB(r,e){r.manual||(MB(r)?(r.left=e.width/-2,r.right=e.width/2,r.top=e.height/2,r.bottom=e.height/-2):r.aspect=e.width/e.height,r.updateProjectionMatrix())}const jr=r=>r?.isObject3D;function Ex(r){return(r.eventObject||r.object).uuid+"/"+r.index+r.instanceId}function LB(r,e,t,n){const i=t.get(e);i&&(t.delete(e),t.size===0&&(r.delete(n),i.target.releasePointerCapture(n)))}function e6(r,e){const{internal:t}=r.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,i)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((n,i)=>{LB(t.capturedMap,e,n,i)})}function t6(r){function e(u){const{internal:c}=r.getState(),h=u.offsetX-c.initialClick[0],p=u.offsetY-c.initialClick[1];return Math.round(Math.sqrt(h*h+p*p))}function t(u){return u.filter(c=>["Move","Over","Enter","Out","Leave"].some(h=>{var p;return(p=c.__r3f)==null?void 0:p.handlers["onPointer"+h]}))}function n(u,c){const h=r.getState(),p=new Set,v=[],y=c?c(h.internal.interaction):h.internal.interaction;for(let T=0;T<y.length;T++){const M=pm(y[T]);M&&(M.raycaster.camera=void 0)}h.previousRoot||h.events.compute==null||h.events.compute(u,h);function _(T){const M=pm(T);if(!M||!M.events.enabled||M.raycaster.camera===null)return[];if(M.raycaster.camera===void 0){var R;M.events.compute==null||M.events.compute(u,M,(R=M.previousRoot)==null?void 0:R.getState()),M.raycaster.camera===void 0&&(M.raycaster.camera=null)}return M.raycaster.camera?M.raycaster.intersectObject(T,!0):[]}let A=y.flatMap(_).sort((T,M)=>{const R=pm(T.object),L=pm(M.object);return!R||!L?T.distance-M.distance:L.events.priority-R.events.priority||T.distance-M.distance}).filter(T=>{const M=Ex(T);return p.has(M)?!1:(p.add(M),!0)});h.events.filter&&(A=h.events.filter(A,h));for(const T of A){let M=T.object;for(;M;){var E;(E=M.__r3f)!=null&&E.eventCount&&v.push({...T,eventObject:M}),M=M.parent}}if("pointerId"in u&&h.internal.capturedMap.has(u.pointerId))for(let T of h.internal.capturedMap.get(u.pointerId).values())p.has(Ex(T.intersection))||v.push(T.intersection);return v}function i(u,c,h,p){if(u.length){const v={stopped:!1};for(const y of u){let _=pm(y.object);if(_||y.object.traverseAncestors(A=>{const E=pm(A);if(E)return _=E,!1}),_){const{raycaster:A,pointer:E,camera:T,internal:M}=_,R=new ee(E.x,E.y,0).unproject(T),L=B=>{var P,V;return(P=(V=M.capturedMap.get(B))==null?void 0:V.has(y.eventObject))!=null?P:!1},w=B=>{const P={intersection:y,target:c.target};M.capturedMap.has(B)?M.capturedMap.get(B).set(y.eventObject,P):M.capturedMap.set(B,new Map([[y.eventObject,P]])),c.target.setPointerCapture(B)},N=B=>{const P=M.capturedMap.get(B);P&&LB(M.capturedMap,y.eventObject,P,B)};let O={};for(let B in c){let P=c[B];typeof P!="function"&&(O[B]=P)}let F={...y,...O,pointer:E,intersections:u,stopped:v.stopped,delta:h,unprojectedPoint:R,ray:A.ray,camera:T,stopPropagation(){const B="pointerId"in c&&M.capturedMap.get(c.pointerId);if((!B||B.has(y.eventObject))&&(F.stopped=v.stopped=!0,M.hovered.size&&Array.from(M.hovered.values()).find(P=>P.eventObject===y.eventObject))){const P=u.slice(0,u.indexOf(y));s([...P,y])}},target:{hasPointerCapture:L,setPointerCapture:w,releasePointerCapture:N},currentTarget:{hasPointerCapture:L,setPointerCapture:w,releasePointerCapture:N},nativeEvent:c};if(p(F),v.stopped===!0)break}}}return u}function s(u){const{internal:c}=r.getState();for(const h of c.hovered.values())if(!u.length||!u.find(p=>p.object===h.object&&p.index===h.index&&p.instanceId===h.instanceId)){const v=h.eventObject.__r3f;if(c.hovered.delete(Ex(h)),v!=null&&v.eventCount){const y=v.handlers,_={...h,intersections:u};y.onPointerOut==null||y.onPointerOut(_),y.onPointerLeave==null||y.onPointerLeave(_)}}}function a(u,c){for(let h=0;h<c.length;h++){const p=c[h].__r3f;p==null||p.handlers.onPointerMissed==null||p.handlers.onPointerMissed(u)}}function o(u){switch(u){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:h}=r.getState();"pointerId"in c&&h.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{h.capturedMap.has(c.pointerId)&&(h.capturedMap.delete(c.pointerId),s([]))})}}return function(h){const{onPointerMissed:p,internal:v}=r.getState();v.lastEvent.current=h;const y=u==="onPointerMove",_=u==="onClick"||u==="onContextMenu"||u==="onDoubleClick",E=n(h,y?t:void 0),T=_?e(h):0;u==="onPointerDown"&&(v.initialClick=[h.offsetX,h.offsetY],v.initialHits=E.map(R=>R.eventObject)),_&&!E.length&&T<=2&&(a(h,v.interaction),p&&p(h)),y&&s(E);function M(R){const L=R.eventObject,w=L.__r3f;if(!(w!=null&&w.eventCount))return;const N=w.handlers;if(y){if(N.onPointerOver||N.onPointerEnter||N.onPointerOut||N.onPointerLeave){const O=Ex(R),F=v.hovered.get(O);F?F.stopped&&R.stopPropagation():(v.hovered.set(O,R),N.onPointerOver==null||N.onPointerOver(R),N.onPointerEnter==null||N.onPointerEnter(R))}N.onPointerMove==null||N.onPointerMove(R)}else{const O=N[u];O?(!_||v.initialHits.includes(L))&&(a(h,v.interaction.filter(F=>!v.initialHits.includes(F))),O(R)):_&&v.initialHits.includes(L)&&a(h,v.interaction.filter(F=>!v.initialHits.includes(F)))}}i(E,h,T,M)}}return{handlePointer:o}}const GL=r=>!!(r!=null&&r.render),tC=Ue.createContext(null),n6=(r,e)=>{const t=yB((o,u)=>{const c=new ee,h=new ee,p=new ee;function v(T=u().camera,M=h,R=u().size){const{width:L,height:w,top:N,left:O}=R,F=L/w;M.isVector3?p.copy(M):p.set(...M);const B=T.getWorldPosition(c).distanceTo(p);if(MB(T))return{width:L/T.zoom,height:w/T.zoom,top:N,left:O,factor:1,distance:B,aspect:F};{const P=T.fov*Math.PI/180,V=2*Math.tan(P/2)*B,J=V*(L/w);return{width:J,height:V,top:N,left:O,factor:L/J,distance:B,aspect:F}}}let y;const _=T=>o(M=>({performance:{...M.performance,current:T}})),A=new Ve;return{set:o,get:u,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(T=1)=>r(u(),T),advance:(T,M)=>e(T,M,u()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new qM,pointer:A,mouse:A,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const T=u();y&&clearTimeout(y),T.performance.current!==T.performance.min&&_(T.performance.min),y=setTimeout(()=>_(u().performance.max),T.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:v},setEvents:T=>o(M=>({...M,events:{...M.events,...T}})),setSize:(T,M,R=0,L=0)=>{const w=u().camera,N={width:T,height:M,top:R,left:L};o(O=>({size:N,viewport:{...O.viewport,...v(w,h,N)}}))},setDpr:T=>o(M=>{const R=CB(T);return{viewport:{...M.viewport,dpr:R,initialDpr:M.viewport.initialDpr||R}}}),setFrameloop:(T="always")=>{const M=u().clock;M.stop(),M.elapsedTime=0,T!=="never"&&(M.start(),M.elapsedTime=0),o(()=>({frameloop:T}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:Ue.createRef(),active:!1,frames:0,priority:0,subscribe:(T,M,R)=>{const L=u().internal;return L.priority=L.priority+(M>0?1:0),L.subscribers.push({ref:T,priority:M,store:R}),L.subscribers=L.subscribers.sort((w,N)=>w.priority-N.priority),()=>{const w=u().internal;w!=null&&w.subscribers&&(w.priority=w.priority-(M>0?1:0),w.subscribers=w.subscribers.filter(N=>N.ref!==T))}}}}}),n=t.getState();let i=n.size,s=n.viewport.dpr,a=n.camera;return t.subscribe(()=>{const{camera:o,size:u,viewport:c,gl:h,set:p}=t.getState();if(u.width!==i.width||u.height!==i.height||c.dpr!==s){i=u,s=c.dpr,DB(o,u),c.dpr>0&&h.setPixelRatio(c.dpr);const v=typeof HTMLCanvasElement<"u"&&h.domElement instanceof HTMLCanvasElement;h.setSize(u.width,u.height,v)}o!==a&&(a=o,p(v=>({viewport:{...v.viewport,...v.viewport.getCurrentViewport(o)}})))}),t.subscribe(o=>r(o)),t};function nC(){const r=Ue.useContext(tC);if(!r)throw new Error("R3F: Hooks can only be used within the Canvas component!");return r}function Ja(r=t=>t,e){return nC()(r,e)}function hy(r,e=0){const t=nC(),n=t.getState().internal.subscribe,i=eC(r);return fy(()=>n(i,e,t),[e,n,t]),null}const HL=new WeakMap,i6=r=>{var e;return typeof r=="function"&&(r==null||(e=r.prototype)==null?void 0:e.constructor)===r};function IB(r,e){return function(t,...n){let i;return i6(t)?(i=HL.get(t),i||(i=new t,HL.set(t,i))):i=t,r&&r(i),Promise.all(n.map(s=>new Promise((a,o)=>i.load(s,u=>{jr(u?.scene)&&Object.assign(u,q5(u.scene)),a(u)},e,u=>o(new Error(`Could not load ${s}: ${u?.message}`))))))}}function qf(r,e,t,n){const i=Array.isArray(e)?e:[e],s=SB(IB(t,n),[r,...i],{equal:Di.equ});return Array.isArray(e)?s:s[0]}qf.preload=function(r,e,t){const n=Array.isArray(e)?e:[e];return R5(IB(t),[r,...n])};qf.clear=function(r,e){const t=Array.isArray(e)?e:[e];return D5([r,...t])};var s6={version:"9.4.2"};function r6(r){const e=P5(r);return e.injectIntoDevTools(),e}const wB=0,Jm={},a6=/^three(?=[A-Z])/,aE=r=>`${r[0].toUpperCase()}${r.slice(1)}`;let o6=0;const l6=r=>typeof r=="function";function BB(r){if(l6(r)){const e=`${o6++}`;return Jm[e]=r,e}else Object.assign(Jm,r)}function OB(r,e){const t=aE(r),n=Jm[t];if(r!=="primitive"&&!n)throw new Error(`R3F: ${t} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(r==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function u6(r,e,t){var n;return r=aE(r)in Jm?r:r.replace(a6,""),OB(r,e),r==="primitive"&&(n=e.object)!=null&&n.__r3f&&delete e.object.__r3f,$S(e.object,t,r,e)}function c6(r){if(!r.isHidden){var e;r.props.attach&&(e=r.parent)!=null&&e.object?eA(r.parent,r):jr(r.object)&&(r.object.visible=!1),r.isHidden=!0,mg(r)}}function PB(r){if(r.isHidden){var e;r.props.attach&&(e=r.parent)!=null&&e.object?ZS(r.parent,r):jr(r.object)&&r.props.visible!==!1&&(r.object.visible=!0),r.isHidden=!1,mg(r)}}function iC(r,e,t){const n=e.root.getState();if(!(!r.parent&&r.object!==n.scene)){if(!e.object){var i,s;const a=Jm[aE(e.type)];e.object=(i=e.props.object)!=null?i:new a(...(s=e.props.args)!=null?s:[]),e.object.__r3f=e}if(bf(e.object,e.props),e.props.attach)ZS(r,e);else if(jr(e.object)&&jr(r.object)){const a=r.object.children.indexOf(t?.object);if(t&&a!==-1){const o=r.object.children.indexOf(e.object);if(o!==-1){r.object.children.splice(o,1);const u=o<a?a-1:a;r.object.children.splice(u,0,e.object)}else e.object.parent=r.object,r.object.children.splice(a,0,e.object),e.object.dispatchEvent({type:"added"}),r.object.dispatchEvent({type:"childadded",child:e.object})}else r.object.add(e.object)}for(const a of e.children)iC(e,a);mg(e)}}function ab(r,e){e&&(e.parent=r,r.children.push(e),iC(r,e))}function zL(r,e,t){if(!e||!t)return;e.parent=r;const n=r.children.indexOf(t);n!==-1?r.children.splice(n,0,e):r.children.push(e),iC(r,e,t)}function NB(r){if(typeof r.dispose=="function"){const e=()=>{try{r.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():UL.unstable_scheduleCallback(UL.unstable_IdlePriority,e)}}function m1(r,e,t){if(!e)return;e.parent=null;const n=r.children.indexOf(e);n!==-1&&r.children.splice(n,1),e.props.attach?eA(r,e):jr(e.object)&&jr(r.object)&&(r.object.remove(e.object),e6(bB(e),e.object));const i=e.props.dispose!==null&&t!==!1;for(let s=e.children.length-1;s>=0;s--){const a=e.children[s];m1(e,a,i)}e.children.length=0,delete e.object.__r3f,i&&e.type!=="primitive"&&e.object.type!=="Scene"&&NB(e.object),t===void 0&&mg(e)}function f6(r,e){for(const t of[r,r.alternate])if(t!==null)if(typeof t.ref=="function"){t.refCleanup==null||t.refCleanup();const n=t.ref(e);typeof n=="function"&&(t.refCleanup=n)}else t.ref&&(t.ref.current=e)}const qx=[];function h6(){for(const[t]of qx){const n=t.parent;if(n){t.props.attach?eA(n,t):jr(t.object)&&jr(n.object)&&n.object.remove(t.object);for(const i of t.children)i.props.attach?eA(t,i):jr(i.object)&&jr(t.object)&&t.object.remove(i.object)}t.isHidden&&PB(t),t.object.__r3f&&delete t.object.__r3f,t.type!=="primitive"&&NB(t.object)}for(const[t,n,i]of qx){t.props=n;const s=t.parent;if(s){var r,e;const a=Jm[aE(t.type)];t.object=(r=t.props.object)!=null?r:new a(...(e=t.props.args)!=null?e:[]),t.object.__r3f=t,f6(i,t.object),bf(t.object,t.props),t.props.attach?ZS(s,t):jr(t.object)&&jr(s.object)&&s.object.add(t.object);for(const o of t.children)o.props.attach?ZS(t,o):jr(o.object)&&jr(t.object)&&t.object.add(o.object);mg(t)}}qx.length=0}const ob=()=>{},VL={};let Tx=wB;const d6=0,p6=4,tA=r6({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:u6,removeChild:m1,appendChild:ab,appendInitialChild:ab,insertBefore:zL,appendChildToContainer(r,e){const t=r.getState().scene.__r3f;!e||!t||ab(t,e)},removeChildFromContainer(r,e){const t=r.getState().scene.__r3f;!e||!t||m1(t,e)},insertInContainerBefore(r,e,t){const n=r.getState().scene.__r3f;!e||!t||!n||zL(n,e,t)},getRootHostContext:()=>VL,getChildHostContext:()=>VL,commitUpdate(r,e,t,n,i){var s,a,o;OB(e,n);let u=!1;if((r.type==="primitive"&&t.object!==n.object||((s=n.args)==null?void 0:s.length)!==((a=t.args)==null?void 0:a.length)||(o=n.args)!=null&&o.some((h,p)=>{var v;return h!==((v=t.args)==null?void 0:v[p])}))&&(u=!0),u)qx.push([r,{...n},i]);else{const h=Q5(r,n);Object.keys(h).length&&(Object.assign(r.props,h),bf(r.object,h))}(i.sibling===null||(i.flags&p6)===d6)&&h6()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:r=>r?.object,prepareForCommit:()=>null,preparePortalMount:r=>$S(r.getState().scene,r,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:c6,unhideInstance:PB,createTextInstance:ob,hideTextInstance:ob,unhideTextInstance:ob,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:Ue.createContext(null),setCurrentUpdatePriority(r){Tx=r},getCurrentUpdatePriority(){return Tx},resolveUpdatePriority(){var r;if(Tx!==wB)return Tx;switch(typeof window<"u"&&((r=window.event)==null?void 0:r.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Vx.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Vx.ContinuousEventPriority;default:return Vx.DefaultEventPriority}},resetFormInstance(){},rendererPackageName:"@react-three/fiber",rendererVersion:s6.version}),Od=new Map,mm={objects:"shallow",strict:!1};function m6(r,e){if(!e&&typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement&&r.parentElement){const{width:t,height:n,top:i,left:s}=r.parentElement.getBoundingClientRect();return{width:t,height:n,top:i,left:s}}else if(!e&&typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas)return{width:r.width,height:r.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function g6(r){const e=Od.get(r),t=e?.fiber,n=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=n||n6(y1,YL),a=t||tA.createContainer(s,Vx.ConcurrentRoot,null,!1,null,"",i,i,i,null);e||Od.set(r,{fiber:a,store:s});let o,u,c=!1,h=null;return{async configure(p={}){let v;h=new Promise(Y=>v=Y);let{gl:y,size:_,scene:A,events:E,onCreated:T,shadows:M=!1,linear:R=!1,flat:L=!1,legacy:w=!1,orthographic:N=!1,frameloop:O="always",dpr:F=[1,2],performance:B,raycaster:P,camera:V,onPointerMissed:J}=p,Q=s.getState(),ie=Q.gl;if(!Q.gl){const Y={canvas:r,powerPreference:"high-performance",antialias:!0,alpha:!0},Z=typeof y=="function"?await y(Y):y;GL(Z)?ie=Z:ie=new vB({...Y,...y}),Q.set({gl:ie})}let ne=Q.raycaster;ne||Q.set({raycaster:ne=new JM});const{params:k,...K}=P||{};if(Di.equ(K,ne,mm)||bf(ne,{...K}),Di.equ(k,ne.params,mm)||bf(ne,{params:{...ne.params,...k}}),!Q.camera||Q.camera===u&&!Di.equ(u,V,mm)){u=V;const Y=V?.isCamera,Z=Y?V:N?new kd(0,0,0,0,.1,1e3):new gs(75,0,.1,1e3);Y||(Z.position.z=5,V&&(bf(Z,V),Z.manual||("aspect"in V||"left"in V||"right"in V||"bottom"in V||"top"in V)&&(Z.manual=!0,Z.updateProjectionMatrix())),!Q.camera&&!(V!=null&&V.rotation)&&Z.lookAt(0,0,0)),Q.set({camera:Z}),ne.camera=Z}if(!Q.scene){let Y;A!=null&&A.isScene?(Y=A,$S(Y,s,"",{})):(Y=new iy,$S(Y,s,"",{}),A&&bf(Y,A)),Q.set({scene:Y})}E&&!Q.events.handlers&&Q.set({events:E(s)});const j=m6(r,_);if(Di.equ(j,Q.size,mm)||Q.setSize(j.width,j.height,j.top,j.left),F&&Q.viewport.dpr!==CB(F)&&Q.setDpr(F),Q.frameloop!==O&&Q.setFrameloop(O),Q.onPointerMissed||Q.set({onPointerMissed:J}),B&&!Di.equ(B,Q.performance,mm)&&Q.set(Y=>({performance:{...Y.performance,...B}})),!Q.xr){var se;const Y=(pe,Te)=>{const ce=s.getState();ce.frameloop!=="never"&&YL(pe,!0,ce,Te)},Z=()=>{const pe=s.getState();pe.gl.xr.enabled=pe.gl.xr.isPresenting,pe.gl.xr.setAnimationLoop(pe.gl.xr.isPresenting?Y:null),pe.gl.xr.isPresenting||y1(pe)},le={connect(){const pe=s.getState().gl;pe.xr.addEventListener("sessionstart",Z),pe.xr.addEventListener("sessionend",Z)},disconnect(){const pe=s.getState().gl;pe.xr.removeEventListener("sessionstart",Z),pe.xr.removeEventListener("sessionend",Z)}};typeof((se=ie.xr)==null?void 0:se.addEventListener)=="function"&&le.connect(),Q.set({xr:le})}if(ie.shadowMap){const Y=ie.shadowMap.enabled,Z=ie.shadowMap.type;if(ie.shadowMap.enabled=!!M,Di.boo(M))ie.shadowMap.type=hv;else if(Di.str(M)){var oe;const le={basic:Uw,percentage:Rm,soft:hv,variance:ud};ie.shadowMap.type=(oe=le[M])!=null?oe:hv}else Di.obj(M)&&Object.assign(ie.shadowMap,M);(Y!==ie.shadowMap.enabled||Z!==ie.shadowMap.type)&&(ie.shadowMap.needsUpdate=!0)}return Mn.enabled=!w,c||(ie.outputColorSpace=R?Nf:xr,ie.toneMapping=L?Oo:TA),Q.legacy!==w&&Q.set(()=>({legacy:w})),Q.linear!==R&&Q.set(()=>({linear:R})),Q.flat!==L&&Q.set(()=>({flat:L})),y&&!Di.fun(y)&&!GL(y)&&!Di.equ(y,ie,mm)&&bf(ie,y),o=T,c=!0,v(),this},render(p){return!c&&!h&&this.configure(),h.then(()=>{tA.updateContainer(ye.jsx(v6,{store:s,children:p,onCreated:o,rootElement:r}),a,null,()=>{})}),s},unmount(){UB(r)}}}function v6({store:r,children:e,onCreated:t,rootElement:n}){return fy(()=>{const i=r.getState();i.set(s=>({internal:{...s.internal,active:!0}})),t&&t(i),r.getState().events.connected||i.events.connect==null||i.events.connect(n)},[]),ye.jsx(tC.Provider,{value:r,children:e})}function UB(r,e){const t=Od.get(r),n=t?.fiber;if(n){const i=t?.store.getState();i&&(i.internal.active=!1),tA.updateContainer(null,n,null,()=>{i&&setTimeout(()=>{try{var s,a,o,u;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=i.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(u=i.gl)!=null&&u.xr&&i.xr.disconnect(),W5(i.scene),Od.delete(r)}catch{}},500)})}}function y6(r,e,t){return ye.jsx(_6,{children:r,container:e,state:t})}function _6({state:r={},children:e,container:t}){const{events:n,size:i,...s}=r,a=nC(),[o]=Ue.useState(()=>new JM),[u]=Ue.useState(()=>new Ve),c=eC((p,v)=>{let y;if(v.camera&&i){const _=v.camera;y=p.viewport.getCurrentViewport(_,new ee,i),_!==p.camera&&DB(_,i)}return{...p,...v,scene:t,raycaster:o,pointer:u,mouse:u,previousRoot:a,events:{...p.events,...v.events,...n},size:{...p.size,...i},viewport:{...p.viewport,...y},setEvents:_=>v.set(A=>({...A,events:{...A.events,..._}}))}}),h=Ue.useMemo(()=>{const p=yB((y,_)=>({...s,set:y,get:_})),v=y=>p.setState(_=>c.current(y,_));return v(a.getState()),a.subscribe(v),p},[a,t]);return ye.jsx(ye.Fragment,{children:tA.createPortal(ye.jsx(tC.Provider,{value:h,children:e}),h,null)})}const x6=new Set,S6=new Set,A6=new Set;function lb(r,e){if(r.size)for(const{callback:t}of r.values())t(e)}function xv(r,e){switch(r){case"before":return lb(x6,e);case"after":return lb(S6,e);case"tail":return lb(A6,e)}}let ub,cb;function g1(r,e,t){let n=e.clock.getDelta();e.frameloop==="never"&&typeof r=="number"&&(n=r-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=r),ub=e.internal.subscribers;for(let i=0;i<ub.length;i++)cb=ub[i],cb.ref.current(cb.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let nA=!1,v1=!1,fb,KL,gm;function FB(r){KL=requestAnimationFrame(FB),nA=!0,fb=0,xv("before",r),v1=!0;for(const t of Od.values()){var e;gm=t.store.getState(),gm.internal.active&&(gm.frameloop==="always"||gm.internal.frames>0)&&!((e=gm.gl.xr)!=null&&e.isPresenting)&&(fb+=g1(r,gm))}if(v1=!1,xv("after",r),fb===0)return xv("tail",r),nA=!1,cancelAnimationFrame(KL)}function y1(r,e=1){var t;if(!r)return Od.forEach(n=>y1(n.store.getState(),e));(t=r.gl.xr)!=null&&t.isPresenting||!r.internal.active||r.frameloop==="never"||(e>1?r.internal.frames=Math.min(60,r.internal.frames+e):v1?r.internal.frames=2:r.internal.frames=1,nA||(nA=!0,requestAnimationFrame(FB)))}function YL(r,e=!0,t,n){if(e&&xv("before",r),t)g1(r,t,n);else for(const i of Od.values())g1(r,i.store.getState());e&&xv("after",r)}const hb={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function E6(r){const{handlePointer:e}=t6(r);return{priority:1,enabled:!0,compute(t,n,i){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(hb).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:i}=r.getState();(t=i.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{const{set:n,events:i}=r.getState();if(i.disconnect==null||i.disconnect(),n(s=>({events:{...s.events,connected:t}})),i.handlers)for(const s in i.handlers){const a=i.handlers[s],[o,u]=hb[s];t.addEventListener(o,a,{passive:u})}},disconnect:()=>{const{set:t,events:n}=r.getState();if(n.connected){if(n.handlers)for(const i in n.handlers){const s=n.handlers[i],[a]=hb[i];n.connected.removeEventListener(a,s)}t(i=>({events:{...i.events,connected:void 0}}))}}}}function XL(r,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>r(...n),e)}}function T6({debounce:r,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const i=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=Ue.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=Ue.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),u=r?typeof r=="number"?r:r.scroll:null,c=r?typeof r=="number"?r:r.resize:null,h=Ue.useRef(!1);Ue.useEffect(()=>(h.current=!0,()=>{h.current=!1}));const[p,v,y]=Ue.useMemo(()=>{const T=()=>{if(!o.current.element)return;const{left:M,top:R,width:L,height:w,bottom:N,right:O,x:F,y:B}=o.current.element.getBoundingClientRect(),P={left:M,top:R,width:L,height:w,bottom:N,right:O,x:F,y:B};o.current.element instanceof HTMLElement&&n&&(P.height=o.current.element.offsetHeight,P.width=o.current.element.offsetWidth),Object.freeze(P),h.current&&!R6(o.current.lastBounds,P)&&a(o.current.lastBounds=P)};return[T,c?XL(T,c):T,u?XL(T,u):T]},[a,n,u,c]);function _(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(T=>T.removeEventListener("scroll",y,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function A(){o.current.element&&(o.current.resizeObserver=new i(y),o.current.resizeObserver.observe(o.current.element),e&&o.current.scrollContainers&&o.current.scrollContainers.forEach(T=>T.addEventListener("scroll",y,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{y()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const E=T=>{!T||T===o.current.element||(_(),o.current.element=T,o.current.scrollContainers=kB(T),A())};return M6(y,!!e),b6(v),Ue.useEffect(()=>{_(),A()},[e,y,v]),Ue.useEffect(()=>_,[]),[E,s,p]}function b6(r){Ue.useEffect(()=>{const e=r;return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[r])}function M6(r,e){Ue.useEffect(()=>{if(e){const t=r;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}},[r,e])}function kB(r){const e=[];if(!r||r===document.body)return e;const{overflow:t,overflowX:n,overflowY:i}=window.getComputedStyle(r);return[t,n,i].some(s=>s==="auto"||s==="scroll")&&e.push(r),[...e,...kB(r.parentElement)]}const C6=["x","y","top","bottom","left","right","width","height"],R6=(r,e)=>C6.every(t=>r[t]===e[t]);function D6({ref:r,children:e,fallback:t,resize:n,style:i,gl:s,events:a=E6,eventSource:o,eventPrefix:u,shadows:c,linear:h,flat:p,legacy:v,orthographic:y,frameloop:_,dpr:A,performance:E,raycaster:T,camera:M,scene:R,onPointerMissed:L,onCreated:w,...N}){Ue.useMemo(()=>BB(g5),[]);const O=K5(),[F,B]=T6({scroll:!0,debounce:{scroll:50,resize:0},...n}),P=Ue.useRef(null),V=Ue.useRef(null);Ue.useImperativeHandle(r,()=>P.current);const J=eC(L),[Q,ie]=Ue.useState(!1),[ne,k]=Ue.useState(!1);if(Q)throw Q;if(ne)throw ne;const K=Ue.useRef(null);fy(()=>{const se=P.current;if(B.width>0&&B.height>0&&se){K.current||(K.current=g6(se));async function oe(){await K.current.configure({gl:s,scene:R,events:a,shadows:c,linear:h,flat:p,legacy:v,orthographic:y,frameloop:_,dpr:A,performance:E,raycaster:T,camera:M,size:B,onPointerMissed:(...Y)=>J.current==null?void 0:J.current(...Y),onCreated:Y=>{Y.events.connect==null||Y.events.connect(o?z5(o)?o.current:o:V.current),u&&Y.setEvents({compute:(Z,le)=>{const pe=Z[u+"X"],Te=Z[u+"Y"];le.pointer.set(pe/le.size.width*2-1,-(Te/le.size.height)*2+1),le.raycaster.setFromCamera(le.pointer,le.camera)}}),w?.(Y)}}),K.current.render(ye.jsx(O,{children:ye.jsx(X5,{set:k,children:ye.jsx(Ue.Suspense,{fallback:ye.jsx(Y5,{set:ie}),children:e??null})})}))}oe()}}),Ue.useEffect(()=>{const se=P.current;if(se)return()=>UB(se)},[]);const j=o?"none":"auto";return ye.jsx("div",{ref:V,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:j,...i},...N,children:ye.jsx("div",{ref:F,style:{width:"100%",height:"100%"},children:ye.jsx("canvas",{ref:P,style:{display:"block"},children:t})})})}function L6(r){return ye.jsx(EB,{children:ye.jsx(D6,{...r})})}function iA(){return iA=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},iA.apply(null,arguments)}const I6=parseInt(og.replace(/\D+/g,""));function qL(r,e){if(e===l2)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),r;if(e===XS||e===mM){let t=r.getIndex();if(t===null){const a=[],o=r.getAttribute("position");if(o!==void 0){for(let u=0;u<o.count;u++)a.push(u);r.setIndex(a),t=r.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),r}const n=t.count-2,i=[];if(t)if(e===XS)for(let a=1;a<=n;a++)i.push(t.getX(0)),i.push(t.getX(a)),i.push(t.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(i.push(t.getX(a)),i.push(t.getX(a+1)),i.push(t.getX(a+2))):(i.push(t.getX(a+2)),i.push(t.getX(a+1)),i.push(t.getX(a)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=r.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),r}function sA(r){if(typeof TextDecoder<"u")return new TextDecoder().decode(r);let e="";for(let t=0,n=r.length;t<n;t++)e+=String.fromCharCode(r[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const md="srgb",Sc="srgb-linear",WL=3001,w6=3e3;class sC extends Cr{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new U6(t)}),this.register(function(t){return new F6(t)}),this.register(function(t){return new q6(t)}),this.register(function(t){return new W6(t)}),this.register(function(t){return new j6(t)}),this.register(function(t){return new G6(t)}),this.register(function(t){return new H6(t)}),this.register(function(t){return new z6(t)}),this.register(function(t){return new V6(t)}),this.register(function(t){return new N6(t)}),this.register(function(t){return new K6(t)}),this.register(function(t){return new k6(t)}),this.register(function(t){return new X6(t)}),this.register(function(t){return new Y6(t)}),this.register(function(t){return new O6(t)}),this.register(function(t){return new J6(t)}),this.register(function(t){return new Q6(t)})}load(e,t,n,i){const s=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const c=wf.extractUrlBase(e);a=wf.resolveURL(c,this.path)}else a=wf.extractUrlBase(e);this.manager.itemStart(e);const o=function(c){i?i(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},u=new no(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(c){try{s.parse(c,a,function(h){t(h),s.manager.itemEnd(e)},o)}catch(h){o(h)}},n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let s;const a={},o={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(sA(new Uint8Array(e.slice(0,4)))===GB){try{a[An.KHR_BINARY_GLTF]=new $6(e)}catch(h){i&&i(h);return}s=JSON.parse(a[An.KHR_BINARY_GLTF].content)}else s=JSON.parse(sA(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new f9(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const h=this.pluginCallbacks[c](u);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[h.name]=h,a[h.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const h=s.extensionsUsed[c],p=s.extensionsRequired||[];switch(h){case An.KHR_MATERIALS_UNLIT:a[h]=new P6;break;case An.KHR_DRACO_MESH_COMPRESSION:a[h]=new Z6(s,this.dracoLoader);break;case An.KHR_TEXTURE_TRANSFORM:a[h]=new e9;break;case An.KHR_MESH_QUANTIZATION:a[h]=new t9;break;default:p.indexOf(h)>=0&&o[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}u.setExtensions(a),u.setPlugins(o),u.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,s){n.parse(e,t,i,s)})}}function B6(){let r={};return{get:function(e){return r[e]},add:function(e,t){r[e]=t},remove:function(e){delete r[e]},removeAll:function(){r={}}}}const An={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class O6{constructor(e){this.parser=e,this.name=An.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const s=t.json,u=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const h=new dt(16777215);u.color!==void 0&&h.setRGB(u.color[0],u.color[1],u.color[2],Sc);const p=u.range!==void 0?u.range:0;switch(u.type){case"directional":c=new KM(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new VM(h),c.distance=p;break;case"spot":c=new zM(h),c.distance=p,u.spot=u.spot||{},u.spot.innerConeAngle=u.spot.innerConeAngle!==void 0?u.spot.innerConeAngle:0,u.spot.outerConeAngle=u.spot.outerConeAngle!==void 0?u.spot.outerConeAngle:Math.PI/4,c.angle=u.spot.outerConeAngle,c.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return c.position.set(0,0,0),c.decay=2,cc(c,u),u.intensity!==void 0&&(c.intensity=u.intensity),c.name=t.createUniqueName(u.name||"light_"+e),i=Promise.resolve(c),t.cache.add(n,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],o=(s.extensions&&s.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(u){return n._getNodeRef(t.cache,o,u)})}}class P6{constructor(){this.name=An.KHR_MATERIALS_UNLIT}getMaterialType(){return Xa}extendParams(e,t,n){const i=[];e.color=new dt(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],Sc),e.opacity=a[3]}s.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",s.baseColorTexture,md))}return Promise.all(i)}}class N6{constructor(e){this.parser=e,this.name=An.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class U6{constructor(e){this.parser=e,this.name=An.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Uo}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Ve(o,o)}return Promise.all(s)}}class F6{constructor(e){this.parser=e,this.name=An.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Uo}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class k6{constructor(e){this.parser=e,this.name=An.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Uo}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class G6{constructor(e){this.parser=e,this.name=An.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Uo}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new dt(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=i.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],Sc)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,md)),a.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}}class H6{constructor(e){this.parser=e,this.name=An.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Uo}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class z6{constructor(e){this.parser=e,this.name=An.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Uo}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return t.attenuationColor=new dt().setRGB(o[0],o[1],o[2],Sc),Promise.all(s)}}class V6{constructor(e){this.parser=e,this.name=An.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Uo}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class K6{constructor(e){this.parser=e,this.name=An.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Uo}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return t.specularColor=new dt().setRGB(o[0],o[1],o[2],Sc),a.specularColorTexture!==void 0&&s.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,md)),Promise.all(s)}}class Y6{constructor(e){this.parser=e,this.name=An.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Uo}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&s.push(n.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(s)}}class X6{constructor(e){this.parser=e,this.name=An.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Uo}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(n.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class q6{constructor(e){this.parser=e,this.name=An.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,a)}}class W6{constructor(e){this.parser=e,this.name=An.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],o=i.images[a.source];let u=n.textureLoader;if(o.uri){const c=n.options.manager.getHandler(o.uri);c!==null&&(u=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,a.source,u);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class j6{constructor(e){this.parser=e,this.name=An.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],o=i.images[a.source];let u=n.textureLoader;if(o.uri){const c=n.options.manager.getHandler(o.uri);c!==null&&(u=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,a.source,u);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class J6{constructor(e){this.name=An.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(o){const u=i.byteOffset||0,c=i.byteLength||0,h=i.count,p=i.byteStride,v=new Uint8Array(o,u,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(h,p,v,i.mode,i.filter).then(function(y){return y.buffer}):a.ready.then(function(){const y=new ArrayBuffer(h*p);return a.decodeGltfBuffer(new Uint8Array(y),h,p,v,i.mode,i.filter),y})})}else return null}}class Q6{constructor(e){this.name=An.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const i=t.meshes[n.mesh];for(const c of i.primitives)if(c.mode!==Ro.TRIANGLES&&c.mode!==Ro.TRIANGLE_STRIP&&c.mode!==Ro.TRIANGLE_FAN&&c.mode!==void 0)return null;const a=n.extensions[this.name].attributes,o=[],u={};for(const c in a)o.push(this.parser.getDependency("accessor",a[c]).then(h=>(u[c]=h,u[c])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(c=>{const h=c.pop(),p=h.isGroup?h.children:[h],v=c[0].count,y=[];for(const _ of p){const A=new zt,E=new ee,T=new Tr,M=new ee(1,1,1),R=new EM(_.geometry,_.material,v);for(let L=0;L<v;L++)u.TRANSLATION&&E.fromBufferAttribute(u.TRANSLATION,L),u.ROTATION&&T.fromBufferAttribute(u.ROTATION,L),u.SCALE&&M.fromBufferAttribute(u.SCALE,L),R.setMatrixAt(L,A.compose(E,T,M));for(const L in u)if(L==="_COLOR_0"){const w=u[L];R.instanceColor=new Dd(w.array,w.itemSize,w.normalized)}else L!=="TRANSLATION"&&L!=="ROTATION"&&L!=="SCALE"&&_.geometry.setAttribute(L,u[L]);Bn.prototype.copy.call(R,_),this.parser.assignFinalMaterial(R),y.push(R)}return h.isGroup?(h.clear(),h.add(...y),h):y[0]}))}}const GB="glTF",tv=12,jL={JSON:1313821514,BIN:5130562};class $6{constructor(e){this.name=An.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,tv);if(this.header={magic:sA(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==GB)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-tv,i=new DataView(e,tv);let s=0;for(;s<n;){const a=i.getUint32(s,!0);s+=4;const o=i.getUint32(s,!0);if(s+=4,o===jL.JSON){const u=new Uint8Array(e,tv+s,a);this.content=sA(u)}else if(o===jL.BIN){const u=tv+s;this.body=e.slice(u,u+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Z6{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=An.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},u={},c={};for(const h in a){const p=_1[h]||h.toLowerCase();o[p]=a[h]}for(const h in e.attributes){const p=_1[h]||h.toLowerCase();if(a[h]!==void 0){const v=n.accessors[e.attributes[h]],y=Im[v.componentType];c[p]=y.name,u[p]=v.normalized===!0}}return t.getDependency("bufferView",s).then(function(h){return new Promise(function(p,v){i.decodeDracoFile(h,function(y){for(const _ in y.attributes){const A=y.attributes[_],E=u[_];E!==void 0&&(A.normalized=E)}p(y)},o,c,Sc,v)})})}}class e9{constructor(){this.name=An.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class t9{constructor(){this.name=An.KHR_MESH_QUANTIZATION}}class HB extends dg{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let a=0;a!==i;a++)t[a]=n[s+a];return t}interpolate_(e,t,n,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,u=o*2,c=o*3,h=i-t,p=(n-t)/h,v=p*p,y=v*p,_=e*c,A=_-c,E=-2*y+3*v,T=y-v,M=1-E,R=T-v+p;for(let L=0;L!==o;L++){const w=a[A+L+o],N=a[A+L+u]*h,O=a[_+L+o],F=a[_+L]*h;s[L]=M*w+R*N+E*O+T*F}return s}}const n9=new Tr;class i9 extends HB{interpolate_(e,t,n,i){const s=super.interpolate_(e,t,n,i);return n9.fromArray(s).normalize().toArray(s),s}}const Ro={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Im={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},JL={9728:Ji,9729:Gn,9984:MA,9985:Dm,9986:cd,9987:Io},QL={33071:Zr,33648:km,10497:mu},db={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_1={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...I6>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},_f={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},s9={CUBICSPLINE:void 0,LINEAR:zm,STEP:Hm},pb={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function r9(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new hg({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:du})),r.DefaultMaterial}function Zh(r,e,t){for(const n in t.extensions)r[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function cc(r,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(r.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function a9(r,e,t){let n=!1,i=!1,s=!1;for(let c=0,h=e.length;c<h;c++){const p=e[c];if(p.POSITION!==void 0&&(n=!0),p.NORMAL!==void 0&&(i=!0),p.COLOR_0!==void 0&&(s=!0),n&&i&&s)break}if(!n&&!i&&!s)return Promise.resolve(r);const a=[],o=[],u=[];for(let c=0,h=e.length;c<h;c++){const p=e[c];if(n){const v=p.POSITION!==void 0?t.getDependency("accessor",p.POSITION):r.attributes.position;a.push(v)}if(i){const v=p.NORMAL!==void 0?t.getDependency("accessor",p.NORMAL):r.attributes.normal;o.push(v)}if(s){const v=p.COLOR_0!==void 0?t.getDependency("accessor",p.COLOR_0):r.attributes.color;u.push(v)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(u)]).then(function(c){const h=c[0],p=c[1],v=c[2];return n&&(r.morphAttributes.position=h),i&&(r.morphAttributes.normal=p),s&&(r.morphAttributes.color=v),r.morphTargetsRelative=!0,r})}function o9(r,e){if(r.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)r.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(r.morphTargetInfluences.length===t.length){r.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)r.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function l9(r){let e;const t=r.extensions&&r.extensions[An.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+mb(t.attributes):e=r.indices+":"+mb(r.attributes)+":"+r.mode,r.targets!==void 0)for(let n=0,i=r.targets.length;n<i;n++)e+=":"+mb(r.targets[n]);return e}function mb(r){let e="";const t=Object.keys(r).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+r[t[n]]+";";return e}function x1(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function u9(r){return r.search(/\.jpe?g($|\?)/i)>0||r.search(/^data\:image\/jpeg/)===0?"image/jpeg":r.search(/\.webp($|\?)/i)>0||r.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const c9=new zt;class f9{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new B6,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||i&&s<98?this.textureLoader=new cy(this.options.manager):this.textureLoader=new rB(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new no(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const o={scene:a[0][i.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:i.asset,parser:n,userData:{}};return Zh(s,o,i),cc(o,i),Promise.all(n._invokeAll(function(u){return u.afterRoot&&u.afterRoot(o)})).then(function(){for(const u of o.scenes)u.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const a=t[i].joints;for(let o=0,u=a.length;o<u;o++)e[a[o]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const a=e[i];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),s=(a,o)=>{const u=this.associations.get(a);u!=null&&this.associations.set(o,u);for(const[c,h]of a.children.entries())s(h,o.children[c])};return s(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(s,a){return n.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[An.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,a){n.load(wf.resolveURL(t.uri,i.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,s=t.byteOffset||0;return n.slice(s,s+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const a=db[i.type],o=Im[i.componentType],u=i.normalized===!0,c=new o(i.count*a);return Promise.resolve(new On(c,a,u))}const s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(a){const o=a[0],u=db[i.type],c=Im[i.componentType],h=c.BYTES_PER_ELEMENT,p=h*u,v=i.byteOffset||0,y=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,_=i.normalized===!0;let A,E;if(y&&y!==p){const T=Math.floor(v/y),M="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+T+":"+i.count;let R=t.cache.get(M);R||(A=new c(o,T*y,i.count*y/h),R=new sy(A,y/h),t.cache.add(M,R)),E=new Ff(R,u,v%y/h,_)}else o===null?A=new c(i.count*u):A=new c(o,v,i.count*u),E=new On(A,u,_);if(i.sparse!==void 0){const T=db.SCALAR,M=Im[i.sparse.indices.componentType],R=i.sparse.indices.byteOffset||0,L=i.sparse.values.byteOffset||0,w=new M(a[1],R,i.sparse.count*T),N=new c(a[2],L,i.sparse.count*u);o!==null&&(E=new On(E.array.slice(),E.itemSize,E.normalized));for(let O=0,F=w.length;O<F;O++){const B=w[O];if(E.setX(B,N[O*u]),u>=2&&E.setY(B,N[O*u+1]),u>=3&&E.setZ(B,N[O*u+2]),u>=4&&E.setW(B,N[O*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return E})}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e].source,a=t.images[s];let o=this.textureLoader;if(a.uri){const u=n.manager.getHandler(a.uri);u!==null&&(o=u)}return this.loadTextureImage(e,s,o)}loadTextureImage(e,t,n){const i=this,s=this.json,a=s.textures[e],o=s.images[t],u=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[u])return this.textureCache[u];const c=this.loadImageSource(t,n).then(function(h){h.flipY=!1,h.name=a.name||o.name||"",h.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(h.name=o.uri);const v=(s.samplers||{})[a.sampler]||{};return h.magFilter=JL[v.magFilter]||Gn,h.minFilter=JL[v.minFilter]||Io,h.wrapS=QL[v.wrapS]||mu,h.wrapT=QL[v.wrapT]||mu,i.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[u]=c,c}loadImageSource(e,t){const n=this,i=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(p=>p.clone());const a=i.images[e],o=self.URL||self.webkitURL;let u=a.uri||"",c=!1;if(a.bufferView!==void 0)u=n.getDependency("bufferView",a.bufferView).then(function(p){c=!0;const v=new Blob([p],{type:a.mimeType});return u=o.createObjectURL(v),u});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(u).then(function(p){return new Promise(function(v,y){let _=v;t.isImageBitmapLoader===!0&&(_=function(A){const E=new yi(A);E.needsUpdate=!0,v(E)}),t.load(wf.resolveURL(p,s.path),_,void 0,y)})}).then(function(p){return c===!0&&o.revokeObjectURL(u),cc(p,a),p.userData.mimeType=a.mimeType||u9(a.uri),p}).catch(function(p){throw console.error("THREE.GLTFLoader: Couldn't load texture",u),p});return this.sourceCache[e]=h,h}assignTexture(e,t,n,i){const s=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(a=a.clone(),a.channel=n.texCoord),s.extensions[An.KHR_TEXTURE_TRANSFORM]){const o=n.extensions!==void 0?n.extensions[An.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const u=s.associations.get(a);a=s.extensions[An.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),s.associations.set(a,u)}}return i!==void 0&&(typeof i=="number"&&(i=i===WL?md:Sc),"colorSpace"in a?a.colorSpace=i:a.encoding=i===md?WL:w6),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+n.uuid;let u=this.cache.get(o);u||(u=new zA,Rs.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,u.sizeAttenuation=!1,this.cache.add(o,u)),n=u}else if(e.isLine){const o="LineBasicMaterial:"+n.uuid;let u=this.cache.get(o);u||(u=new Mr,Rs.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,this.cache.add(o,u)),n=u}if(i||s||a){let o="ClonedMaterial:"+n.uuid+":";i&&(o+="derivative-tangents:"),s&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let u=this.cache.get(o);u||(u=n.clone(),s&&(u.vertexColors=!0),a&&(u.flatShading=!0),i&&(u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(o,u),this.associations.set(u,this.associations.get(n))),n=u}e.material=n}getMaterialType(){return hg}loadMaterial(e){const t=this,n=this.json,i=this.extensions,s=n.materials[e];let a;const o={},u=s.extensions||{},c=[];if(u[An.KHR_MATERIALS_UNLIT]){const p=i[An.KHR_MATERIALS_UNLIT];a=p.getMaterialType(),c.push(p.extendParams(o,s,t))}else{const p=s.pbrMetallicRoughness||{};if(o.color=new dt(1,1,1),o.opacity=1,Array.isArray(p.baseColorFactor)){const v=p.baseColorFactor;o.color.setRGB(v[0],v[1],v[2],Sc),o.opacity=v[3]}p.baseColorTexture!==void 0&&c.push(t.assignTexture(o,"map",p.baseColorTexture,md)),o.metalness=p.metallicFactor!==void 0?p.metallicFactor:1,o.roughness=p.roughnessFactor!==void 0?p.roughnessFactor:1,p.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(o,"metalnessMap",p.metallicRoughnessTexture)),c.push(t.assignTexture(o,"roughnessMap",p.metallicRoughnessTexture))),a=this._invokeOne(function(v){return v.getMaterialType&&v.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(v){return v.extendMaterialParams&&v.extendMaterialParams(e,o)})))}s.doubleSided===!0&&(o.side=Lo);const h=s.alphaMode||pb.OPAQUE;if(h===pb.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===pb.MASK&&(o.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==Xa&&(c.push(t.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new Ve(1,1),s.normalTexture.scale!==void 0)){const p=s.normalTexture.scale;o.normalScale.set(p,p)}if(s.occlusionTexture!==void 0&&a!==Xa&&(c.push(t.assignTexture(o,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==Xa){const p=s.emissiveFactor;o.emissive=new dt().setRGB(p[0],p[1],p[2],Sc)}return s.emissiveTexture!==void 0&&a!==Xa&&c.push(t.assignTexture(o,"emissiveMap",s.emissiveTexture,md)),Promise.all(c).then(function(){const p=new a(o);return s.name&&(p.name=s.name),cc(p,s),t.associations.set(p,{materials:e}),s.extensions&&Zh(i,p,s),p})}createUniqueName(e){const t=Nn.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function s(o){return n[An.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(u){return $L(u,o,t)})}const a=[];for(let o=0,u=e.length;o<u;o++){const c=e[o],h=l9(c),p=i[h];if(p)a.push(p.promise);else{let v;c.extensions&&c.extensions[An.KHR_DRACO_MESH_COMPRESSION]?v=s(c):v=$L(new en,c,t),i[h]={primitive:c,promise:v},a.push(v)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,i=this.extensions,s=n.meshes[e],a=s.primitives,o=[];for(let u=0,c=a.length;u<c;u++){const h=a[u].material===void 0?r9(this.cache):this.getDependency("material",a[u].material);o.push(h)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(u){const c=u.slice(0,u.length-1),h=u[u.length-1],p=[];for(let y=0,_=h.length;y<_;y++){const A=h[y],E=a[y];let T;const M=c[y];if(E.mode===Ro.TRIANGLES||E.mode===Ro.TRIANGLE_STRIP||E.mode===Ro.TRIANGLE_FAN||E.mode===void 0)T=s.isSkinnedMesh===!0?new AM(A,M):new $i(A,M),T.isSkinnedMesh===!0&&T.normalizeSkinWeights(),E.mode===Ro.TRIANGLE_STRIP?T.geometry=qL(T.geometry,mM):E.mode===Ro.TRIANGLE_FAN&&(T.geometry=qL(T.geometry,XS));else if(E.mode===Ro.LINES)T=new xl(A,M);else if(E.mode===Ro.LINE_STRIP)T=new Ec(A,M);else if(E.mode===Ro.LINE_LOOP)T=new TM(A,M);else if(E.mode===Ro.POINTS)T=new bM(A,M);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+E.mode);Object.keys(T.geometry.morphAttributes).length>0&&o9(T,s),T.name=t.createUniqueName(s.name||"mesh_"+e),cc(T,s),E.extensions&&Zh(i,T,E),t.assignFinalMaterial(T),p.push(T)}for(let y=0,_=p.length;y<_;y++)t.associations.set(p[y],{meshes:e,primitives:y});if(p.length===1)return s.extensions&&Zh(i,p[0],s),p[0];const v=new _c;s.extensions&&Zh(i,v,s),t.associations.set(v,{meshes:e});for(let y=0,_=p.length;y<_;y++)v.add(p[y]);return v})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new gs(qS.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new kd(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),cc(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,s=t.joints.length;i<s;i++)n.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(i){const s=i.pop(),a=i,o=[],u=[];for(let c=0,h=a.length;c<h;c++){const p=a[c];if(p){o.push(p);const v=new zt;s!==null&&v.fromArray(s.array,c*16),u.push(v)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new ry(o,u)})}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],s=i.name?i.name:"animation_"+e,a=[],o=[],u=[],c=[],h=[];for(let p=0,v=i.channels.length;p<v;p++){const y=i.channels[p],_=i.samplers[y.sampler],A=y.target,E=A.node,T=i.parameters!==void 0?i.parameters[_.input]:_.input,M=i.parameters!==void 0?i.parameters[_.output]:_.output;A.node!==void 0&&(a.push(this.getDependency("node",E)),o.push(this.getDependency("accessor",T)),u.push(this.getDependency("accessor",M)),c.push(_),h.push(A))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(u),Promise.all(c),Promise.all(h)]).then(function(p){const v=p[0],y=p[1],_=p[2],A=p[3],E=p[4],T=[];for(let M=0,R=v.length;M<R;M++){const L=v[M],w=y[M],N=_[M],O=A[M],F=E[M];if(L===void 0)continue;L.updateMatrix&&L.updateMatrix();const B=n._createAnimationTracks(L,w,N,O,F);if(B)for(let P=0;P<B.length;P++)T.push(B[P])}return new jm(s,void 0,T)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(s){const a=n._getNodeRef(n.meshCache,i.mesh,s);return i.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let u=0,c=i.weights.length;u<c;u++)o.morphTargetInfluences[u]=i.weights[u]}),a})}loadNode(e){const t=this.json,n=this,i=t.nodes[e],s=n._loadNodeShallow(e),a=[],o=i.children||[];for(let c=0,h=o.length;c<h;c++)a.push(n.getDependency("node",o[c]));const u=i.skin===void 0?Promise.resolve(null):n.getDependency("skin",i.skin);return Promise.all([s,Promise.all(a),u]).then(function(c){const h=c[0],p=c[1],v=c[2];v!==null&&h.traverse(function(y){y.isSkinnedMesh&&y.bind(v,c9)});for(let y=0,_=p.length;y<_;y++)h.add(p[y]);return h})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],a=s.name?i.createUniqueName(s.name):"",o=[],u=i._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return u&&o.push(u),s.camera!==void 0&&o.push(i.getDependency("camera",s.camera).then(function(c){return i._getNodeRef(i.cameraCache,s.camera,c)})),i._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){o.push(c)}),this.nodeCache[e]=Promise.all(o).then(function(c){let h;if(s.isBone===!0?h=new GA:c.length>1?h=new _c:c.length===1?h=c[0]:h=new Bn,h!==c[0])for(let p=0,v=c.length;p<v;p++)h.add(c[p]);if(s.name&&(h.userData.name=s.name,h.name=a),cc(h,s),s.extensions&&Zh(n,h,s),s.matrix!==void 0){const p=new zt;p.fromArray(s.matrix),h.applyMatrix4(p)}else s.translation!==void 0&&h.position.fromArray(s.translation),s.rotation!==void 0&&h.quaternion.fromArray(s.rotation),s.scale!==void 0&&h.scale.fromArray(s.scale);return i.associations.has(h)||i.associations.set(h,{}),i.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,s=new _c;n.name&&(s.name=i.createUniqueName(n.name)),cc(s,n),n.extensions&&Zh(t,s,n);const a=n.nodes||[],o=[];for(let u=0,c=a.length;u<c;u++)o.push(i.getDependency("node",a[u]));return Promise.all(o).then(function(u){for(let h=0,p=u.length;h<p;h++)s.add(u[h]);const c=h=>{const p=new Map;for(const[v,y]of i.associations)(v instanceof Rs||v instanceof yi)&&p.set(v,y);return h.traverse(v=>{const y=i.associations.get(v);y!=null&&p.set(v,y)}),p};return i.associations=c(s),s})}_createAnimationTracks(e,t,n,i,s){const a=[],o=e.name?e.name:e.uuid,u=[];_f[s.path]===_f.weights?e.traverse(function(v){v.morphTargetInfluences&&u.push(v.name?v.name:v.uuid)}):u.push(o);let c;switch(_f[s.path]){case _f.weights:c=Id;break;case _f.rotation:c=wd;break;case _f.position:case _f.scale:c=Bd;break;default:switch(n.itemSize){case 1:c=Id;break;case 2:case 3:default:c=Bd;break}break}const h=i.interpolation!==void 0?s9[i.interpolation]:zm,p=this._getArrayFromAccessor(n);for(let v=0,y=u.length;v<y;v++){const _=new c(u[v]+"."+_f[s.path],t.array,p,h);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(_),a.push(_)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=x1(t.constructor),i=new Float32Array(t.length);for(let s=0,a=t.length;s<a;s++)i[s]=t[s]*n;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const i=this instanceof wd?i9:HB;return new i(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function h9(r,e,t){const n=e.attributes,i=new nr;if(n.POSITION!==void 0){const o=t.json.accessors[n.POSITION],u=o.min,c=o.max;if(u!==void 0&&c!==void 0){if(i.set(new ee(u[0],u[1],u[2]),new ee(c[0],c[1],c[2])),o.normalized){const h=x1(Im[o.componentType]);i.min.multiplyScalar(h),i.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const o=new ee,u=new ee;for(let c=0,h=s.length;c<h;c++){const p=s[c];if(p.POSITION!==void 0){const v=t.json.accessors[p.POSITION],y=v.min,_=v.max;if(y!==void 0&&_!==void 0){if(u.setX(Math.max(Math.abs(y[0]),Math.abs(_[0]))),u.setY(Math.max(Math.abs(y[1]),Math.abs(_[1]))),u.setZ(Math.max(Math.abs(y[2]),Math.abs(_[2]))),v.normalized){const A=x1(Im[v.componentType]);u.multiplyScalar(A)}o.max(u)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(o)}r.boundingBox=i;const a=new Vs;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,r.boundingSphere=a}function $L(r,e,t){const n=e.attributes,i=[];function s(a,o){return t.getDependency("accessor",a).then(function(u){r.setAttribute(o,u)})}for(const a in n){const o=_1[a]||a.toLowerCase();o in r.attributes||i.push(s(n[a],o))}if(e.indices!==void 0&&!r.index){const a=t.getDependency("accessor",e.indices).then(function(o){r.setIndex(o)});i.push(a)}return cc(r,e),h9(r,e,t),Promise.all(i).then(function(){return e.targets!==void 0?a9(r,e.targets,t):r})}const gb=new WeakMap;class d9 extends Cr{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const s=new no(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,a=>{const o={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,o).then(t).catch(i)},n,i)}decodeDracoFile(e,t,n,i){const s={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const u in t.attributeTypes){const c=t.attributeTypes[u];c.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[u]=c.name)}const n=JSON.stringify(t);if(gb.has(e)){const u=gb.get(e);if(u.key===n)return u.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,a=e.byteLength,o=this._getWorker(s,a).then(u=>(i=u,new Promise((c,h)=>{i._callbacks[s]={resolve:c,reject:h},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(u=>this._createGeometry(u.geometry));return o.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),gb.set(e,{key:n,promise:o}),o}_createGeometry(e){const t=new en;e.index&&t.setIndex(new On(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],s=i.name,a=i.array,o=i.itemSize;t.setAttribute(s,new On(a,o))}return t}_loadLibrary(e,t){const n=new no(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((i,s)=>{n.load(e,i,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const i=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const s=p9.toString(),a=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(s){const a=s.data;switch(a.type){case"decode":i._callbacks[a.id].resolve(a);break;case"error":i._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,s){return i._taskLoad>s._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function p9(){let r,e;onmessage=function(a){const o=a.data;switch(o.type){case"init":r=o.decoderConfig,e=new Promise(function(h){r.onModuleLoaded=function(p){h({draco:p})},DracoDecoderModule(r)});break;case"decode":const u=o.buffer,c=o.taskConfig;e.then(h=>{const p=h.draco,v=new p.Decoder,y=new p.DecoderBuffer;y.Init(new Int8Array(u),u.byteLength);try{const _=t(p,v,y,c),A=_.attributes.map(E=>E.array.buffer);_.index&&A.push(_.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:_},A)}catch(_){console.error(_),self.postMessage({type:"error",id:o.id,error:_.message})}finally{p.destroy(y),p.destroy(v)}});break}};function t(a,o,u,c){const h=c.attributeIDs,p=c.attributeTypes;let v,y;const _=o.GetEncodedGeometryType(u);if(_===a.TRIANGULAR_MESH)v=new a.Mesh,y=o.DecodeBufferToMesh(u,v);else if(_===a.POINT_CLOUD)v=new a.PointCloud,y=o.DecodeBufferToPointCloud(u,v);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!y.ok()||v.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+y.error_msg());const A={index:null,attributes:[]};for(const E in h){const T=self[p[E]];let M,R;if(c.useUniqueIDs)R=h[E],M=o.GetAttributeByUniqueId(v,R);else{if(R=o.GetAttributeId(v,a[h[E]]),R===-1)continue;M=o.GetAttribute(v,R)}A.attributes.push(i(a,o,v,E,T,M))}return _===a.TRIANGULAR_MESH&&(A.index=n(a,o,v)),a.destroy(v),A}function n(a,o,u){const h=u.num_faces()*3,p=h*4,v=a._malloc(p);o.GetTrianglesUInt32Array(u,p,v);const y=new Uint32Array(a.HEAPF32.buffer,v,h).slice();return a._free(v),{array:y,itemSize:1}}function i(a,o,u,c,h,p){const v=p.num_components(),_=u.num_points()*v,A=_*h.BYTES_PER_ELEMENT,E=s(a,h),T=a._malloc(A);o.GetAttributeDataArrayForAllPoints(u,p,E,A,T);const M=new h(a.HEAPF32.buffer,T,_).slice();return a._free(T),{name:c,array:M,itemSize:v}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let bx;const vb=()=>{if(bx)return bx;const r="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let i=r;WebAssembly.validate(t)&&(i=e);let s;const a=WebAssembly.instantiate(o(i),{}).then(p=>{s=p.instance,s.exports.__wasm_call_ctors()});function o(p){const v=new Uint8Array(p.length);for(let _=0;_<p.length;++_){const A=p.charCodeAt(_);v[_]=A>96?A-71:A>64?A-65:A>47?A+4:A>46?63:62}let y=0;for(let _=0;_<p.length;++_)v[y++]=v[_]<60?n[v[_]]:(v[_]-60)*64+v[++_];return v.buffer.slice(0,y)}function u(p,v,y,_,A,E){const T=s.exports.sbrk,M=y+3&-4,R=T(M*_),L=T(A.length),w=new Uint8Array(s.exports.memory.buffer);w.set(A,L);const N=p(R,y,_,L,A.length);if(N===0&&E&&E(R,M,_),v.set(w.subarray(R,R+y*_)),T(R-T(0)),N!==0)throw new Error(`Malformed buffer data: ${N}`)}const c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return bx={ready:a,supported:!0,decodeVertexBuffer(p,v,y,_,A){u(s.exports.meshopt_decodeVertexBuffer,p,v,y,_,s.exports[c[A]])},decodeIndexBuffer(p,v,y,_){u(s.exports.meshopt_decodeIndexBuffer,p,v,y,_)},decodeIndexSequence(p,v,y,_){u(s.exports.meshopt_decodeIndexSequence,p,v,y,_)},decodeGltfBuffer(p,v,y,_,A,E){u(s.exports[h[A]],p,v,y,_,s.exports[c[E]])}},bx},yb=r=>r===Object(r)&&!Array.isArray(r)&&typeof r!="function";function oE(r,e){const t=Ja(s=>s.gl),n=qf(cy,yb(r)?Object.values(r):r);return Ue.useLayoutEffect(()=>{e?.(n)},[e]),Ue.useEffect(()=>{if("initTexture"in t){let s=[];Array.isArray(n)?s=n:n instanceof yi?s=[n]:yb(n)&&(s=Object.values(n)),s.forEach(a=>{a instanceof yi&&t.initTexture(a)})}},[t,n]),Ue.useMemo(()=>{if(yb(r)){const s={};let a=0;for(const o in r)s[o]=n[a++];return s}else return n},[r,n])}oE.preload=r=>qf.preload(cy,r);oE.clear=r=>qf.clear(cy,r);const m9=()=>parseInt(og.replace(/\D+/g,"")),g9=m9();let Mx=null,zB="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function VB(r=!0,e=!0,t){return n=>{t&&t(n),r&&(Mx||(Mx=new d9),Mx.setDecoderPath(typeof r=="string"?r:zB),n.setDRACOLoader(Mx)),e&&n.setMeshoptDecoder(typeof vb=="function"?vb():vb)}}const wm=(r,e,t,n)=>qf(sC,r,VB(e,t,n));wm.preload=(r,e,t,n)=>qf.preload(sC,r,VB(e,t,n));wm.clear=r=>qf.clear(sC,r);wm.setDecoderPath=r=>{zB=r};function v9(r,e,t){const n=Ja(y=>y.size),i=Ja(y=>y.viewport),s=typeof r=="number"?r:n.width*i.dpr,a=n.height*i.dpr,o=(typeof r=="number"?t:r)||{},{samples:u=0,depth:c,...h}=o,p=c??o.depthBuffer,v=Ue.useMemo(()=>{const y=new tr(s,a,{minFilter:Gn,magFilter:Gn,type:Za,...h});return p&&(y.depthTexture=new kf(s,a,Ar)),y.samples=u,y},[]);return Ue.useLayoutEffect(()=>{v.setSize(s,a),u&&(v.samples=u)},[u,v,s,a]),Ue.useEffect(()=>()=>v.dispose(),[]),v}const y9=r=>typeof r=="function",KB=Ue.forwardRef(({envMap:r,resolution:e=256,frames:t=1/0,children:n,makeDefault:i,...s},a)=>{const o=Ja(({set:E})=>E),u=Ja(({camera:E})=>E),c=Ja(({size:E})=>E),h=Ue.useRef(null);Ue.useImperativeHandle(a,()=>h.current,[]);const p=Ue.useRef(null),v=v9(e);Ue.useLayoutEffect(()=>{s.manual||h.current.updateProjectionMatrix()},[c,s]),Ue.useLayoutEffect(()=>{h.current.updateProjectionMatrix()}),Ue.useLayoutEffect(()=>{if(i){const E=u;return o(()=>({camera:h.current})),()=>o(()=>({camera:E}))}},[h,i,o]);let y=0,_=null;const A=y9(n);return hy(E=>{A&&(t===1/0||y<t)&&(p.current.visible=!1,E.gl.setRenderTarget(v),_=E.scene.background,r&&(E.scene.background=r),E.gl.render(E.scene,h.current),E.scene.background=_,E.gl.setRenderTarget(null),p.current.visible=!0,y++)}),Ue.createElement(Ue.Fragment,null,Ue.createElement("orthographicCamera",iA({left:c.width/-2,right:c.width/2,top:c.height/2,bottom:c.height/-2,ref:h},s),!A&&n),Ue.createElement("group",{ref:p},A&&n(v.texture)))});function _9({defaultScene:r,defaultCamera:e,renderPriority:t=1}){const{gl:n,scene:i,camera:s}=Ja();let a;return hy(()=>{a=n.autoClear,t===1&&(n.autoClear=!0,n.render(r,e)),n.autoClear=!1,n.clearDepth(),n.render(i,s),n.autoClear=a},t),Ue.createElement("group",{onPointerOver:()=>null})}function YB({children:r,renderPriority:e=1}){const{scene:t,camera:n}=Ja(),[i]=Ue.useState(()=>new iy);return Ue.createElement(Ue.Fragment,null,y6(Ue.createElement(Ue.Fragment,null,r,Ue.createElement(_9,{defaultScene:t,defaultCamera:n,renderPriority:e})),i,{events:{priority:e+1}}))}const x9="modulepreload",S9=function(r){return"/"+r},ZL={},A9=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){let c=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};var a=c;document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),u=o?.nonce||o?.getAttribute("nonce");i=c(t.map(h=>{if(h=S9(h),h in ZL)return;ZL[h]=!0;const p=h.endsWith(".css"),v=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${v}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":x9,p||(y.as="script"),y.crossOrigin="",y.href=h,u&&y.setAttribute("nonce",u),document.head.appendChild(y),p)return new Promise((_,A)=>{y.addEventListener("load",_),y.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${h}`)))})}))}function s(o){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=o,window.dispatchEvent(u),!u.defaultPrevented)throw o}return i.then(o=>{for(const u of o||[])u.status==="rejected"&&s(u.reason);return e().catch(s)})},yt=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},E9=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=T9},T9=Number.MAX_SAFE_INTEGER||9007199254740991;let Lt=(function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r})({}),Se=(function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r})({}),H=(function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r})({});var _n={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Tt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class vm{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class b9{constructor(e,t,n,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new vm(e),this.fast_=new vm(t),this.defaultTTFB_=i,this.ttfb_=new vm(e)}update(e,t){const{slow_:n,fast_:i,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new vm(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new vm(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new vm(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,i=e/1e3,s=n/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function M9(r,e,t){return(e=R9(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function li(){return li=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},li.apply(null,arguments)}function eI(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function ti(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?eI(Object(t),!0).forEach(function(n){M9(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):eI(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function C9(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function R9(r){var e=C9(r,"string");return typeof e=="symbol"?e:e+""}class ko{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=Af,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const Af=function(){},D9={trace:Af,debug:Af,log:Af,warn:Af,info:Af,error:Af};function S1(){return li({},D9)}function L9(r,e){const t=self.console[r];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${r}] >`):Af}function tI(r,e,t){return e[r]?e[r].bind(e):L9(r,t)}const A1=S1();function I9(r,e,t){const n=S1();if(typeof console=="object"&&r===!0||typeof r=="object"){const i=["debug","log","info","warn","error"];i.forEach(s=>{n[s]=tI(s,r,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return S1()}i.forEach(s=>{A1[s]=tI(s,r)})}else li(A1,n);return n}const ii=A1;function Tc(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function w9(r){return typeof self<"u"&&r===self.ManagedMediaSource}function XB(r,e){const t=Object.keys(r),n=Object.keys(e),i=t.length,s=n.length;return!i||!s||i===s&&!t.some(a=>n.indexOf(a)===-1)}function Qa(r,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(r);if(e){const h=c.indexOf("\0");return h!==-1?c.substring(0,h):c}return c.replace(/\0/g,"")}const t=r.length;let n,i,s,a="",o=0;for(;o<t;){if(n=r[o++],n===0&&e)return a;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(n);break;case 12:case 13:i=r[o++],a+=String.fromCharCode((n&31)<<6|i&63);break;case 14:i=r[o++],s=r[o++],a+=String.fromCharCode((n&15)<<12|(i&63)<<6|(s&63)<<0);break}}return a}function er(r){let e="";for(let t=0;t<r.length;t++){let n=r[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function qB(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function B9(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var _b={exports:{}},nI;function O9(){return nI||(nI=1,(function(r,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(u,c,h){if(h=h||{},u=u.trim(),c=c.trim(),!c){if(!h.alwaysNormalize)return u;var p=o.parseURL(u);if(!p)throw new Error("Error trying to parse base URL.");return p.path=o.normalizePath(p.path),o.buildURLFromParts(p)}var v=o.parseURL(c);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return h.alwaysNormalize?(v.path=o.normalizePath(v.path),o.buildURLFromParts(v)):c;var y=o.parseURL(u);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var _=i.exec(y.path);y.netLoc=_[1],y.path=_[2]}y.netLoc&&!y.path&&(y.path="/");var A={scheme:y.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(A.netLoc=y.netLoc,v.path[0]!=="/"))if(!v.path)A.path=y.path,v.params||(A.params=y.params,v.query||(A.query=y.query));else{var E=y.path,T=E.substring(0,E.lastIndexOf("/")+1)+v.path;A.path=o.normalizePath(T)}return A.path===null&&(A.path=h.alwaysNormalize?o.normalizePath(v.path):v.path),o.buildURLFromParts(A)},parseURL:function(u){var c=n.exec(u);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(u){for(u=u.split("").reverse().join("").replace(s,"");u.length!==(u=u.replace(a,"")).length;);return u.split("").reverse().join("")},buildURLFromParts:function(u){return u.scheme+u.netLoc+u.path+u.params+u.query+u.fragment}};r.exports=o})()})(_b)),_b.exports}var rC=O9();class lE{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var gi={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class aC{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,P9(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let i;n.length===1?i=t?.byteRangeEndOffset||0:i=parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[gi.AUDIO]:null,[gi.VIDEO]:null,[gi.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new lE),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=rC.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[gi.AUDIO]=null,e[gi.VIDEO]=null,e[gi.AUDIOVIDEO]=null}}function rs(r){return r.sn!=="initSegment"}class Wx extends aC{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(yt(e)&&yt(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const i=this._decryptdata=t[n[0]]||null;i&&(this._decryptdata=i.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=yt(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),i=n.length;if(i>1||i===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!yt(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return rs(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const i=t[e];i&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=i.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,i,s,a=!1){const{elementaryStreams:o}=this,u=o[e];if(!u){o[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:s,partial:a};return}u.startPTS=Math.min(u.startPTS,t),u.endPTS=Math.max(u.endPTS,n),u.startDTS=Math.min(u.startDTS,i),u.endDTS=Math.max(u.endDTS,s)}}class WB extends aC{constructor(e,t,n,i,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function jB(r,e){const t=Object.getPrototypeOf(r);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||jB(t,e)}}function P9(r,e){const t=jB(r,e);t&&(t.enumerable=!0,Object.defineProperty(r,e,t))}const iI=Math.pow(2,32)-1,N9=[].push,JB={video:1,audio:2,id3:3,text:4};function bs(r){return String.fromCharCode.apply(null,r)}function QB(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function Zt(r,e){const t=$B(r,e);return t<0?4294967296+t:t}function sI(r,e){let t=Zt(r,e);return t*=Math.pow(2,32),t+=Zt(r,e+4),t}function $B(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function U9(r){const e=r.byteLength;for(let t=0;t<e;){const n=Zt(r,t);if(n>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=n>1?t+n:e}return!1}function mn(r,e){const t=[];if(!e.length)return t;const n=r.byteLength;for(let i=0;i<n;){const s=Zt(r,i),a=bs(r.subarray(i+4,i+8)),o=s>1?i+s:n;if(a===e[0])if(e.length===1)t.push(r.subarray(i+8,o));else{const u=mn(r.subarray(i+8,o),e.slice(1));u.length&&N9.apply(t,u)}i=o}return t}function F9(r){const e=[],t=r[0];let n=8;const i=Zt(r,n);n+=4;let s=0,a=0;t===0?(s=Zt(r,n),a=Zt(r,n+4),n+=8):(s=sI(r,n),a=sI(r,n+8),n+=16),n+=2;let o=r.length+a;const u=QB(r,n);n+=2;for(let c=0;c<u;c++){let h=n;const p=Zt(r,h);h+=4;const v=p&2147483647;if((p&2147483648)>>>31===1)return ii.warn("SIDX has hierarchical references (not supported)"),null;const _=Zt(r,h);h+=4,e.push({referenceSize:v,subsegmentDuration:_,info:{duration:_/i,start:o,end:o+v-1}}),o+=v,h+=4,n=h}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:u,references:e}}function ZB(r){const e=[],t=mn(r,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],a=mn(s,["tkhd"])[0];if(a){let o=a[0];const u=Zt(a,o===0?12:20),c=mn(s,["mdia","mdhd"])[0];if(c){o=c[0];const h=Zt(c,o===0?12:20),p=mn(s,["mdia","hdlr"])[0];if(p){const v=bs(p.subarray(8,12)),y={soun:gi.AUDIO,vide:gi.VIDEO}[v],_=mn(s,["mdia","minf","stbl","stsd"])[0],A=k9(_);y?(e[u]={timescale:h,type:y,stsd:A},e[y]=ti({timescale:h,id:u},A)):e[u]={timescale:h,type:v,stsd:A}}}}}return mn(r,["moov","mvex","trex"]).forEach(i=>{const s=Zt(i,4),a=e[s];a&&(a.default={duration:Zt(i,12),flags:Zt(i,20)})}),e}function k9(r){const e=r.subarray(8),t=e.subarray(86),n=bs(e.subarray(4,8));let i=n,s;const a=n==="enca"||n==="encv";if(a){const c=mn(e,[n])[0].subarray(n==="enca"?28:78);mn(c,["sinf"]).forEach(p=>{const v=mn(p,["schm"])[0];if(v){const y=bs(v.subarray(4,8));if(y==="cbcs"||y==="cenc"){const _=mn(p,["frma"])[0];_&&(i=bs(_))}}})}const o=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const u=mn(t,["avcC"])[0];u&&u.length>3&&(i+="."+Rx(u[1])+Rx(u[2])+Rx(u[3]),s=Cx(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const u=mn(e,[n])[0],c=mn(u.subarray(28),["esds"])[0];if(c&&c.length>7){let h=4;if(c[h++]!==3)break;h=xb(c,h),h+=2;const p=c[h++];if(p&128&&(h+=2),p&64&&(h+=c[h++]),c[h++]!==4)break;h=xb(c,h);const v=c[h++];if(v===64)i+="."+Rx(v);else break;if(h+=12,c[h++]!==5)break;h=xb(c,h);const y=c[h++];let _=(y&248)>>3;_===31&&(_+=1+((y&7)<<3)+((c[h]&224)>>5)),i+="."+_}break}case"hvc1":case"hev1":{const u=mn(t,["hvcC"])[0];if(u&&u.length>12){const c=u[1],h=["","A","B","C"][c>>6],p=c&31,v=Zt(u,2),y=(c&32)>>5?"H":"L",_=u[12],A=u.subarray(6,12);i+="."+h+p,i+="."+G9(v).toString(16).toUpperCase(),i+="."+y+_;let E="";for(let T=A.length;T--;){const M=A[T];(M||E)&&(E="."+M.toString(16).toUpperCase()+E)}i+=E}s=Cx(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=Cx(i,t)||i;break}case"vp09":{const u=mn(t,["vpcC"])[0];if(u&&u.length>6){const c=u[4],h=u[5],p=u[6]>>4&15;i+="."+au(c)+"."+au(h)+"."+au(p)}break}case"av01":{const u=mn(t,["av1C"])[0];if(u&&u.length>2){const c=u[1]>>>5,h=u[1]&31,p=u[2]>>>7?"H":"M",v=(u[2]&64)>>6,y=(u[2]&32)>>5,_=c===2&&v?y?12:10:v?10:8,A=(u[2]&16)>>4,E=(u[2]&8)>>3,T=(u[2]&4)>>2,M=u[2]&3;i+="."+c+"."+au(h)+p+"."+au(_)+"."+A+"."+E+T+M+"."+au(1)+"."+au(1)+"."+au(1)+"."+0,s=Cx("dav1",t)}break}}return{codec:i,encrypted:a,supplemental:s}}function Cx(r,e){const t=mn(e,["dvvC"]),n=t.length?t[0]:mn(e,["dvcC"])[0];if(n){const i=n[2]>>1&127,s=n[2]<<5&32|n[3]>>3&31;return r+"."+au(i)+"."+au(s)}}function G9(r){let e=0;for(let t=0;t<32;t++)e|=(r>>t&1)<<31-t;return e>>>0}function xb(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function Rx(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function au(r){return(r<10?"0":"")+r}function H9(r,e){if(!r||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&eO(r,(n,i)=>{const s=n.subarray(8,24);s.some(a=>a!==0)||(ii.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${er(s)} -> ${er(t)}`),n.set(t,8))})}function z9(r){const e=[];return eO(r,t=>e.push(t.subarray(8,24))),e}function eO(r,e){mn(r,["moov","trak"]).forEach(n=>{const i=mn(n,["mdia","minf","stbl","stsd"])[0];if(!i)return;const s=i.subarray(8);let a=mn(s,["enca"]);const o=a.length>0;o||(a=mn(s,["encv"])),a.forEach(u=>{const c=o?u.subarray(28):u.subarray(78);mn(c,["sinf"]).forEach(p=>{const v=tO(p);v&&e(v,o)})})})}function tO(r){const e=mn(r,["schm"])[0];if(e){const t=bs(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=mn(r,["schi","tenc"])[0];if(n)return n}}}function V9(r,e,t){const n={},i=mn(r,["moof","traf"]);for(let s=0;s<i.length;s++){const a=i[s],o=mn(a,["tfhd"])[0],u=Zt(o,4),c=e[u];if(!c)continue;n[u]||(n[u]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const h=n[u],p=mn(a,["tfdt"])[0];if(p){const R=p[0];let L=Zt(p,4);R===1&&(L===iI?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(L*=iI+1,L+=Zt(p,8))),yt(L)&&(!yt(h.start)||L<h.start)&&(h.start=L)}const v=c.default,y=Zt(o,0)|v?.flags;let _=v?.duration||0;y&8&&(y&2?_=Zt(o,12):_=Zt(o,8));const A=mn(a,["trun"]);let E=h.start||0,T=0,M=_;for(let R=0;R<A.length;R++){const L=A[R],w=Zt(L,4),N=h.sampleCount;h.sampleCount+=w;const O=L[3]&1,F=L[3]&4,B=L[2]&1,P=L[2]&2,V=L[2]&4,J=L[2]&8;let Q=8,ie=w;for(O&&(Q+=4),F&&w&&(!(L[Q+1]&1)&&h.keyFrameIndex===void 0&&(h.keyFrameIndex=N),Q+=4,B?(M=Zt(L,Q),Q+=4):M=_,P&&(Q+=4),J&&(Q+=4),E+=M,T+=M,ie--);ie--;)B?(M=Zt(L,Q),Q+=4):M=_,P&&(Q+=4),V&&(L[Q+1]&1||h.keyFrameIndex===void 0&&(h.keyFrameIndex=h.sampleCount-(ie+1),h.keyFrameStart=E),Q+=4),J&&(Q+=4),E+=M,T+=M;!T&&_&&(T+=_*w)}h.duration+=T}if(!Object.keys(n).some(s=>n[s].duration)){let s=1/0,a=0;const o=mn(r,["sidx"]);for(let u=0;u<o.length;u++){const c=F9(o[u]);if(c!=null&&c.references){s=Math.min(s,c.earliestPresentationTime/c.timescale);const h=c.references.reduce((p,v)=>p+v.info.duration||0,0);a=Math.max(a,h+c.earliestPresentationTime/c.timescale)}}a&&yt(a)&&Object.keys(n).forEach(u=>{n[u].duration||(n[u].duration=a*n[u].timescale-n[u].start)})}return n}function K9(r){const e={valid:null,remainder:null},t=mn(r,["moof"]);if(t.length<2)return e.remainder=r,e;const n=t[t.length-1];return e.valid=r.slice(0,n.byteOffset-8),e.remainder=r.slice(n.byteOffset-8),e}function No(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function rI(r,e){const t=[],n=e.samples,i=e.timescale,s=e.id;let a=!1;return mn(n,["moof"]).map(u=>{const c=u.byteOffset-8;mn(u,["traf"]).map(p=>{const v=mn(p,["tfdt"]).map(y=>{const _=y[0];let A=Zt(y,4);return _===1&&(A*=Math.pow(2,32),A+=Zt(y,8)),A/i})[0];return v!==void 0&&(r=v),mn(p,["tfhd"]).map(y=>{const _=Zt(y,4),A=Zt(y,0)&16777215,E=(A&1)!==0,T=(A&2)!==0,M=(A&8)!==0;let R=0;const L=(A&16)!==0;let w=0;const N=(A&32)!==0;let O=8;_===s&&(E&&(O+=8),T&&(O+=4),M&&(R=Zt(y,O),O+=4),L&&(w=Zt(y,O),O+=4),N&&(O+=4),e.type==="video"&&(a=uE(e.codec)),mn(p,["trun"]).map(F=>{const B=F[0],P=Zt(F,0)&16777215,V=(P&1)!==0;let J=0;const Q=(P&4)!==0,ie=(P&256)!==0;let ne=0;const k=(P&512)!==0;let K=0;const j=(P&1024)!==0,se=(P&2048)!==0;let oe=0;const Y=Zt(F,4);let Z=8;V&&(J=Zt(F,Z),Z+=4),Q&&(Z+=4);let le=J+c;for(let pe=0;pe<Y;pe++){if(ie?(ne=Zt(F,Z),Z+=4):ne=R,k?(K=Zt(F,Z),Z+=4):K=w,j&&(Z+=4),se&&(B===0?oe=Zt(F,Z):oe=$B(F,Z),Z+=4),e.type===gi.VIDEO){let Te=0;for(;Te<K;){const ce=Zt(n,le);if(le+=4,Y9(a,n[le])){const Me=n.subarray(le,le+ce);oC(Me,a?2:1,r+oe/i,t)}le+=ce,Te+=ce+4}}r+=ne/i}}))})})}),t}function uE(r){if(!r)return!1;const e=r.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Y9(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function oC(r,e,t,n){const i=nO(r);let s=0;s+=e;let a=0,o=0,u=0;for(;s<i.length;){a=0;do{if(s>=i.length)break;u=i[s++],a+=u}while(u===255);o=0;do{if(s>=i.length)break;u=i[s++],o+=u}while(u===255);const c=i.length-s;let h=s;if(o<c)s+=o;else if(o>c){ii.error(`Malformed SEI payload. ${o} is too small, only ${c} bytes left to parse.`);break}if(a===4){if(i[h++]===181){const v=QB(i,h);if(h+=2,v===49){const y=Zt(i,h);if(h+=4,y===1195456820){const _=i[h++];if(_===3){const A=i[h++],E=31&A,T=64&A,M=T?2+E*3:0,R=new Uint8Array(M);if(T){R[0]=A;for(let L=1;L<M;L++)R[L]=i[h++]}n.push({type:_,payloadType:a,pts:t,bytes:R})}}}}}else if(a===5&&o>16){const p=[];for(let _=0;_<16;_++){const A=i[h++].toString(16);p.push(A.length==1?"0"+A:A),(_===3||_===5||_===7||_===9)&&p.push("-")}const v=o-16,y=new Uint8Array(v);for(let _=0;_<v;_++)y[_]=i[h++];n.push({payloadType:a,pts:t,uuid:p.join(""),userData:Qa(y),userDataBytes:y})}}}function nO(r){const e=r.byteLength,t=[];let n=1;for(;n<e-2;)r[n]===0&&r[n+1]===0&&r[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return r;const i=e-t.length,s=new Uint8Array(i);let a=0;for(n=0;n<i;a++,n++)a===t[0]&&(a++,t.shift()),s[n]=r[a];return s}function X9(r){const e=r[0];let t="",n="",i=0,s=0,a=0,o=0,u=0,c=0;if(e===0){for(;bs(r.subarray(c,c+1))!=="\0";)t+=bs(r.subarray(c,c+1)),c+=1;for(t+=bs(r.subarray(c,c+1)),c+=1;bs(r.subarray(c,c+1))!=="\0";)n+=bs(r.subarray(c,c+1)),c+=1;n+=bs(r.subarray(c,c+1)),c+=1,i=Zt(r,12),s=Zt(r,16),o=Zt(r,20),u=Zt(r,24),c=28}else if(e===1){c+=4,i=Zt(r,c),c+=4;const p=Zt(r,c);c+=4;const v=Zt(r,c);for(c+=4,a=2**32*p+v,E9(a)||(a=Number.MAX_SAFE_INTEGER,ii.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Zt(r,c),c+=4,u=Zt(r,c),c+=4;bs(r.subarray(c,c+1))!=="\0";)t+=bs(r.subarray(c,c+1)),c+=1;for(t+=bs(r.subarray(c,c+1)),c+=1;bs(r.subarray(c,c+1))!=="\0";)n+=bs(r.subarray(c,c+1)),c+=1;n+=bs(r.subarray(c,c+1)),c+=1}const h=r.subarray(c,r.byteLength);return{schemeIdUri:t,value:n,timeScale:i,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:u,payload:h}}function q9(r,...e){const t=e.length;let n=8,i=t;for(;i--;)n+=e[i].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(r,4),i=0,n=8;i<t;i++)s.set(e[i],n),n+=e[i].byteLength;return s}function W9(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let n,i;n=0,i=new Uint8Array;let s;n>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),q9([112,115,115,104],new Uint8Array([n,0,0,0]),r,s,i,a,t)}function j9(r){const e=[];if(r instanceof ArrayBuffer){const t=r.byteLength;let n=0;for(;n+32<t;){const i=new DataView(r,n),s=J9(i);e.push(s),n+=s.size}}return e}function J9(r){const e=r.getUint32(0),t=r.byteOffset,n=r.byteLength;if(n<e)return{offset:t,size:n};if(r.getUint32(4)!==1886614376)return{offset:t,size:e};const s=r.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const a=r.buffer,o=er(new Uint8Array(a,t+12,16));let u=null,c=null,h=0;if(s===0)h=28;else{const v=r.getUint32(28);if(!v||n<32+v*16)return{offset:t,size:e};u=[];for(let y=0;y<v;y++)u.push(new Uint8Array(a,t+32+y*16,16));h=32+v*16}if(!h)return{offset:t,size:e};const p=r.getUint32(h);return e-32<p?{offset:t,size:e}:(c=new Uint8Array(a,t+h+4,p),{version:s,systemId:o,kids:u,data:c,offset:t,size:e})}const iO=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Qm={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function lC(r,e){const t=Qm[e];return!!t&&!!t[r.slice(0,4)]}function Gv(r,e,t=!0){return!r.split(",").some(n=>!uC(n,e,t))}function uC(r,e,t=!0){var n;const i=Tc(t);return(n=i?.isTypeSupported(Hv(r,e)))!=null?n:!1}function Hv(r,e){return`${e}/mp4;codecs=${r}`}function aI(r){if(r){const e=r.substring(0,4);return Qm.video[e]}return 2}function rA(r){const e=iO();return r.split(",").reduce((t,n)=>{const s=e&&uE(n)?9:Qm.video[n];return s?(s*2+t)/(t?3:2):(Qm.audio[n]+t)/(t?2:1)},0)}const Sb={};function Q9(r,e=!0){if(Sb[r])return Sb[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let i=0;i<t.length;i++){var n;if(uC(t[i],"audio",e))return Sb[r]=t[i],t[i];if(t[i]==="mp3"&&(n=Tc(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return r}const $9=/flac|opus|mp4a\.40\.34/i;function aA(r,e=!0){return r.replace($9,t=>Q9(t.toLowerCase(),e))}function Z9(r,e){const t=[];if(r){const n=r.split(",");for(let i=0;i<n.length;i++)lC(n[i],"video")||t.push(n[i])}return e&&t.push(e),t.join(",")}function jx(r,e){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1)&&(oI(r,"audio")||oI(r,"video")))return r;if(e){const t=e.split(",");if(t.length>1){if(r){for(let n=t.length;n--;)if(t[n].substring(0,4)===r.substring(0,4))return t[n]}return t[0]}}return e||r}function oI(r,e){return lC(r,e)&&uC(r,e)}function eV(r){const e=r.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function tV(r){if(r.startsWith("av01.")){const e=r.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return r}function lI(r){const e=Tc(r)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function E1(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const nV={supported:!0,powerEfficient:!0,smooth:!0},iV={supported:!1,smooth:!1,powerEfficient:!1},sO={supported:!0,configurations:[],decodingInfoResults:[nV]};function rO(r,e){return{supported:!1,configurations:e,decodingInfoResults:[iV],error:r}}function sV(r,e,t,n,i,s){const a=r.videoCodec,o=r.audioCodec?r.audioGroups:null,u=s?.audioCodec,c=s?.channels,h=c?parseInt(c):u?1/0:2;let p=null;if(o!=null&&o.length)try{o.length===1&&o[0]?p=e.groups[o[0]].channels:p=o.reduce((v,y)=>{if(y){const _=e.groups[y];if(!_)throw new Error(`Audio track group ${y} not found`);Object.keys(_.channels).forEach(A=>{v[A]=(v[A]||0)+_.channels[A]})}return v},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(v=>uE(v))||r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(n,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(i,8e6))||!!p&&yt(h)&&Object.keys(p).some(v=>parseInt(v)>h)}function aO(r,e,t,n={}){const i=r.videoCodec;if(!i&&!r.audioCodec||!t)return Promise.resolve(sO);const s=[],a=rV(r),o=a.length,u=aV(r,e,o>0),c=u.length;for(let h=o||1*c||1;h--;){const p={type:"media-source"};if(o&&(p.video=a[h%o]),c){p.audio=u[h%c];const v=p.audio.bitrate;p.video&&v&&(p.video.bitrate-=v)}s.push(p)}if(i){const h=navigator.userAgent;if(i.split(",").some(p=>uE(p))&&iO())return Promise.resolve(rO(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${h})`),s))}return Promise.all(s.map(h=>{const p=lV(h);return n[p]||(n[p]=t.decodingInfo(h))})).then(h=>({supported:!h.some(p=>!p.supported),configurations:s,decodingInfoResults:h})).catch(h=>({supported:!1,configurations:s,decodingInfoResults:[],error:h}))}function rV(r){var e;const t=(e=r.videoCodec)==null?void 0:e.split(","),n=oO(r),i=r.width||640,s=r.height||480,a=r.frameRate||30,o=r.videoRange.toLowerCase();return t?t.map(u=>{const c={contentType:Hv(tV(u),"video"),width:i,height:s,bitrate:n,framerate:a};return o!=="sdr"&&(c.transferFunction=o),c}):[]}function aV(r,e,t){var n;const i=(n=r.audioCodec)==null?void 0:n.split(","),s=oO(r);return i&&r.audioGroups?r.audioGroups.reduce((a,o)=>{var u;const c=o?(u=e.groups[o])==null?void 0:u.tracks:null;return c?c.reduce((h,p)=>{if(p.groupId===o){const v=parseFloat(p.channels||"");i.forEach(y=>{const _={contentType:Hv(y,"audio"),bitrate:t?oV(y,s):s};v&&(_.channels=""+v),h.push(_)})}return h},a):a},[]):[]}function oV(r,e){if(e<=1)return 1;let t=128e3;return r==="ec-3"?t=768e3:r==="ac-3"&&(t=64e4),Math.min(e/2,t)}function oO(r){return Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)/1e3)*1e3||1}function lV(r){let e="";const{audio:t,video:n}=r;if(n){const i=E1(n.contentType);e+=`${i}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const i=E1(t.contentType);e+=`${n?"_":""}${i}_c${t.channels}`}return e}const T1=["NONE","TYPE-0","TYPE-1",null];function uV(r){return T1.indexOf(r)>-1}const oA=["SDR","PQ","HLG"];function cV(r){return!!r&&oA.indexOf(r)>-1}var Sv={No:"",Yes:"YES",v2:"v2"};function uI(r){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=r,i=n<e/2;return e&&i?t?Sv.v2:Sv.Yes:Sv.No}class b1{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class $m{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return cI(this._audioGroups,e)}hasSubtitleGroup(e){return cI(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function cI(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function fV(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function hV(r,e){let t=!1,n=[];if(r&&(t=r!=="SDR",n=[r]),e){n=e.allowedVideoRanges||oA.slice(0);const i=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&fV(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const dV=r=>{const e=new WeakSet;return(t,n)=>{if(r&&(n=r(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},vi=(r,e)=>JSON.stringify(r,dV(e));function pV(r,e,t,n,i){const s=Object.keys(r),a=n?.channels,o=n?.audioCodec,u=i?.videoCodec,c=a&&parseInt(a)===2;let h=!1,p=!1,v=1/0,y=1/0,_=1/0,A=1/0,E=0,T=[];const{preferHDR:M,allowedVideoRanges:R}=hV(e,i);for(let F=s.length;F--;){const B=r[s[F]];h||(h=B.channels[2]>0),v=Math.min(v,B.minHeight),y=Math.min(y,B.minFramerate),_=Math.min(_,B.minBitrate),R.filter(V=>B.videoRanges[V]>0).length>0&&(p=!0)}v=yt(v)?v:0,y=yt(y)?y:0;const L=Math.max(1080,v),w=Math.max(30,y);_=yt(_)?_:t,t=Math.max(_,t),p||(e=void 0);const N=s.length>1;return{codecSet:s.reduce((F,B)=>{const P=r[B];if(B===F)return F;if(T=p?R.filter(V=>P.videoRanges[V]>0):[],N){if(P.minBitrate>t)return su(B,`min bitrate of ${P.minBitrate} > current estimate of ${t}`),F;if(!P.hasDefaultAudio)return su(B,"no renditions with default or auto-select sound found"),F;if(o&&B.indexOf(o.substring(0,4))%5!==0)return su(B,`audio codec preference "${o}" not found`),F;if(a&&!c){if(!P.channels[a])return su(B,`no renditions with ${a} channel sound found (channels options: ${Object.keys(P.channels)})`),F}else if((!o||c)&&h&&P.channels[2]===0)return su(B,"no renditions with stereo sound found"),F;if(P.minHeight>L)return su(B,`min resolution of ${P.minHeight} > maximum of ${L}`),F;if(P.minFramerate>w)return su(B,`min framerate of ${P.minFramerate} > maximum of ${w}`),F;if(!T.some(V=>P.videoRanges[V]>0))return su(B,`no variants with VIDEO-RANGE of ${vi(T)} found`),F;if(u&&B.indexOf(u.substring(0,4))%5!==0)return su(B,`video codec preference "${u}" not found`),F;if(P.maxScore<E)return su(B,`max score of ${P.maxScore} < selected max of ${E}`),F}return F&&(rA(B)>=rA(F)||P.fragmentError>r[F].fragmentError)?F:(A=P.minIndex,E=P.maxScore,B)},void 0),videoRanges:T,preferHDR:M,minFramerate:y,minBitrate:_,minIndex:A}}function su(r,e){ii.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function lO(r){return r.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const i=t.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function mV(r,e,t,n){return r.slice(t,n+1).reduce((i,s,a)=>{if(!s.codecSet)return i;const o=s.audioGroups;let u=i[s.codecSet];u||(i[s.codecSet]=u={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),u.minBitrate=Math.min(u.minBitrate,s.bitrate);const c=Math.min(s.height,s.width);return u.minHeight=Math.min(u.minHeight,c),u.minFramerate=Math.min(u.minFramerate,s.frameRate),u.minIndex=Math.min(u.minIndex,a),u.maxScore=Math.max(u.maxScore,s.score),u.fragmentError+=s.fragmentError,u.videoRanges[s.videoRange]=(u.videoRanges[s.videoRange]||0)+1,o&&o.forEach(h=>{if(!h)return;const p=e.groups[h];p&&(u.hasDefaultAudio=u.hasDefaultAudio||e.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(p.channels).forEach(v=>{u.channels[v]=(u.channels[v]||0)+p.channels[v]}))}),i},{})}function fI(r){if(!r)return r;const{lang:e,assocLang:t,characteristics:n,channels:i,audioCodec:s}=r;return{lang:e,assocLang:t,characteristics:n,channels:i,audioCodec:s}}function fu(r,e,t){if("attrs"in r){const n=e.indexOf(r);if(n!==-1)return n}for(let n=0;n<e.length;n++){const i=e[n];if(xd(r,i,t))return n}return-1}function xd(r,e,t){const{groupId:n,name:i,lang:s,assocLang:a,default:o}=r,u=r.forced;return(n===void 0||e.groupId===n)&&(i===void 0||e.name===i)&&(s===void 0||gV(s,e.lang))&&(s===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(u===void 0||e.forced===u)&&(!("characteristics"in r)||vV(r.characteristics||"",e.characteristics))&&(t===void 0||t(r,e))}function gV(r,e="--"){return r.length===e.length?r===e:r.startsWith(e)||e.startsWith(r)}function vV(r,e=""){const t=r.split(","),n=e.split(",");return t.length===n.length&&!t.some(i=>n.indexOf(i)===-1)}function rd(r,e){const{audioCodec:t,channels:n}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function yV(r,e,t,n,i){const s=e[n],o=e.reduce((v,y,_)=>{const A=y.uri;return(v[A]||(v[A]=[])).push(_),v},{})[s.uri];o.length>1&&(n=Math.max.apply(Math,o));const u=s.videoRange,c=s.frameRate,h=s.codecSet.substring(0,4),p=hI(e,n,v=>{if(v.videoRange!==u||v.frameRate!==c||v.codecSet.substring(0,4)!==h)return!1;const y=v.audioGroups,_=t.filter(A=>!y||y.indexOf(A.groupId)!==-1);return fu(r,_,i)>-1});return p>-1?p:hI(e,n,v=>{const y=v.audioGroups,_=t.filter(A=>!y||y.indexOf(A.groupId)!==-1);return fu(r,_,i)>-1})}function hI(r,e,t){for(let n=e;n>-1;n--)if(t(r[n]))return n;for(let n=e+1;n<r.length;n++)if(t(r[n]))return n;return-1}function lA(r,e){var t;return!!r&&r!==((t=e.loadLevelObj)==null?void 0:t.uri)}class uO extends ko{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:i,partCurrent:s,hls:a}=this,{autoLevelEnabled:o,media:u}=a;if(!i||!u)return;const c=performance.now(),h=s?s.stats:i.stats,p=s?s.duration:i.duration,v=c-h.loading.start,y=a.minAutoLevel,_=i.level,A=this._nextAutoLevel;if(h.aborted||h.loaded&&h.loaded===h.total||_<=y){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const E=A>-1&&A!==_,T=!!t||E;if(!T&&(u.paused||!u.playbackRate||!u.readyState))return;const M=a.mainForwardBufferInfo;if(!T&&M===null)return;const R=this.bwEstimator.getEstimateTTFB(),L=Math.abs(u.playbackRate);if(v<=Math.max(R,1e3*(p/(L*2))))return;const w=M?M.len/L:0,N=h.loading.first?h.loading.first-h.loading.start:-1,O=h.loaded&&N>-1,F=this.getBwEstimate(),B=a.levels,P=B[_],V=Math.max(h.loaded,Math.round(p*(i.bitrate||P.averageBitrate)/8));let J=O?v-N:v;J<1&&O&&(J=Math.min(v,h.loaded*8/F));const Q=O?h.loaded*1e3/J:0,ie=R/1e3,ne=Q?(V-h.loaded)/Q:V*8/F+ie;if(ne<=w)return;const k=Q?Q*8:F,K=((n=t?.details||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,j=this.hls.config.abrBandWidthUpFactor;let se=Number.POSITIVE_INFINITY,oe;for(oe=_-1;oe>y;oe--){const pe=B[oe].maxBitrate,Te=!B[oe].details||K;if(se=this.getTimeToLoadFrag(ie,k,p*pe,Te),se<Math.min(w,p+ie))break}if(se>=ne||se>p*10)return;O?this.bwEstimator.sample(v-Math.min(R,N),h.loaded):this.bwEstimator.sampleTTFB(v);const Y=B[oe].maxBitrate;this.getBwEstimate()*j>Y&&this.resetEstimator(Y);const Z=this.findBestLevel(Y,y,oe,0,w,1,1);Z>-1&&(oe=Z),this.warn(`Fragment ${i.sn}${s?" part "+s.index:""} of level ${_} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${w.toFixed(3)} s
      Estimated load time for current fragment: ${ne.toFixed(3)} s
      Estimated load time for down switch fragment: ${se.toFixed(3)} s
      TTFB estimate: ${N|0} ms
      Current BW estimate: ${yt(F)?F|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${oe} @ ${Y|0} bps`),a.nextLoadLevel=a.nextAutoLevel=oe,this.clearTimer();const le=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===oe&&oe>0){const pe=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${oe>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${pe.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,oe>y){let Te=this.findBestLevel(this.hls.levels[y].bitrate,y,oe,0,pe,1,1);Te===-1&&(Te=y),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Te,this.resetEstimator(this.hls.levels[Te].bitrate)}}};E||ne>se*2?le():this.timer=self.setInterval(le,se*1e3),a.trigger(H.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:s,stats:h})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new b9(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.FRAG_LOADING,this.onFragLoading,this),e.on(H.FRAG_LOADED,this.onFragLoaded,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this),e.on(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(H.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.FRAG_LOADING,this.onFragLoading,this),e.off(H.FRAG_LOADED,this.onFragLoaded,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this),e.off(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(H.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(H.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var i;this.fragCurrent=n,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Se.BUFFER_ADD_CODEC_ERROR:case Se.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Se.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:i,partCurrent:s}=this;if(n&&i&&n.sn===i.sn&&n.level===i.level){const a=performance.now(),o=s?s.stats:n.stats,u=a-o.loading.start,c=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&c>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(u-Math.min(p,c),o.loaded)}else this.bwEstimator.sampleTTFB(u)}break}}}getTimeToLoadFrag(e,t,n,i){const s=e+n/t,a=i?e+this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){const n=this.hls.config,{loading:i}=t.stats,s=i.end-i.first;yt(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const i=n?n.stats:t.stats;if(t.type===Tt.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=n?n.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+i.loaded,u=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:u},a.realBitrate=Math.round(8*o/u)}if(t.bitrateTest){const s={stats:i,frag:t,part:n,id:t.type};this.onFragBuffered(H.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Tt.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,t,e,0,i,1,1);if(s>-1)return s;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=n&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:i,config:s,minAutoLevel:a}=n,o=t?t.duration:e?e.duration:0,u=this.getBwEstimate(),c=this.getStarvationDelay();let h=s.abrBandWidthFactor,p=s.abrBandWidthUpFactor;if(c){const E=this.findBestLevel(u,a,i,c,0,h,p);if(E>=0)return this.rebufferNotice=-1,E}let v=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay;if(!c){const E=this.bitrateTestDelay;E&&(v=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-E,this.info(`bitrate test took ${Math.round(1e3*E)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),h=p=1)}const y=this.findBestLevel(u,a,i,c,v,h,p);if(this.rebufferNotice!==y&&(this.rebufferNotice=y,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${y}`)),y>-1)return y;const _=n.levels[a],A=n.loadLevelObj;return A&&_?.bitrate<A.bitrate?a:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,i,s,a,o){var u;const c=i+s,h=this.lastLoadedFragLevel,p=h===-1?this.hls.firstLevel:h,{fragCurrent:v,partCurrent:y}=this,{levels:_,allAudioTracks:A,loadLevel:E,config:T}=this.hls;if(_.length===1)return 0;const M=_[p],R=!!((u=this.hls.latestLevelDetails)!=null&&u.live),L=E===-1||h===-1;let w,N="SDR",O=M?.frameRate||0;const{audioPreference:F,videoPreference:B}=T,P=this.audioTracksByGroup||(this.audioTracksByGroup=lO(A));let V=-1;if(L){if(this.firstSelection!==-1)return this.firstSelection;const k=this.codecTiers||(this.codecTiers=mV(_,P,t,n)),K=pV(k,N,e,F,B),{codecSet:j,videoRanges:se,minFramerate:oe,minBitrate:Y,minIndex:Z,preferHDR:le}=K;V=Z,w=j,N=le?se[se.length-1]:se[0],O=oe,e=Math.max(e,Y),this.log(`picked start tier ${vi(K)}`)}else w=M?.codecSet,N=M?.videoRange;const J=y?y.duration:v?v.duration:0,Q=this.bwEstimator.getEstimateTTFB()/1e3,ie=[];for(let k=n;k>=t;k--){var ne;const K=_[k],j=k>p;if(!K)continue;if(T.useMediaCapabilities&&!K.supportedResult&&!K.supportedPromise){const Te=navigator.mediaCapabilities;typeof Te?.decodingInfo=="function"&&sV(K,P,N,O,e,F)?(K.supportedPromise=aO(K,P,Te,this.supportedCache),K.supportedPromise.then(ce=>{if(!this.hls)return;K.supportedResult=ce;const Me=this.hls.levels,Xe=Me.indexOf(K);ce.error?this.warn(`MediaCapabilities decodingInfo error: "${ce.error}" for level ${Xe} ${vi(ce)}`):ce.supported?ce.decodingInfoResults.some(nt=>nt.smooth===!1||nt.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Xe} not smooth or powerEfficient: ${vi(ce)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Xe} ${vi(ce)}`),Xe>-1&&Me.length>1&&(this.log(`Removing unsupported level ${Xe}`),this.hls.removeLevel(Xe),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ce=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ce}`)})):K.supportedResult=sO}if((w&&K.codecSet!==w||N&&K.videoRange!==N||j&&O>K.frameRate||!j&&O>0&&O<K.frameRate||(ne=K.supportedResult)!=null&&(ne=ne.decodingInfoResults)!=null&&ne.some(Te=>Te.smooth===!1))&&(!L||k!==V)){ie.push(k);continue}const se=K.details,oe=(y?se?.partTarget:se?.averagetargetduration)||J;let Y;j?Y=o*e:Y=a*e;const Z=J&&i>=J*2&&s===0?K.averageBitrate:K.maxBitrate,le=this.getTimeToLoadFrag(Q,Y,Z*oe,se===void 0);if(Y>=Z&&(k===h||K.loadError===0&&K.fragmentError===0)&&(le<=Q||!yt(le)||R&&!this.bitrateTestDelay||le<c)){const Te=this.forcedAutoLevel;return k!==E&&(Te===-1||Te!==E)&&(ie.length&&this.trace(`Skipped level(s) ${ie.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${_[ie[0]].codecs}" ${_[ie[0]].videoRange}; not compatible with "${w}" ${N}`),this.info(`switch candidate:${p}->${k} adjustedbw(${Math.round(Y)})-bitrate=${Math.round(Y-Z)} ttfb:${Q.toFixed(1)} avgDuration:${oe.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${le.toFixed(1)} firstSelection:${L} codecSet:${K.codecSet} videoRange:${K.videoRange} hls.loadLevel:${E}`)),L&&(this.firstSelection=k),k}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const cO={search:function(r,e){let t=0,n=r.length-1,i=null,s=null;for(;t<=n;){i=(t+n)/2|0,s=r[i];const a=e(s);if(a>0)t=i+1;else if(a<0)n=i-1;else return s}return null}};function _V(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!yt(e))return null;const n=r[0].programDateTime;if(e<(n||0))return null;const i=r[r.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let s=0;s<r.length;++s){const a=r[s];if(SV(e,t,a))return a}return null}function Pd(r,e,t=0,n=0,i=.005){let s=null;if(r){s=e[1+r.sn-e[0].sn]||null;const o=r.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),s&&r.level!==s.level&&s.end<=r.end&&(s=e[2+r.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!r||r.level===s.level)&&dI(t,n,s)===0||xV(s,r,Math.min(i,n))))return s;const a=cO.search(e,dI.bind(null,t,n));return a&&(a!==r||!s)?a:s}function xV(r,e,t){if(e&&e.start===0&&e.level<r.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((i,s)=>(s[0]==="INF"&&(i+=parseFloat(s[1])),i),t);return r.start<=n}return!1}function dI(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=r?1:t.start-n>r&&t.start?-1:0}function SV(r,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>r}function fO(r,e,t){if(r&&r.startCC<=e&&r.endCC>=e){let n=r.fragments;const{fragmentHint:i}=r;i&&(n=n.concat(i));let s;return cO.search(n,a=>a.cc<e?1:a.cc>e?-1:(s=a,a.end<=t?1:a.start>t?-1:0)),s||null}return null}function uA(r){switch(r.details){case Se.FRAG_LOAD_TIMEOUT:case Se.KEY_LOAD_TIMEOUT:case Se.LEVEL_LOAD_TIMEOUT:case Se.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function hO(r){return r.details.startsWith("key")}function dO(r){return hO(r)&&!!r.frag&&!r.frag.decryptdata}function pI(r,e){const t=uA(e);return r.default[`${t?"timeout":"error"}Retry`]}function cC(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function mI(r){return ti(ti({},r),{errorRetry:null,timeoutRetry:null})}function cA(r,e,t,n){if(!r)return!1;const i=n?.code,s=e<r.maxNumRetry&&(AV(i)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,n,s):s}function AV(r){return M1(r)||!!r&&(r<400||r>499)}function M1(r){return r===0&&navigator.onLine===!1}var Ms={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},va={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class pO extends ko{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(H.ERROR,this.onError,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(H.ERROR,this.onError,this),e.off(H.ERROR,this.onErrorOut,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===Tt.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(a=>i.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const i=this.hls,s=t.context;switch(t.details){case Se.FRAG_LOAD_ERROR:case Se.FRAG_LOAD_TIMEOUT:case Se.KEY_LOAD_ERROR:case Se.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Se.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=Bm();return}case Se.FRAG_GAP:case Se.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Ms.SendAlternateToPenaltyBox;return}case Se.LEVEL_EMPTY_ERROR:case Se.LEVEL_PARSING_ERROR:{var a;const u=t.parent===Tt.MAIN?t.level:i.loadLevel;t.details===Se.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u))}return;case Se.LEVEL_LOAD_ERROR:case Se.LEVEL_LOAD_TIMEOUT:typeof s?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case Se.AUDIO_TRACK_LOAD_ERROR:case Se.AUDIO_TRACK_LOAD_TIMEOUT:case Se.SUBTITLE_LOAD_ERROR:case Se.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const u=i.loadLevelObj;if(u&&(s.type===_n.AUDIO_TRACK&&u.hasAudioGroup(s.groupId)||s.type===_n.SUBTITLE_TRACK&&u.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Ms.SendAlternateToPenaltyBox,t.errorAction.flags=va.MoveAllAlternatesMatchingHost;return}}return;case Se.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Ms.SendAlternateToPenaltyBox,flags:va.MoveAllAlternatesMatchingHDCP};return;case Se.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Se.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Se.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Ms.SendAlternateToPenaltyBox,flags:va.MoveAllAlternatesMatchingKey};return;case Se.BUFFER_ADD_CODEC_ERROR:case Se.REMUX_ALLOC_ERROR:case Se.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:i.loadLevel)}return;case Se.INTERNAL_EXCEPTION:case Se.BUFFER_APPENDING_ERROR:case Se.BUFFER_FULL_ERROR:case Se.LEVEL_SWITCH_ERROR:case Se.BUFFER_STALLED_ERROR:case Se.BUFFER_SEEK_OVER_HOLE:case Se.BUFFER_NUDGE_ON_STALL:t.errorAction=Bm();return}t.type===Lt.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Bm())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,i=pI(n.config.playlistLoadPolicy,e),s=this.playlistError++;if(cA(i,s,uA(e),e.response))return{action:Ms.RetryRequest,flags:va.None,retryConfig:i,retryCount:s};const o=this.getLevelSwitchAction(e,t);return i&&(o.retryConfig=i,o.retryCount=s),o}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,o=pI(hO(e)?a:s,e),u=t.levels.reduce((h,p)=>h+p.fragmentError,0);if(i&&(e.details!==Se.FRAG_GAP&&i.fragmentError++,!dO(e)&&cA(o,u,uA(e),e.response)))return{action:Ms.RetryRequest,flags:va.None,retryConfig:o,retryCount:u};const c=this.getLevelSwitchAction(e,n);return o&&(c.retryConfig=o,c.retryCount=u),c}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const i=this.hls.levels[t];if(i){var s,a;const c=e.details;i.loadError++,c===Se.BUFFER_APPEND_ERROR&&i.fragmentError++;let h=-1;const{levels:p,loadLevel:v,minAutoLevel:y,maxAutoLevel:_}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const A=(s=e.frag)==null?void 0:s.type,T=(A===Tt.AUDIO&&c===Se.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===Se.BUFFER_ADD_CODEC_ERROR||c===Se.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:N})=>i.audioCodec!==N),R=e.sourceBufferName==="video"&&(c===Se.BUFFER_ADD_CODEC_ERROR||c===Se.BUFFER_APPEND_ERROR)&&p.some(({codecSet:N,audioCodec:O})=>i.codecSet!==N&&i.audioCodec===O),{type:L,groupId:w}=(a=e.context)!=null?a:{};for(let N=p.length;N--;){const O=(N+v)%p.length;if(O!==v&&O>=y&&O<=_&&p[O].loadError===0){var o,u;const F=p[O];if(c===Se.FRAG_GAP&&A===Tt.MAIN&&e.frag){const B=p[O].details;if(B){const P=Pd(e.frag,B.fragments,e.frag.start);if(P!=null&&P.gap)continue}}else{if(L===_n.AUDIO_TRACK&&F.hasAudioGroup(w)||L===_n.SUBTITLE_TRACK&&F.hasSubtitleGroup(w))continue;if(A===Tt.AUDIO&&(o=i.audioGroups)!=null&&o.some(B=>F.hasAudioGroup(B))||A===Tt.SUBTITLE&&(u=i.subtitleGroups)!=null&&u.some(B=>F.hasSubtitleGroup(B))||T&&i.audioCodec===F.audioCodec||R&&i.codecSet===F.codecSet||!T&&i.codecSet!==F.codecSet)continue}h=O;break}}if(h>-1&&n.loadLevel!==h)return e.levelRetry=!0,this.playlistError=0,{action:Ms.SendAlternateToPenaltyBox,flags:va.None,nextAutoLevel:h}}return{action:Ms.SendAlternateToPenaltyBox,flags:va.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case Ms.DoNothing:break;case Ms.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Se.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break;case Ms.RetryRequest:break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:i}=n,s=n.nextAutoLevel;switch(i){case va.None:this.switchLevel(e,s);break;case va.MoveAllAlternatesMatchingHDCP:{const u=this.getVariantLevelIndex(e.frag),c=t.levels[u],h=c?.attrs["HDCP-LEVEL"];if(n.hdcpLevel=h,h==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(h){t.maxHdcpLevel=T1[T1.indexOf(h)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case va.MoveAllAlternatesMatchingKey:{const u=e.decryptdata;if(u){const c=this.hls.levels,h=c.length;for(let v=h;v--;)if(this.variantHasKey(c[v],u)){var a,o;this.log(`Banned key found in level ${v} (${c[v].bitrate}bps) or audio group "${(a=c[v].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${er(u.keyId||[])}`),c[v].fragmentError++,c[v].loadError++,this.log(`Removing level ${v} with key error (${e.error})`),this.hls.removeLevel(v)}const p=e.frag;if(this.hls.levels.length<h)n.resolved=!0;else if(p&&p.type!==Tt.MAIN){const v=p.decryptdata;v&&!u.matches(v)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Se.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=E1(e.mimeType),i=this.hls.levels;for(let s=i.length;s--;)i[s][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${s} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(s))}}}function Bm(r){const e={action:Ms.DoNothing,flags:va.None};return r&&(e.resolved=!0),e}var Cs={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class EV{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.BUFFER_APPENDED,this.onBufferAppended,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this),e.on(H.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.BUFFER_APPENDED,this.onBufferAppended,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this),e.off(H.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let i=n.length;i--;){const s=n[i];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:i}=this,s=Object.keys(i);for(let a=s.length;a--;){const o=i[s[a]];if(o?.body.type===t&&(!n||o.buffered)){const u=o.body;if(u.start<=e&&e<=u.end)return u}}return null}detectEvictedFragments(e,t,n,i,s){this.timeRanges&&(this.timeRanges[e]=t);const a=i?.fragment.sn||-1;Object.keys(this.fragments).forEach(o=>{const u=this.fragments[o];if(!u||a>=u.body.sn)return;if(!u.buffered&&(!u.loaded||s)){u.body.type===n&&this.removeFragment(u.body);return}const c=u.range[e];if(c){if(c.time.length===0){this.removeFragment(u.body);return}c.time.some(h=>{const p=!this.isTimeBuffered(h.startPTS,h.endPTS,t);return p&&this.removeFragment(u.body),p})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,i=ym(n),s=this.fragments[i];if(!s||s.buffered&&n.gap)return;const a=!n.relurl;Object.keys(t).forEach(o=>{const u=n.elementaryStreams[o];if(!u)return;const c=t[o],h=a||u.partial===!0;s.range[o]=this.getBufferedTimes(n,e.part,h,c)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,n),Dx(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=gI(n,i=>i.fragment.sn>=e))}fragBuffered(e,t){const n=ym(e);let i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,this.bufferedEnd(i,e))}getBufferedTimes(e,t,n,i){const s={time:[],partial:n},a=e.start,o=e.end,u=e.minEndPTS||o,c=e.maxStartPTS||a;for(let h=0;h<i.length;h++){const p=i.start(h)-this.bufferPadding,v=i.end(h)+this.bufferPadding;if(c>=p&&u<=v){s.time.push({startPTS:Math.max(a,i.start(h)),endPTS:Math.min(o,i.end(h))});break}else if(a<v&&o>p){const y=Math.max(a,i.start(h)),_=Math.min(o,i.end(h));_>y&&(s.partial=!0,s.time.push({startPTS:y,endPTS:_}))}else if(o<=p)break}return s}getPartialFragment(e){let t=null,n,i,s,a=0;const{bufferPadding:o,fragments:u}=this;return Object.keys(u).forEach(c=>{const h=u[c];h&&Dx(h)&&(i=h.body.start-o,s=h.body.end+o,e>=i&&e<=s&&(n=Math.min(e-i,s-e),a<=n&&(t=h.body,a=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Dx(t))}getState(e){const t=ym(e),n=this.fragments[t];return n?n.buffered?Dx(n)?Cs.PARTIAL:Cs.OK:Cs.APPENDING:Cs.NOT_LOADED}isTimeBuffered(e,t,n){let i,s;for(let a=0;a<n.length;a++){if(i=n.start(a)-this.bufferPadding,s=n.end(a)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,i=t.part?null:t,s=ym(n);this.fragments[s]={body:n,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:i,timeRanges:s,type:a}=t;if(n.sn==="initSegment")return;const o=n.type;if(i){let c=this.activePartLists[o];c||(this.activePartLists[o]=c=[]),c.push(i)}this.timeRanges=s;const u=s[a];this.detectEvictedFragments(a,u,o,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=ym(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let i=n.length;i--;){const s=t[n[i]];if(s?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const u=o.body;u.type!==n||i&&!u.gap||u.start<t&&u.end>e&&(o.buffered||s)&&this.removeFragment(u)})}removeFragment(e){const t=ym(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const i=e.sn;this.activePartLists[e.type]=gI(n,s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function Dx(r){var e,t,n;return r.buffered&&!!(r.body.gap||(e=r.range.video)!=null&&e.partial||(t=r.range.audio)!=null&&t.partial||(n=r.range.audiovideo)!=null&&n.partial)}function ym(r){return`${r.type}_${r.level}_${r.sn}`}function gI(r,e){return r.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var Gf={cbc:0,ctr:1};class TV{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case Gf.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Gf.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function bV(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?r.slice(0,e-t):r}class MV{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let i=0;i<4;i++)n[i]=t.getUint32(i*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],s=n[1],a=n[2],o=n[3],u=this.invSubMix,c=u[0],h=u[1],p=u[2],v=u[3],y=new Uint32Array(256);let _=0,A=0,E=0;for(E=0;E<256;E++)E<128?y[E]=E<<1:y[E]=E<<1^283;for(E=0;E<256;E++){let T=A^A<<1^A<<2^A<<3^A<<4;T=T>>>8^T&255^99,e[_]=T,t[T]=_;const M=y[_],R=y[M],L=y[R];let w=y[T]*257^T*16843008;i[_]=w<<24|w>>>8,s[_]=w<<16|w>>>16,a[_]=w<<8|w>>>24,o[_]=w,w=L*16843009^R*65537^M*257^_*16843008,c[T]=w<<24|w>>>8,h[T]=w<<16|w>>>16,p[T]=w<<8|w>>>24,v[T]=w,_?(_=M^y[y[y[L^M]]],A^=y[y[A]]):_=A=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,i=0;for(;i<t.length&&n;)n=t[i]===this.key[i],i++;if(n)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let o,u;const c=this.keySchedule=new Uint32Array(a),h=this.invKeySchedule=new Uint32Array(a),p=this.sBox,v=this.rcon,y=this.invSubMix,_=y[0],A=y[1],E=y[2],T=y[3];let M,R;for(o=0;o<a;o++){if(o<s){M=c[o]=t[o];continue}R=M,o%s===0?(R=R<<8|R>>>24,R=p[R>>>24]<<24|p[R>>>16&255]<<16|p[R>>>8&255]<<8|p[R&255],R^=v[o/s|0]<<24):s>6&&o%s===4&&(R=p[R>>>24]<<24|p[R>>>16&255]<<16|p[R>>>8&255]<<8|p[R&255]),c[o]=M=(c[o-s]^R)>>>0}for(u=0;u<a;u++)o=a-u,u&3?R=c[o]:R=c[o-4],u<4||o<=4?h[u]=R:h[u]=_[p[R>>>24]]^A[p[R>>>16&255]]^E[p[R>>>8&255]]^T[p[R&255]],h[u]=h[u]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const i=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,u=o[0],c=o[1],h=o[2],p=o[3],v=this.uint8ArrayToUint32Array_(n);let y=v[0],_=v[1],A=v[2],E=v[3];const T=new Int32Array(e),M=new Int32Array(T.length);let R,L,w,N,O,F,B,P,V,J,Q,ie,ne,k;const K=this.networkToHostOrderSwap;for(;t<T.length;){for(V=K(T[t]),J=K(T[t+1]),Q=K(T[t+2]),ie=K(T[t+3]),O=V^s[0],F=ie^s[1],B=Q^s[2],P=J^s[3],ne=4,k=1;k<i;k++)R=u[O>>>24]^c[F>>16&255]^h[B>>8&255]^p[P&255]^s[ne],L=u[F>>>24]^c[B>>16&255]^h[P>>8&255]^p[O&255]^s[ne+1],w=u[B>>>24]^c[P>>16&255]^h[O>>8&255]^p[F&255]^s[ne+2],N=u[P>>>24]^c[O>>16&255]^h[F>>8&255]^p[B&255]^s[ne+3],O=R,F=L,B=w,P=N,ne=ne+4;R=a[O>>>24]<<24^a[F>>16&255]<<16^a[B>>8&255]<<8^a[P&255]^s[ne],L=a[F>>>24]<<24^a[B>>16&255]<<16^a[P>>8&255]<<8^a[O&255]^s[ne+1],w=a[B>>>24]<<24^a[P>>16&255]<<16^a[O>>8&255]<<8^a[F&255]^s[ne+2],N=a[P>>>24]<<24^a[O>>16&255]<<16^a[F>>8&255]<<8^a[B&255]^s[ne+3],M[t]=K(R^y),M[t+1]=K(N^_),M[t+2]=K(w^A),M[t+3]=K(L^E),y=V,_=J,A=Q,E=ie,t=t+4}return M.buffer}}class CV{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=RV(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function RV(r){switch(r){case Gf.cbc:return"AES-CBC";case Gf.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}const DV=16;class fC{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?bV(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,i){return this.useSoftware?new Promise((s,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,n,i);const u=this.flush();u?s(u.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,i)}softwareDecrypt(e,t,n,i){const{currentIV:s,currentResult:a,remainderData:o}=this;if(i!==Gf.cbc||t.byteLength!==16)return ii.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=No(o,e),this.remainderData=null);const u=this.getValidChunk(e);if(!u.length)return null;s&&(n=s);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new MV),c.expandKey(t);const h=a;return this.currentResult=c.decrypt(u.buffer,0,n),this.currentIV=u.slice(-16).buffer,h||null}webCryptoDecrypt(e,t,n,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,i));this.key=t,this.fastAesKey=new CV(this.subtle,t,i)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new TV(this.subtle,new Uint8Array(n),i).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(ii.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,n,i)))}onWebCryptoError(e,t,n,i){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,i);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%DV;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(ii.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const vI=Math.pow(2,17);class LV{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new fc({type:Lt.NETWORK_ERROR,details:Se.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,u)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(_=>_[0]==="GAP")){u(_I(e));return}else e.gap=!1;const c=this.loader=s?new s(i):new a(i),h=yI(e);e.loader=c;const p=mI(i.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:vI};e.stats=c.stats;const y={onSuccess:(_,A,E,T)=>{this.resetLoader(e,c);let M=_.data;E.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(M.slice(0,16)),M=M.slice(16)),o({frag:e,part:null,payload:M,networkDetails:T})},onError:(_,A,E,T)=>{this.resetLoader(e,c),u(new fc({type:Lt.NETWORK_ERROR,details:Se.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:ti({url:n,data:void 0},_),error:new Error(`HTTP Error ${_.code} ${_.text}`),networkDetails:E,stats:T}))},onAbort:(_,A,E)=>{this.resetLoader(e,c),u(new fc({type:Lt.NETWORK_ERROR,details:Se.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:E,stats:_}))},onTimeout:(_,A,E)=>{this.resetLoader(e,c),u(new fc({type:Lt.NETWORK_ERROR,details:Se.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:E,stats:_}))}};t&&(y.onProgress=(_,A,E,T)=>t({frag:e,part:null,payload:E,networkDetails:T})),c.load(h,v,y)})}loadPart(e,t,n){this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,u)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){u(_I(e,t));return}const c=this.loader=s?new s(i):new a(i),h=yI(e,t);e.loader=c;const p=mI(i.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:vI};t.stats=c.stats,c.load(h,v,{onSuccess:(y,_,A,E)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const T={frag:e,part:t,payload:y.data,networkDetails:E};n(T),o(T)},onError:(y,_,A,E)=>{this.resetLoader(e,c),u(new fc({type:Lt.NETWORK_ERROR,details:Se.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:ti({url:h.url,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:A,stats:E}))},onAbort:(y,_,A)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),u(new fc({type:Lt.NETWORK_ERROR,details:Se.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:A,stats:y}))},onTimeout:(y,_,A)=>{this.resetLoader(e,c),u(new fc({type:Lt.NETWORK_ERROR,details:Se.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:A,stats:y}))}})})}updateStatsFromPart(e,t){const n=e.stats,i=t.stats,s=i.total;if(n.loaded+=i.loaded,s){const u=Math.round(e.duration/t.duration),c=Math.min(Math.round(n.loaded/s),u),p=(u-c)*Math.round(n.loaded/c);n.total=n.loaded+p}else n.total=Math.max(n.loaded,n.total);const a=n.loading,o=i.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function yI(r,e=null){const t=e||r,n={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(yt(i)&&yt(s)){var a;let o=i,u=s;if(r.sn==="initSegment"&&IV((a=r.decryptdata)==null?void 0:a.method)){const c=s-i;c%16&&(u=s+(16-c%16)),i!==0&&(n.resetIV=!0,o=i-16)}n.rangeStart=o,n.rangeEnd=u}return n}function _I(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),n={type:Lt.MEDIA_ERROR,details:Se.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(n.part=e),(e||r).stats.aborted=!0,new fc(n)}function IV(r){return r==="AES-128"||r==="AES-256"}class fc extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class mO extends ko{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class cE{constructor(e,t,n,i=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Lx(),this.buffering={audio:Lx(),video:Lx(),audiovideo:Lx()},this.level=e,this.sn=t,this.id=n,this.size=i,this.part=s,this.partial=a}}function Lx(){return{start:0,executeStart:0,executeEnd:0,end:0}}const xI={length:0,start:()=>0,end:()=>0};class nn{static isBuffered(e,t){if(e){const n=nn.getBuffered(e);for(let i=n.length;i--;)if(t>=n.start(i)&&t<=n.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=nn.getBuffered(e);return nn.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const i=nn.bufferedRanges(e);if(i.length)return nn.bufferedInfo(i,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((h,p)=>h.start-p.start||p.end-h.end);let i=-1,s=[];if(n)for(let h=0;h<e.length;h++){t>=e[h].start&&t<=e[h].end&&(i=h);const p=s.length;if(p){const v=s[p-1].end;e[h].start-v<n?e[h].end>v&&(s[p-1].end=e[h].end):s.push(e[h])}else s.push(e[h])}else s=e;let a=0,o,u=t,c=t;for(let h=0;h<s.length;h++){const p=s[h].start,v=s[h].end;if(i===-1&&t>=p&&t<=v&&(i=h),t+n>=p&&t<v)u=p,c=v,a=c-t;else if(t+n<p){o=p;break}}return{len:a,start:u||0,end:c||0,nextStart:o,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||xI}catch(t){return ii.log("failed to get media.buffered",t),xI}}}const gO=/\{\$([a-zA-Z0-9-_]+)\}/g;function SI(r){return gO.test(r)}function C1(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(gO,n=>{const i=n.substring(2,n.length-1),s=t?.[i];return s===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),n):s})}return e}function AI(r,e,t){let n=r.variableList;n||(r.variableList=n={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(i))s=a.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(a){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=e.NAME,s=e.VALUE;i in n?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):n[i]=s||""}function wV(r,e,t){const n=e.IMPORT;if(t&&n in t){let i=r.variableList;i||(r.variableList=i={}),i[n]=t[n]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const BV=/^(\d+)x(\d+)$/,EI=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Ri{constructor(e,t){typeof e=="string"&&(e=Ri.parseAttrList(e,t)),li(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)n[i]=parseInt(t.slice(i*2,i*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((i,s)=>(i[s.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=BV.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const i={};for(EI.lastIndex=0;(n=EI.exec(e))!==null;){const a=n[1].trim();let o=n[2];const u=o.indexOf('"')===0&&o.lastIndexOf('"')===o.length-1;let c=!1;if(u)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(u||c))o=C1(t,o);else if(!c&&!u)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":ii.warn(`${e}: attribute ${a} is missing quotes`)}i[a]=o}return i}}const OV="com.apple.hls.interstitial";function PV(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function NV(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}class hC{constructor(e,t,n=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(i=t?.tagOrder)!=null?i:n,t){const s=t.attr;for(const a in s)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==s[a]){ii.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=li(new Ri({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=t?.endDate||new Date(this.attr["END-DATE"]);yt(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(ii.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(yt(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===OV}get isValid(){return!!this.id&&!this._badValueForSameId&&yt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const UV=10;class vO{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?yt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||UV}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function fA(r,e){return r.length===e.length?!r.some((t,n)=>t!==e[n]):!1}function TI(r,e){return!r&&!e?!0:!r||!e?!1:fA(r,e)}function Om(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function dC(r){switch(r){case"AES-128":case"AES-256":return Gf.cbc;case"AES-256-CTR":return Gf.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function pC(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function R1(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}function FV(r){const e=R1(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function yO(r){const e=function(n,i,s){const a=n[i];n[i]=n[s],n[s]=a};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function _O(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),i=n[n.length-1].split(",");if(i.length===2){const s=i[0]==="base64",a=i[1];s?(n.splice(-1,1),t=pC(a)):t=FV(a)}}return t}const hA=typeof self<"u"?self:void 0;var Li={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},zs={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Jx(r){switch(r){case zs.FAIRPLAY:return Li.FAIRPLAY;case zs.PLAYREADY:return Li.PLAYREADY;case zs.WIDEVINE:return Li.WIDEVINE;case zs.CLEARKEY:return Li.CLEARKEY}}function Ab(r){switch(r){case Li.FAIRPLAY:return zs.FAIRPLAY;case Li.PLAYREADY:return zs.PLAYREADY;case Li.WIDEVINE:return zs.WIDEVINE;case Li.CLEARKEY:return zs.CLEARKEY}}function uv(r){const{drmSystems:e,widevineLicenseUrl:t}=r,n=e?[Li.FAIRPLAY,Li.WIDEVINE,Li.PLAYREADY,Li.CLEARKEY].filter(i=>!!e[i]):[];return!n[Li.WIDEVINE]&&t&&n.push(Li.WIDEVINE),n}const mC=(function(r){return hA!=null&&(r=hA.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function kV(r,e,t,n){let i;switch(r){case Li.FAIRPLAY:i=["cenc","sinf"];break;case Li.WIDEVINE:case Li.PLAYREADY:i=["cenc"];break;case Li.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return GV(i,e,t,n)}function GV(r,e,t,n){return[{initDataTypes:r,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function HV(r){var e;return!!r&&(r.sessionType==="persistent-license"||!!((e=r.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function xO(r){const e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const u=pC(o).subarray(0,16);return yO(u),u}}return null}let _m={};class Ac{static clearKeyUriToKeyIdMap(){_m={}}static setKeyIdForUri(e,t){_m[e]=t}static addKeyIdForUri(e){const t=Object.keys(_m).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),_m[e]=n,n}constructor(e,t,n,i=[1],s=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Om(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(qB(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&fA(e.keyFormatVersions,this.keyFormatVersions)&&TI(e.iv,this.iv)&&TI(e.keyId,this.keyId)}isSupported(){if(this.method){if(Om(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case zs.FAIRPLAY:case zs.WIDEVINE:case zs.PLAYREADY:case zs.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Om(this.method)){let s=this.iv;return s||(typeof e!="number"&&(ii.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=VV(e)),new Ac(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=_m[this.uri];if(s&&!fA(this.keyId,s)&&Ac.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=_O(this.uri);if(n)switch(this.keyFormat){case zs.WIDEVINE:if(this.pssh=n,!this.keyId){const s=j9(n.buffer);if(s.length){var i;const a=s[0];this.keyId=(i=a.kids)!=null&&i.length?a.kids[0]:null}}this.keyId||(this.keyId=bI(t));break;case zs.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=W9(s,null,n),this.keyId=xO(n);break}default:{let s=n.subarray(0,16);if(s.length!==16){const a=new Uint8Array(16);a.set(s,16-s.length),s=a}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=zV(t),s||(s=bI(t),s||(s=_m[this.uri])),s&&(this.keyId=s,Ac.setKeyIdForUri(this.uri,s))}return this}}function zV(r){const e=r?.[zs.WIDEVINE];return e?e.keyId:null}function bI(r){const e=r?.[zs.PLAYREADY];if(e){const t=_O(e.uri);if(t)return xO(t)}return null}function VV(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const MI=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,CI=/#EXT-X-MEDIA:(.*)/g,KV=/^#EXT(?:INF|-X-TARGETDURATION):/m,Eb=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),YV=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class gl{static findGroup(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.id===t)return i}}static resolve(e,t){return rC.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return KV.test(e)}static parseMasterPlaylist(e,t){const n=SI(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];if(MI.lastIndex=0,!e.startsWith("#EXTM3U"))return i.playlistParsingError=new Error("no EXTM3U delimiter"),i;let a;for(;(a=MI.exec(e))!=null;)if(a[1]){var o;const c=new Ri(a[1],i),h=C1(i,a[2]),p={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:gl.resolve(h,t)},v=c.decimalResolution("RESOLUTION");v&&(p.width=v.width,p.height=v.height),LI(c.CODECS,p);const y=c["SUPPLEMENTAL-CODECS"];y&&(p.supplemental={},LI(y,p.supplemental)),(o=p.unknownCodecs)!=null&&o.length||s.push(p),i.levels.push(p)}else if(a[3]){const c=a[3],h=a[4];switch(c){case"SESSION-DATA":{const p=new Ri(h,i),v=p["DATA-ID"];v&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[v]=p);break}case"SESSION-KEY":{const p=RI(h,t,i);p.encrypted&&p.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(p)):ii.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${h}"`);break}case"DEFINE":{{const p=new Ri(h,i);AI(i,p,t)}break}case"CONTENT-STEERING":{const p=new Ri(h,i);i.contentSteering={uri:gl.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=DI(h);break}}}const u=s.length>0&&s.length<i.levels.length;return i.levels=u?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,n){let i;const s={},a=n.levels,o={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let u=0;for(CI.lastIndex=0;(i=CI.exec(e))!==null;){const c=new Ri(i[1],n),h=c.TYPE;if(h){const p=o[h],v=s[h]||[];s[h]=v;const y=c.LANGUAGE,_=c["ASSOC-LANGUAGE"],A=c.CHANNELS,E=c.CHARACTERISTICS,T=c["INSTREAM-ID"],M={attrs:c,bitrate:0,id:u++,groupId:c["GROUP-ID"]||"",name:c.NAME||y||"",type:h,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:y,url:c.URI?gl.resolve(c.URI,t):""};if(_&&(M.assocLang=_),A&&(M.channels=A),E&&(M.characteristics=E),T&&(M.instreamId=T),p!=null&&p.length){const R=gl.findGroup(p,M.groupId)||p[0];II(M,R,"audioCodec"),II(M,R,"textCodec")}v.push(M)}}return s}static parseLevelPlaylist(e,t,n,i,s,a){var o;const u={url:t},c=new vO(t),h=c.fragments,p=[];let v=null,y=0,_=0,A=0,E=0,T=0,M=null,R=new Wx(i,u),L,w,N,O=-1,F=!1,B=null,P;if(Eb.lastIndex=0,c.m3u8=e,c.hasVariableRefs=SI(e),((o=Eb.exec(e))==null?void 0:o[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(L=Eb.exec(e))!==null;){F&&(F=!1,R=new Wx(i,u),R.playlistOffset=A,R.setStart(A),R.sn=y,R.cc=E,T&&(R.bitrate=T),R.level=n,v&&(R.initSegment=v,v.rawProgramDateTime&&(R.rawProgramDateTime=v.rawProgramDateTime,v.rawProgramDateTime=null),B&&(R.setByteRange(B),B=null)));const ie=L[1];if(ie){R.duration=parseFloat(ie);const ne=(" "+L[2]).slice(1);R.title=ne||null,R.tagList.push(ne?["INF",ie,ne]:["INF",ie])}else if(L[3]){if(yt(R.duration)){R.playlistOffset=A,R.setStart(A),N&&BI(R,N,c),R.sn=y,R.level=n,R.cc=E,h.push(R);const ne=(" "+L[3]).slice(1);R.relurl=C1(c,ne),D1(R,M,p),M=R,A+=R.duration,y++,_=0,F=!0}}else{if(L=L[0].match(YV),!L){ii.warn("No matches on slow regex match for level playlist!");continue}for(w=1;w<L.length&&L[w]===void 0;w++);const ne=(" "+L[w]).slice(1),k=(" "+L[w+1]).slice(1),K=L[w+2]?(" "+L[w+2]).slice(1):null;switch(ne){case"BYTERANGE":M?R.setByteRange(k,M):R.setByteRange(k);break;case"PROGRAM-DATE-TIME":R.rawProgramDateTime=k,R.tagList.push(["PROGRAM-DATE-TIME",k]),O===-1&&(O=h.length);break;case"PLAYLIST-TYPE":c.type&&lc(c,ne,L),c.type=k.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?lc(c,ne,L):h.length>0&&OI(c,ne,L),y=c.startSN=parseInt(k);break;case"SKIP":{c.skippedSegments&&lc(c,ne,L);const j=new Ri(k,c),se=j.decimalInteger("SKIPPED-SEGMENTS");if(yt(se)){c.skippedSegments+=se;for(let Y=se;Y--;)h.push(null);y+=se}const oe=j.enumeratedString("RECENTLY-REMOVED-DATERANGES");oe&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(oe.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&lc(c,ne,L),c.targetduration=Math.max(parseInt(k),1);break;case"VERSION":c.version!==null&&lc(c,ne,L),c.version=parseInt(k);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||lc(c,ne,L),c.live=!1;break;case"#":(k||K)&&R.tagList.push(K?[k,K]:[k]);break;case"DISCONTINUITY":E++,R.tagList.push(["DIS"]);break;case"GAP":R.gap=!0,R.tagList.push([ne]);break;case"BITRATE":R.tagList.push([ne,k]),T=parseInt(k)*1e3,yt(T)?R.bitrate=T:T=0;break;case"DATERANGE":{const j=new Ri(k,c),se=new hC(j,c.dateRanges[j.ID],c.dateRangeTagCount);c.dateRangeTagCount++,se.isValid||c.skippedSegments?c.dateRanges[se.id]=se:ii.warn(`Ignoring invalid DATERANGE tag: "${k}"`),R.tagList.push(["EXT-X-DATERANGE",k]);break}case"DEFINE":{{const j=new Ri(k,c);"IMPORT"in j?wV(c,j,a):AI(c,j,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?lc(c,ne,L):h.length>0&&OI(c,ne,L),c.startCC=E=parseInt(k);break;case"KEY":{const j=RI(k,t,c);if(j.isSupported()){if(j.method==="NONE"){N=void 0;break}N||(N={});const se=N[j.keyFormat];se!=null&&se.matches(j)||(se&&(N=li({},N)),N[j.keyFormat]=j)}else ii.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${k}"`);break}case"START":c.startTimeOffset=DI(k);break;case"MAP":{const j=new Ri(k,c);if(R.duration){const se=new Wx(i,u);wI(se,j,n,N),v=se,R.initSegment=v,v.rawProgramDateTime&&!R.rawProgramDateTime&&(R.rawProgramDateTime=v.rawProgramDateTime)}else{const se=R.byteRangeEndOffset;if(se){const oe=R.byteRangeStartOffset;B=`${se-oe}@${oe}`}else B=null;wI(R,j,n,N),v=R,F=!0}v.cc=E;break}case"SERVER-CONTROL":{P&&lc(c,ne,L),P=new Ri(k),c.canBlockReload=P.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=P.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&P.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=P.optionalFloat("PART-HOLD-BACK",0),c.holdBack=P.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&lc(c,ne,L);const j=new Ri(k);c.partTarget=j.decimalFloatingPoint("PART-TARGET");break}case"PART":{let j=c.partList;j||(j=c.partList=[]);const se=_>0?j[j.length-1]:void 0,oe=_++,Y=new Ri(k,c),Z=new WB(Y,R,u,oe,se);j.push(Z),R.duration+=Z.duration;break}case"PRELOAD-HINT":{const j=new Ri(k,c);c.preloadHint=j;break}case"RENDITION-REPORT":{const j=new Ri(k,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(j);break}default:ii.warn(`line parsed but not handled: ${L}`);break}}}M&&!M.relurl?(h.pop(),A-=M.duration,c.partList&&(c.fragmentHint=M)):c.partList&&(D1(R,M,p),R.cc=E,c.fragmentHint=R,N&&BI(R,N,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const V=h.length,J=h[0],Q=h[V-1];if(A+=c.skippedSegments*c.targetduration,A>0&&V&&Q){c.averagetargetduration=A/V;const ie=Q.sn;c.endSN=ie!=="initSegment"?ie:0,c.live||(Q.endList=!0),O>0&&(qV(h,O),J&&p.unshift(J))}return c.fragmentHint&&(A+=c.fragmentHint.duration),c.totalduration=A,p.length&&c.dateRangeTagCount&&J&&SO(p,c),c.endCC=E,c}}function SO(r,e){let t=r.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];r.push(o),t++}else return;const n=r[t-1],i=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let o=s.length;o--;){const u=e.dateRanges[s[o]],c=u.startDate.getTime();u.tagAnchor=n.ref;for(let h=t;h--;){var a;if(((a=r[h])==null?void 0:a.sn)<e.startSN)break;const p=XV(e,c,r,h,i);if(p!==-1){u.tagAnchor=e.fragments[p].ref;break}}}}function XV(r,e,t,n,i){const s=t[n];if(s){const o=s.programDateTime;if(e>=o||n===0){var a;const u=(((a=t[n+1])==null?void 0:a.start)||i)-s.start;if(e<=o+u*1e3){const c=t[n].sn-r.startSN;if(c<0)return-1;const h=r.fragments;if(h.length>t.length){const v=(t[n+1]||h[h.length-1]).sn-r.startSN;for(let y=v;y>c;y--){const _=h[y].programDateTime;if(e>=_&&e<_+h[y].duration*1e3)return y}}return c}}}return-1}function RI(r,e,t){var n,i;const s=new Ri(r,t),a=(n=s.METHOD)!=null?n:"",o=s.URI,u=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,h=(i=s.KEYFORMAT)!=null?i:"identity";o&&s.IV&&!u&&ii.error(`Invalid IV: ${s.IV}`);const p=o?gl.resolve(o,e):"",v=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Ac(a,p,h,v,u,s.KEYID)}function DI(r){const t=new Ri(r).decimalFloatingPoint("TIME-OFFSET");return yt(t)?t:null}function LI(r,e){let t=(r||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const i=t.filter(s=>lC(s,n));i.length&&(e[`${n}Codec`]=i.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function II(r,e,t){const n=e[t];n&&(r[t]=n)}function qV(r,e){let t=r[e];for(let n=e;n--;){const i=r[n];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function D1(r,e,t){r.rawProgramDateTime?t.push(r):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime)}function wI(r,e,t,n){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",n&&(r.levelkeys=n),r.initSegment=null}function BI(r,e,t){r.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&n.push(r)}function lc(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function OI(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Tb(r,e){const t=e.startPTS;if(yt(t)){let n=0,i;e.sn>r.sn?(n=t-r.start,i=r):(n=r.start-t,i=e),i.duration!==n&&i.setDuration(n)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.setStart(r.start+(r.minEndPTS-r.start)):e.setStart(r.start+r.duration):e.setStart(Math.max(r.start-e.duration,0))}function AO(r,e,t,n,i,s,a){n-t<=0&&(a.warn("Fragment should have a positive duration",e),n=t+e.duration,s=i+e.duration);let u=t,c=n;const h=e.startPTS,p=e.endPTS;if(yt(h)){const T=Math.abs(h-t);r&&T>r.totalduration?a.warn(`media timestamps and playlist times differ by ${T}s for level ${e.level} ${r.url}`):yt(e.deltaPTS)?e.deltaPTS=Math.max(T,e.deltaPTS):e.deltaPTS=T,u=Math.max(t,h),t=Math.min(t,h),i=e.startDTS!==void 0?Math.min(i,e.startDTS):i,c=Math.min(n,p),n=Math.max(n,p),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const v=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=u,e.startDTS=i,e.endPTS=n,e.minEndPTS=c,e.endDTS=s;const y=e.sn;if(!r||y<r.startSN||y>r.endSN)return 0;let _;const A=y-r.startSN,E=r.fragments;for(E[A]=e,_=A;_>0;_--)Tb(E[_],E[_-1]);for(_=A;_<E.length-1;_++)Tb(E[_],E[_+1]);return r.fragmentHint&&Tb(E[E.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,v}function WV(r,e,t){if(r===e)return;let n=null;const i=r.fragments;for(let h=i.length-1;h>=0;h--){const p=i[h].initSegment;if(p){n=p;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let s;QV(r,e,(h,p,v,y)=>{if((!e.startCC||e.skippedSegments)&&p.cc!==h.cc){const _=h.cc-p.cc;for(let A=v;A<y.length;A++)y[A].cc+=_;e.endCC=y[y.length-1].cc}yt(h.startPTS)&&yt(h.endPTS)&&(p.setStart(p.startPTS=h.startPTS),p.startDTS=h.startDTS,p.maxStartPTS=h.maxStartPTS,p.endPTS=h.endPTS,p.endDTS=h.endDTS,p.minEndPTS=h.minEndPTS,p.setDuration(h.endPTS-h.startPTS),p.duration&&(s=p),e.PTSKnown=e.alignedSliding=!0),h.hasStreams&&(p.elementaryStreams=h.elementaryStreams),p.loader=h.loader,h.hasStats&&(p.stats=h.stats),h.initSegment&&(p.initSegment=h.initSegment,n=h.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(n&&o.forEach(h=>{var p;h&&(!h.initSegment||h.initSegment.relurl===((p=n)==null?void 0:p.relurl))&&(h.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(h=>!h),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=e.skippedSegments;h--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=jV(r.dateRanges,e,t));const h=r.fragments.filter(p=>p.rawProgramDateTime);if(r.hasProgramDateTime&&!e.hasProgramDateTime)for(let p=1;p<o.length;p++)o[p].programDateTime===null&&D1(o[p],o[p-1],h);SO(h,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var u;const h=bO(r,e.startSN-1);e.startCC=(u=h?.cc)!=null?u:a[0].cc}JV(r.partList,e.partList,(h,p)=>{p.elementaryStreams=h.elementaryStreams,p.stats=h.stats}),s?AO(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):EO(r,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const h=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=h),e.driftEndTime=c,e.driftEnd=h}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=r.requestScheduled)}function jV(r,e,t){const{dateRanges:n,recentlyRemovedDateranges:i}=e,s=li({},r);i&&i.forEach(u=>{delete s[u]});const o=Object.keys(s).length;return o?(Object.keys(n).forEach(u=>{const c=s[u],h=new hC(n[u].attr,c);h.isValid?(s[u]=h,c||(h.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${vi(n[u].attr)}"`)}),s):n}function JV(r,e,t){if(r&&e){let n=0;for(let i=0,s=r.length;i<=s;i++){const a=r[i],o=e[i+n];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):n--}}}function QV(r,e,t){const n=e.skippedSegments,i=Math.max(r.startSN,e.startSN)-e.startSN,s=(r.fragmentHint?1:0)+(n?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,a=e.startSN-r.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let c=i;c<=s;c++){const h=u[a+c];let p=o[c];if(n&&!p&&h&&(p=e.fragments[c]=h),h&&p){t(h,p,c,o);const v=h.relurl,y=p.relurl;if(v&&$V(v,y)){e.playlistParsingError=PI(`media sequence mismatch ${p.sn}:`,r,e,h,p);return}else if(h.cc!==p.cc){e.playlistParsingError=PI(`discontinuity sequence mismatch (${h.cc}!=${p.cc})`,r,e,h,p);return}}}}function PI(r,e,t,n,i){return new Error(`${r} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function EO(r,e,t=!0){const n=e.startSN+e.skippedSegments-r.startSN,i=r.fragments,s=n>=0;let a=0;if(s&&n<i.length)a=i[n].start;else if(s&&e.startSN===r.endSN+1)a=r.fragmentEnd;else if(s&&t)a=r.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=r.fragmentStart;else return;L1(e,a)}function L1(r,e){if(e){const t=r.fragments;for(let n=r.skippedSegments;n<t.length;n++)t[n].addStart(e);r.fragmentHint&&r.fragmentHint.addStart(e)}}function TO(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const n=r.fragments;if(n.length&&t*4>e){const s=n[n.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function bO(r,e,t){if(!r)return null;let n=r.fragments[e-r.startSN];return n||(n=r.fragmentHint,n&&n.sn===e)?n:e<r.startSN&&t&&t.sn===e?t:null}function NI(r,e,t){return r?MO(r.partList,e,t):null}function MO(r,e,t){if(r)for(let n=r.length;n--;){const i=r[n];if(i.index===t&&i.fragment.sn===e)return i}return null}function CO(r){r.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function $V(r,e){return r!==e&&e?UI(r)!==UI(e):!1}function UI(r){return r.replace(/\?[^?]*$/,"")}function Av(r,e){for(let n=0,i=r.length;n<i;n++){var t;if(((t=r[n])==null?void 0:t.cc)===e)return r[n]}return null}function ZV(r,e){return!!(r&&e.startCC<r.endCC&&e.endCC>r.startCC)}function FI(r,e){const t=r.start+e;r.startPTS=t,r.setStart(t),r.endPTS=t+r.duration}function RO(r,e){const t=e.fragments;for(let n=0,i=t.length;n<i;n++)FI(t[n],r);e.fragmentHint&&FI(e.fragmentHint,r),e.alignedSliding=!0}function e7(r,e){r&&(DO(e,r),e.alignedSliding||dA(e,r),!e.alignedSliding&&!e.skippedSegments&&EO(r,e,!1))}function DO(r,e){if(!ZV(e,r))return;const t=Math.min(e.endCC,r.endCC),n=Av(e.fragments,t),i=Av(r.fragments,t);if(!n||!i)return;ii.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=n.start-i.start;RO(s,r)}function dA(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,n=e.fragments;if(!t.length||!n.length)return;let i,s;const a=Math.min(e.endCC,r.endCC);e.startCC<a&&r.startCC<a&&(i=Av(n,a),s=Av(t,a)),(!i||!s)&&(i=n[Math.floor(n.length/2)],s=Av(t,i.cc)||t[Math.floor(t.length/2)]);const o=i.programDateTime,u=s.programDateTime;if(!o||!u)return;const c=(u-o)/1e3-(s.start-i.start);RO(c,r)}function ea(r,e,t){xa(r,e,t),r.addEventListener(e,t)}function xa(r,e,t){r.removeEventListener(e,t)}const t7={toString:function(r){let e="";const t=r.length;for(let n=0;n<t;n++)e+=`[${r.start(n).toFixed(3)}-${r.end(n).toFixed(3)}]`;return e}},ke={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class fE extends mO{constructor(e,t,n,i,s){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ke.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:u,mediaBuffer:c,state:h}=this,p=u?u.currentTime:0,v=nn.bufferInfo(c||u,p,a.maxBufferHole),y=!v.len;if(this.log(`Media seeking to ${yt(p)?p.toFixed(3):p}, state: ${h}, ${y?"out of":"in"} buffer`),this.state===ke.ENDED)this.resetLoadingState();else if(o){const _=a.maxFragLookUpTolerance,A=o.start-_,E=o.start+o.duration+_;if(y||E<v.start||A>v.end){const T=p>E;(p<A||T)&&(T&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(u){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const _=this.lastCurrentTime;if(p>_&&(this.lastCurrentTime=p),!this.loadingParts){const A=Math.max(v.end,p),E=this.shouldLoadParts(this.getLevelDetails(),A);E&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${A.toFixed(2)}`),this.loadingParts=E)}}this.hls.hasEnoughToStart||(this.log(`Setting ${y?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,y&&(this.startPosition=p)),y&&this.state===ke.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new LV(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new fC(e.config)}registerListeners(){const{hls:e}=this;e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(H.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ke.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ke.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,i=this.config.timelineOffset||0;if(n<=i)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=nn.bufferedInfo(s,e.start,0));const a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;const u=t.partList;if(u!=null&&u.length){const h=u[u.length-1];return nn.isBuffered(this.media,h.start+h.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;ea(n,"seeking",this.onMediaSeeking),ea(n,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===ke.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),xa(i,"seeking",this.onMediaSeeking),xa(i,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ke.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const i=s=>{const a=s.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(a,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,n,i).then(s=>{if(!s)return;const a=this.state,o=s.frag;if(this.fragContextChanged(o)){(a===ke.FRAG_LOADING||!this.fragCurrent&&a===ke.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=ke.IDLE);return}"payload"in s&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(H.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===ke.STOPPED||this.state===ke.ERROR||(this.warn(`Frag error: ${s?.message||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===Cs.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),u=this.backtrackFragment;((u?e.sn-u.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===Cs.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:n};this.hls.trigger(H.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const i=n?.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:i}=this,{frag:s,payload:a}=n,o=s.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&Om(o.method)){const u=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,dC(o.method)).catch(c=>{throw i.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:s}),c}).then(c=>{const h=self.performance.now();return i.trigger(H.FRAG_DECRYPTED,{frag:s,payload:c,stats:{tstart:u,tdecrypt:h}}),n.payload=c,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===ke.STOPPED||this.state===ke.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==ke.STOPPED&&(this.state=ke.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,i;const s=e.tracks;if(s&&!t.encrypted&&((n=s.audio)!=null&&n.encrypted||(i=s.video)!=null&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(H.ERROR,{type:Lt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?t7.toString(nn.getBuffered(n)):"(detached)"})`),rs(e)){var i;if(e.type!==Tt.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=ke.IDLE;return}}const s=(i=this.levels)==null?void 0:i[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=ke.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:i,partsLoaded:s}=e,a=!s||s.length===0||s.some(u=>!u),o=new cE(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,i){var s;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ke.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(v=>{if(!this.fragContextChanged(v.frag))return this.hls.trigger(H.KEY_LOADED,v),this.state===ke.KEY_LOADING&&(this.state=ke.IDLE),v}),this.hls.trigger(H.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const u=this.fragPrevious;if(rs(e)&&(!u||e.sn!==u.sn)){const v=this.shouldLoadParts(t.details,e.end);v!==this.loadingParts&&(this.log(`LL-Part loading ${v?"ON":"OFF"} loading sn ${u?.sn}->${e.sn}`),this.loadingParts=v)}if(n=Math.max(e.start,n||0),this.loadingParts&&rs(e)){const v=a.partList;if(v&&i){n>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const y=this.getNextPart(v,e,n);if(y>-1){const _=v[y];e=this.fragCurrent=_.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${_.index} (${y}/${v.length-1}) of ${this.fragInfo(e,!1,_)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=_.start+_.duration,this.state=ke.FRAG_LOADING;let A;return o?A=o.then(E=>!E||this.fragContextChanged(E.frag)?null:this.doFragPartsLoad(e,_,t,i)).catch(E=>this.handleFragLoadError(E)):A=this.doFragPartsLoad(e,_,t,i).catch(E=>this.handleFragLoadError(E)),this.hls.trigger(H.FRAG_LOADING,{frag:e,part:_,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):A}else if(!e.url||this.loadedEndOfParts(v,n))return Promise.resolve(null)}}if(rs(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=a.partList)==null?void 0:c.filter(v=>v.loaded).map(v=>`[${v.start}-${v.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),yt(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ke.FRAG_LOADING;const h=this.config.progressive&&e.type!==Tt.SUBTITLE;let p;return h&&o?p=o.then(v=>!v||this.fragContextChanged(v.frag)?null:this.fragmentLoader.load(e,i)).catch(v=>this.handleFragLoadError(v)):p=Promise.all([this.fragmentLoader.load(e,h?i:void 0),o]).then(([v])=>(!h&&i&&i(v),v)).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(H.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):p}doFragPartsLoad(e,t,n,i){return new Promise((s,a)=>{var o;const u=[],c=(o=n.details)==null?void 0:o.partList,h=p=>{this.fragmentLoader.loadPart(e,p,i).then(v=>{u[p.index]=v;const y=v.part;this.hls.trigger(H.FRAG_LOADED,v);const _=NI(n.details,e.sn,p.index+1)||MO(c,e.sn,p.index+1);if(_)h(_);else return s({frag:e,part:y,partsLoaded:u})}).catch(a)};h(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Se.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Lt.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(H.ERROR,t)}else this.hls.trigger(H.ERROR,{type:Lt.OTHER_ERROR,details:Se.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ke.PARSING){!this.fragCurrent&&this.state!==ke.STOPPED&&this.state!==ke.ERROR&&(this.state=ke.IDLE);return}const{frag:n,part:i,level:s}=t,a=self.performance.now();n.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const o=this.getLevelDetails(),c=o&&n.sn>o.endSN||this.shouldLoadParts(o,n.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(n,i,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const s=e.partList[0];if(s.fragment.type===Tt.SUBTITLE)return!1;const a=s.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=a){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:i,sn:s,part:a}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const o=t[i],u=o.details,c=a>-1?NI(u,s,a):null,h=c?c.fragment:bO(u,s,n);return h?(n&&n!==h&&(h.stats=n.stats),{frag:h,part:c,level:o}):null}bufferFragmentData(e,t,n,i,s){if(this.state!==ke.PARSING)return;const{data1:a,data2:o}=e;let u=a;if(o&&(u=No(a,o)),!u.length)return;const c=this.initPTS[t.cc],h=c?-c.baseTime/c.timescale:void 0,p={type:e.type,frag:t,part:n,chunkMeta:i,offset:h,parent:t.type,data:u};if(this.hls.trigger(H.BUFFER_APPENDING,p),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!nn.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,i=nn.bufferInfo(t,n,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(e.start-a,i.end-a),n+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var n;const i=this.getLoadPosition();if(!yt(i))return null;const a=this.lastCurrentTime>i||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,a)}getFwdBufferInfoAtPos(e,t,n,i){const s=nn.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,n);if(a&&(s.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(s.nextStart,a.end)-t,i);return nn.bufferInfo(e,t,o)}}return s}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,i=Math.max(Math.min(e-t,n.maxBufferLength),t),s=Math.max(e-t*3,n.maxMaxBufferLength/2,i);return s>=i?(n.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=Tt.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,i=n.length;if(!i)return null;const{config:s}=this,a=n[0].start,o=s.lowLatencyMode&&!!t.partList;let u=null;if(t.live){const p=s.initialLiveManifestSize;if(i<p)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${p})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var c;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),u=this.getInitialLiveFragment(t);const v=this.hls.startPosition,y=this.hls.liveSyncPosition,_=u?(v!==-1&&v>=a?v:y)||u.start:e;this.log(`Setting startPosition to ${_} to match start frag at live edge. mainStart: ${v} liveSyncPosition: ${y} frag.start: ${(c=u)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=_}}else e<=a&&(u=n[0]);if(!u){const p=this.loadingParts?t.partEnd:t.fragmentEnd;u=this.getFragmentAtPosition(e,p,t)}let h=this.filterReplacedPrimary(u,t);if(!h&&u){const p=u.sn-t.startSN;h=this.filterReplacedPrimary(n[p+1]||null,t)}return this.mapToInitFragWhenRequired(h)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===Cs.OK||n===Cs.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,i,s){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&n.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i,0);if(o!==null&&n.len+o.len>=s){const u=a.sn;return this.loopSn!==u&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${u}`),this.loopSn=u),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(kI(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(kI(this.config)&&e.type!==Tt.SUBTITLE){const n=this.hls.interstitialsManager,i=n?.bufferingItem;if(i){const a=i.event;if(a){if(a.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&t?.live===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const s=n?.playerQueue;if(s)for(let a=s.length;a--;){const o=s[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let i=-1,s=!1,a=!0;for(let o=0,u=e.length;o<u;o++){const c=e[o];if(a=a&&!c.independent,i>-1&&n<c.start)break;const h=c.loaded;h?i=-1:(s||(c.independent||a)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${c.start}`),i=o),s=h}return i}loadedEndOfParts(e,t){let n;for(let i=e.length;i--;){if(n=e[i],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let i=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),i=_V(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=t[s-e.startSN];n.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=fO(e,n.cc,n.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,n){const{config:i}=this;let{fragPrevious:s}=this,{fragments:a,endSN:o}=n;const{fragmentHint:u}=n,{maxFragLookUpTolerance:c}=i,h=n.partList,p=!!(this.loadingParts&&h!=null&&h.length&&u);p&&!this.bitrateTest&&h[h.length-1].fragment.sn===u.sn&&(a=a.concat(u),o=u.sn);let v;if(e<t){var y;const A=e<this.lastCurrentTime||e>t-c||(y=this.media)!=null&&y.paused||!this.startFragRequested?0:c;v=Pd(s,a,e,A)}else v=a[a.length-1];if(v){const _=v.sn-n.startSN,A=this.fragmentTracker.getState(v);if((A===Cs.OK||A===Cs.PARTIAL&&v.gap)&&(s=v),s&&v.sn===s.sn&&(!p||h[0].fragment.sn>v.sn||!n.live)&&v.level===s.level){const T=a[_+1];v.sn<o&&this.fragmentTracker.getState(T)!==Cs.OK?v=T:v=null}}return v}alignPlaylists(e,t,n){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,a=!t,o=e.alignedSliding&&yt(s);if(a||!o&&!s){e7(n,e);const u=e.fragmentStart;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),u}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const i=this.timelineOffset;if(n===-1){const s=this.startTimeOffset!==null,a=s?this.startTimeOffset:e.startTimeOffset;a!==null&&yt(a)?(n=t+a,a<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${a} found in ${s?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+i}this.nextLoadPosition=n+i}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&rs(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ke.FRAG_LOADING_WAITING_RETRY)&&(this.state=ke.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const T=this.getCurrentContext(t.chunkMeta);T&&(t.frag=T.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const a=t.details===Se.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);const o=t.errorAction;if(!o){this.state=ke.ERROR;return}const{action:u,flags:c,retryCount:h=0,retryConfig:p}=o,v=!!p,y=v&&u===Ms.RetryRequest,_=v&&!o.resolved&&c===va.MoveAllAlternatesMatchingHost,A=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!y&&_&&rs(i)&&!i.endList&&A&&!dO(t))this.resetFragmentErrors(e),this.treatAsGap(i),o.resolved=!0;else if((y||_)&&h<p.maxNumRetry){var E;const T=M1((E=t.response)==null?void 0:E.code),M=cC(p,h);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+M,this.state=ke.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,T){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${h+1}/${p.maxNumRetry} in ${M}ms`)}else if(p)if(this.resetFragmentErrors(e),h<p.maxNumRetry)!a&&u!==Ms.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${h})`);return}else u===Ms.SendAlternateToPenaltyBox?this.state=ke.WAITING_LEVEL:this.state=ke.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!M1(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ke.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ke.PARSING||this.state===ke.PARSED){const t=e.frag,n=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len,t?.duration||10);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Tt.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ke.STOPPED&&(this.state=ke.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const i=nn.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===ke.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ke.STOPPED&&(this.state=ke.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,i){const s=n.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((u,c)=>{const h=e.elementaryStreams[c];if(h){const p=h.endPTS-h.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${p})`),u||!1;const v=i?0:AO(s,e,h.startPTS,h.endPTS,h.startDTS,h.endDTS,this);return this.hls.trigger(H.LEVEL_PTS_UPDATED,{details:s,level:n,drift:v,type:c,frag:e,start:h.startPTS,end:h.endPTS}),!0}return u},!1)){var o;const u=((o=this.transmuxer)==null?void 0:o.error)===null;if((n.fragmentError===0||u&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),u){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ke.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(H.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Tt.MAIN?"level":"track"}fragInfo(e,t=!0,n){var i,s;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((i=t&&!n?e.startPTS:(n||e).start)!=null?i:NaN).toFixed(3)}-${((s=t&&!n?e.endPTS:(n||e).end)!=null?s:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function kI(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}class LO{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=n7(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function n7(r,e){const t=new Uint8Array(e);let n=0;for(let i=0;i<r.length;i++){const s=r[i];t.set(s,n),n+=s.length}return t}var bb={exports:{}},GI;function i7(){return GI||(GI=1,(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(u,c,h){this.fn=u,this.context=c,this.once=h||!1}function s(u,c,h,p,v){if(typeof h!="function")throw new TypeError("The listener must be a function");var y=new i(h,p||u,v),_=t?t+c:c;return u._events[_]?u._events[_].fn?u._events[_]=[u._events[_],y]:u._events[_].push(y):(u._events[_]=y,u._eventsCount++),u}function a(u,c){--u._eventsCount===0?u._events=new n:delete u._events[c]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],h,p;if(this._eventsCount===0)return c;for(p in h=this._events)e.call(h,p)&&c.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},o.prototype.listeners=function(c){var h=t?t+c:c,p=this._events[h];if(!p)return[];if(p.fn)return[p.fn];for(var v=0,y=p.length,_=new Array(y);v<y;v++)_[v]=p[v].fn;return _},o.prototype.listenerCount=function(c){var h=t?t+c:c,p=this._events[h];return p?p.fn?1:p.length:0},o.prototype.emit=function(c,h,p,v,y,_){var A=t?t+c:c;if(!this._events[A])return!1;var E=this._events[A],T=arguments.length,M,R;if(E.fn){switch(E.once&&this.removeListener(c,E.fn,void 0,!0),T){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,h),!0;case 3:return E.fn.call(E.context,h,p),!0;case 4:return E.fn.call(E.context,h,p,v),!0;case 5:return E.fn.call(E.context,h,p,v,y),!0;case 6:return E.fn.call(E.context,h,p,v,y,_),!0}for(R=1,M=new Array(T-1);R<T;R++)M[R-1]=arguments[R];E.fn.apply(E.context,M)}else{var L=E.length,w;for(R=0;R<L;R++)switch(E[R].once&&this.removeListener(c,E[R].fn,void 0,!0),T){case 1:E[R].fn.call(E[R].context);break;case 2:E[R].fn.call(E[R].context,h);break;case 3:E[R].fn.call(E[R].context,h,p);break;case 4:E[R].fn.call(E[R].context,h,p,v);break;default:if(!M)for(w=1,M=new Array(T-1);w<T;w++)M[w-1]=arguments[w];E[R].fn.apply(E[R].context,M)}}return!0},o.prototype.on=function(c,h,p){return s(this,c,h,p,!1)},o.prototype.once=function(c,h,p){return s(this,c,h,p,!0)},o.prototype.removeListener=function(c,h,p,v){var y=t?t+c:c;if(!this._events[y])return this;if(!h)return a(this,y),this;var _=this._events[y];if(_.fn)_.fn===h&&(!v||_.once)&&(!p||_.context===p)&&a(this,y);else{for(var A=0,E=[],T=_.length;A<T;A++)(_[A].fn!==h||v&&!_[A].once||p&&_[A].context!==p)&&E.push(_[A]);E.length?this._events[y]=E.length===1?E[0]:E:a(this,y)}return this},o.prototype.removeAllListeners=function(c){var h;return c?(h=t?t+c:c,this._events[h]&&a(this,h)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o})(bb)),bb.exports}var s7=i7(),gC=B9(s7);const zv="1.6.15",Zm={};function r7(){return typeof __HLS_WORKER_BUNDLE__=="function"}function a7(){const r=Zm[zv];if(r)return r.clientCount++,r;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return Zm[zv]=i,i}function o7(r){const e=Zm[r];if(e)return e.clientCount++,e;const t=new self.URL(r,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Zm[r]=i,i}function l7(r){const e=Zm[r||zv];if(e&&e.clientCount--===1){const{worker:n,objectURL:i}=e;delete Zm[r||zv],i&&self.URL.revokeObjectURL(i),n.terminate()}}function IO(r,e){return e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function vC(r,e){return e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function hE(r,e){let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t}function Vv(r,e){const t=e;let n=0;for(;vC(r,e);){n+=10;const i=hE(r,e+6);n+=i,IO(r,e+10)&&(n+=10),e+=n}if(n>0)return r.subarray(t,t+n)}function u7(r,e,t,n){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],a=s>>2&15;if(a>12){const y=new Error(`invalid ADTS sampling index:${a}`);r.emit(H.ERROR,H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.FRAG_PARSING_ERROR,fatal:!0,error:y,reason:y.message});return}const o=(s>>6&3)+1,u=e[t+3]>>6&3|(s&1)<<2,c="mp4a.40."+o,h=i[a];let p=a;(o===5||o===29)&&(p-=3);const v=[o<<3|(p&14)>>1,(p&1)<<7|u<<3];return ii.log(`manifest codec:${n}, parsed codec:${c}, channels:${u}, rate:${h} (ADTS object type:${o} sampling index:${a})`),{config:v,samplerate:h,channelCount:u,codec:c,parsedCodec:c,manifestCodec:n}}function wO(r,e){return r[e]===255&&(r[e+1]&246)===240}function BO(r,e){return r[e+1]&1?7:9}function yC(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function c7(r,e){return e+5<r.length}function pA(r,e){return e+1<r.length&&wO(r,e)}function f7(r,e){return c7(r,e)&&wO(r,e)&&yC(r,e)<=r.length-e}function h7(r,e){if(pA(r,e)){const t=BO(r,e);if(e+t>=r.length)return!1;const n=yC(r,e);if(n<=t)return!1;const i=e+n;return i===r.length||pA(r,i)}return!1}function OO(r,e,t,n,i){if(!r.samplerate){const s=u7(e,t,n,i);if(!s)return;li(r,s)}}function PO(r){return 1024*9e4/r}function d7(r,e){const t=BO(r,e);if(e+t<=r.length){const n=yC(r,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function NO(r,e,t,n,i){const s=PO(r.samplerate),a=n+i*s,o=d7(e,t);let u;if(o){const{frameLength:p,headerLength:v}=o,y=v+p,_=Math.max(0,t+y-e.length);_?(u=new Uint8Array(y-v),u.set(e.subarray(t+v,e.length),0)):u=e.subarray(t+v,t+y);const A={unit:u,pts:a};return _||r.samples.push(A),{sample:A,length:y,missing:_}}const c=e.length-t;return u=new Uint8Array(c),u.set(e.subarray(t,e.length),0),{sample:{unit:u,pts:a},length:c,missing:-1}}function p7(r,e){return vC(r,e)&&hE(r,e+6)+10<=r.length-e}function m7(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function Mb(r,e=0,t=1/0){return g7(r,e,t,Uint8Array)}function g7(r,e,t,n){const i=v7(r);let s=1;"BYTES_PER_ELEMENT"in n&&(s=n.BYTES_PER_ELEMENT);const a=y7(r)?r.byteOffset:0,o=(a+r.byteLength)/s,u=(a+e)/s,c=Math.floor(Math.max(0,Math.min(u,o))),h=Math.floor(Math.min(c+Math.max(t,0),o));return new n(i,c,h-c)}function v7(r){return r instanceof ArrayBuffer?r:r.buffer}function y7(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function _7(r){const e={key:r.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(r.size<2)return;if(r.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=r.data.subarray(1).indexOf(0);if(n===-1)return;const i=Qa(Mb(r.data,1,n)),s=r.data[2+n],a=r.data.subarray(3+n).indexOf(0);if(a===-1)return;const o=Qa(Mb(r.data,3+n,a));let u;return i==="-->"?u=Qa(Mb(r.data,4+n+a)):u=m7(r.data.subarray(4+n+a)),e.mimeType=i,e.pictureType=s,e.description=o,e.data=u,e}function x7(r){if(r.size<2)return;const e=Qa(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}}function S7(r){if(r.size<2)return;if(r.type==="TXXX"){let t=1;const n=Qa(r.data.subarray(t),!0);t+=n.length+1;const i=Qa(r.data.subarray(t));return{key:r.type,info:n,data:i}}const e=Qa(r.data.subarray(1));return{key:r.type,info:"",data:e}}function A7(r){if(r.type==="WXXX"){if(r.size<2)return;let t=1;const n=Qa(r.data.subarray(t),!0);t+=n.length+1;const i=Qa(r.data.subarray(t));return{key:r.type,info:n,data:i}}const e=Qa(r.data);return{key:r.type,info:"",data:e}}function E7(r){return r.type==="PRIV"?x7(r):r.type[0]==="W"?A7(r):r.type==="APIC"?_7(r):S7(r)}function T7(r){const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=hE(r,4),n=10;return{type:e,size:t,data:r.subarray(n,n+t)}}const Ix=10,b7=10;function UO(r){let e=0;const t=[];for(;vC(r,e);){const n=hE(r,e+6);r[e+5]>>6&1&&(e+=Ix),e+=Ix;const i=e+n;for(;e+b7<i;){const s=T7(r.subarray(e)),a=E7(s);a&&t.push(a),e+=s.size+Ix}IO(r,e)&&(e+=Ix)}return t}function FO(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function M7(r){if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function _C(r){const e=UO(r);for(let t=0;t<e.length;t++){const n=e[t];if(FO(n))return M7(n)}}let ya=(function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r})({});function lu(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class xC{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=No(this.cachedData,e),this.cachedData=null);let n=Vv(e,0),i=n?n.length:0,s;const a=this._audioTrack,o=this._id3Track,u=n?_C(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&yt(u))&&(this.basePTS=C7(u,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:ya.audioId3,duration:Number.POSITIVE_INFINITY});i<c;){if(this.canParse(e,i)){const h=this.appendFrame(a,e,i);h?(this.frameIndex++,this.lastPTS=h.sample.pts,i+=h.length,s=i):i=c}else p7(e,i)?(n=Vv(e,i),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:ya.audioId3,duration:Number.POSITIVE_INFINITY}),i+=n.length,s=i):i++;if(i===c&&s!==c){const h=e.slice(s);this.cachedData?this.cachedData=No(this.cachedData,h):this.cachedData=h}}return{audioTrack:a,videoTrack:lu(),id3Track:o,textTrack:lu()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:lu(),id3Track:this._id3Track,textTrack:lu()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const C7=(r,e,t)=>{if(yt(r))return r*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let wx=null;const R7=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],D7=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],L7=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],I7=[0,1,1,4];function kO(r,e,t,n,i){if(t+24>e.length)return;const s=GO(e,t);if(s&&t+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,o=n+i*a,u={unit:e.subarray(t,t+s.frameLength),pts:o,dts:o};return r.config=[],r.channelCount=s.channelCount,r.samplerate=s.sampleRate,r.samples.push(u),{sample:u,length:s.frameLength,missing:0}}}function GO(r,e){const t=r[e+1]>>3&3,n=r[e+1]>>1&3,i=r[e+2]>>4&15,s=r[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const a=r[e+2]>>1&1,o=r[e+3]>>6,u=t===3?3-n:n===3?3:4,c=R7[u*14+i-1]*1e3,p=D7[(t===3?0:t===2?1:2)*3+s],v=o===3?1:2,y=L7[t][n],_=I7[n],A=y*8*_,E=Math.floor(y*c/p+a)*_;if(wx===null){const R=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);wx=R?parseInt(R[1]):0}return wx&&wx<=87&&n===2&&c>=224e3&&o===0&&(r[e+3]=r[e+3]|128),{sampleRate:p,channelCount:v,frameLength:E,samplesPerFrame:A}}}function SC(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function HO(r,e){return e+1<r.length&&SC(r,e)}function w7(r,e){return SC(r,e)&&4<=r.length-e}function zO(r,e){if(e+1<r.length&&SC(r,e)){const n=GO(r,e);let i=4;n!=null&&n.frameLength&&(i=n.frameLength);const s=e+i;return s===r.length||HO(r,s)}return!1}class B7 extends xC{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Vv(e,0);let i=n?.length||0;if(zO(e,i))return!1;for(let s=e.length;i<s;i++)if(h7(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return f7(e,t)}appendFrame(e,t,n){OO(e,this.observer,t,n,e.manifestCodec);const i=NO(e,t,n,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const VO=(r,e)=>{let t=0,n=5;e+=n;const i=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;n>0;){a[0]=r[e];const o=Math.min(n,8),u=8-o;s[0]=4278190080>>>24+u<<u,i[0]=(a[0]&s[0])>>u,t=t?t<<o|i[0]:i[0],e+=1,n-=o}return t};class O7 extends xC{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const i=KO(e,t,n,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Vv(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&_C(t)!==void 0&&VO(e,n)<16}}function KO(r,e,t,n,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const o=[48e3,44100,32e3][s],u=e[t+4]&63,h=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][u*3+s]*2;if(t+h>e.length)return-1;const p=e[t+6]>>5;let v=0;p===2?v+=2:(p&1&&p!==1&&(v+=2),p&4&&(v+=2));const y=(e[t+6]<<8|e[t+7])>>12-v&1,A=[2,1,2,3,3,4,4,5][p]+y,E=e[t+5]>>3,T=e[t+5]&7,M=new Uint8Array([s<<6|E<<1|T>>2,(T&3)<<6|p<<3|y<<2|u>>4,u<<4&224]),R=1536/o*9e4,L=n+i*R,w=e.subarray(t,t+h);return r.config=M,r.channelCount=A,r.samplerate=o,r.samples.push({unit:w,pts:L}),h}class P7 extends xC{resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Vv(e,0);let n=t?.length||0;if(t&&e[n]===11&&e[n+1]===119&&_C(t)!==void 0&&VO(e,n)<=16)return!1;for(let i=e.length;n<i;n++)if(zO(e,n))return ii.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return w7(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return kO(e,t,n,this.basePTS,this.frameIndex)}}const N7=/\/emsg[-/]ID3/i;class U7{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,i){const s=this.videoTrack=lu("video",1),a=this.audioTrack=lu("audio",1),o=this.txtTrack=lu("text",1);if(this.id3Track=lu("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const u=ZB(e);if(u.video){const{id:c,timescale:h,codec:p,supplemental:v}=u.video;s.id=c,s.timescale=o.timescale=h,s.codec=p,s.supplemental=v}if(u.audio){const{id:c,timescale:h,codec:p}=u.audio;a.id=c,a.timescale=h,a.codec=p}o.id=JB.text,s.sampleDuration=0,s.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return U9(e)}demux(e,t){this.timeOffset=t;let n=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=No(this.remainderData,e));const o=K9(n);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=n;const a=this.extractID3Track(i,t);return s.samples=rI(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return n.samples=rI(e,t),{videoTrack:t,audioTrack:lu(),id3Track:i,textTrack:lu()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const i=mn(e.samples,["emsg"]);i&&i.forEach(s=>{const a=X9(s);if(N7.test(a.schemeIdUri)){const o=HI(a,t);let u=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;u<=.001&&(u=Number.POSITIVE_INFINITY);const c=a.payload;n.samples.push({data:c,len:c.byteLength,dts:o,pts:o,type:ya.emsg,duration:u})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=HI(a,t);n.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:ya.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function HI(r,e){return yt(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale}class F7{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new fC(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Gf.cbc)}decryptAacSample(e,t,n){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(o=>{const u=new Uint8Array(o);i.set(u,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)n.set(e.subarray(s,s+16),i);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(n.subarray(i,i+16),s);return e}decryptAvcSample(e,t,n,i,s){const a=nO(s.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(u=>{s.data=this.getAvcDecryptedUnit(a,u),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,i)}).catch(i)}decryptAvcSamples(e,t,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(n>=s.length);n++){const a=s[n];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,n,i,a),!this.decrypter.isSync()))return}}}}class YO{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,i;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const s=n.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,i=n.length;if(i){const s=n[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const i=t.byteLength;let s=e.naluState||0;const a=s,o=[];let u=0,c,h,p,v=-1,y=0;for(s===-1&&(v=0,y=this.getNALuType(t,0),s=0,u=1);u<i;){if(c=t[u++],!s){s=c?0:1;continue}if(s===1){s=c?0:2;continue}if(!c)s=3;else if(c===1){if(h=u-s-1,v>=0){const _={data:t.subarray(v,h),type:y};o.push(_)}else{const _=this.getLastNalUnit(e.samples);_&&(a&&u<=4-a&&_.state&&(_.data=_.data.subarray(0,_.data.byteLength-a)),h>0&&(_.data=No(_.data,t.subarray(0,h)),_.state=0))}u<i?(p=this.getNALuType(t,u),v=u,y=p,s=0):s=-1}else s=0}if(v>=0&&s>=0){const _={data:t.subarray(v,i),type:y,state:s};o.push(_)}if(o.length===0){const _=this.getLastNalUnit(e.samples);_&&(_.data=No(_.data,t))}return e.naluState=s,o}}class Ev{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(n,n+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&ii.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class k7 extends YO{parsePES(e,t,n,i){const s=this.parseNALu(e,n.data,i);let a=this.VideoSample,o,u=!1;n.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(c=>{var h,p;switch(c.type){case 1:{let A=!1;o=!0;const E=c.data;if(u&&E.length>4){const T=this.readSliceType(E);(T===2||T===4||T===7||T===9)&&(A=!0)}if(A){var v;(v=a)!=null&&v.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=A;break}case 5:o=!0,(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,oC(c.data,1,n.pts,t.samples);break}case 7:{var y,_;o=!0,u=!0;const A=c.data,E=this.readSPS(A);if(!e.sps||e.width!==E.width||e.height!==E.height||((y=e.pixelRatio)==null?void 0:y[0])!==E.pixelRatio[0]||((_=e.pixelRatio)==null?void 0:_[1])!==E.pixelRatio[1]){e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.sps=[A];const T=A.subarray(1,4);let M="avc1.";for(let R=0;R<3;R++){let L=T[R].toString(16);L.length<2&&(L="0"+L),M+=L}e.codec=M}break}case 8:o=!0,e.pps=[c.data];break;case 9:o=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(c)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Ev(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,i=8,s;for(let a=0;a<e;a++)i!==0&&(s=t.readEG(),i=(n+s+256)%256),n=i===0?n:i}readSPS(e){const t=new Ev(e);let n=0,i=0,s=0,a=0,o,u,c;const h=t.readUByte.bind(t),p=t.readBits.bind(t),v=t.readUEG.bind(t),y=t.readBoolean.bind(t),_=t.skipBits.bind(t),A=t.skipEG.bind(t),E=t.skipUEG.bind(t),T=this.skipScalingList.bind(this);h();const M=h();if(p(5),_(3),h(),E(),M===100||M===110||M===122||M===244||M===44||M===83||M===86||M===118||M===128){const F=v();if(F===3&&_(1),E(),E(),_(1),y())for(u=F!==3?8:12,c=0;c<u;c++)y()&&(c<6?T(16,t):T(64,t))}E();const R=v();if(R===0)v();else if(R===1)for(_(1),A(),A(),o=v(),c=0;c<o;c++)A();E(),_(1);const L=v(),w=v(),N=p(1);N===0&&_(1),_(1),y()&&(n=v(),i=v(),s=v(),a=v());let O=[1,1];if(y()&&y())switch(h()){case 1:O=[1,1];break;case 2:O=[12,11];break;case 3:O=[10,11];break;case 4:O=[16,11];break;case 5:O=[40,33];break;case 6:O=[24,11];break;case 7:O=[20,11];break;case 8:O=[32,11];break;case 9:O=[80,33];break;case 10:O=[18,11];break;case 11:O=[15,11];break;case 12:O=[64,33];break;case 13:O=[160,99];break;case 14:O=[4,3];break;case 15:O=[3,2];break;case 16:O=[2,1];break;case 255:{O=[h()<<8|h(),h()<<8|h()];break}}return{width:Math.ceil((L+1)*16-n*2-i*2),height:(2-N)*(w+1)*16-(N?2:4)*(s+a),pixelRatio:O}}}class G7 extends YO{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,i){const s=this.parseNALu(e,n.data,i);let a=this.VideoSample,o,u=!1;n.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(c=>{var h,p;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,u){var v;(v=a)!=null&&v.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,oC(c.data,2,n.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=li(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(o=!0,u=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const y=this.readSPS(c.data);e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.codec=y.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const _ in y.params)e.params[_]=y.params[_]}this.pushParameterSet(e.sps,c.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const y=this.readPPS(c.data);for(const _ in y)e.params[_]=y[_]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:o=!1;break}a&&o&&a.units.push(c)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[n]=e[i],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Ev(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:i}}readSPS(e){const t=new Ev(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const i=t.readBits(2),s=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),u=t.readUByte(),c=t.readUByte(),h=t.readUByte(),p=t.readUByte(),v=t.readUByte(),y=t.readUByte(),_=t.readUByte(),A=t.readUByte(),E=t.readUByte(),T=t.readUByte(),M=[],R=[];for(let Ie=0;Ie<n;Ie++)M.push(t.readBoolean()),R.push(t.readBoolean());if(n>0)for(let Ie=n;Ie<8;Ie++)t.readBits(2);for(let Ie=0;Ie<n;Ie++)M[Ie]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),R[Ie]&&t.readUByte();t.readUEG();const L=t.readUEG();L==3&&t.skipBits(1);const w=t.readUEG(),N=t.readUEG(),O=t.readBoolean();let F=0,B=0,P=0,V=0;O&&(F+=t.readUEG(),B+=t.readUEG(),P+=t.readUEG(),V+=t.readUEG());const J=t.readUEG(),Q=t.readUEG(),ie=t.readUEG(),ne=t.readBoolean();for(let Ie=ne?0:n;Ie<=n;Ie++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let je=0;je<4;je++)for(let te=0;te<(je===3?2:6);te++)if(!t.readBoolean())t.readUEG();else{const $e=Math.min(64,1<<4+(je<<1));je>1&&t.readEG();for(let At=0;At<$e;At++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const j=t.readUEG();let se=0;for(let Ie=0;Ie<j;Ie++){let je=!1;if(Ie!==0&&(je=t.readBoolean()),je){Ie===j&&t.readUEG(),t.readBoolean(),t.readUEG();let te=0;for(let St=0;St<=se;St++){const $e=t.readBoolean();let At=!1;$e||(At=t.readBoolean()),($e||At)&&te++}se=te}else{const te=t.readUEG(),St=t.readUEG();se=te+St;for(let $e=0;$e<te;$e++)t.readUEG(),t.readBoolean();for(let $e=0;$e<St;$e++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ie=t.readUEG();for(let je=0;je<Ie;je++){for(let te=0;te<ie+4;te++)t.readBits(1);t.readBits(1)}}let Y=0,Z=1,le=1,pe=!0,Te=1,ce=0;t.readBoolean(),t.readBoolean();let Me=!1;if(t.readBoolean()){if(t.readBoolean()){const et=t.readUByte(),$=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],z=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];et>0&&et<16?(Z=$[et-1],le=z[et-1]):et===255&&(Z=t.readBits(16),le=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Me=t.readBoolean(),Me&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(Te=t.readBits(32),ce=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const z=t.readBoolean(),fe=t.readBoolean();let we=!1;(z||fe)&&(we=t.readBoolean(),we&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),we&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let He=0;He<=n;He++){pe=t.readBoolean();const Oe=pe||t.readBoolean();let Et=!1;Oe?t.readEG():Et=t.readBoolean();const it=Et?1:t.readUEG()+1;if(z)for(let vt=0;vt<it;vt++)t.readUEG(),t.readUEG(),we&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(fe)for(let vt=0;vt<it;vt++)t.readUEG(),t.readUEG(),we&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),Y=t.readUEG())}let nt=w,at=N;if(O){let Ie=1,je=1;L===1?Ie=je=2:L==2&&(Ie=2),nt=w-Ie*B-Ie*F,at=N-je*V-je*P}const Vt=i?["A","B","C"][i]:"",dn=o<<24|u<<16|c<<8|h;let Ut=0;for(let Ie=0;Ie<32;Ie++)Ut=(Ut|(dn>>Ie&1)<<31-Ie)>>>0;let Ne=Ut.toString(16);return a===1&&Ne==="2"&&(Ne="6"),{codecString:`hvc1.${Vt}${a}.${Ne}.${s?"H":"L"}${T}.B0`,params:{general_tier_flag:s,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[o,u,c,h],general_constraint_indicator_flags:[p,v,y,_,A,E],general_level_idc:T,bit_depth:J+8,bit_depth_luma_minus8:J,bit_depth_chroma_minus8:Q,min_spatial_segmentation_idc:Y,chroma_format_idc:L,frame_rate:{fixed:pe,fps:ce/Te}},width:nt,height:at,pixelRatio:[Z,le]}}readPPS(e){const t=new Ev(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),s=t.readBoolean();let a=1;return s&&i?a=0:s?a=3:i&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Hs=188;class Ef{constructor(e,t,n,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=i,this.videoParser=null}static probe(e,t){const n=Ef.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(Hs*5,t-Hs)+1,i=0;for(;i<n;){let s=!1,a=-1,o=0;for(let u=i;u<t;u+=Hs)if(e[u]===71&&(t-u===Hs||e[u+Hs]===71)){if(o++,a===-1&&(a=u,a!==0&&(n=Math.min(a+Hs*99,e.length-Hs)+1)),s||(s=I1(e,u)===0),s&&o>1&&(a===0&&o>2||u+Hs>n))return a}else{if(o)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:JB[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Ef.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=Ef.createTrack("audio",i),this._id3Track=Ef.createTrack("id3"),this._txtTrack=Ef.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,i=!1){n||(this.sampleAes=null);let s;const a=this._videoTrack,o=this._audioTrack,u=this._id3Track,c=this._txtTrack;let h=a.pid,p=a.pesData,v=o.pid,y=u.pid,_=o.pesData,A=u.pesData,E=null,T=this.pmtParsed,M=this._pmtId,R=e.length;if(this.remainderData&&(e=No(this.remainderData,e),R=e.length,this.remainderData=null),R<Hs&&!i)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:u,textTrack:c};const L=Math.max(0,Ef.syncOffset(e));R-=(R-L)%Hs,R<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,R,e.buffer.byteLength-R));let w=0;for(let O=L;O<R;O+=Hs)if(e[O]===71){const F=!!(e[O+1]&64),B=I1(e,O),P=(e[O+3]&48)>>4;let V;if(P>1){if(V=O+5+e[O+4],V===O+Hs)continue}else V=O+4;switch(B){case h:F&&(p&&(s=xm(p,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,c,s,!1)),p={data:[],size:0}),p&&(p.data.push(e.subarray(V,O+Hs)),p.size+=O+Hs-V);break;case v:if(F){if(_&&(s=xm(_,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break;case"ac3":this.parseAC3PES(o,s);break}_={data:[],size:0}}_&&(_.data.push(e.subarray(V,O+Hs)),_.size+=O+Hs-V);break;case y:F&&(A&&(s=xm(A,this.logger))&&this.parseID3PES(u,s),A={data:[],size:0}),A&&(A.data.push(e.subarray(V,O+Hs)),A.size+=O+Hs-V);break;case 0:F&&(V+=e[V]+1),M=this._pmtId=H7(e,V);break;case M:{F&&(V+=e[V]+1);const J=z7(e,V,this.typeSupported,n,this.observer,this.logger);h=J.videoPid,h>0&&(a.pid=h,a.segmentCodec=J.segmentVideoCodec),v=J.audioPid,v>0&&(o.pid=v,o.segmentCodec=J.segmentAudioCodec),y=J.id3Pid,y>0&&(u.pid=y),E!==null&&!T&&(this.logger.warn(`MPEG-TS PMT found at ${O} after unknown PID '${E}'. Backtracking to sync byte @${L} to parse all TS packets.`),E=null,O=L-188),T=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=B;break}}else w++;w>0&&w1(this.observer,new Error(`Found ${w} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=p,o.pesData=_,u.pesData=A;const N={audioTrack:o,videoTrack:a,id3Track:u,textTrack:c};return i&&this.extractRemainingSamples(N),N}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:i,textTrack:s}=e,a=n.pesData,o=t.pesData,u=i.pesData;let c;if(a&&(c=xm(a,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,s,c,!0),n.pesData=null)):n.pesData=a,o&&(c=xm(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;u&&(c=xm(u,this.logger))?(this.parseID3PES(i,c),i.pesData=null):i.pesData=u}demuxSampleAes(e,t,n){const i=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new F7(this.observer,this.config,t);return this.decrypt(i,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new k7:e==="hevc"&&(this.videoParser=new G7))}decrypt(e,t){return new Promise(n=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const p=i.missing,v=i.sample.unit.byteLength;if(p===-1)s=No(i.sample.unit,s);else{const y=v-p;i.sample.unit.set(s.subarray(0,p),y),e.samples.push(i.sample),n=i.missing}}let a,o;for(a=n,o=s.length;a<o-1&&!pA(s,a);a++);if(a!==n){let p;const v=a<o-1;if(v?p=`AAC PES did not start with ADTS header,offset:${a}`:p="No ADTS header found in AAC PES",w1(this.observer,new Error(p),v,this.logger),!v)return}OO(e,this.observer,s,a,this.audioCodec);let u;if(t.pts!==void 0)u=t.pts;else if(i){const p=PO(e.samplerate);u=i.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,h;for(;a<o;)if(h=NO(e,s,a,u,c),a+=h.length,h.missing){this.aacOverFlow=h;break}else for(c++;a<o-1&&!pA(s,a);a++);}parseMPEGPES(e,t){const n=t.data,i=n.length;let s=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(HO(n,a)){const u=kO(e,n,a,o,s);if(u)a+=u.length,s++;else break}else a++}parseAC3PES(e,t){{const n=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=n.length;let a=0,o=0,u;for(;o<s&&(u=KO(e,n,o,i,a++))>0;)o+=u}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=li({},t,{type:this._videoTrack?ya.emsg:ya.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function I1(r,e){return((r[e+1]&31)<<8)+r[e+2]}function H7(r,e){return(r[e+10]&31)<<8|r[e+11]}function z7(r,e,t,n,i,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(r[e+1]&15)<<8|r[e+2],u=e+3+o-4,c=(r[e+10]&15)<<8|r[e+11];for(e+=12+c;e<u;){const h=I1(r,e),p=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!n){Cb("ADTS AAC",s);break}case 15:a.audioPid===-1&&(a.audioPid=h);break;case 21:a.id3Pid===-1&&(a.id3Pid=h);break;case 219:if(!n){Cb("H.264",s);break}case 27:a.videoPid===-1&&(a.videoPid=h);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=h,a.segmentAudioCodec="mp3");break;case 193:if(!n){Cb("AC-3",s);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=h,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&p>0){let v=e+5,y=p;for(;y>2;){switch(r[v]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=h,a.segmentAudioCodec="ac3");break}const A=r[v+1]+2;v+=A,y-=A}}break;case 194:case 135:return w1(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:a.videoPid===-1&&(a.videoPid=h,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=p+5}return a}function w1(r,e,t,n){n.warn(`parsing error: ${e.message}`),r.emit(H.ERROR,H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Cb(r,e){e.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function xm(r,e){let t=0,n,i,s,a,o;const u=r.data;if(!r||r.size===0)return null;for(;u[0].length<19&&u.length>1;)u[0]=No(u[0],u[1]),u.splice(1,1);if(n=u[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(i=(n[4]<<8)+n[5],i&&i>r.size-6)return null;const h=n[7];h&192&&(a=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,h&64?(o=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),s=n[8];let p=s+9;if(r.size<=p)return null;r.size-=p;const v=new Uint8Array(r.size);for(let y=0,_=u.length;y<_;y++){n=u[y];let A=n.byteLength;if(p)if(p>A){p-=A;continue}else n=n.subarray(p),A-=p,p=0;v.set(n,t),t+=A}return i&&(i-=s+3),{data:v,pts:a,dts:o,len:i}}return null}class V7{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const xf=Math.pow(2,32)-1;class xe{static init(){xe.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in xe.types)xe.types.hasOwnProperty(e)&&(xe.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);xe.HDLR_TYPES={video:t,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);xe.STTS=xe.STSC=xe.STCO=s,xe.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),xe.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),xe.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),xe.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);xe.FTYP=xe.box(xe.types.ftyp,a,u,a,o),xe.DINF=xe.box(xe.types.dinf,xe.box(xe.types.dref,i))}static box(e,...t){let n=8,i=t.length;const s=i;for(;i--;)n+=t[i].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=n&255,a.set(e,4),i=0,n=8;i<s;i++)a.set(t[i],n),n+=t[i].byteLength;return a}static hdlr(e){return xe.box(xe.types.hdlr,xe.HDLR_TYPES[e])}static mdat(e){return xe.box(xe.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(xf+1)),i=Math.floor(t%(xf+1));return xe.box(xe.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return xe.box(xe.types.mdia,xe.mdhd(e.timescale||0,e.duration||0),xe.hdlr(e.type),xe.minf(e))}static mfhd(e){return xe.box(xe.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?xe.box(xe.types.minf,xe.box(xe.types.smhd,xe.SMHD),xe.DINF,xe.stbl(e)):xe.box(xe.types.minf,xe.box(xe.types.vmhd,xe.VMHD),xe.DINF,xe.stbl(e))}static moof(e,t,n){return xe.box(xe.types.moof,xe.mfhd(e),xe.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=xe.trak(e[t]);return xe.box.apply(null,[xe.types.moov,xe.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(xe.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=xe.trex(e[t]);return xe.box.apply(null,[xe.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(xf+1)),i=Math.floor(t%(xf+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return xe.box(xe.types.mvhd,s)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,n[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return xe.box(xe.types.sdtp,n)}static stbl(e){return xe.box(xe.types.stbl,xe.stsd(e),xe.box(xe.types.stts,xe.STTS),xe.box(xe.types.stsc,xe.STSC),xe.box(xe.types.stsz,xe.STSZ),xe.box(xe.types.stco,xe.STCO))}static avc1(e){let t=[],n=[],i,s,a;for(i=0;i<e.sps.length;i++)s=e.sps[i],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],a=s.byteLength,n.push(a>>>8&255),n.push(a&255),n=n.concat(Array.prototype.slice.call(s));const o=xe.box(xe.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),u=e.width,c=e.height,h=e.pixelRatio[0],p=e.pixelRatio[1];return xe.box(xe.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,xe.box(xe.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),xe.box(xe.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return xe.box(xe.types.mp4a,xe.audioStsd(e),xe.box(xe.types.esds,xe.esds(e)))}static mp3(e){return xe.box(xe.types[".mp3"],xe.audioStsd(e))}static ac3(e){return xe.box(xe.types["ac-3"],xe.audioStsd(e),xe.box(xe.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return xe.box(xe.types.stsd,xe.STSD,xe.mp4a(e));if(t==="ac3"&&e.config)return xe.box(xe.types.stsd,xe.STSD,xe.ac3(e));if(t==="mp3"&&e.codec==="mp3")return xe.box(xe.types.stsd,xe.STSD,xe.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return xe.box(xe.types.stsd,xe.STSD,xe.avc1(e));if(t==="hevc"&&e.vps)return xe.box(xe.types.stsd,xe.STSD,xe.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),i=e.width||0,s=e.height||0,a=Math.floor(n/(xf+1)),o=Math.floor(n%(xf+1));return xe.box(xe.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const n=xe.sdtp(e),i=e.id,s=Math.floor(t/(xf+1)),a=Math.floor(t%(xf+1));return xe.box(xe.types.traf,xe.box(xe.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),xe.box(xe.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),xe.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,xe.box(xe.types.trak,xe.tkhd(e),xe.mdia(e))}static trex(e){const t=e.id;return xe.box(xe.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],i=n.length,s=12+16*i,a=new Uint8Array(s);let o,u,c,h,p,v;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<i;o++)u=n[o],c=u.duration,h=u.size,p=u.flags,v=u.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*o);return xe.box(xe.types.trun,a)}static initSegment(e){xe.types||xe.init();const t=xe.moov(e);return No(xe.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],i=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let a=s.length;for(let _=0;_<n.length;_+=1){a+=3;for(let A=0;A<n[_].length;A+=1)a+=2+n[_][A].length}const o=new Uint8Array(a);o.set(s,0),a=s.length;const u=n.length-1;for(let _=0;_<n.length;_+=1){o.set(new Uint8Array([32+_|(_===u?128:0),0,n[_].length]),a),a+=3;for(let A=0;A<n[_].length;A+=1)o.set(new Uint8Array([n[_][A].length>>8,n[_][A].length&255]),a),a+=2,o.set(n[_][A],a),a+=n[_][A].length}const c=xe.box(xe.types.hvcC,o),h=e.width,p=e.height,v=e.pixelRatio[0],y=e.pixelRatio[1];return xe.box(xe.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,xe.box(xe.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),xe.box(xe.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,y>>24,y>>16&255,y>>8&255,y&255])))}}xe.types=void 0;xe.HDLR_TYPES=void 0;xe.STTS=void 0;xe.STSC=void 0;xe.STCO=void 0;xe.STSZ=void 0;xe.VMHD=void 0;xe.SMHD=void 0;xe.STSD=void 0;xe.FTYP=void 0;xe.DINF=void 0;const XO=9e4;function AC(r,e,t=1,n=!1){const i=r*e*t;return n?Math.round(i):i}function K7(r,e,t=1,n=!1){return AC(r,e,1/t,n)}function nv(r,e=!1){return AC(r,1e3,1/XO,e)}function Y7(r,e=1){return AC(r,XO,1/e)}function zI(r){const{baseTime:e,timescale:t,trackId:n}=r;return`${e/t} (${e}/${t}) trackId: ${n}`}const X7=10*1e3,q7=1024,W7=1152,j7=1536;let Sm=null,Rb=null;function VI(r,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class Qx extends ko{constructor(e,t,n,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,Sm===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Sm=a?parseInt(a[1]):0}if(Rb===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Rb=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&zI(t)} > ${e&&zI(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,i=e.reduce((s,a)=>{let o=a.pts,u=o-s;return u<-4294967296&&(t=!0,o=za(o,n),u=o-s),u>0?s:o},n);return t&&this.debug("PTS rollover detected"),i}remux(e,t,n,i,s,a,o,u){let c,h,p,v,y,_,A=s,E=s;const T=e.pid>-1,M=t.pid>-1,R=t.samples.length,L=e.samples.length>0,w=o&&R>0||R>1;if((!T||L)&&(!M||w)||this.ISGenerated||o){if(this.ISGenerated){var O,F,B,P;const ie=this.videoTrackConfig;(ie&&(t.width!==ie.width||t.height!==ie.height||((O=t.pixelRatio)==null?void 0:O[0])!==((F=ie.pixelRatio)==null?void 0:F[0])||((B=t.pixelRatio)==null?void 0:B[1])!==((P=ie.pixelRatio)==null?void 0:P[1]))||!ie&&w||this.nextAudioTs===null&&L)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,s,a));const V=this.isVideoContiguous;let J=-1,Q;if(w&&(J=J7(t.samples),!V&&this.config.forceKeyFrameOnDiscontinuity))if(_=!0,J>0){this.warn(`Dropped ${J} out of ${R} video samples due to a missing keyframe`);const ie=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(J),t.dropped+=J,E+=(t.samples[0].pts-ie)/t.inputTimeScale,Q=E}else J===-1&&(this.warn(`No keyframe found out of ${R} video samples`),_=!1);if(this.ISGenerated){if(L&&w){const ie=this.getVideoStartPts(t.samples),k=(za(e.samples[0].pts,ie)-ie)/t.inputTimeScale;A+=Math.max(0,k),E+=Math.max(0,-k)}if(L){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(e,t,s,a)),h=this.remuxAudio(e,A,this.isAudioContiguous,a,M||w||u===Tt.AUDIO?E:void 0),w){const ie=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(e,t,s,a)),c=this.remuxVideo(t,E,V,ie)}}else w&&(c=this.remuxVideo(t,E,V,0));c&&(c.firstKeyFrame=J,c.independent=J!==-1,c.firstKeyFramePTS=Q)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(y=qO(n,s,this._initPTS,this._initDTS)),i.samples.length&&(v=WO(i,s,this._initPTS))),{audio:h,video:c,initSegment:p,independent:_,text:v,id3:y}}computeInitPts(e,t,n,i){const s=Math.round(n*t);let a=za(e,s);if(a<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-a)/t} ${i}`);a<s+t;)a+=8589934592;return a-s}generateIS(e,t,n,i){const s=e.samples,a=t.samples,o=this.typeSupported,u={},c=this._initPTS;let h=!c||i,p="audio/mp4",v,y,_,A=-1;if(h&&(v=y=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(p="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}u.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):xe.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(A=e.id,_=e.inputTimeScale,!c||_!==c.timescale?v=y=this.computeInitPts(s[0].pts,_,n,"audio"):h=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:xe.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(A=t.id,_=t.inputTimeScale,!c||_!==c.timescale){const E=this.getVideoStartPts(a),T=za(a[0].dts,E),M=this.computeInitPts(T,_,n,"video"),R=this.computeInitPts(E,_,n,"video");y=Math.min(y,M),v=Math.min(v,R)}else h=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(u).length)return this.ISGenerated=!0,h?(c&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${n} ${v/_} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${v/_} (${v}/${_}) trackId: ${A}`),this._initPTS={baseTime:v,timescale:_,trackId:A},this._initDTS={baseTime:y,timescale:_,trackId:A}):v=_=void 0,{tracks:u,initPTS:v,timescale:_,trackId:A}}remuxVideo(e,t,n,i){const s=e.inputTimeScale,a=e.samples,o=[],u=a.length,c=this._initPTS,h=c.baseTime*s/c.timescale;let p=this.nextVideoTs,v=8,y=this.videoSampleDuration,_,A,E=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,M=!1;if(!n||p===null){const Y=h+t*s,Z=a[0].pts-za(a[0].dts,a[0].pts);Sm&&p!==null&&Math.abs(Y-Z-(p+h))<15e3?n=!0:p=Y-Z-h}const R=p+h;for(let Y=0;Y<u;Y++){const Z=a[Y];Z.pts=za(Z.pts,R),Z.dts=za(Z.dts,R),Z.dts<a[Y>0?Y-1:Y].dts&&(M=!0)}M&&a.sort(function(Y,Z){const le=Y.dts-Z.dts,pe=Y.pts-Z.pts;return le||pe}),_=a[0].dts,A=a[a.length-1].dts;const L=A-_,w=L?Math.round(L/(u-1)):y||e.inputTimeScale/30;if(n){const Y=_-R,Z=Y>w,le=Y<-1;if((Z||le)&&(Z?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${nv(Y,!0)} ms (${Y}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${nv(-Y,!0)} ms (${Y}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!le||R>=a[0].pts||Sm)){_=R;const pe=a[0].pts-Y;if(Z)a[0].dts=_,a[0].pts=pe;else{let Te=!0;for(let ce=0;ce<a.length&&!(a[ce].dts>pe&&Te);ce++){const Me=a[ce].pts;if(a[ce].dts-=Y,a[ce].pts-=Y,ce<a.length-1){const Xe=a[ce+1].pts,nt=a[ce].pts,at=Xe<=nt,Vt=Xe<=Me;Te=at==Vt}}}this.log(`Video: Initial PTS/DTS adjusted: ${nv(pe,!0)}/${nv(_,!0)}, delta: ${nv(Y,!0)} ms`)}}_=Math.max(0,_);let N=0,O=0,F=_;for(let Y=0;Y<u;Y++){const Z=a[Y],le=Z.units,pe=le.length;let Te=0;for(let ce=0;ce<pe;ce++)Te+=le[ce].data.length;O+=Te,N+=pe,Z.length=Te,Z.dts<F?(Z.dts=F,F+=w/4|0||1):F=Z.dts,E=Math.min(Z.pts,E),T=Math.max(Z.pts,T)}A=a[u-1].dts;const B=O+4*N+8;let P;try{P=new Uint8Array(B)}catch(Y){this.observer.emit(H.ERROR,H.ERROR,{type:Lt.MUX_ERROR,details:Se.REMUX_ALLOC_ERROR,fatal:!1,error:Y,bytes:B,reason:`fail allocating video mdat ${B}`});return}const V=new DataView(P.buffer);V.setUint32(0,B),P.set(xe.types.mdat,4);let J=!1,Q=Number.POSITIVE_INFINITY,ie=Number.POSITIVE_INFINITY,ne=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY;for(let Y=0;Y<u;Y++){const Z=a[Y],le=Z.units;let pe=0;for(let Me=0,Xe=le.length;Me<Xe;Me++){const nt=le[Me],at=nt.data,Vt=nt.data.byteLength;V.setUint32(v,Vt),v+=4,P.set(at,v),v+=Vt,pe+=4+Vt}let Te;if(Y<u-1)y=a[Y+1].dts-Z.dts,Te=a[Y+1].pts-Z.pts;else{const Me=this.config,Xe=Y>0?Z.dts-a[Y-1].dts:w;if(Te=Y>0?Z.pts-a[Y-1].pts:w,Me.stretchShortVideoTrack&&this.nextAudioTs!==null){const nt=Math.floor(Me.maxBufferHole*s),at=(i?E+i*s:this.nextAudioTs+h)-Z.pts;at>nt?(y=at-Xe,y<0?y=Xe:J=!0,this.log(`It is approximately ${at/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=Xe}else y=Xe}const ce=Math.round(Z.pts-Z.dts);Q=Math.min(Q,y),ne=Math.max(ne,y),ie=Math.min(ie,Te),k=Math.max(k,Te),o.push(VI(Z.key,y,pe,ce))}if(o.length){if(Sm){if(Sm<70){const Y=o[0].flags;Y.dependsOn=2,Y.isNonSync=0}}else if(Rb&&k-ie<ne-Q&&w/ne<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let Y=_;for(let Z=0,le=o.length;Z<le;Z++){const pe=Y+o[Z].duration,Te=Y+o[Z].cts;if(Z<le-1){const ce=pe+o[Z+1].cts;o[Z].duration=ce-Te}else o[Z].duration=Z?o[Z-1].duration:w;o[Z].cts=0,Y=pe}}}y=J||!y?w:y;const K=A+y;this.nextVideoTs=p=K-h,this.videoSampleDuration=y,this.isVideoContiguous=!0;const oe={data1:xe.moof(e.sequenceNumber++,_,li(e,{samples:o})),data2:P,startPTS:(E-h)/s,endPTS:(T+y-h)/s,startDTS:(_-h)/s,endDTS:p/s,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,oe}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return W7;case"ac3":return j7;default:return q7}}remuxAudio(e,t,n,i,s){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,u=a/o,c=this.getSamplesPerFrame(e),h=c*u,p=this._initPTS,v=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,y=[],_=s!==void 0;let A=e.samples,E=v?0:8,T=this.nextAudioTs||-1;const M=p.baseTime*a/p.timescale,R=M+t*a;if(this.isAudioContiguous=n=n||A.length&&T>0&&(i&&Math.abs(R-(T+M))<9e3||Math.abs(za(A[0].pts,R)-(T+M))<20*h),A.forEach(function(k){k.pts=za(k.pts,R)}),!n||T<0){const k=A.length;if(A=A.filter(K=>K.pts>=0),k!==A.length&&this.warn(`Removed ${A.length-k} of ${k} samples (initPTS ${M} / ${a})`),!A.length)return;s===0?T=0:i&&!_?T=Math.max(0,R-M):T=A[0].pts-M}if(e.segmentCodec==="aac"){const k=this.config.maxAudioFramesDrift;for(let K=0,j=T+M;K<A.length;K++){const se=A[K],oe=se.pts,Y=oe-j,Z=Math.abs(1e3*Y/a);if(Y<=-k*h&&_)K===0&&(this.warn(`Audio frame @ ${(oe/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*Y/a)} ms.`),this.nextAudioTs=T=oe-M,j=oe);else if(Y>=k*h&&Z<X7&&_){let le=Math.round(Y/h);for(j=oe-le*h;j<0&&le&&h;)le--,j+=h;K===0&&(this.nextAudioTs=T=j-M),this.warn(`Injecting ${le} audio frames @ ${((j-M)/a).toFixed(3)}s due to ${Math.round(1e3*Y/a)} ms gap.`);for(let pe=0;pe<le;pe++){let Te=V7.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Te||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Te=se.unit.subarray()),A.splice(K,0,{unit:Te,pts:j}),j+=h,K++}}se.pts=j,j+=h}}let L=null,w=null,N,O=0,F=A.length;for(;F--;)O+=A[F].unit.byteLength;for(let k=0,K=A.length;k<K;k++){const j=A[k],se=j.unit;let oe=j.pts;if(w!==null){const Z=y[k-1];Z.duration=Math.round((oe-w)/u)}else if(n&&e.segmentCodec==="aac"&&(oe=T+M),L=oe,O>0){O+=E;try{N=new Uint8Array(O)}catch(Z){this.observer.emit(H.ERROR,H.ERROR,{type:Lt.MUX_ERROR,details:Se.REMUX_ALLOC_ERROR,fatal:!1,error:Z,bytes:O,reason:`fail allocating audio mdat ${O}`});return}v||(new DataView(N.buffer).setUint32(0,O),N.set(xe.types.mdat,4))}else return;N.set(se,E);const Y=se.byteLength;E+=Y,y.push(VI(!0,c,Y,0)),w=oe}const B=y.length;if(!B)return;const P=y[y.length-1];T=w-M,this.nextAudioTs=T+u*P.duration;const V=v?new Uint8Array(0):xe.moof(e.sequenceNumber++,L/u,li({},e,{samples:y}));e.samples=[];const J=(L-M)/a,Q=this.nextAudioTs/a,ne={data1:V,data2:N,startPTS:J,endPTS:Q,startDTS:J,endDTS:Q,type:"audio",hasAudio:!0,hasVideo:!1,nb:B};return this.isAudioContiguous=!0,ne}}function za(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function J7(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function qO(r,e,t,n){const i=r.samples.length;if(!i)return;const s=r.inputTimeScale;for(let o=0;o<i;o++){const u=r.samples[o];u.pts=za(u.pts-t.baseTime*s/t.timescale,e*s)/s,u.dts=za(u.dts-n.baseTime*s/n.timescale,e*s)/s}const a=r.samples;return r.samples=[],{samples:a}}function WO(r,e,t){const n=r.samples.length;if(!n)return;const i=r.inputTimeScale;for(let a=0;a<n;a++){const o=r.samples[a];o.pts=za(o.pts-t.baseTime*i/t.timescale,e*i)/i}r.samples.sort((a,o)=>a.pts-o.pts);const s=r.samples;return r.samples=[],{samples:s}}class Q7 extends ko{constructor(e,t,n,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:a}=this.initData=ZB(e);if(t)H9(e,t);else{const u=s||a;u!=null&&u.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${u.codec}")!`)}s&&(n=KI(s,gi.AUDIO,this)),a&&(i=KI(a,gi.VIDEO,this));const o={};s&&a?o.audiovideo={container:"video/mp4",codec:n+","+i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:s?o.audio={container:"audio/mp4",codec:n,encrypted:s.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,n,i,s,a){var o,u;let{initPTS:c,lastEndTime:h}=this;const p={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};yt(h)||(h=this.lastEndTime=s||0);const v=t.samples;if(!v.length)return p;const y={initPTS:void 0,timescale:void 0,trackId:void 0};let _=this.initData;if((o=_)!=null&&o.length||(this.generateInitSegment(v),_=this.initData),!((u=_)!=null&&u.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);const A=V9(v,_,this),E=_.audio?A[_.audio.id]:null,T=_.video?A[_.video.id]:null,M=Bx(T,1/0),R=Bx(E,1/0),L=Bx(T,0,!0),w=Bx(E,0,!0);let N=s,O=0;const F=E&&(!T||!c&&R<M||c&&c.trackId===_.audio.id),B=F?E:T;if(B){const j=B.timescale,se=B.start-s*j,oe=F?_.audio.id:_.video.id;N=B.start/j,O=F?w-R:L-M,(a||!c)&&($7(c,N,s,O)||j!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${s} ${se/j} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${N-s} (${se}/${j}) trackId: ${oe}`),c=null,y.initPTS=se,y.timescale=j,y.trackId=oe)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);c?(y.initPTS=c.baseTime,y.timescale=c.timescale,y.trackId=c.trackId):((!y.timescale||y.trackId===void 0||y.initPTS===void 0)&&(this.warn("Could not set initPTS"),y.initPTS=N,y.timescale=1,y.trackId=-1),this.initPTS=c={baseTime:y.initPTS,timescale:y.timescale,trackId:y.trackId});const P=N-c.baseTime/c.timescale,V=P+O;O>0?this.lastEndTime=V:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const J=!!_.audio,Q=!!_.video;let ie="";J&&(ie+="audio"),Q&&(ie+="video");const ne=(_.audio?_.audio.encrypted:!1)||(_.video?_.video.encrypted:!1),k={data1:v,startPTS:P,startDTS:P,endPTS:V,endDTS:V,type:ie,hasAudio:J,hasVideo:Q,nb:1,dropped:0,encrypted:ne};p.audio=J&&!Q?k:void 0,p.video=Q?k:void 0;const K=T?.sampleCount;if(K){const j=T.keyFrameIndex,se=j!==-1;k.nb=K,k.dropped=j===0||this.isVideoContiguous?0:se?j:K,k.independent=se,k.firstKeyFrame=j,se&&T.keyFrameStart&&(k.firstKeyFramePTS=(T.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(p.independent=se),this.isVideoContiguous||(this.isVideoContiguous=se),k.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${j}/${K} dropped: ${k.dropped} start: ${k.firstKeyFramePTS||"NA"}`)}return p.initSegment=y,p.id3=qO(n,s,c,c),i.samples.length&&(p.text=WO(i,s,c)),p}}function Bx(r,e,t=!1){return r?.start!==void 0?(r.start+(t?r.duration:0))/r.timescale:e}function $7(r,e,t,n){if(r===null)return!0;const i=Math.max(n,1),s=e-r.baseTime/r.timescale;return Math.abs(s-t)>i}function KI(r,e,t){const n=r.codec;return n&&n.length>4?n:e===gi.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?aA(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let hc;try{hc=self.performance.now.bind(self.performance)}catch{hc=Date.now}const $x=[{demux:U7,remux:Q7},{demux:Ef,remux:Qx},{demux:B7,remux:Qx},{demux:P7,remux:Qx}];$x.splice(2,0,{demux:O7,remux:Qx});class YI{constructor(e,t,n,i,s,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=s,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,i){const s=n.transmuxing;s.executeStart=hc();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:u}=this;i&&(this.currentTransmuxState=i);const{contiguous:c,discontinuity:h,trackSwitch:p,accurateTimeOffset:v,timeOffset:y,initSegmentChange:_}=i||o,{audioCodec:A,videoCodec:E,defaultInitPts:T,duration:M,initSegmentData:R}=u,L=Z7(a,t);if(L&&Om(L.method)){const F=this.getDecrypter(),B=dC(L.method);if(F.isSync()){let P=F.softwareDecrypt(a,L.key.buffer,L.iv.buffer,B);if(n.part>-1){const J=F.flush();P=J&&J.buffer}if(!P)return s.executeEnd=hc(),Db(n);a=new Uint8Array(P)}else return this.asyncResult=!0,this.decryptionPromise=F.webCryptoDecrypt(a,L.key.buffer,L.iv.buffer,B).then(P=>{const V=this.push(P,null,n);return this.decryptionPromise=null,V}),this.decryptionPromise}const w=this.needsProbing(h,p);if(w){const F=this.configureTransmuxer(a);if(F)return this.logger.warn(`[transmuxer] ${F.message}`),this.observer.emit(H.ERROR,H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.FRAG_PARSING_ERROR,fatal:!1,error:F,reason:F.message}),s.executeEnd=hc(),Db(n)}(h||p||_||w)&&this.resetInitSegment(R,A,E,M,t),(h||_||w)&&this.resetInitialTimestamp(T),c||this.resetContiguity();const N=this.transmux(a,L,y,v,n);this.asyncResult=Kv(N);const O=this.currentTransmuxState;return O.contiguous=!0,O.discontinuity=!1,O.trackSwitch=!1,s.executeEnd=hc(),N}flush(e){const t=e.transmuxing;t.executeStart=hc();const{decrypter:n,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const a=[],{timeOffset:o}=i;if(n){const p=n.flush();p&&a.push(this.push(p.buffer,null,e))}const{demuxer:u,remuxer:c}=this;if(!u||!c){t.executeEnd=hc();const p=[Db(e)];return this.asyncResult?Promise.resolve(p):p}const h=u.flush(o);return Kv(h)?(this.asyncResult=!0,h.then(p=>(this.flushRemux(a,p,e),a))):(this.flushRemux(a,h,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,n){const{audioTrack:i,videoTrack:s,id3Track:a,textTrack:o}=t,{accurateTimeOffset:u,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===Tt.MAIN?"level":"track"} ${n.level}`);const h=this.remuxer.remux(i,s,a,o,c,u,!0,this.id);e.push({remuxResult:h,chunkMeta:n}),n.transmuxing.executeEnd=hc()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,i,s){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,n,i),o.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,i,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,n,i,s):a=this.transmuxUnencrypted(e,n,i,s),a}transmuxUnencrypted(e,t,n,i){const{audioTrack:s,videoTrack:a,id3Track:o,textTrack:u}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,o,u,t,n,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,n,i,s){return this.demuxer.demuxSampleAes(e,t,n).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,n,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:i}=this;let s;for(let p=0,v=$x.length;p<v;p++){var a;if((a=$x[p].demux)!=null&&a.probe(e,this.logger)){s=$x[p];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,u=this.remuxer,c=s.remux,h=s.demux;(!u||!(u instanceof c))&&(this.remuxer=new c(n,t,i,this.logger)),(!o||!(o instanceof h))&&(this.demuxer=new h(n,t,i,this.logger),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new fC(this.config)),e}}function Z7(r,e){let t=null;return r.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Db=r=>({remuxResult:{},chunkMeta:r});function Kv(r){return"then"in r&&r.then instanceof Function}class eK{constructor(e,t,n,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=i,this.defaultInitPts=s||null}}class tK{constructor(e,t,n,i,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=a}}let XI=0;class jO{constructor(e,t,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=XI++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=u=>{const c=u.data,h=this.hls;if(!(!h||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var p;const v=(p=this.workerContext)==null?void 0:p.objectURL;v&&self.URL.revokeObjectURL(v);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{h.logger[c.data.logType]&&h.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,h.trigger(c.event,c.data);break}}},this.onWorkerError=u=>{if(!this.hls)return;const c=new Error(`${u.message}  (${u.filename}:${u.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(H.ERROR,{type:Lt.OTHER_ERROR,details:Se.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const a=(u,c)=>{c=c||{},c.frag=this.frag||void 0,u===H.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(u,c)};this.observer=new gC,this.observer.on(H.FRAG_DECRYPTED,a),this.observer.on(H.ERROR,a);const o=lI(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const u=this.hls.logger;if(s.workerPath||r7()){try{s.workerPath?(u.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=o7(s.workerPath)):(u.log(`injecting Web Worker for "${t}"`),this.workerContext=a7());const{worker:h}=this.workerContext;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:vi(s)})}catch(h){u.warn(`Error setting up "${t}" Web Worker, fallback to inline`,h),this.terminateWorker(),this.error=null,this.transmuxer=new YI(this.observer,o,s,"",t,e.logger)}return}}this.transmuxer=new YI(this.observer,o,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=XI++;const t=this.hls.config,n=lI(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:vi(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),l7(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,i,s,a,o,u,c,h){var p,v;c.transmuxing.start=self.performance.now();const{instanceNo:y,transmuxer:_}=this,A=a?a.start:s.start,E=s.decryptdata,T=this.frag,M=!(T&&s.cc===T.cc),R=!(T&&c.level===T.level),L=T?c.sn-T.sn:-1,w=this.part?c.part-this.part.index:-1,N=L===0&&c.id>1&&c.id===T?.stats.chunkCount,O=!R&&(L===1||L===0&&(w===1||N&&w<=0)),F=self.performance.now();(R||L||s.stats.parsing.start===0)&&(s.stats.parsing.start=F),a&&(w||!O)&&(a.stats.parsing.start=F);const B=!(T&&((p=s.initSegment)==null?void 0:p.url)===((v=T.initSegment)==null?void 0:v.url)),P=new tK(M,O,u,R,A,B);if(!O||M||B){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===Tt.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${M}
        trackSwitch: ${R}
        contiguous: ${O}
        accurateTimeOffset: ${u}
        timeOffset: ${A}
        initSegmentChange: ${B}`);const V=new eK(n,i,t,o,h);this.configureTransmuxer(V)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:y,cmd:"demux",data:e,decryptdata:E,chunkMeta:c,state:P},e instanceof ArrayBuffer?[e]:[]);else if(_){const V=_.push(e,E,c,P);Kv(V)?V.then(J=>{this.handleTransmuxComplete(J)}).catch(J=>{this.transmuxerError(J,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(V)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const i=n.flush(e);Kv(i)?i.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const qI=100;class JO extends fE{constructor(e,t,n){super(e,t,n,"audio-stream-controller",Tt.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(H.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(H.BUFFER_RESET,this.onBufferReset,this),e.on(H.BUFFER_CREATED,this.onBufferCreated,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(H.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(H.FRAG_LOADING,this.onFragLoading,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(H.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(H.BUFFER_RESET,this.onBufferReset,this),e.off(H.BUFFER_CREATED,this.onBufferCreated,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(H.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(H.FRAG_LOADING,this.onFragLoading,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s,trackId:a}){if(n===Tt.MAIN){const o=t.cc,u=this.fragCurrent;if(this.initPTS[o]={baseTime:i,timescale:s,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${i/s} (${i}/${s}) trackId: ${a}`),this.mainAnchor=t,this.state===ke.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==o)&&this.syncWithAnchor(t,c?.frag)}else!this.hls.hasEnoughToStart&&u&&u.cc!==o?(u.abortRequests(),this.syncWithAnchor(t,u)):this.state===ke.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const i=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&i?.cc===t.cc)return;const s=(i||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),u=fO(a,s,o);u&&(this.log(`Syncing with main frag at ${u.start} cc ${u.cc}`),this.startFragRequested=!1,this.nextLoadPosition=u.start,this.resetLoadingState(),this.state===ke.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ke.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(qI),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=ke.IDLE):this.state=ke.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ke.IDLE:this.doTickIdle();break;case ke.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e?.[t],i=n?.details;if(i&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(i))break;this.state=ke.WAITING_INIT_PTS}break}case ke.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ke.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:i,complete:s}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ke.FRAG_LOADING;const o=i.flush().buffer,u={frag:t,part:n,payload:o,networkDetails:null};this._handleFragmentLoadProgress(u),s&&super._handleFragmentLoadComplete(u)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=ke.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:i,trackId:s}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(n!=null&&n[s]))return;const o=n[s],u=o.details;if(!u||this.waitForLive(o)||this.waitForCdnTuneIn(u)){this.state=ke.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,gi.AUDIO,Tt.AUDIO));const h=this.getFwdBufferInfo(c,Tt.AUDIO);if(h===null)return;if(!this.switchingTrack&&this._streamEnded(h,u)){t.trigger(H.BUFFER_EOS,{type:"audio"}),this.state=ke.ENDED;return}const p=h.len,v=t.maxBufferLength,y=u.fragments,_=y[0].start,A=this.getLoadPosition(),E=this.flushing?A:h.end;if(this.switchingTrack&&i){const R=A;u.PTSKnown&&R<_&&(h.end>_||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=_+.05)}if(p>=v&&!this.switchingTrack&&E<y[y.length-1].start)return;let T=this.getNextFragment(E,u);if(T&&this.isLoopLoading(T,E)&&(T=this.getNextFragmentLoopLoading(T,u,h,Tt.MAIN,v)),!T){this.bufferFlushed=!0;return}let M=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&M&&rs(T)&&!T.endList&&(!u.live||!this.loadingParts&&E<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(M)===Cs.OK&&(this.mainFragLoading=M=null),M&&rs(M))){if(T.start>M.end){const L=this.fragmentTracker.getFragAtPos(E,Tt.MAIN);L&&L.end>M.end&&(M=L,this.mainFragLoading={frag:L,targetBufferTime:null})}if(T.start>M.end)return}this.loadFragment(T,o,E)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new $m(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ke.STOPPED&&(this.setInterval(qI),this.state=ke.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(H.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:i}=this,{details:s,id:a,groupId:o,track:u}=t;if(!i){this.warn(`Audio tracks reset while loading track ${a} "${u.name}" of "${o}"`);return}const c=this.mainDetails;if(!c||s.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==ke.STOPPED&&(this.state=ke.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${u.name}" of "${o}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const h=i[a];let p=0;if(s.live||(n=h.details)!=null&&n.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(h.details){var v;p=this.alignPlaylists(s,h.details,(v=this.levelLastLoaded)==null?void 0:v.details)}s.alignedSliding||(DO(s,c),s.alignedSliding||dA(s,c),p=s.fragmentStart)}h.details=s,this.levelLastLoaded=h,this.startFragRequested||this.setStartPosition(c,p),this.hls.trigger(H.AUDIO_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.state===ke.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=ke.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:s}=e,{config:a,trackId:o,levels:u}=this;if(!u){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=u[o];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const h=c.details;if(!h){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const p=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let v=this.transmuxer;v||(v=this.transmuxer=new jO(this.hls,Tt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const y=this.initPTS[n.cc],_=(t=n.initSegment)==null?void 0:t.data;if(y!==void 0){const E=i?i.index:-1,T=E!==-1,M=new cE(n.level,n.sn,n.stats.chunkCount,s.byteLength,E,T);v.push(s,_,p,"",n,i,h.totalduration,!1,M,y)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${h.startSN} ,${h.endSN}],track ${o}`);const{cache:A}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new LO,complete:!1};A.push(new Uint8Array(s)),this.state!==ke.STOPPED&&(this.state=ke.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Tt.MAIN&&rs(t.frag)&&(this.mainFragLoading=t,this.state===ke.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n.type!==Tt.AUDIO){!this.audioOnly&&n.type===Tt.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(rs(n)){this.fragPrevious=n;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(H.AUDIO_TRACK_SWITCHED,ti({},s)))}this.fragBufferedComplete(n,i),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=ke.ERROR;return}switch(t.details){case Se.FRAG_GAP:case Se.FRAG_PARSING_ERROR:case Se.FRAG_DECRYPT_ERROR:case Se.FRAG_LOAD_ERROR:case Se.FRAG_LOAD_TIMEOUT:case Se.KEY_LOAD_ERROR:case Se.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Tt.AUDIO,t);break;case Se.AUDIO_TRACK_LOAD_ERROR:case Se.AUDIO_TRACK_LOAD_TIMEOUT:case Se.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ke.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===_n.AUDIO_TRACK&&(this.state=ke.IDLE);break;case Se.BUFFER_ADD_CODEC_ERROR:case Se.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Se.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Se.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==gi.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==gi.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ke.ENDED&&(this.state=ke.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,Tt.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:u,part:c,level:h}=o,{details:p}=h,{audio:v,text:y,id3:_,initSegment:A}=s;if(this.fragContextChanged(u)||!p){this.fragmentTracker.removeFragment(u);return}if(this.state=ke.PARSING,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),A!=null&&A.tracks){const E=u.initSegment||u;if(this.unhandledEncryptionError(A,u))return;this._bufferInitSegment(h,A.tracks,E,a),i.trigger(H.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:n,tracks:A.tracks})}if(v){const{startPTS:E,endPTS:T,startDTS:M,endDTS:R}=v;c&&(c.elementaryStreams[gi.AUDIO]={startPTS:E,endPTS:T,startDTS:M,endDTS:R}),u.setElementaryStreamInfo(gi.AUDIO,E,T,M,R),this.bufferFragmentData(v,u,c,a)}if(_!=null&&(t=_.samples)!=null&&t.length){const E=li({id:n,frag:u,details:p},_);i.trigger(H.FRAG_PARSING_METADATA,E)}if(y){const E=li({id:n,frag:u,details:p},y);i.trigger(H.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(e,t,n,i){if(this.state!==ke.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=Tt.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(H.BUFFER_CODECS,t);const o=s.initSegment;if(o!=null&&o.byteLength){const u={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:o};this.hls.trigger(H.BUFFER_APPENDING,u)}this.tickImmediate()}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===Cs.NOT_LOADED||i===Cs.PARTIAL){var s;if(!rs(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ke.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&dA(t.details,a)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:i,characteristics:s,audioCodec:a,channels:o}=this.bufferedTrack;xd({name:t,lang:n,assocLang:i,characteristics:s,audioCodec:a,channels:o},e,rd)||(lA(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(H.AUDIO_TRACK_SWITCHED,ti({},e))}}class dE extends ko{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const i=t?.renditionReports;if(i){let s=-1;for(let a=0;a<i.length;a++){const o=i[a];let u;try{u=new self.URL(o.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),u=o.URI||""}if(u===e){s=a;break}else u===e.substring(0,u.length)&&(s=a)}if(s!==-1){const a=i[s],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let u=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const h=Math.min(t.age-t.partTarget,t.targetduration);u>=0&&h>t.partTarget&&(u+=1)}const c=n&&uI(n);return new b1(o,u>=0?u:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:i,stats:s}=t,a=self.performance.now(),o=s.loading.first?Math.max(0,a-s.loading.first):0;i.advancedDateTime=Date.now()-o;const u=this.hls.config.timelineOffset;if(u!==i.appliedTimelineOffset){const h=Math.max(u||0,0);i.appliedTimelineOffset=h,i.fragments.forEach(p=>{p.setStart(p.playlistOffset+h)})}if(i.live||n!=null&&n.live){const h="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(n),n&&i.fragments.length>0){WV(n,i,this);const M=i.playlistParsingError;if(M){this.warn(M);const R=this.hls;if(!R.config.ignorePlaylistParsingErrors){var c;const{networkDetails:L}=t;R.trigger(H.ERROR,{type:Lt.NETWORK_ERROR,details:Se.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:M,reason:M.message,level:t.level||void 0,parent:(c=i.fragments[0])==null?void 0:c.type,networkDetails:L,stats:s});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=s.loading.start);const p=this.hls.mainForwardBufferInfo,v=p?p.end-p.len:0,y=(i.edge-v)*1e3,_=TO(i,y);if(i.requestScheduled+_<a?i.requestScheduled=a:i.requestScheduled+=_,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let A,E,T;if(i.canBlockReload&&i.endSN&&i.advanced){const M=this.hls.config.lowLatencyMode,R=i.lastPartSn,L=i.endSN,w=i.lastPartIndex,N=w!==-1,O=R===L;N?O?(E=L+1,T=M?0:w):(E=R,T=M?w+1:i.maxPartIndex):E=L+1;const F=i.age,B=F+i.ageHeader;let P=Math.min(B-i.partTarget,i.targetduration*1.5);if(P>0){if(B>i.targetduration*3)this.log(`Playlist last advanced ${F.toFixed(2)}s ago. Omitting segment and part directives.`),E=void 0,T=void 0;else if(n!=null&&n.tuneInGoal&&B-i.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${P} with playlist age: ${i.age}`),P=0;else{const V=Math.floor(P/i.targetduration);if(E+=V,T!==void 0){const J=Math.round(P%i.targetduration/i.partTarget);T+=J}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${F.toFixed(2)}s goal: ${P} skip sn ${V} to part ${T}`)}i.tuneInGoal=P}if(A=this.getDeliveryDirectives(i,t.deliveryDirectives,E,T),M||!O){i.requestScheduled=a,this.loadingPlaylist(h,A);return}}else(i.canBlockReload||i.canSkipUntil)&&(A=this.getDeliveryDirectives(i,t.deliveryDirectives,E,T));A&&E!==void 0&&i.canBlockReload&&(i.requestScheduled=s.loading.first+Math.max(_-o*2,_/2)),this.scheduleLoading(h,A,i)}else this.clearTimer()}scheduleLoading(e,t,n){const i=n||e.details;if(!i){this.loadingPlaylist(e,t);return}const s=self.performance.now(),a=i.requestScheduled;if(s>=a){this.loadingPlaylist(e,t);return}const o=a-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,n,i){let s=uI(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,s=Sv.No),new b1(n,i,s)}checkRetry(e){const t=e.details,n=uA(e),i=e.errorAction,{action:s,retryCount:a=0,retryConfig:o}=i||{},u=!!i&&!!o&&(s===Ms.RetryRequest||!i.resolved&&s===Ms.SendAlternateToPenaltyBox);if(u){var c;if(a>=o.maxNumRetry)return!1;if(n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const h=cC(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),h),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${h}ms`)}e.levelRetry=!0,i.resolved=!0}return u}}function QO(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!Yv(r[t].attrs,e[t].attrs))return!1;return!0}function Yv(r,e,t){const n=r["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>r[i]!==e[i])}function B1(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}class $O extends dE{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.LEVEL_LOADING,this.onLevelLoading,this),e.on(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(H.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.LEVEL_LOADING,this.onLevelLoading,this),e.off(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(H.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(H.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:i,details:s}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i){this.warn(`Audio track with id:${n} and group:${i} not found in active group ${a?.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!n||i?.length!==n?.length||n!=null&&n.some(o=>i?.indexOf(o)===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(v=>!n||n.indexOf(v.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(v=>v.default)&&(this.selectDefaultTrack=!1),o.forEach((v,y)=>{v.id=y});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const u=this.hls.config.audioPreference;if(!s&&u){const v=fu(u,o,rd);if(v>-1)s=o[v];else{const y=fu(u,this.tracks);s=this.tracks[y]}}let c=this.findTrackId(s);c===-1&&s&&(c=this.findTrackId(null));const h={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${n?.join(",")}`),this.hls.trigger(H.AUDIO_TRACKS_UPDATED,h);const p=this.trackId;if(c!==-1&&p===-1)this.setAudioTrack(c);else if(o.length&&p===-1){var a;const v=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(v.message),this.hls.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:v})}}}onError(e,t){t.fatal||!t.context||t.context.type===_n.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&xd(e,i,rd))return i;const s=fu(e,this.tracksInGroup,rd);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(i){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=yV(e,t.levels,n,a,rd);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=fu(e,n);if(a>-1)return n[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===n&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(H.AUDIO_TRACK_SWITCHING,ti({},i)),s))return;const a=this.switchParams(i.url,n?.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(!(this.selectDefaultTrack&&!i.default)&&(!e||xd(e,i,rd)))return n}if(e){const{name:n,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:u}=e;for(let c=0;c<t.length;c++){const h=t[c];if(xd({name:n,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:u},h,rd))return c}for(let c=0;c<t.length;c++){const h=t[c];if(Yv(e.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const h=t[c];if(Yv(e.attrs,h.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&lA(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a?.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(H.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:t||null,track:e})}}class nK{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(s){var n;if(i.onError(s),this.queues===null||this.tracks===null)return;const a=(n=this.tracks[e])==null?void 0:n.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],i=n?.buffer;return i?`SourceBuffer${i.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const WI=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,ZO="HlsJsTrackRemovedError";class iK extends Error{constructor(e){super(e),this.name=ZO}}class e3 extends ko{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:i,mediaSource:s}=this;n&&this.log("Media source opened"),!(!i||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(H.MEDIA_ATTACHED,{media:i,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:i}=this;n!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=w9(Tc(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.BUFFER_RESET,this.onBufferReset,this),e.on(H.BUFFER_APPENDING,this.onBufferAppending,this),e.on(H.BUFFER_CODECS,this.onBufferCodecs,this),e.on(H.BUFFER_EOS,this.onBufferEos,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(H.FRAG_PARSED,this.onFragParsed,this),e.on(H.FRAG_CHANGED,this.onFragChanged,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.BUFFER_RESET,this.onBufferReset,this),e.off(H.BUFFER_APPENDING,this.onBufferAppending,this),e.off(H.BUFFER_CODECS,this.onBufferCodecs,this),e.off(H.BUFFER_EOS,this.onBufferEos,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(H.FRAG_PARSED,this.onFragParsed,this),e.off(H.FRAG_CHANGED,this.onFragChanged,this),e.off(H.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const a=this.isQueued();(s||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?li(n,i.tracks):this.sourceBuffers.forEach(s=>{const[a]=s;a&&(n[a]=li({},this.tracks[a]),this.removeBuffer(a)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const i=Tc(this.appendSource);if(i){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),s)this._objectUrl=n.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{n.removeAttribute("src");const u=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||u&&a instanceof u,jI(n),sK(n,o),n.load()}catch{n.src=o}else n.src=o}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,i=t.tracks,s=i?Object.keys(i):null,a=s?s.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&s&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${vi(n,(u,c)=>u==="initSegment"?void 0:c)};
transfer tracks: ${vi(i,(u,c)=>u==="initSegment"?void 0:c)}}`),!XB(i,n)){t.mediaSource=null,t.tracks=void 0;const u=e.currentTime,c=this.details,h=Math.max(u,c?.fragments[0].start||0);if(h-u>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${u} -> ${h}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(n)}") start time: ${h} currentTime: ${u}`),this.onMediaDetaching(H.MEDIA_DETACHING,{}),this.onMediaAttaching(H.MEDIA_ATTACHING,t),e.currentTime=h;return}this.transferData=void 0,s.forEach(u=>{const c=u,h=i[c];if(h){const p=h.buffer;if(p){const v=this.fragmentTracker,y=h.id;if(v.hasFragments(y)||v.hasParts(y)){const E=nn.getBuffered(p);v.detectEvictedFragments(c,E,y,null,!0)}const _=Lb(c),A=[c,p];this.sourceBuffers[_]=A,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,h)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:s,_objectUrl:a}=this;if(s){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=s.readyState==="open";try{const u=s.sourceBuffers;for(let c=u.length;c--;)o&&u[c].abort(),s.removeSourceBuffer(u[c]);o&&s.endOfStream()}catch(u){this.warn(`onMediaDetaching: ${u.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),n||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&jI(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(H.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Lb(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new nK(this.tracks)}onBufferCodecs(e,t){var n;const i=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&s.some(u=>!i[u]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${s}" SourceBuffers`);return}s.forEach(u=>{var c,h;const p=t[u],{id:v,codec:y,levelCodec:_,container:A,metadata:E,supplemental:T}=p;let M=i[u];const R=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[u],L=R!=null&&R.buffer?R:M,w=L?.pendingCodec||L?.codec,N=L?.levelCodec;M||(M=i[u]={buffer:void 0,listeners:[],codec:y,supplemental:T,container:A,levelCodec:_,metadata:E,id:v});const O=jx(w,N),F=O?.replace(WI,"$1");let B=jx(y,_);const P=(h=B)==null?void 0:h.replace(WI,"$1");B&&O&&F!==P&&(u.slice(0,5)==="audio"&&(B=aA(B,this.appendSource)),this.log(`switching codec ${w} to ${B}`),B!==(M.pendingCodec||M.codec)&&(M.pendingCodec=B),M.container=A,this.appendChangeType(u,A,B))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const i=`${t};codecs=${n}`,s={label:`change-type=${i}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),o.changeType(i),a.codec=n,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,i=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,Tt.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const u=this.tracks.video;(this.lastVideoAppendEnd>i||u!=null&&u.buffer&&nn.isBuffered(u.buffer,i)||((o=this.fragmentTracker.getAppendedFrag(i,Tt.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:i,type:s,parent:a,frag:o,part:u,chunkMeta:c,offset:h}=t,p=c.buffering[s],{sn:v,cc:y}=o,_=self.performance.now();p.start=_;const A=o.stats.buffering,E=u?u.stats.buffering:null;A.start===0&&(A.start=_),E&&E.start===0&&(E.start=_);const T=n.audio;let M=!1;s==="audio"&&T?.container==="audio/mpeg"&&(M=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const R=n.video,L=R?.buffer;if(L&&v!=="initSegment"){const O=u||o,F=this.blockedAudioAppend;if(s==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(R.ending||R.ended)){const P=O.start+O.duration*.05,V=L.buffered,J=this.currentOp("video");!V.length&&!J?this.blockAudio(O):!J&&!nn.isBuffered(L,P)&&this.lastVideoAppendEnd<P&&this.blockAudio(O)}else if(s==="video"){const B=O.end;if(F){const P=F.frag.start;(B>P||B<this.lastVideoAppendEnd||nn.isBuffered(L,P))&&this.unblockAudio()}this.lastVideoAppendEnd=B}}const w=(u||o).start,N={label:`append-${s}`,execute:()=>{var O;p.executeStart=self.performance.now();const F=(O=this.tracks[s])==null?void 0:O.buffer;F&&(M?this.updateTimestampOffset(F,w,.1,s,v,y):h!==void 0&&yt(h)&&this.updateTimestampOffset(F,h,1e-6,s,v,y)),this.appendExecutor(i,s)},onStart:()=>{},onComplete:()=>{const O=self.performance.now();p.executeEnd=p.end=O,A.first===0&&(A.first=O),E&&E.first===0&&(E.first=O);const F={};this.sourceBuffers.forEach(([B,P])=>{B&&(F[B]=nn.getBuffered(P))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(H.BUFFER_APPENDED,{type:s,frag:o,part:u,chunkMeta:c,parent:o.type,timeRanges:F})},onError:O=>{var F;const B={type:Lt.MEDIA_ERROR,parent:o.type,details:Se.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:o,part:u,chunkMeta:c,error:O,err:O,fatal:!1},P=(F=this.media)==null?void 0:F.error;if(O.code===DOMException.QUOTA_EXCEEDED_ERR||O.name=="QuotaExceededError"||"quota"in O)B.details=Se.BUFFER_FULL_ERROR;else if(O.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!P)B.errorAction=Bm(!0);else if(O.name===ZO&&this.sourceBufferCount===0)B.errorAction=Bm(!0);else{const V=++this.appendErrors[s];this.warn(`Failed ${V}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${P||"no media error"})`),(V>=this.hls.config.appendErrorMaxRetry||P)&&(B.fatal=!0)}this.hls.trigger(H.ERROR,B)}};this.log(`queuing "${s}" append sn: ${v}${u?" p: "+u.index:""} of ${o.type===Tt.MAIN?"level":"track"} ${o.level} cc: ${y}`),this.append(N,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(H.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:n,startOffset:i,endOffset:s}=t;n?this.append(this.getFlushOp(n,i,s),n):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,i,s),a)})}onFragParsed(e,t){const{frag:n,part:i}=t,s=[],a=i?i.elementaryStreams:n.elementaryStreams;a[gi.AUDIOVIDEO]?s.push("audiovideo"):(a[gi.AUDIO]&&s.push("audio"),a[gi.VIDEO]&&s.push("video"));const o=()=>{const u=self.performance.now();n.stats.buffering.end=u,i&&(i.stats.buffering.end=u);const c=i?i.stats:n.stats;this.hls.trigger(H.FRAG_BUFFERED,{frag:n,part:i,stats:c,id:n.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(o,s).catch(u=>{this.warn(`Fragment buffered callback ${u}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const i=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(H.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(H.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Se.BUFFER_APPEND_ERROR&&t.frag){var n;const i=(n=t.errorAction)==null?void 0:n.nextAutoLevel;yt(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const i=e.config,s=n.currentTime,a=t.levelTargetDuration,o=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(yt(o)&&o>=0){const c=Math.max(o,a),h=Math.floor(s/a)*a-c;this.flushBackBuffer(s,a,h)}const u=i.frontBufferFlushThreshold;if(yt(u)&&u>0){const c=Math.max(i.maxBufferLength,u),h=Math.max(c,a),p=Math.floor(s/a)*a+h;this.flushFrontBuffer(s,a,p)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([i,s])=>{if(s){const o=nn.getBuffered(s);if(o.length>0&&n>o.start(0)){var a;this.hls.trigger(H.BACK_BUFFER_REACHED,{bufferEnd:n});const u=this.tracks[i];if((a=this.details)!=null&&a.live)this.hls.trigger(H.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(u!=null&&u.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(H.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:i})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([i,s])=>{if(s){const a=nn.getBuffered(s),o=a.length;if(o<2)return;const u=a.start(o-1),c=a.end(o-1);if(n>u||e>=u&&e<=c)return;this.hls.trigger(H.BUFFER_FLUSHING,{startOffset:u,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||n?.readyState!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),h=Math.max(c,i);return{duration:1/0,start:c,end:h}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return yt(s)?{duration:s}:null;const a=this.media.duration,o=yt(n.duration)?n.duration:0;return i>o&&i>a||!yt(a)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:n}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(yt(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${n}.`),i.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${vi(n)}`),this.tracksReady){var i;const s=(i=this.transferData)==null?void 0:i.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const i=this.tracks[t];e[t]={buffer:n,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(H.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const a=s,o=e[a];if(this.isPending(o)){const u=this.getTrackCodec(o,a),c=`${o.container};codecs=${u}`;o.codec=u,this.log(`creating sourceBuffer(${c})${this.currentOp(a)?" Queued":""} ${vi(o)}`);try{const h=n.addSourceBuffer(c),p=Lb(a),v=[a,h];t[p]=v,o.buffer=h}catch(h){var i;this.error(`error while trying to add sourceBuffer: ${h.message}`),this.shiftAndExecuteNext(a),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[a],this.hls.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,sourceBufferName:a,mimeType:c,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let i=e.codec;n&&(t==="video"||t==="audiovideo")&&Gv(n,"video")&&(i=Z9(i,n));const s=jx(i,e.levelCodec);return s?t.slice(0,5)==="audio"?aA(s,this.appendSource):s:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(H.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${i}`,t),this.hls.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.currentOp(e);s&&s.onError(i)}updateTimestampOffset(e,t,n,i,s,a){const o=t-e.timestampOffset;Math.abs(o)>=n&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:i,mediaSource:s}=this,a=this.tracks[e],o=a?.buffer;if(!i||!s||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const u=yt(i.duration)?i.duration:1/0,c=yt(s.duration)?s.duration:1/0,h=Math.max(0,t),p=Math.min(n,u,c);p>h&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${h},${p}] from the ${e} SourceBuffer`),o.remove(h,p)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],i=n?.buffer;if(!i)throw new iK(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,i=t.map(a=>this.appendBlocker(a));return t.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(a=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const i=(n=this.tracks[t])==null?void 0:n.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const i=this.tracks[e];if(!i)return;const s=i.buffer;if(!s)return;const a=n.bind(this,e);i.listeners.push({event:t,listener:a}),s.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(i=>{n.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function jI(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function sK(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}function Lb(r){return r==="audio"?1:0}class pE{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(H.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(H.BUFFER_CODECS,this.onBufferCodecs,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(H.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(H.BUFFER_CODECS,this.onBufferCodecs,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&yt(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,pE.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const i=(o,u)=>u?o.width!==u.width||o.height!==u.height:!0;let s=e.length-1;const a=Math.max(t,n);for(let o=0;o<e.length;o+=1){const u=e[o];if((u.width>=a||u.height>=a)&&i(u,e[o+1])){s=o;break}}return s}}const rK={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},ma=rK,aK={HLS:"h"},oK=aK;class gu{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof gu?n:new gu(n))),this.value=e,this.params=t}}const lK="Dict";function uK(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function cK(r,e,t,n){return new Error(`failed to ${r} "${uK(e)}" as ${t}`,{cause:n})}function vu(r,e,t){return cK("serialize",r,e,t)}class t3{constructor(e){this.description=e}}const JI="Bare Item",fK="Boolean";function hK(r){if(typeof r!="boolean")throw vu(r,fK);return r?"?1":"?0"}function dK(r){return btoa(String.fromCharCode(...r))}const pK="Byte Sequence";function mK(r){if(ArrayBuffer.isView(r)===!1)throw vu(r,pK);return`:${dK(r)}:`}const gK="Integer";function vK(r){return r<-999999999999999||999999999999999<r}function n3(r){if(vK(r))throw vu(r,gK);return r.toString()}function yK(r){return`@${n3(r.getTime()/1e3)}`}function i3(r,e){if(r<0)return-i3(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const i=Math.floor(r*t);return(i%2===0?i:i+1)/t}else return Math.round(r*t)/t}const _K="Decimal";function xK(r){const e=i3(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw vu(r,_K);const t=e.toString();return t.includes(".")?t:`${t}.0`}const SK="String",AK=/[\x00-\x1f\x7f]+/;function EK(r){if(AK.test(r))throw vu(r,SK);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function TK(r){return r.description||r.toString().slice(7,-1)}const bK="Token";function QI(r){const e=TK(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw vu(e,bK);return e}function O1(r){switch(typeof r){case"number":if(!yt(r))throw vu(r,JI);return Number.isInteger(r)?n3(r):xK(r);case"string":return EK(r);case"symbol":return QI(r);case"boolean":return hK(r);case"object":if(r instanceof Date)return yK(r);if(r instanceof Uint8Array)return mK(r);if(r instanceof t3)return QI(r);default:throw vu(r,JI)}}const MK="Key";function P1(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw vu(r,MK);return r}function EC(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${P1(e)}`:`;${P1(e)}=${O1(t)}`).join("")}function s3(r){return r instanceof gu?`${O1(r.value)}${EC(r.params)}`:O1(r)}function CK(r){return`(${r.value.map(s3).join(" ")})${EC(r.params)}`}function RK(r,e={whitespace:!0}){if(typeof r!="object"||r==null)throw vu(r,lK);const t=r instanceof Map?r.entries():Object.entries(r),n=e?.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof gu||(s=new gu(s));let a=P1(i);return s.value===!0?a+=EC(s.params):(a+="=",Array.isArray(s.value)?a+=CK(s):a+=s3(s)),a}).join(`,${n}`)}function r3(r,e){return RK(r,e)}const ru="CMCD-Object",ji="CMCD-Request",ed="CMCD-Session",Sf="CMCD-Status",DK={br:ru,ab:ru,d:ru,ot:ru,tb:ru,tpb:ru,lb:ru,tab:ru,lab:ru,url:ru,pb:ji,bl:ji,tbl:ji,dl:ji,ltc:ji,mtp:ji,nor:ji,nrr:ji,rc:ji,sn:ji,sta:ji,su:ji,ttfb:ji,ttfbb:ji,ttlb:ji,cmsdd:ji,cmsds:ji,smrt:ji,df:ji,cs:ji,ts:ji,cid:ed,pr:ed,sf:ed,sid:ed,st:ed,v:ed,msd:ed,bs:Sf,bsd:Sf,cdn:Sf,rtp:Sf,bg:Sf,pt:Sf,ec:Sf,e:Sf},LK={REQUEST:ji};function IK(r){return Object.keys(r).reduce((e,t)=>{var n;return(n=r[t])===null||n===void 0||n.forEach(i=>e[i]=t),e},{})}function wK(r,e){const t={};if(!r)return t;const n=Object.keys(r),i=e?IK(e):{};return n.reduce((s,a)=>{var o;const u=DK[a]||i[a]||LK.REQUEST,c=(o=s[u])!==null&&o!==void 0?o:s[u]={};return c[a]=r[a],s},t)}function BK(r){return["ot","sf","st","e","sta"].includes(r)}function OK(r){return typeof r=="number"?yt(r):r!=null&&r!==""&&r!==!1}const a3="event";function PK(r,e){const t=new URL(r),n=new URL(e);if(t.origin!==n.origin)return r;const i=t.pathname.split("/").slice(1),s=n.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")+t.search+t.hash}const Zx=r=>Math.round(r),N1=(r,e)=>Array.isArray(r)?r.map(t=>N1(t,e)):r instanceof gu&&typeof r.value=="string"?new gu(N1(r.value,e),r.params):(e.baseUrl&&(r=PK(r,e.baseUrl)),e.version===1?encodeURIComponent(r):r),Ox=r=>Zx(r/100)*100,NK=(r,e)=>{let t=r;return e.version>=2&&(r instanceof gu&&typeof r.value=="string"?t=new gu([r]):typeof r=="string"&&(t=[r])),N1(t,e)},UK={br:Zx,d:Zx,bl:Ox,dl:Ox,mtp:Ox,nor:NK,rtp:Ox,tb:Zx},o3="request",l3="response",TC=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],FK=["e"],kK=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function mE(r){return kK.test(r)}function GK(r){return TC.includes(r)||FK.includes(r)||mE(r)}const u3=["d","dl","nor","ot","rtp","su"];function HK(r){return TC.includes(r)||u3.includes(r)||mE(r)}const zK=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function VK(r){return TC.includes(r)||u3.includes(r)||zK.includes(r)||mE(r)}const KK=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function YK(r){return KK.includes(r)||mE(r)}const XK={[l3]:VK,[a3]:GK,[o3]:HK};function c3(r,e={}){const t={};if(r==null||typeof r!="object")return t;const n=e.version||r.v||1,i=e.reportingMode||o3,s=n===1?YK:XK[i];let a=Object.keys(r).filter(s);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const u=i===l3||i===a3;u&&!a.includes("ts")&&a.push("ts"),n>1&&!a.includes("v")&&a.push("v");const c=li({},UK,e.formatters),h={version:n,reportingMode:i,baseUrl:e.baseUrl};return a.sort().forEach(p=>{let v=r[p];const y=c[p];if(typeof y=="function"&&(v=y(v,h)),p==="v"){if(n===1)return;v=n}p=="pr"&&v===1||(u&&p==="ts"&&!yt(v)&&(v=Date.now()),OK(v)&&(BK(p)&&typeof v=="string"&&(v=new t3(v)),t[p]=v))}),t}function qK(r,e={}){const t={};if(!r)return t;const n=c3(r,e),i=wK(n,e?.customHeaderMap);return Object.entries(i).reduce((s,[a,o])=>{const u=r3(o,{whitespace:!1});return u&&(s[a]=u),s},t)}function WK(r,e,t){return li(r,qK(e,t))}const jK="CMCD";function JK(r,e={}){return r?r3(c3(r,e),{whitespace:!1}):""}function QK(r,e={}){if(!r)return"";const t=JK(r,e);return encodeURIComponent(t)}function $K(r,e={}){if(!r)return"";const t=QK(r,e);return`${jK}=${t}`}const $I=/CMCD=[^&#]+/;function ZK(r,e,t){const n=$K(e,t);if(!n)return r;if($I.test(r))return r.replace($I,n);const i=r.includes("?")?"&":"?";return`${r}${i}${n}`}class f3{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:ma.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const{frag:s,part:a}=i,o=this.hls.levels[s.level],u=this.getObjectType(s),c={d:(a||s).duration*1e3,ot:u};(u===ma.VIDEO||u===ma.AUDIO||u==ma.MUXED)&&(c.br=o.bitrate/1e3,c.tb=this.getTopBandwidth(u)/1e3,c.bl=this.getBufferLength(u));const h=a?this.getNextPart(a):this.getNextFrag(s);h!=null&&h.url&&h.url!==s.url&&(c.nor=h.url),this.apply(i,c)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHED,this.onMediaDetached,this),e.on(H.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHED,this.onMediaDetached,this),e.off(H.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,i;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:oK.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){li(t,this.createData());const n=t.ot===ma.INIT||t.ot===ma.VIDEO||t.ot===ma.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((a,o)=>(i.includes(o)&&(a[o]=t[o]),a),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),WK(e.headers,t,s)):e.url=ZK(e.url,t,s)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const i=e.sn-n.startSN;return n.fragments[i+1]}}getNextPart(e){var t;const{index:n,fragment:i}=e,s=(t=this.hls.levels[i.level])==null||(t=t.details)==null?void 0:t.partList;if(s){const{sn:a}=i;for(let o=s.length-1;o>=0;o--){const u=s[o];if(u.index===n&&u.fragment.sn===a)return s[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return ma.TIMED_TEXT;if(e.sn==="initSegment")return ma.INIT;if(t==="audio")return ma.AUDIO;if(t==="main")return this.hls.audioTracks.length?ma.VIDEO:ma.MUXED}getTopBandwidth(e){let t=0,n;const i=this.hls;if(e===ma.AUDIO)n=i.audioTracks;else{const s=i.maxAutoLevel,a=s>-1?s+1:i.levels.length;n=i.levels.slice(0,a)}return n.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===ma.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:nn.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}}const eY=3e5;class h3 extends ko{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if(n?.action===Ms.SendAlternateToPenaltyBox&&n.flags===va.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:u,type:c}=t.context;o&&i?a=this.getPathwayForGroupId(o,c,a):u&&(a=u)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&i&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),n.resolved=this.pathwayId!==a),t.details===Se.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${i&&i.length} priorities: ${vi(s)} penalized: ${vi(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(s=>{i-n[s]>eY&&delete n[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in n)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,u=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,CO(t),this.hls.trigger(H.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[o];u&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==u.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==u.bitrate&&this.log(`Unstable Pathways change from bitrate ${u.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===_n.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===_n.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},i={};e.forEach(s=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":u}=s;if(t.some(h=>h.pathwayId===a))return;const c=this.getLevelsForPathway(o).map(h=>{const p=new Ri(h.attrs);p["PATHWAY-ID"]=a;const v=p.AUDIO&&`${p.AUDIO}_clone_${a}`,y=p.SUBTITLES&&`${p.SUBTITLES}_clone_${a}`;v&&(n[p.AUDIO]=v,p.AUDIO=v),y&&(i[p.SUBTITLES]=y,p.SUBTITLES=y);const _=d3(h.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",u),A=new $m({attrs:p,audioCodec:h.audioCodec,bitrate:h.bitrate,height:h.height,name:h.name,url:_,videoCodec:h.videoCodec,width:h.width});if(h.audioGroups)for(let E=1;E<h.audioGroups.length;E++)A.addGroupId("audio",`${h.audioGroups[E]}_clone_${a}`);if(h.subtitleGroups)for(let E=1;E<h.subtitleGroups.length;E++)A.addGroupId("text",`${h.subtitleGroups[E]}_clone_${a}`);return A});t.push(...c),ZI(this.audioTracks,n,u,a),ZI(this.subtitleTracks,i,u,a)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const h=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+h)}const s={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},u={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(h,p,v,y)=>{this.log(`Loaded steering manifest: "${i}"`);const _=h.data;if(_?.VERSION!==1){this.log(`Steering VERSION ${_.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=_.TTL;const{"RELOAD-URI":A,"PATHWAY-CLONES":E,"PATHWAY-PRIORITY":T}=_;if(A)try{this.uri=new self.URL(A,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${A}`);return}this.scheduleRefresh(this.uri||v.url),E&&this.clonePathways(E);const M={steeringManifest:_,url:i.toString()};this.hls.trigger(H.STEERING_MANIFEST_LOADED,M),T&&this.updatePathwayPriority(T)},onError:(h,p,v,y)=>{if(this.log(`Error loading steering manifest: ${h.code} ${h.text} (${p.url})`),this.stopLoad(),h.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let _=this.timeToLoad*1e3;if(h.code===429){const A=this.loader;if(typeof A?.getResponseHeader=="function"){const E=A.getResponseHeader("Retry-After");E&&(_=parseFloat(E)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,_)},onTimeout:(h,p,v)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,u,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const i=(n=this.hls)==null?void 0:n.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function ZI(r,e,t,n){r&&Object.keys(e).forEach(i=>{const s=r.filter(a=>a.groupId===i).map(a=>{const o=li({},a);return o.details=void 0,o.attrs=new Ri(o.attrs),o.url=o.attrs.URI=d3(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[i],o.attrs["PATHWAY-ID"]=n,o});r.push(...s)})}function d3(r,e,t,n){const{HOST:i,PARAMS:s,[t]:a}=n;let o;e&&(o=a?.[e],o&&(r=o));const u=new self.URL(r);return i&&!o&&(u.host=i),s&&Object.keys(s).sort().forEach(c=>{c&&u.searchParams.set(c,s[c])}),u.href}class Sd extends ko{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Sd.CDMCleanupPromise?[Sd.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:i}=t,s=`"${t.type}" event: init data type: "${n}"`;if(this.debug(s),i!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=uv(this.config));const o=a.map(Ab).filter(u=>!!u);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=Jx(a);if(n!=="sinf"||o!==Li.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${o}`);return}let u;try{const y=bs(new Uint8Array(i)),_=pC(JSON.parse(y).sinf),A=tO(_);if(!A)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");u=new Uint8Array(A.subarray(8,24))}catch(y){this.warn(`${s} Failed to parse sinf: ${y}`);return}const c=er(u),{keyIdToKeySessionPromise:h,mediaKeySessions:p}=this;let v=h[c];for(let y=0;y<p.length;y++){const _=p[y],A=_.decryptdata;if(!A.keyId)continue;const E=er(A.keyId);if(fA(u,A.keyId)||A.uri.replace(/-/g,"").indexOf(c)!==-1){if(v=h[E],!v)continue;if(A.pssh)break;delete h[E],A.pssh=new Uint8Array(i),A.keyId=u,v=h[c]=v.then(()=>this.generateRequestWithPreferredKeySession(_,n,i,"encrypted-event-key-match")),v.catch(T=>this.handleError(T));break}}v||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${p.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(H.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(H.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(H.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(H.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(H.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(H.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,i=t?.[e];if(i)return i.licenseUrl;if(e===Li.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t?.[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(a,o,u)=>!!a&&u.indexOf(a)===o,i=t.map(a=>a.audioCodec).filter(n),s=t.map(a=>a.videoCodec).filter(n);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,o)=>{const u=c=>{const h=c.shift();this.getMediaKeysPromise(h,i,s).then(p=>a({keySystem:h,mediaKeys:p})).catch(p=>{c.length?u(c):p instanceof Ha?o(p):o(new Ha({type:Lt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};u(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${n}`;return mC===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return n(e,t)}getMediaKeysPromise(e,t,n){var i;const s=kV(e,t,n,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(i=a)==null?void 0:i.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${vi(s)}`),o=this.requestMediaKeySystemAccess(e,s);const u=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),o.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const h=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const p=u.mediaKeys=c.createMediaKeys().then(v=>(this.log(`Media-keys created for "${e}"`),u.hasMediaKeys=!0,h.then(y=>y?this.setMediaKeysServerCertificate(v,e,y):v)));return p.catch(v=>{this.error(`Failed to create media-keys for "${e}"}: ${v}`)}),p})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${er(e.keyId||[])} keyUri: ${e.uri}`);const i=n.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),i=Px(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${er(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Ab(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const s=Ab(i);s?t(s):n(new Error(`Unable to find format for key-system "${i}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=uv(this.config),n=e.map(Jx).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const i=tY(e,t[n]);if(i)return i}}loadKey(e){const t=e.keyInfo.decryptdata,n=Px(t),i=this.bannedKeyIds[n];if(i||this.getKeyStatus(t)==="internal-error"){const o=ew(i||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const s=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);const a=this.keyIdToKeySessionPromise[n];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:u,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(u,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:u,mediaKeys:c,decryptdata:t}))))).then(u=>{const c="cenc",h=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(u,c,h,"playlist-key")});return o.catch(u=>this.handleError(u,e.frag)),this.keyIdToKeySessionPromise[n]=o,o}return a.catch(o=>{if(o instanceof Ha){const u=ti({},o.data);this.getKeyStatus(t)==="internal-error"&&(u.decryptdata=t);const c=new Ha(u,o.message);this.handleError(c,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Ha){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${er(n.keyId||[])})`:""}`),this.hls.trigger(H.ERROR,e.data)}else this.error(e.message),this.hls.trigger(H.ERROR,{type:Lt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Px(e),n=this.keyIdToKeySessionPromise[t];if(!n){const i=Jx(e.keyFormat),s=i?[i]:uv(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=uv(this.config)),e.length===0)throw new Ha({type:Lt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${vi({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((s,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(s).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,n,i){var s;const a=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(a)try{const _=a.call(this.hls,t,n,e);if(!_)throw new Error("Invalid response from configured generateRequest filter");t=_.initDataType,n=_.initData?_.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(_){if(this.warn(_.message),this.hls&&this.hls.config.debug)throw _}if(n===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const o=Px(e.decryptdata),u=e.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${o} URI: ${u} (init data type: ${t} length: ${n.byteLength})`);const c=new gC,h=e._onmessage=_=>{const A=e.mediaKeysSession;if(!A){c.emit("error",new Error("invalid state"));return}const{messageType:E,message:T}=_;this.log(`"${E}" message event for session "${A.sessionId}" message size: ${T.byteLength}`),E==="license-request"||E==="license-renewal"?this.renewLicense(e,T).catch(M=>{c.eventNames().length?c.emit("error",M):this.handleError(M)}):E==="license-release"?e.keySystem===Li.FAIRPLAY&&this.updateKeySession(e,R1("acknowledged")).then(()=>this.removeSession(e)).catch(M=>this.handleError(M)):this.warn(`unhandled media key message type "${E}"`)},p=(_,A)=>{A.keyStatus=_;let E;_.startsWith("usable")?c.emit("resolved"):_==="internal-error"||_==="output-restricted"||_==="output-downscaled"?E=ew(_,A.decryptdata):_==="expired"?E=new Error(`key expired (keyId: ${o})`):_==="released"?E=new Error("key released"):_==="status-pending"||this.warn(`unhandled key status change "${_}" (keyId: ${o})`),E&&(c.eventNames().length?c.emit("error",E):this.handleError(E))},v=e._onkeystatuseschange=_=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const E=this.getKeyStatuses(e);if(!Object.keys(E).some(L=>E[L]!=="status-pending"))return;if(E[o]==="expired"){this.log(`Expired key ${vi(E)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let M=E[o];if(M)p(M,e);else{var R;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(R=e.keyStatusTimeouts)[o]||(R[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const w=this.getKeyStatus(e.decryptdata);if(w&&w!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${w} from other session.`),p(w,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),M="internal-error",p(M,e)},1e3)),this.log(`No status for keyId ${o} (${vi(E)}).`)}};ea(e.mediaKeysSession,"message",h),ea(e.mediaKeysSession,"keystatuseschange",v);const y=new Promise((_,A)=>{c.on("error",A),c.on("resolved",_)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${u}`)}).catch(_=>{throw new Ha({type:Lt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_NO_SESSION,error:_,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${_}`)}).then(()=>y).catch(_=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw _}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,i)=>{if(typeof i=="string"&&typeof n=="object"){const o=i;i=n,n=o}const s="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);if(e.keySystem===Li.PLAYREADY&&s.length===16){const o=er(s);t[o]=n,yO(s)}const a=er(s);n==="internal-error"&&(this.bannedKeyIds[a]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,i=new n(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const u={responseType:"arraybuffer",url:s},c=t.certLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,y,_,A)=>{a(v.data)},onError:(v,y,_,A)=>{o(new Ha({type:Lt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:_,response:ti({url:u.url,data:void 0},v)},`"${e}" certificate request failed (${s}). Status: ${v.code} (${v.text})`))},onTimeout:(v,y,_)=>{o(new Ha({type:Lt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:_,response:{url:u.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(v,y,_)=>{o(new Error("aborted"))}};i.load(u,h,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((i,s)=>{e.setServerCertificate(n).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),i(e)}).catch(a=>{s(new Ha({type:Lt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(i=>{throw new Ha({type:Lt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:i,fatal:!1},i.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(n,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let h;for(let p=0,v=s.length;p<v;p++){var a,o;h=s[p];const y=(a=h.querySelector("name"))==null?void 0:a.textContent,_=(o=h.querySelector("value"))==null?void 0:o.textContent;y&&_&&e.setRequestHeader(y,_)}}const u=i.querySelector("Challenge"),c=u?.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return R1(atob(c))}setupLicenseXHR(e,t,n,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,i)}).catch(a=>{if(!n.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,n,i)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let u=o.response;this.log(`License received ${u instanceof ArrayBuffer?u.byteLength:u}`);const c=this.config.licenseResponseCallback;if(c)try{u=c.call(this.hls,o,a,e)}catch(h){this.error(h)}i(u)}else{const u=n.errorRetry,c=u?u.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||o.status>=400&&o.status<500)s(new Ha({type:Lt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const h=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${h} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:u,licenseChallenge:c})=>{e.keySystem==Li.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(u,c)),u.send(c)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,ea(n,"encrypted",this.onMediaEncrypted),ea(n,"waitingforkey",this.onWaitingForKey);const i=this.mediaResolved;i?i():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(xa(e,"encrypted",this.onMediaEncrypted),xa(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ac.clearKeyUriToKeyIdMap();const s=i.length;Sd.CDMCleanupPromise=Promise.all(i.map(a=>this.removeSession(a)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(H.ERROR,{type:Lt.OTHER_ERROR,details:Se.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(H.ERROR,{type:Lt.OTHER_ERROR,details:Se.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:i}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${er(i?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(c=>self.clearTimeout(a[c]));const{drmSystemOptions:o}=this.config;return(HV(o)?new Promise((c,h)=>{self.setTimeout(()=>h(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(h)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(H.ERROR,{type:Lt.OTHER_ERROR,details:Se.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(H.ERROR,{type:Lt.OTHER_ERROR,details:Se.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}Sd.CDMCleanupPromise=void 0;function Px(r){if(!r)throw new Error("Could not read keyId of undefined decryptdata");if(r.keyId===null)throw new Error("keyId is null");return er(r.keyId)}function tY(r,e){if(r.keyId&&e.mediaKeysSession.keyStatuses.has(r.keyId))return e.mediaKeysSession.keyStatuses.get(r.keyId);if(r.matches(e.decryptdata))return e.keyStatus}class Ha extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function ew(r,e){const t=r==="output-restricted",n=t?Se.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Se.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Ha({type:Lt.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${r}"`)}class p3{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(H.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(H.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,a=n-this.lastDroppedFrames,o=t-this.lastDecodedFrames,u=1e3*a/s,c=this.hls;if(c.trigger(H.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:n}),u>0&&a>c.config.fpsDroppedMonitoringThreshold*o){let h=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=h)&&(h=h-1,c.trigger(H.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:c.currentLevel}),c.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function m3(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function g3(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){ii.debug(`[texttrack-utils]: ${n}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,r.addCue(i)}catch(i){ii.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(r.mode=t)}function bm(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let n=r.cues.length;n--;)e&&r.cues[n].removeEventListener("enter",e),r.removeCue(r.cues[n]);t==="disabled"&&(r.mode=t)}function U1(r,e,t,n){const i=r.mode;if(i==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const s=iY(r.cues,e,t);for(let a=0;a<s.length;a++)(!n||n(s[a]))&&r.removeCue(s[a])}i==="disabled"&&(r.mode=i)}function nY(r,e){if(e<=r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let n=0,i=t,s;for(;n<=i;)if(s=Math.floor((i+n)/2),e<r[s].startTime)i=s-1;else if(e>r[s].startTime&&n<t)n=s+1;else return s;return r[n].startTime-e<e-r[i].startTime?n:i}function iY(r,e,t){const n=[],i=nY(r,e);if(i>-1)for(let s=i,a=r.length;s<a;s++){const o=r[s];if(o.startTime>=e&&o.endTime<=t)n.push(o);else if(o.startTime>t)return n}return n}function eS(r){const e=[];for(let t=0;t<r.length;t++){const n=r[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(r[t])}return e}class v3 extends dE{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=eS(this.media.textTracks);for(let s=0;s<n.length;s++)if(n[s].mode==="hidden")t=n[s];else if(n[s].mode==="showing"){t=n[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.LEVEL_LOADING,this.onLevelLoading,this),e.on(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(H.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.LEVEL_LOADING,this.onLevelLoading,this),e.off(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(H.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(H.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;eS(n.textTracks).forEach(a=>{bm(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:i,details:s}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i){this.warn(`Subtitle track with id:${n} and group:${i} not found in active group ${a?.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!n||i?.length!==n?.length||n!=null&&n.some(a=>i?.indexOf(a)===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(h=>!n||n.indexOf(h.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(h=>h.default)&&(this.selectDefaultTrack=!1),a.forEach((h,p)=>{h.id=p});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!s&&o){this.selectDefaultTrack=!1;const h=fu(o,a);if(h>-1)s=a[h];else{const p=fu(o,this.tracks);s=this.tracks[p]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const c={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${n?.join(",")}" group-id`),this.hls.trigger(H.SUBTITLE_TRACKS_UPDATED,c),u!==-1&&this.trackId===-1&&this.setSubtitleTrack(u)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(n&&!s.default||!n&&!e)&&(!e||xd(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(Yv(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(Yv(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(B1(i,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===_n.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&xd(e,n))return n;const i=fu(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(n)return null;{const s=fu(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a?.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(H.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=eS(e.textTracks),n=this.currentTrack;let i;if(n&&(i=t.filter(s=>B1(n,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!yt(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(H.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===n&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:o="",name:u,type:c,url:h}=i;this.hls.trigger(H.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:u,type:c,url:h});const p=this.switchParams(i.url,n?.details,i.details);this.loadPlaylist(p)}}function sY(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}function Tv(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString()}const Pm=.025;let mA=(function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r})({});function rY(r,e,t){return`${r.identifier}-${t+1}-${Tv(e)}`}class aY{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Ib(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=Ib(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=yt(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Ib(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Pm))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?mA.Range:mA.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return oY(this)}}function Ib(r,e){return r-e.start<e.duration/2&&!(Math.abs(r-(e.start+e.duration))<Pm)?e.start:e.start+e.duration}function y3(r,e,t){const n=new self.URL(r,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function wb(r,e){for(;(t=r.assetList[++e])!=null&&t.error;)var t;return e}function oY(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function Em(r){const e=r.timelineStart,t=r.duration||0;return`["${r.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class lY{constructor(e,t,n,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(H.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=n,this.assetItem=i;const a=()=>{this.hasDetails=!0};s.once(H.LEVEL_LOADED,a),s.once(H.AUDIO_TRACK_LOADED,a),s.once(H.SUBTITLE_TRACK_LOADED,a),s.on(H.MEDIA_ATTACHING,(o,{media:u})=>{this.removeMediaListeners(),this.mediaAttached=u,this.interstitial.playoutLimit&&(u.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(H.BUFFER_APPENDED,()=>{const h=this.bufferedEnd;this.reachedPlayout(h)&&(this._bufferedEosTime=h,s.trigger(H.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=y3(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,s=nn.bufferInfo(e,i,0);return this.getAssetTime(s.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=nn.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var i;(i=this.hls)==null||i.on(e,t)}once(e,t,n){var i;(i=this.hls)==null||i.once(e,t)}off(e,t,n){var i;(i=this.hls)==null||i.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Em(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const tw=.033;class uY extends ko{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(s=i[n])!=null&&s.event;){var s;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let i=0;i<n.length;i++){let s=n[i];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return i}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let i=e;i<=t&&n[i];i++){const s=n[i].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var n;if(((n=t[i].event)==null?void 0:n.identifier)===e)return i}return-1}findAssetIndex(e,t){const n=e.assetList,i=n.length;if(i>1)for(let s=0;s<i;s++){const a=n[s];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||s===i-1))return s}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,i=n[n.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:i}=n,s=this.events,a=this.parseDateRanges(i,{url:n.url},t),o=Object.keys(i),u=s?s.filter(c=>!o.includes(c.identifier)):[];a.length&&a.sort((c,h)=>{const p=c.cue.pre,v=c.cue.post,y=h.cue.pre,_=h.cue.post;if(p&&!y)return-1;if(y&&!p||v&&!_)return 1;if(_&&!v)return-1;if(!p&&!y&&!v&&!_){const A=c.startTime,E=h.startTime;if(A!==E)return A-E}return c.dateRange.tagOrder-h.dateRange.tagOrder}),this.events=a,u.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,u)}updateSchedule(e,t=[],n=!1){const i=this.events||[];if(i.length||t.length||this.length<2){const s=this.items,a=this.parseSchedule(i,e);(n||t.length||s?.length!==a.length||a.some((u,c)=>Math.abs(u.playout.start-s[c].playout.start)>.005||Math.abs(u.playout.end-s[c].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,n){const i=[],s=Object.keys(e);for(let a=0;a<s.length;a++){const o=s[a],u=e[o];if(u.isInterstitial){let c=this.eventMap[o];c?c.setDateRange(u):(c=new aY(u,t),this.eventMap[o]=c,n===!1&&(c.appendInPlace=n)),i.push(c)}}return i}parseSchedule(e,t){const n=[],i=t.main.details,s=i.live?1/0:i.edge;let a=0;if(e=e.filter(u=>!u.error&&!(u.cue.once&&u.hasPlayed)),e.length){this.resolveOffsets(e,t);let u=0,c=0;if(e.forEach((h,p)=>{const v=h.cue.pre,y=h.cue.post,_=e[p-1]||null,A=h.appendInPlace,E=y?s:h.startOffset,T=h.duration,M=h.timelineOccupancy===mA.Range?T:0,R=h.resumptionOffset,L=_?.startTime===E,w=E+h.cumulativeDuration;let N=A?w+T:E+R;if(v||!y&&E<=0){const F=c;c+=M,h.timelineStart=w;const B=a;a+=T,n.push({event:h,start:w,end:N,playout:{start:B,end:a},integrated:{start:F,end:c}})}else if(E<=s){if(!L){const P=E-u;if(P>tw){const V=u,J=c;c+=P;const Q=a;a+=P;const ie={previousEvent:e[p-1]||null,nextEvent:h,start:V,end:V+P,playout:{start:Q,end:a},integrated:{start:J,end:c}};n.push(ie)}else P>0&&_&&(_.cumulativeDuration+=P,n[n.length-1].end=E)}y&&(N=w),h.timelineStart=w;const F=c;c+=M;const B=a;a+=T,n.push({event:h,start:w,end:N,playout:{start:B,end:a},integrated:{start:F,end:c}})}else return;const O=h.resumeTime;y||O>s?u=s:u=O}),u<s){var o;const h=u,p=c,v=s-u;c+=v;const y=a;a+=v,n.push({previousEvent:((o=n[n.length-1])==null?void 0:o.event)||null,nextEvent:null,start:u,end:h+v,playout:{start:y,end:a},integrated:{start:p,end:c}})}this.setDurations(s,a,c)}else n.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,i=n.live?1/0:n.edge;let s=0,a=-1;e.forEach((o,u)=>{const c=o.cue.pre,h=o.cue.post,p=c?0:h?i:o.startTime;this.updateAssetDurations(o),a===p?o.cumulativeDuration=s:(s=0,a=p),!h&&o.snapOptions.in&&(o.resumeAnchor=Pd(null,n.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&u+1<e.length&&e[u+1].startTime-e[u].resumeTime<tw&&(e[u+1].appendInPlace=!1,e[u+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const y=yt(o.resumeOffset)?o.resumeOffset:o.duration;s+=y})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(n-i)>Pm?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${i}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,u=o.edge;if(n>=u)return this.log(`"${e.identifier}" resumption ${n} past ${a} playlist end ${u}`),!1;const c=Pd(null,o.fragments,n);if(!c)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const h=a==="audio"?.175:0;return Math.abs(c.start-n)<Pm+h||Math.abs(c.end-n)<Pm+h?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${a} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,i=!1,s=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],u=t+n;o.startOffset=n,o.timelineStart=u,i||(i=o.duration===null),s||(s=!!o.error);const c=o.error?0:o.duration||0;n+=c}i&&!s?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function hl(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}class cY{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let i;try{i=y3(n,this.hls.sessionId,e.baseUrl)}catch(v){const y=this.assignAssetListError(e,Se.ASSET_LIST_LOAD_ERROR,v,n);this.hls.trigger(H.ERROR,y);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,a=s.loader,o=new a(s),u={responseType:"json",url:i.href},c=s.interstitialAssetListLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,y,_,A)=>{const E=v.data,T=E?.ASSETS;if(!Array.isArray(T)){const M=this.assignAssetListError(e,Se.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),_.url,y,A);this.hls.trigger(H.ERROR,M);return}e.assetListResponse=E,this.hls.trigger(H.ASSET_LIST_LOADED,{event:e,assetListResponse:E,networkDetails:A})},onError:(v,y,_,A)=>{const E=this.assignAssetListError(e,Se.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${v.code} ${v.text} (${y.url})`),y.url,A,_);this.hls.trigger(H.ERROR,E)},onTimeout:(v,y,_)=>{const A=this.assignAssetListError(e,Se.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${y.url})`),y.url,v,_);this.hls.trigger(H.ERROR,A)}};return o.load(u,h,p),this.hls.trigger(H.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,n,i,s,a){return e.error=n,{type:Lt.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:n,networkDetails:a,stats:s}}}function nw(r){var e;r==null||(e=r.play())==null||e.catch(()=>{})}function Nx(r,e){return`[${r}] Advancing timeline position to ${e}`}class fY extends ko{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const i=n-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const a=i<=-.01;this.timelinePos=n,this.bufferedPos=n;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(n,n-i)&&this.updateSchedule(!0),this.checkBuffer(),a&&n<o.start||n>=o.end){var u;const y=this.findItemIndex(o);let _=this.schedule.findItemIndexAtTime(n);if(_===-1&&(_=y+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${n} (resolving from ${y} to ${_})`)),!this.isInterstitial(o)&&(u=this.media)!=null&&u.paused&&(this.shouldPlay=!1),!a&&_>y){const A=this.schedule.findJumpRestrictedIndex(y+1,_);if(A>y){this.setSchedulePosition(A);return}}this.setSchedulePosition(_);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(o)){const y=o.event.assetList[0];y&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,y))}return}const h=c.timelineStart,p=c.duration||0;if(a&&n<h||n>=h+p){var v;(v=o.event)!=null&&v.appendInPlace&&(this.clearAssetPlayers(o.event,o),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,c)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(n>=i.end){this.timelinePos=i.end;const o=this.findItemIndex(i);this.setSchedulePosition(o+1)}const s=this.playingAsset;if(!s)return;const a=s.timelineStart+(s.duration||0);n>=a&&this.setScheduleToAssetAtTime(n,s)},this.onScheduleUpdate=(n,i)=>{const s=this.schedule;if(!s)return;const a=this.playingItem,o=s.events||[],u=s.items||[],c=s.durations,h=n.map(A=>A.identifier),p=!!(o.length||h.length);(p||i)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${u.map(A=>hl(A))} pos: ${this.timelinePos}`),h.length&&this.log(`Removed events ${h}`);let v=null,y=null;a&&(v=this.updateItem(a,this.timelinePos),this.itemsMatch(a,v)?this.playingItem=v:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const _=this.bufferingItem;if(_&&(y=this.updateItem(_,this.bufferedPos),this.itemsMatch(_,y)?this.bufferingItem=y:_.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(_.event,null))),n.forEach(A=>{A.assetList.forEach(E=>{this.clearAssetPlayer(E.identifier,null)})}),this.playerQueue.forEach(A=>{if(A.interstitial.appendInPlace){const E=A.assetItem.timelineStart,T=A.timelineOffset-E;if(T)try{A.timelineOffset=E}catch(M){Math.abs(T)>Pm&&this.warn(`${M} ("${A.assetId}" ${A.timelineOffset}->${E})`)}}}),p||i){if(this.hls.trigger(H.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:u.slice(0),durations:c,removedIds:h}),this.isInterstitial(a)&&h.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(v,a),_&&y!==v&&this.trimInPlace(y,_),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new cY(e),this.schedule=new uY(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(H.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(H.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(H.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(H.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(H.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(H.BUFFER_APPENDED,this.onBufferAppended,this),e.on(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(H.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(H.MEDIA_ENDED,this.onMediaEnded,this),e.on(H.ERROR,this.onError,this),e.on(H.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(H.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(H.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(H.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(H.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(H.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(H.BUFFER_CODECS,this.onBufferCodecs,this),e.off(H.BUFFER_APPENDED,this.onBufferAppended,this),e.off(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(H.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(H.MEDIA_ENDED,this.onMediaEnded,this),e.off(H.ERROR,this.onError,this),e.off(H.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){xa(e,"play",this.onPlay),xa(e,"pause",this.onPause),xa(e,"seeking",this.onSeeking),xa(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;ea(n,"seeking",this.onSeeking),ea(n,"timeupdate",this.onTimeupdate),ea(n,"play",this.onPlay),ea(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!i){this.clearScheduleState();const s=this.findItemIndex(n);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(this.media=null,!n&&(i&&this.removeMediaListeners(i),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=p=>p&&e.getAssetPlayer(p.identifier),i=(p,v,y,_,A)=>{if(p){let E=p[v].start;const T=p.event;if(T){if(v==="playout"||T.timelineOccupancy!==mA.Point){const M=n(y);M?.interstitial===T&&(E+=M.assetItem.startOffset+M[A])}}else{const M=_==="bufferedPos"?a():e[_];E+=M-p.start}return E}return 0},s=(p,v)=>{var y;if(p!==0&&v!=="primary"&&(y=e.schedule)!=null&&y.length){var _;const A=e.schedule.findItemIndexAtTime(p),E=(_=e.schedule.items)==null?void 0:_[A];if(E){const T=E[v].start-E.start;return p+T}}return p},a=()=>{const p=e.bufferedPos;return p===Number.MAX_VALUE?o("primary"):Math.max(p,0)},o=p=>{var v,y;return(v=e.primaryDetails)!=null&&v.live?e.primaryDetails.edge:((y=e.schedule)==null?void 0:y.durations[p])||0},u=(p,v)=>{var y,_;const A=e.effectivePlayingItem;if(A!=null&&(y=A.event)!=null&&y.restrictions.skip||!e.schedule)return;e.log(`seek to ${p} "${v}"`);const E=e.effectivePlayingItem,T=e.schedule.findItemIndexAtTime(p,v),M=(_=e.schedule.items)==null?void 0:_[T],R=e.getBufferingPlayer(),L=R?.interstitial,w=L?.appendInPlace,N=E&&e.itemsMatch(E,M);if(E&&(w||N)){const O=n(e.playingAsset),F=O?.media||e.primaryMedia;if(F){const B=v==="primary"?F.currentTime:i(E,v,e.playingAsset,"timelinePos","currentTime"),P=p-B,V=(w?B:F.currentTime)+P;if(V>=0&&(!O||w||V<=O.duration)){F.currentTime=V;return}}}if(M){let O=p;if(v!=="primary"){const B=M[v].start,P=p-B;O=M.start+P}const F=!e.isInterstitial(M);if((!e.isInterstitial(E)||E.event.appendInPlace)&&(F||M.event.appendInPlace)){const B=e.media||(w?R?.media:null);B&&(B.currentTime=O)}else if(E){const B=e.findItemIndex(E);if(T>B){const V=e.schedule.findJumpRestrictedIndex(B+1,T);if(V>B){e.setSchedulePosition(V);return}}let P=0;if(F)e.timelinePos=O,e.checkBuffer();else{const V=M.event.assetList,J=p-(M[v]||M).start;for(let Q=V.length;Q--;){const ie=V[Q];if(ie.duration&&J>=ie.startOffset&&J<ie.startOffset+ie.duration){P=Q;break}}}e.setSchedulePosition(T,P)}}},c=()=>{const p=e.effectivePlayingItem;if(e.isInterstitial(p))return p;const v=t();return e.isInterstitial(v)?v:null},h={get bufferedEnd(){const p=t(),v=e.bufferingItem;if(v&&v===p){var y;return i(v,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-v.playout.start||((y=e.bufferingAsset)==null?void 0:y.startOffset)||0}return 0},get currentTime(){const p=c(),v=e.effectivePlayingItem;return v&&v===p?i(v,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-v.playout.start:0},set currentTime(p){const v=c(),y=e.effectivePlayingItem;y&&y===v&&u(p+y.playout.start,"playout")},get duration(){const p=c();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const v=(p=c())==null?void 0:p.event.assetList;return v?v.map(y=>e.getAssetPlayer(y.identifier)):[]},get playingIndex(){var p;const v=(p=c())==null?void 0:p.event;return v&&e.effectivePlayingAsset?v.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var p;return((p=e.schedule)==null||(p=p.events)==null?void 0:p.slice(0))||[]},get schedule(){var p;return((p=e.schedule)==null||(p=p.items)==null?void 0:p.slice(0))||[]},get interstitialPlayer(){return c()?h:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const p=t();return e.findItemIndex(p)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const p=e.effectivePlayingItem;return e.findItemIndex(p)},primary:{get bufferedEnd(){return a()},get currentTime(){const p=e.timelinePos;return p>0?p:0},set currentTime(p){u(p,"primary")},get duration(){return o("primary")},get seekableStart(){var p;return((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){u(p,"integrated")},get duration(){return o("integrated")},get seekableStart(){var p;return s(((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=e.effectivePlayingItem,v=p?.event;if(v&&!v.restrictions.skip){const y=e.findItemIndex(p);if(v.appendInPlace){const _=p.playout.start+p.event.duration;u(_+.001,"playout")}else e.advanceAfterAssetEnded(v,y,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(i=this.primaryMedia);const s=(t=i)==null?void 0:t.currentTime;if(!(s===void 0||!yt(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,i=e.media;if(n&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${vi(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var n,i;if(e.media===t)return;let s=null;const a=this.hls,o=e!==a,u=o&&e.interstitial.appendInPlace,c=(n=this.detachedData)==null?void 0:n.mediaSource;let h;if(a.media)u&&(s=a.transferMedia(),this.detachedData=s),h="Primary";else if(c){const _=this.getBufferingPlayer();_?(s=_.transferMedia(),h=`${_}`):h="detached MediaSource"}else h="detached media";if(!s){if(c)s=this.detachedData,this.log(`using detachedData: MediaSource ${vi(s)}`);else if(!this.detachedData||a.media===t){const _=this.playerQueue;_.length>1&&_.forEach(A=>{if(o&&A.interstitial.appendInPlace!==u){const E=A.interstitial;this.clearInterstitial(A.interstitial,null),E.appendInPlace=!1,E.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${E}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const p=s&&"mediaSource"in s&&((i=s.mediaSource)==null?void 0:i.readyState)!=="closed",v=p&&s?s:t;this.log(`${p?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${h} (media.currentTime: ${t.currentTime})`);const y=this.schedule;if(v===s&&y){const _=o&&e.assetId===y.assetIdAtEnd;v.overrides={duration:y.duration,endOfStream:!o||_,cueRemoval:!o}}e.attachMedia(v)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,i=this.effectivePlayingItem;if(n===-1){const s=this.hls.startPosition;if(this.log(Nx("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(s>=0||!this.primaryLive){const a=this.timelinePos=s>0?s:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(i&&!this.playingItem){const s=e.findItemIndex(i);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){const n=e.event,i=n.findAssetIndex(t),s=wb(n,i);if(!n.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,n){const i=wb(e,n);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const s=this.schedule.items;if(s){const a=t+1,o=s.length;if(a>=o){this.setSchedulePosition(-1);return}const u=e.resumeTime;this.timelinePos<u&&(this.log(Nx("advanceAfterAssetEnded",u)),this.timelinePos=u,e.appendInPlace&&this.advanceInPlace(u),this.checkBuffer(this.bufferedPos<u)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const s=e.assetList[i];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const i=t.parentIdentifier,s=n.getEvent(i);if(s){const a=n.findEventIndex(i),o=n.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,a,o-1)}}setSchedulePosition(e,t){var n;const i=(n=this.schedule)==null?void 0:n.items;if(!i||this.playbackDisabled)return;const s=e>=0?i[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&hl(s)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const h=a.event,p=this.playingAsset,v=p?.identifier,y=v?this.getAssetPlayer(v):null;if(y&&v&&(!this.eventItemsMatch(a,s)||t!==void 0&&v!==h.assetList[t].identifier)){var u;const _=h.findAssetIndex(p);if(this.log(`INTERSTITIAL_ASSET_ENDED ${_+1}/${h.assetList.length} ${Em(p)}`),this.endedAsset=p,this.playingAsset=null,this.hls.trigger(H.INTERSTITIAL_ASSET_ENDED,{asset:p,assetListIndex:_,event:h,schedule:i.slice(0),scheduleIndex:e,player:y}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(h,this.findItemIndex(this.playingItem),_);return}this.retreiveMediaSource(v,s),y.media&&!((u=this.detachedData)!=null&&u.mediaSource)&&y.detachMedia()}if(!this.eventItemsMatch(a,s)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${hl(a)}`),h.hasPlayed=!0,this.hls.trigger(H.INTERSTITIAL_ENDED,{event:h,schedule:i.slice(0),scheduleIndex:e}),h.cue.once)){var c;this.updateSchedule();const _=(c=this.schedule)==null?void 0:c.items;if(s&&_){const A=this.findItemIndex(s);this.advanceSchedule(A,_,t,a,o)}return}}this.advanceSchedule(e,i,t,a,o)}advanceSchedule(e,t,n,i,s){const a=this.schedule;if(!a)return;const o=t[e]||null,u=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(h=>{const p=h.interstitial,v=a.findEventIndex(p.identifier);(v<e||v>e+1)&&this.clearInterstitial(p,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const h=o.event;if(n===void 0){n=a.findAssetIndex(h,this.timelinePos);const _=wb(h,n-1);if(h.isAssetPastPlayoutLimit(_)||h.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(h,e,n);return}n=_}const p=this.waitingItem;this.assetsBuffered(o,u)||this.setBufferingItem(o);let v=this.preloadAssets(h,n);if(this.eventItemsMatch(o,p||i)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${hl(o)} ${h.appendInPlace?"append in place":""}`),this.hls.trigger(H.INTERSTITIAL_STARTED,{event:h,schedule:t.slice(0),scheduleIndex:e})),!h.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${h}`);return}if(h.assetListLoader&&(h.assetListLoader.destroy(),h.assetListLoader=void 0),!u){this.log(`Waiting for attachMedia to start Interstitial ${h}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const y=h.assetList[n];if(!y){this.advanceAfterAssetEnded(h,e,n||0);return}if(v||(v=this.getAssetPlayer(y.identifier)),v===null||v.destroyed){const _=h.assetList.length;this.warn(`asset ${n+1}/${_} player destroyed ${h}`),v=this.createAssetPlayer(h,y,n),v.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&h.appendInPlace&&this.isAssetBuffered(y))return;this.startAssetPlayer(v,n,t,e,u),this.shouldPlay&&nw(v.media)}else o?(this.resumePrimary(o,e,i),this.shouldPlay&&nw(this.hls.media)):s&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var i,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${hl(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(Nx("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!n)return;const a=(s=this.schedule)==null?void 0:s.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${hl(e)}`),this.hls.trigger(H.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(n<i.fragmentStart||n>i.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:nn.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,i),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(Nx("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((n=i.mainForwardBufferInfo)==null?void 0:n.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(H.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(H.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const i=ti(ti({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=ti(ti({},this.altSelection),{},{audio:n});return}const s=ti(ti({},i),{},{audio:n});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=ti(ti({},this.altSelection),{},{subtitles:n});return}const s=ti(ti({},i),{},{subtitles:n});this.mediaSelection=s}onAudioTrackSwitching(e,t){const n=fI(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setAudioOption(t)||i.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=fI(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setSubtitleOption(t)||t.id!==-1&&i.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const s=t[i];if(s.cue.post){var n;const a=this.schedule.findEventIndex(s.identifier),o=(n=this.schedule.items)==null?void 0:n[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const i=(n=this.schedule)==null?void 0:n.items;if(e&&i){const s=this.findItemIndex(e,t);return i[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(s.identifier,null)});const n=e.end+.25,i=nn.bufferInfo(this.primaryMedia,n,0);(i.end>n||(i.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${hl(e)} (was ${hl(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const i=nn.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,n,e)}updateBufferedPos(e,t,n){const i=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let u=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const h=this.findItemIndex(s),p=Math.min(h+1,t.length-1),v=t[p];if((u===-1&&s&&e>=s.end||(c=v.event)!=null&&c.appendInPlace&&e+.01>=v.start)&&(u=p),this.isInterstitial(s)){const y=s.event;if(p-o>1&&y.appendInPlace===!1||y.assetList.length===0&&y.assetListLoader)return}if(this.bufferedPos=e,u>h&&u>o)this.bufferedToItem(v);else{const y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&v.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(v)&&this.preloadAssets(v.event,0)}}else n&&a&&!this.itemsMatch(a,s)&&(u===o?this.bufferedToItem(a):u===o+1&&this.bufferedToItem(t[u]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const s=this.getAssetPlayer(i.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:i,events:s}=n;if(!i||!s)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const u=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${hl(e)}`+(t?` (${u.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const c=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((h,p)=>{const v=this.getAssetPlayer(h.identifier);v&&(p===c&&v.loadSource(),v.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(H.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,i=n.assetList.length===0&&!n.assetListLoader,s=n.cue.once;if(i||!s){const a=this.preloadAssets(n,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const n=e.assetUrl,i=e.assetList.length,s=i===0&&!e.assetListLoader,a=e.cue.once;if(s){const u=e.timelineStart;if(e.appendInPlace){var o;const v=this.playingItem;!this.isInterstitial(v)&&(v==null||(o=v.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(u+.25)}let c,h=0;if(!this.playingItem&&this.primaryLive&&(h=this.hls.startPosition,h===-1&&(h=this.hls.liveSyncPosition||0)),h&&!(e.cue.pre||e.cue.post)){const v=h-u;v>0&&(c=Math.round(v*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:i} ${e}${c?` live-start: ${h} start-offset: ${c}`:""}`),n)return this.createAsset(e,0,0,u,e.duration,n);const p=this.assetListLoader.loadAssetList(e,c);p&&(e.assetListLoader=p)}else if(!a&&i){for(let c=t;c<i;c++){const h=e.assetList[c],p=this.getAssetPlayerQueueIndex(h.identifier);(p===-1||this.playerQueue[p].destroyed)&&!h.error&&this.createAssetPlayer(e,h,c)}const u=e.assetList[t];if(u){const c=this.getAssetPlayer(u.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(H.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,i,s,a){const o={parentIdentifier:e.identifier,identifier:rY(e,a,t),duration:s,startOffset:n,timelineStart:i,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,n){const i=this.hls,s=i.userConfig;let a=s.videoPreference;const o=i.loadLevelObj||i.levels[i.currentLevel];(a||o)&&(a=li({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const u=i.audioTracks[i.audioTrack],c=i.subtitleTracks[i.subtitleTrack];let h=0;if(this.primaryLive||e.appendInPlace){const L=this.timelinePos-t.timelineStart;if(L>1){const w=t.duration;w&&L<w&&(h=L)}}const p=t.identifier,v=ti(ti({},s),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:h,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:u||s.audioPreference,subtitlePreference:c||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(v.timelineOffset=t.timelineStart));const y=v.cmcd;y!=null&&y.sessionId&&y.contentId&&(v.cmcd=li({},y,{contentId:Tv(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);const _=new lY(this.HlsPlayerClass,v,e,t);this.playerQueue.push(_),e.assetList[n]=t;let A=!0;const E=L=>{if(L.live){var w;const F=new Error(`Interstitials MUST be VOD assets ${e}`),B={fatal:!0,type:Lt.OTHER_ERROR,details:Se.INTERSTITIAL_ASSET_ITEM_ERROR,error:F},P=((w=this.schedule)==null?void 0:w.findEventIndex(e.identifier))||-1;this.handleAssetItemError(B,e,P,n,F.message);return}const N=L.edge-L.fragmentStart,O=t.duration;(A||O===null||N>O)&&(A=!1,this.log(`Interstitial asset "${p}" duration change ${O} > ${N}`),t.duration=N,this.updateSchedule())};_.on(H.LEVEL_UPDATED,(L,{details:w})=>E(w)),_.on(H.LEVEL_PTS_UPDATED,(L,{details:w})=>E(w)),_.on(H.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const T=(L,w)=>{const N=this.getAssetPlayer(p);if(N&&w.tracks){N.off(H.BUFFER_CODECS,T),N.tracks=w.tracks;const O=this.primaryMedia;this.bufferingAsset===N.assetItem&&O&&!N.media&&this.bufferAssetPlayer(N,O)}};_.on(H.BUFFER_CODECS,T);const M=()=>{var L;const w=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${w}`),!w||!this.schedule)return;const N=this.schedule.findEventIndex(e.identifier),O=(L=this.schedule.items)==null?void 0:L[N];this.isInterstitial(O)&&this.advanceAssetBuffering(O,t)};_.on(H.BUFFERED_TO_END,M);const R=L=>()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;this.shouldPlay=!0;const N=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,N,L)};return _.once(H.MEDIA_ENDED,R(n)),_.once(H.PLAYOUT_LIMIT_REACHED,R(1/0)),_.on(H.ERROR,(L,w)=>{if(!this.schedule)return;const N=this.getAssetPlayer(p);if(w.details===Se.BUFFER_STALLED_ERROR){if(N!=null&&N.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(w,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${w.error} ${e}`)}),_.on(H.DESTROYING,()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;const w=new Error(`Asset player destroyed unexpectedly ${p}`),N={fatal:!0,type:Lt.OTHER_ERROR,details:Se.INTERSTITIAL_ASSET_ITEM_ERROR,error:w};this.handleAssetItemError(N,e,this.schedule.findEventIndex(e.identifier),n,w.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Em(t)}`),this.hls.trigger(H.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:_}),_}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const i=this.playerQueue[n];this.log(`clear ${i} toSegment: ${t&&hl(t)}`),this.transferMediaFromPlayer(i,t),this.playerQueue.splice(n,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,i,s){const{interstitial:a,assetItem:o,assetId:u}=e,c=a.assetList.length,h=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!h||h.identifier!==u)&&(h&&(this.clearAssetPlayer(h.identifier,n[i]),delete h.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${Em(o)}`),this.hls.trigger(H.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:n.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var n,i;if(!this.schedule)return;const{interstitial:s,assetItem:a}=e,o=this.schedule.findEventIndex(s.identifier),u=(n=this.schedule.items)==null?void 0:n[o];if(!u)return;e.loadSource(),this.setBufferingItem(u),this.bufferingAsset=a;const c=this.getBufferingPlayer();if(c===e)return;const h=s.appendInPlace;if(h&&c?.interstitial.appendInPlace===!1)return;const p=c?.tracks||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(h&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(p&&!XB(p,e.tracks)){const v=new Error(`Asset ${Em(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),y={fatal:!0,type:Lt.OTHER_ERROR,details:Se.INTERSTITIAL_ASSET_ITEM_ERROR,error:v},_=s.findAssetIndex(a);this.handleAssetItemError(y,s,o,_,v.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const i=n.currentTime,s=t.findAssetIndex(e,i),a=e.assetList[s];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const u=o.currentTime||i-a.timelineStart,c=o.duration-u;if(this.warn(`Stalled at ${u} of ${u+c} in ${o} ${e} (media.currentTime: ${i})`),u&&(c/n.playbackRate<.5||o.bufferedInPlaceToEnd(n))&&o.hls){const h=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,h,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,i,s){if(e.details===Se.BUFFER_STALLED_ERROR)return;const a=t.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&Em(a)} ${e.error}`),!this.schedule)return;const o=a?.identifier||"",u=this.getAssetPlayerQueueIndex(o),c=this.playerQueue[u]||null,h=this.schedule.items,p=li({},e,{fatal:!1,errorAction:Bm(!0),asset:a,assetListIndex:i,event:t,schedule:h,scheduleIndex:n,player:c});if(this.hls.trigger(H.INTERSTITIAL_ASSET_ERROR,p),!e.fatal)return;const v=this.playingAsset,y=this.bufferingAsset,_=new Error(s);if(a&&(this.clearAssetPlayer(o,null),a.error=_),!t.assetList.some(A=>!A.error))t.error=_;else for(let A=i;A<t.assetList.length;A++)this.resetAssetPlayer(t.assetList[A].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):v&&v.identifier===o?this.advanceAfterAssetEnded(t,n,i):y&&y.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,y)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let i=this.timelinePos;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${i} playing: ${hl(n)} error: ${e.error}`),i===-1&&(i=this.hls.startPosition);const a=this.updateItem(n,i);this.itemsMatch(n,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(i===-1){this.checkStart();return}if(!this.schedule)return;const s=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var n,i;const s=t.event,a=s.identifier,o=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(a)))return;const u=s.timelineStart,c=s.duration;let h=0;o.forEach((A,E)=>{const T=parseFloat(A.DURATION);this.createAsset(s,E,h,u+h,T,A.URI),h+=T}),s.duration=h,this.log(`Loaded asset-list with duration: ${h} (was: ${c}) ${s}`);const p=this.waitingItem,v=p?.event.identifier===a;this.updateSchedule();const y=(i=this.bufferingItem)==null?void 0:i.event;if(v){var _;const A=this.schedule.findEventIndex(a),E=(_=this.schedule.items)==null?void 0:_[A];if(E){if(!this.playingItem&&this.timelinePos>E.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==A){s.error=new Error(`Interstitial ${o.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${s}`),this.log(s.error.message),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(E)}this.setSchedulePosition(A)}else if(y?.identifier===a){const A=s.assetList[0];if(A){const E=this.getAssetPlayer(A.identifier);if(y.appendInPlace){const T=this.primaryMedia;E&&T&&this.bufferAssetPlayer(E,T)}else E&&E.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Se.ASSET_LIST_PARSING_ERROR:case Se.ASSET_LIST_LOAD_ERROR:case Se.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case Se.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const iw=500;class _3 extends fE{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",Tt.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(H.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(H.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(H.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(H.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(H.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(H.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ke.IDLE,this.setInterval(iw),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:i}=t;if(this.fragContextChanged(n)||(rs(n)&&(this.fragPrevious=n),this.state=ke.IDLE),!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const o=n.start;for(let c=0;c<s.length;c++)if(o>=s[c].start&&o<=s[c].end){a=s[c];break}const u=n.start+n.duration;a?a.end=u:(a={start:o,end:u},s.push(a)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:i}=t;if(n===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=s){a.shift();continue}else if(a[o].start<s)a[o].start=s;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(n,s,Tt.SUBTITLE)}}onError(e,t){const n=t.frag;n?.type===Tt.SUBTITLE&&(t.details===Se.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ke.STOPPED&&(this.state=ke.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&QO(this.levels,t)){this.levels=t.map(n=>new $m(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const i=new $m(n);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Tt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==ke.STOPPED&&this.setInterval(iw)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:i,levels:s}=this,{details:a,id:o}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const u=s[o];if(o>=s.length||!u)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(a.live||(n=u.details)!=null&&n.live){if(a.deltaUpdateFailed)return;const p=this.mainDetails;if(!p){this.startFragRequested=!1;return}const v=p.fragments[0];if(!u.details)a.hasProgramDateTime&&p.hasProgramDateTime?(dA(a,p),c=a.fragmentStart):v&&(c=v.start,L1(a,c));else{var h;c=this.alignPlaylists(a,u.details,(h=this.levelLastLoaded)==null?void 0:h.details),c===0&&v&&(c=v.start,L1(a,c))}p&&!this.startFragRequested&&this.setStartPosition(p,c)}u.details=a,this.levelLastLoaded=u,o===i&&(this.hls.trigger(H.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===ke.IDLE&&(Pd(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),u.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&i!=null&&i.key&&i.iv&&Om(i.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer,dC(i.method)).catch(o=>{throw s.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const u=performance.now();s.trigger(H.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:u}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=ke.IDLE})}}doTick(){if(!this.media){this.state=ke.IDLE;return}if(this.state===ke.IDLE){const{currentTrackId:e,levels:t}=this,n=t?.[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:i}=this,s=this.getLoadPosition(),a=nn.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:o,len:u}=a,c=n.details,h=this.hls.maxBufferLength+c.levelTargetDuration;if(u>h)return;const p=c.fragments,v=p.length,y=c.edge;let _=null;const A=this.fragPrevious;if(o<y){const M=i.maxFragLookUpTolerance,R=o>y-M?0:M;_=Pd(A,p,Math.max(p[0].start,o),R),!_&&A&&A.start<p[0].start&&(_=p[0])}else _=p[v-1];if(_=this.filterReplacedPrimary(_,n.details),!_)return;const E=_.sn-c.startSN,T=p[E-1];if(T&&T.cc===_.cc&&this.fragmentTracker.getState(T)===Cs.NOT_LOADED&&(_=T),this.fragmentTracker.getState(_)===Cs.NOT_LOADED){const M=this.mapToInitFragWhenRequired(_);M&&this.loadFragment(M,n,o)}}}loadFragment(e,t,n){rs(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new hY(this.tracksBuffered[this.currentTrackId]||[])}}class hY{constructor(e){this.buffered=void 0;const t=(n,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const dY={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},x3=r=>String.fromCharCode(dY[r]||r),dl=15,uc=100,pY={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},mY={17:2,18:4,21:6,22:8,23:10,19:13,20:15},gY={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},vY={25:2,26:4,29:6,30:8,31:10,27:13,28:15},yY=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class _Y{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;ii.log(`${this.time} [${e}] ${n}`)}}}const td=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class S3{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class xY{constructor(){this.uchar=" ",this.penState=new S3}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class SY{constructor(e){this.chars=[],this.pos=0,this.currPenState=new S3,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<uc;t++)this.chars.push(new xY);this.logger=e}equals(e){for(let t=0;t<uc;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<uc;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<uc;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>uc&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=uc)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=x3(e);if(this.pos>=uc){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<uc;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<uc;n++){const i=this.chars[n].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Bb{constructor(e){this.rows=[],this.currRow=dl-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<dl;t++)this.rows.push(new SY(e));this.logger=e}reset(){for(let e=0;e<dl;e++)this.rows[e].clear();this.currRow=dl-1}equals(e){let t=!0;for(let n=0;n<dl;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<dl;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<dl;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+vi(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<dl;o++)this.rows[o].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[s].cueStartTime,u=this.logger.time;if(o!==null&&u!==null&&o<u)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[s+c])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);n.setCursor(e.indent),e.color=n.chars[a].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+vi(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",i=-1;for(let s=0;s<dl;s++){const a=this.rows[s].getTextString();a&&(i=s+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class sw{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Bb(n),this.nonDisplayedMemory=new Bb(n),this.lastOutputScreen=new Bb(n),this.currRollUpRow=this.displayedMemory.rows[dl-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[dl-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[n]}this.logger.log(2,"MIDROW: "+vi(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class rw{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=EY(),this.logger=void 0;const i=this.logger=new _Y;this.channels=[null,new sw(e,t,i),new sw(e+1,n,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const i=t[n]&127,s=t[n+1]&127;let a=!1,o=null;if(i===0&&s===0)continue;this.logger.log(3,()=>"["+td([t[n],t[n+1]])+"] -> ("+td([i,s])+")");const u=this.cmdHistory;if(i>=16&&i<=31){if(AY(i,s,u)){Ux(null,null,u),this.logger.log(3,()=>"Repeated command ("+td([i,s])+") is dropped");continue}Ux(i,s,this.cmdHistory),a=this.parseCmd(i,s),a||(a=this.parseMidrow(i,s)),a||(a=this.parsePAC(i,s)),a||(a=this.parseBackgroundAttributes(i,s))}else Ux(null,null,u);if(!a&&(o=this.parseChars(i,s),o)){const h=this.currentChannel;h&&h>0?this.channels[h].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+td([i,s])+" orig: "+td([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(n||i))return!1;const s=e===20||e===21||e===23?1:2,a=this.channels[s];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+td([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(i||s))return!1;const a=e<=23?1:2;t>=64&&t<=95?n=a===1?pY[e]:gY[e]:n=a===1?mY[e]:vY[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(n,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,i.underline=(n&1)===1,n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((n-16)/2)*4,i}parseChars(e,t){let n,i=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+x3(a)+"' in channel "+n),i=[a]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+td(i).join(",")),i}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(n||i))return!1;let s;const a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=yY[s],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Ux(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Ux(r,e,t){t.a=r,t.b=e}function AY(r,e,t){return t.a===r&&t.b===e}function EY(){return{a:null,b:null}}var bC=(function(){if(hA!=null&&hA.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,u){if(typeof u!="string"||!Array.isArray(o))return!1;const c=u.toLowerCase();return~o.indexOf(c)?c:!1}function n(o){return t(r,o)}function i(o){return t(e,o)}function s(o,...u){let c=1;for(;c<arguments.length;c++){const h=arguments[c];for(const p in h)o[p]=h[p]}return o}function a(o,u,c){const h=this,p={enumerable:!0};h.hasBeenReset=!1;let v="",y=!1,_=o,A=u,E=c,T=null,M="",R=!0,L="auto",w="start",N=50,O="middle",F=50,B="middle";Object.defineProperty(h,"id",s({},p,{get:function(){return v},set:function(P){v=""+P}})),Object.defineProperty(h,"pauseOnExit",s({},p,{get:function(){return y},set:function(P){y=!!P}})),Object.defineProperty(h,"startTime",s({},p,{get:function(){return _},set:function(P){if(typeof P!="number")throw new TypeError("Start time must be set to a number.");_=P,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",s({},p,{get:function(){return A},set:function(P){if(typeof P!="number")throw new TypeError("End time must be set to a number.");A=P,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",s({},p,{get:function(){return E},set:function(P){E=""+P,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",s({},p,{get:function(){return T},set:function(P){T=P,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",s({},p,{get:function(){return M},set:function(P){const V=n(P);if(V===!1)throw new SyntaxError("An invalid or illegal string was specified.");M=V,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",s({},p,{get:function(){return R},set:function(P){R=!!P,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",s({},p,{get:function(){return L},set:function(P){if(typeof P!="number"&&P!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");L=P,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",s({},p,{get:function(){return w},set:function(P){const V=i(P);if(!V)throw new SyntaxError("An invalid or illegal string was specified.");w=V,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",s({},p,{get:function(){return N},set:function(P){if(P<0||P>100)throw new Error("Position must be between 0 and 100.");N=P,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",s({},p,{get:function(){return O},set:function(P){const V=i(P);if(!V)throw new SyntaxError("An invalid or illegal string was specified.");O=V,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",s({},p,{get:function(){return F},set:function(P){if(P<0||P>100)throw new Error("Size must be between 0 and 100.");F=P,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",s({},p,{get:function(){return B},set:function(P){const V=i(P);if(!V)throw new SyntaxError("An invalid or illegal string was specified.");B=V,this.hasBeenReset=!0}})),h.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a})();class TY{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function A3(r){function e(n,i,s,a){return(n|0)*3600+(i|0)*60+(s|0)+parseFloat(a||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class bY{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function E3(r,e,t,n){const i=n?r.split(n):[r];for(const s in i){if(typeof i[s]!="string")continue;const a=i[s].split(t);if(a.length!==2)continue;const o=a[0],u=a[1];e(o,u)}}const F1=new bC(0,0,""),Fx=F1.align==="middle"?"middle":"center";function MY(r,e,t){const n=r;function i(){const o=A3(r);if(o===null)throw new Error("Malformed timestamp: "+n);return r=r.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,u){const c=new bY;E3(o,function(v,y){let _;switch(v){case"region":for(let A=t.length-1;A>=0;A--)if(t[A].id===y){c.set(v,t[A].region);break}break;case"vertical":c.alt(v,y,["rl","lr"]);break;case"line":_=y.split(","),c.integer(v,_[0]),c.percent(v,_[0])&&c.set("snapToLines",!1),c.alt(v,_[0],["auto"]),_.length===2&&c.alt("lineAlign",_[1],["start",Fx,"end"]);break;case"position":_=y.split(","),c.percent(v,_[0]),_.length===2&&c.alt("positionAlign",_[1],["start",Fx,"end","line-left","line-right","auto"]);break;case"size":c.percent(v,y);break;case"align":c.alt(v,y,["start",Fx,"end","left","right"]);break}},/:/,/\s/),u.region=c.get("region",null),u.vertical=c.get("vertical","");let h=c.get("line","auto");h==="auto"&&F1.line===-1&&(h=-1),u.line=h,u.lineAlign=c.get("lineAlign","start"),u.snapToLines=c.get("snapToLines",!0),u.size=c.get("size",100),u.align=c.get("align",Fx);let p=c.get("position","auto");p==="auto"&&F1.position===50&&(p=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=p}function a(){r=r.replace(/^\s+/,"")}if(a(),e.startTime=i(),a(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);r=r.slice(3),a(),e.endTime=i(),a(),s(r,e)}function T3(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class CY{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new TY,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let s=t.buffer,a=0;for(s=T3(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const o=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),o}function i(s){E3(s,function(a,o){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=n();const o=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=n(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new bC(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{MY(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=s.indexOf("-->")!==-1;if(!s||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const RY=/\r\n|\n\r|\n|\r/g,Ob=function(e,t,n=0){return e.slice(n,n+t.length)===t},DY=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!yt(t)||!yt(n)||!yt(i)||!yt(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*i,t+=3600*1e3*s,t};function MC(r,e,t){return Tv(r.toString())+Tv(e.toString())+Tv(t)}const LY=function(e,t,n){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=n};function IY(r,e,t,n,i,s,a){const o=new CY,u=Qa(new Uint8Array(r)).trim().replace(RY,`
`).split(`
`),c=[],h=e?Y7(e.baseTime,e.timescale):0;let p="00:00.000",v=0,y=0,_,A=!0;o.oncue=function(E){const T=t[n];let M=t.ccOffset;const R=(v-h)/9e4;if(T!=null&&T.new&&(y!==void 0?M=t.ccOffset=T.start:LY(t,n,R)),R){if(!e){_=new Error("Missing initPTS for VTT MPEGTS");return}M=R-t.presentationOffset}const L=E.endTime-E.startTime,w=za((E.startTime+M-y)*9e4,i*9e4)/9e4;E.startTime=Math.max(w,0),E.endTime=Math.max(w+L,0);const N=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(N)),E.id||(E.id=MC(E.startTime,E.endTime,N)),E.endTime>0&&c.push(E)},o.onparsingerror=function(E){_=E},o.onflush=function(){if(_){a(_);return}s(c)},u.forEach(E=>{if(A)if(Ob(E,"X-TIMESTAMP-MAP=")){A=!1,E.slice(16).split(",").forEach(T=>{Ob(T,"LOCAL:")?p=T.slice(6):Ob(T,"MPEGTS:")&&(v=parseInt(T.slice(7)))});try{y=DY(p)/1e3}catch(T){_=T}return}else E===""&&(A=!1);o.parse(E+`
`)}),o.flush()}const Pb="stpp.ttml.im1t",b3=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,M3=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,wY={left:"start",center:"center",right:"end",start:"start",end:"end"};function aw(r,e,t,n){const i=mn(new Uint8Array(r),["mdat"]);if(i.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(o=>Qa(o)),a=K7(e.baseTime,1,e.timescale);try{s.forEach(o=>t(BY(o,a)))}catch(o){n(o)}}function BY(r,e){const i=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((p,v)=>(p[v]=i.getAttribute(`ttp:${v}`)||s[v],p),{}),o=i.getAttribute("xml:space")!=="preserve",u=ow(Nb(i,"styling","style")),c=ow(Nb(i,"layout","region")),h=Nb(i,"body","[begin]");return[].map.call(h,p=>{const v=C3(p,o);if(!v||!p.hasAttribute("begin"))return null;const y=Fb(p.getAttribute("begin"),a),_=Fb(p.getAttribute("dur"),a);let A=Fb(p.getAttribute("end"),a);if(y===null)throw lw(p);if(A===null){if(_===null)throw lw(p);A=y+_}const E=new bC(y-e,A-e,v);E.id=MC(E.startTime,E.endTime,E.text);const T=c[p.getAttribute("region")],M=u[p.getAttribute("style")],R=OY(T,M,u),{textAlign:L}=R;if(L){const w=wY[L];w&&(E.lineAlign=w),E.align=L}return li(E,R),E}).filter(p=>p!==null)}function Nb(r,e,t){const n=r.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function ow(r){return r.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function C3(r,e){return[].slice.call(r.childNodes).reduce((t,n,i)=>{var s;return n.nodeName==="br"&&i?t+`
`:(s=n.childNodes)!=null&&s.length?C3(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function OY(r,e,t){const n="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(i=t[a]),s.reduce((o,u)=>{const c=Ub(e,n,u)||Ub(r,n,u)||Ub(i,n,u);return c&&(o[u]=c),o},{})}function Ub(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function lw(r){return new Error(`Could not parse ttml timestamp ${r}`)}function Fb(r,e){if(!r)return null;let t=A3(r);return t===null&&(b3.test(r)?t=PY(r,e):M3.test(r)&&(t=NY(r,e))),t}function PY(r,e){const t=b3.exec(r),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function NY(r,e){const t=M3.exec(r),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class kx{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class R3{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=cw(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(H.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(H.FRAG_LOADING,this.onFragLoading,this),e.on(H.FRAG_LOADED,this.onFragLoaded,this),e.on(H.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(H.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(H.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(H.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(H.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(H.FRAG_LOADING,this.onFragLoading,this),e.off(H.FRAG_LOADED,this.onFragLoaded,this),e.off(H.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(H.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(H.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(H.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new kx(this,"textTrack1"),t=new kx(this,"textTrack2"),n=new kx(this,"textTrack3"),i=new kx(this,"textTrack4");this.cea608Parser1=new rw(1,e,t),this.cea608Parser2=new rw(3,n,i)}addCues(e,t,n,i,s){let a=!1;for(let o=s.length;o--;){const u=s[o],c=UY(u[0],u[1],t,n);if(c>=0&&(u[0]=Math.min(u[0],t),u[1]=Math.max(u[1],n),a=!0,c/(n-t)>.5))return}if(a||s.push([t,n]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,n,i)}else{const o=this.Cues.newCue(null,t,n,i);this.hls.trigger(H.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s,trackId:a}){const{unparsedVttFrags:o}=this;n===Tt.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:s,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(u=>{this.initPTS[u.frag.cc]?this.onFragLoaded(H.FRAG_LOADED,u):this.hls.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:u.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const s=n.textTracks[i];if(uw(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:i}=this,{label:s,languageCode:a}=t[e],o=this.getExistingTrack(s,a);if(o)n[e]=o,bm(n[e]),m3(n[e],i);else{const u=this.createTextTrack("captions",s,a);u&&(u[e]=!0,n[e]=u)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,i={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(H.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,n){const i=this.media;if(i)return i.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:i}=this;Object.keys(i).forEach(s=>{bm(i[s]),delete i[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=cw(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)bm(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],i=n.some(s=>s.textCodec===Pb);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(QO(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const a=this.media,o=a?eS(a.textTracks):null;if(this.tracks.forEach((u,c)=>{let h;if(o){let p=null;for(let v=0;v<o.length;v++)if(o[v]&&uw(o[v],u)){p=o[v],o[v]=null;break}p&&(h=p)}if(h)bm(h);else{const p=D3(u);h=this.createTextTrack(p,u.name,u.lang),h&&(h.mode="disabled")}h&&this.textTracks.push(h)}),o!=null&&o.length){const u=o.filter(c=>c!==null).map(c=>c.label);u.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${u.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(H.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const i=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!i)return;const s=`textTrack${i[1]}`,a=this.captionsProperties[s];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Tt.MAIN){var n,i;const{cea608Parser1:s,cea608Parser2:a,lastSn:o}=this,{cc:u,sn:c}=t.frag,h=(n=(i=t.part)==null?void 0:i.index)!=null?n:-1;s&&a&&(c!==o+1||c===o&&h!==this.lastPartIndex+1||u!==this.lastCc)&&(s.reset(),a.reset()),this.lastCc=u,this.lastSn=c,this.lastPartIndex=h}}onFragLoaded(e,t){const{frag:n,payload:i}=t;if(n.type===Tt.SUBTITLE)if(i.byteLength){const s=n.decryptdata,a="stats"in t;if(s==null||!s.encrypted||a){const o=this.tracks[n.level],u=this.vttCCs;u[n.cc]||(u[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),o&&o.textCodec===Pb?this._parseIMSC1(n,i):this._parseVTTs(t)}}else this.hls.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;aw(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),n.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{n.logger.log(`Failed to parse IMSC1: ${i}`),n.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:n,payload:i}=e,{initPTS:s,unparsedVttFrags:a}=this,o=s.length-1;if(!s[n.cc]&&o===-1){a.push(e);return}const u=this.hls,c=(t=n.initSegment)!=null&&t.data?No(n.initSegment.data,new Uint8Array(i)).buffer:i;IY(c,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,h=>{this._appendCues(h,n.level),u.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},h=>{const p=h.message==="Missing initPTS for VTT MPEGTS";p?a.push(e):this._fallbackToIMSC1(n,i),u.logger.log(`Failed to parse VTT cue: ${h}`),!(p&&o>n.cc)&&u.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:h})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||aw(t,this.initPTS[e.cc],()=>{n.textCodec=Pb,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>g3(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;n.trigger(H.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===Tt.SUBTITLE&&this.onFragLoaded(H.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:i}=t;if(!(n.type===Tt.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let s=0;s<i.length;s++){const a=i[s].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(i[s].pts,o[0]),this.cea608Parser2.addData(i[s].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:i,type:s}){const{media:a}=this;if(!(!a||a.currentTime<n)){if(!s||s==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(u=>U1(o[u],t,n))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(u=>U1(o[u],t,i))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let i=2;for(let s=0;s<n;s++){const a=e[i++],o=127&e[i++],u=127&e[i++];if(o===0&&u===0)continue;if((4&a)!==0){const h=3&a;(h===0||h===1)&&(t[h].push(o),t[h].push(u))}}return t}}function D3(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function uw(r,e){return!!r&&r.kind===D3(e)&&B1(e,r)}function UY(r,e,t,n){return Math.min(e,n)-Math.max(r,t)}function cw(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const FY=/\s/,L3={newCue(r,e,t,n){const i=[];let s,a,o,u,c;const h=self.VTTCue||self.TextTrackCue;for(let v=0;v<n.rows.length;v++)if(s=n.rows[v],o=!0,u=0,c="",!s.isEmpty()){var p;for(let A=0;A<s.chars.length;A++)FY.test(s.chars[A].uchar)&&o?u++:(c+=s.chars[A].uchar,o=!1);s.cueStartTime=e,e===t&&(t+=1e-4),u>=16?u--:u++;const y=T3(c.trim()),_=MC(e,t,y);r!=null&&(p=r.cues)!=null&&p.getCueById(_)||(a=new h(e,t,y),a.id=_,a.line=v+1,a.align="left",a.position=10+Math.min(80,Math.floor(u*8/32)*10),i.push(a))}return r&&i.length&&(i.sort((v,y)=>v.line==="auto"||y.line==="auto"?0:v.line>8&&y.line>8?y.line-v.line:v.line-y.line),i.forEach(v=>g3(r,v))),i}};function I3(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const kY=/(\d+)-(\d+)\/(\d+)/;class k1{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||VY,this.controller=new self.AbortController,this.stats=new lE}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=GY(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:u,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=u&&yt(u)?u:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(Kv(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var v;this.response=this.loader=p;const y=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},c-(y-i.loading.start)),!p.ok){const{status:A,statusText:E}=p;throw new KY(E||"fetch, bad network response",A,p)}i.loading.first=y,i.total=zY(p.headers)||i.total;const _=(v=this.callbacks)==null?void 0:v.onProgress;return _&&yt(t.highWaterMark)?this.loadProgressively(p,i,e,t.highWaterMark,_):a?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{var v,y;const _=this.response;if(!_)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const A=p[o];A&&(i.loaded=i.total=A);const E={url:_.url,data:p,code:_.status},T=(v=this.callbacks)==null?void 0:v.onProgress;T&&!yt(t.highWaterMark)&&T(i,e,p,_),(y=this.callbacks)==null||y.onSuccess(E,i,e,_)}).catch(p=>{var v;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const y=p&&p.code||0,_=p?p.message:null;(v=this.callbacks)==null||v.onError({code:y,text:_},e,p?p.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,i=0,s){const a=new LO,o=e.body.getReader(),u=()=>o.read().then(c=>{if(c.done)return a.dataLength&&s(t,n,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const h=c.value,p=h.length;return t.loaded+=p,p<i||a.dataLength?(a.push(h),a.dataLength>=i&&s(t,n,a.flush().buffer,e)):s(t,n,h.buffer,e),u()}).catch(()=>Promise.reject());return u()}}function GY(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(li({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function HY(r){const e=kY.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function zY(r){const e=r.get("Content-Range");if(e){const n=HY(e);if(yt(n))return n}const t=r.get("Content-Length");if(t)return parseInt(t)}function VY(r,e){return new self.Request(r.url,e)}class KY extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const YY=/^age:\s*[\d.]+\s*$/im;class CC{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new lE,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return s(n,t.url)}).catch(a=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),s(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:n.status,text:a.message},t,n,i)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=n.loadPolicy;if(i)for(const o in i)e.setRequestHeader(o,i[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&yt(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!n.aborted&&i>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,h=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const _=h??t.response;if(_!=null){var a,o;n.loading.end=Math.max(self.performance.now(),n.loading.first);const A=t.responseType==="arraybuffer"?_.byteLength:_.length;n.loaded=n.total=A,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const E=(a=this.callbacks)==null?void 0:a.onProgress;E&&E(n,e,_,t);const T={url:t.responseURL,data:_,code:c};(o=this.callbacks)==null||o.onSuccess(T,n,e,t);return}}const p=s.loadPolicy.errorRetry,v=n.retry,y={url:e.url,data:void 0,code:c};if(cA(p,v,!1,y))this.retry(p);else{var u;ii.error(`${c} while loading ${e.url}`),(u=this.callbacks)==null||u.onError({code:c,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(cA(e,t,!0))this.retry(e);else{var n;ii.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=cC(e,n.retry),n.retry++,ii.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&YY.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const XY={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},qY=ti(ti({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:CC,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:uO,bufferController:e3,capLevelController:pE,errorController:pO,fpsController:p3,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:mC,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:XY},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},WY()),{},{subtitleStreamController:_3,subtitleTrackController:v3,timelineController:R3,audioStreamController:JO,audioTrackController:$O,emeController:Sd,cmcdController:f3,contentSteeringController:h3,interstitialsController:fY});function WY(){return{cueHandler:L3,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function jY(r,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=G1(r),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,u=e[o]===void 0,c=[];s.forEach(h=>{const p=`${a}Loading${h}`,v=e[p];if(v!==void 0&&u){c.push(p);const y=n[o].default;switch(e[o]={default:y},h){case"TimeOut":y.maxLoadTimeMs=v,y.maxTimeToFirstByteMs=v;break;case"MaxRetry":y.errorRetry.maxNumRetry=v,y.timeoutRetry.maxNumRetry=v;break;case"RetryDelay":y.errorRetry.retryDelayMs=v,y.timeoutRetry.retryDelayMs=v;break;case"MaxRetryTimeout":y.errorRetry.maxRetryDelayMs=v,y.timeoutRetry.maxRetryDelayMs=v;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${o}": ${vi(e[o])}`)}),ti(ti({},n),e)}function G1(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(G1):Object.keys(r).reduce((e,t)=>(e[t]=G1(r[t]),e),{}):r}function JY(r,e){const t=r.loader;t!==k1&&t!==CC?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):I3()&&(r.loader=k1,r.progressive=!0,r.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const tS=2,QY=.1,$Y=.05,ZY=100;class eX extends mO{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(H.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(ZY),this.mediaSource=t.mediaSource;const n=this.media=t.media;ea(n,"playing",this.onMediaPlaying),ea(n,"waiting",this.onMediaWaiting),ea(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(xa(n,"playing",this.onMediaPlaying),xa(n,"waiting",this.onMediaWaiting),xa(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,i;const s=(n=this.hls)==null?void 0:n.config;if(!s)return;const a=this.media;if(!a)return;const{seeking:o}=a,u=this.seeking&&!o,c=!this.seeking&&o,h=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!h&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||u){u&&this.stallResolved(e);return}if(h){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(H.MEDIA_ENDED,{stalled:!1}));return}if(!nn.getBuffered(a).length){this.nudgeRetry=0;return}const p=nn.bufferInfo(a,e,0),v=p.nextStart||0,y=this.fragmentTracker;if(o&&y&&this.hls){const N=fw(this.hls.inFlightFragments,e),O=p.len>tS,F=!v||N||v-e>tS&&!y.getPartialFragment(e);if(O||F)return;this.moved=!1}const _=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){if(!(p.len>0)&&!v)return;const O=Math.max(v,p.start||0)-e,B=!!(_!=null&&_.live)?_.targetduration*2:tS,P=Gx(e,y);if(O>0&&(O<=B||P)){a.paused||this._trySkipBufferHole(P);return}}const A=s.detectStallWithCurrentTimeMs,E=self.performance.now(),T=this.waiting;let M=this.stalled;if(M===null)if(T>0&&E-T<A)M=this.stalled=T;else{this.stalled=E;return}const R=E-M;if(!o&&(R>=A||T)&&this.hls){var L;if(((L=this.mediaSource)==null?void 0:L.readyState)==="ended"&&!(_!=null&&_.live)&&Math.abs(e-(_?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(H.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const w=nn.bufferInfo(a,e,s.maxBufferHole);this._tryFixBufferStall(w,R,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(H.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&i&&i.length>1&&e>i.end(0)){const s=nn.bufferedInfo(nn.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const a=nn.timeRangesToArray(i),o=nn.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const u=nn.bufferedInfo(a,e,0).bufferedIndex,c=a[o].end,h=a[o+1].start;if((u===-1||u>o)&&h-c<1&&e-c<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${h} buffered index: ${u}`);this.warn(p.message),this.media.currentTime+=1e-6;let v=Gx(e,this.fragmentTracker);v&&"fragment"in v?v=v.fragment:v||(v=void 0);const y=nn.bufferInfo(this.media,e,0);this.hls.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:v,buffer:y.len,bufferInfo:y})}}}}}_tryFixBufferStall(e,t,n){var i,s;const{fragmentTracker:a,media:o}=this,u=(i=this.hls)==null?void 0:i.config;if(!o||!a||!u)return;const c=(s=this.hls)==null?void 0:s.latestLevelDetails,h=Gx(n,a);if((h||c!=null&&c.live&&n<c.fragmentStart)&&(this._trySkipBufferHole(h)||!this.media))return;const p=e.buffered,v=this.adjacentTraversal(e,n);(p&&p.length>1&&e.len>u.maxBufferHole||e.nextStart&&(e.nextStart-n<u.maxBufferHole||v))&&(t>u.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,i=e.nextStart;if(n&&i){const s=n.getFragAtPos(t,Tt.MAIN),a=n.getFragAtPos(i,Tt.MAIN);if(s&&a)return a.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:i,stalled:s}=this;if(!i&&s!==null&&n&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${vi(e)})`);this.warn(a.message),t.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:i}=this,s=(t=this.hls)==null?void 0:t.config;if(!i||!n||!s)return 0;const a=i.currentTime,o=nn.bufferInfo(i,a,0),u=a<o.start?o.start:o.nextStart;if(u&&this.hls){const h=o.len<=s.maxBufferHole,p=o.len>0&&o.len<1&&i.readyState<3,v=u-a;if(v>0&&(h||p)){if(v>s.maxBufferHole){let _=!1;if(a===0){const A=n.getAppendedFrag(0,Tt.MAIN);A&&u<A.end&&(_=!0)}if(!_&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||fw(this.hls.inFlightFragments,u))return 0;let E=!1,T=e.end;for(;T<u;){const M=Gx(T,n);if(M)T+=M.duration;else{E=!0;break}}if(E)return 0}}const y=Math.max(u+$Y,a+QY);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${y}`),this.moved=!0,i.currentTime=y,!(e!=null&&e.gap)){const _=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${y}`),A={type:Lt.MEDIA_ERROR,details:Se.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:_,reason:_.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?A.part=e:A.frag=e),this.hls.trigger(H.ERROR,A)}return y}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:i}=this,s=t?.config;if(!n||!s)return 0;const a=n.currentTime;if(this.nudgeRetry++,i<s.nudgeMaxRetry){const o=a+(i+1)*s.nudgeOffset,u=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(u.message),n.currentTime=o,t.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.BUFFER_NUDGE_ON_STALL,error:u,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${s.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function fw(r,e){const t=hw(r.main);if(t&&t.start<=e)return t;const n=hw(r.audio);return n&&n.start<=e?n:null}function hw(r){if(!r)return null;switch(r.state){case ke.IDLE:case ke.STOPPED:case ke.ENDED:case ke.ERROR:return null}return r.frag}function Gx(r,e){return e.getAppendedFrag(r,Tt.MAIN)||e.getPartialFragment(r)}const tX=.25;function H1(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function kb(r,e,t,n,i){let s=new r(e,t,"");try{s.value=n,i&&(s.type=i)}catch{s=new r(e,t,vi(i?ti({type:i},n):n))}return s}const Hx=(()=>{const r=H1();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class nX{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(H.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(H.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(H.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&bm(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return m3(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:i}=this.hls.config;if(!n&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=H1();if(a)for(let o=0;o<s.length;o++){const u=s[o].type;if(u===ya.emsg&&!n||!i)continue;const c=UO(s[o].data),h=s[o].pts;let p=h+s[o].duration;p>Hx&&(p=Hx),p-h<=0&&(p=h+tX);for(let y=0;y<c.length;y++){const _=c[y];if(!FO(_)){this.updateId3CueEnds(h,u);const A=kb(a,h,p,_,u);A&&this.id3Track.addCue(A)}}}}updateId3CueEnds(e,t){var n;const i=(n=this.id3Track)==null?void 0:n.cues;if(i)for(let s=i.length;s--;){const a=i[s];a.type===t&&a.startTime<e&&a.endTime===Hx&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:i}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:u}}=a;if(s&&(o||u)){let c;i==="audio"?c=h=>h.type===ya.audioId3&&u:i==="video"?c=h=>h.type===ya.emsg&&o:c=h=>h.type===ya.audioId3&&u||h.type===ya.emsg&&o,U1(s,t,n,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:i,enableDateRangeMetadataCues:s,interstitialsController:a}=this.hls.config;if(!s)return;const o=H1();if(n&&i&&!a){const{fragmentStart:A,fragmentEnd:E}=e;let T=this.assetCue;T?(T.startTime=A,T.endTime=E):o&&(T=this.assetCue=kb(o,A,E,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),T&&(T.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(T),T.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:u}=this,{dateRanges:c}=e,h=Object.keys(c);let p=this.dateRangeCuesAppended;if(u&&t){var v;if((v=u.cues)!=null&&v.length){const A=Object.keys(p).filter(E=>!h.includes(E));for(let E=A.length;E--;){var y;const T=A[E],M=(y=p[T])==null?void 0:y.cues;delete p[T],M&&Object.keys(M).forEach(R=>{const L=M[R];if(L){L.removeEventListener("enter",this.onEventCueEnter);try{u.removeCue(L)}catch{}}})}}else p=this.dateRangeCuesAppended={}}const _=e.fragments[e.fragments.length-1];if(!(h.length===0||!yt(_?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let A=0;A<h.length;A++){const E=h[A],T=c[E],M=T.startTime,R=p[E],L=R?.cues||{};let w=R?.durationKnown||!1,N=Hx;const{duration:O,endDate:F}=T;if(F&&O!==null)N=M+O,w=!0;else if(T.endOnNext&&!w){const P=h.reduce((V,J)=>{if(J!==T.id){const Q=c[J];if(Q.class===T.class&&Q.startDate>T.startDate&&(!V||T.startDate<V.startDate))return Q}return V},null);P&&(N=P.startTime,w=!0)}const B=Object.keys(T.attr);for(let P=0;P<B.length;P++){const V=B[P];if(!PV(V))continue;const J=L[V];if(J)w&&!(R!=null&&R.durationKnown)?J.endTime=N:Math.abs(J.startTime-M)>.01&&(J.startTime=M,J.endTime=N);else if(o){let Q=T.attr[V];NV(V)&&(Q=qB(Q));const ne=kb(o,M,N,{key:V,data:Q},ya.dateRange);ne&&(ne.id=E,this.id3Track.addCue(ne),L[V]=ne,a&&(V==="X-ASSET-LIST"||V==="X-ASSET-URL")&&ne.addEventListener("enter",this.onEventCueEnter))}}p[E]={cues:L,dateRange:T,durationKnown:w}}}}}class iX{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:a}=this.config;if(!s||a===1||!n.live)return;const o=this.targetLatency;if(o===null)return;const u=i-o,c=Math.min(this.maxLatency,o+n.targetduration);if(u<c&&u>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,a)),v=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20,y=Math.min(p,Math.max(1,v));this.changeMediaPlaybackRate(t,y)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,u=this.hls.userConfig;let c=o&&n||t;(this._targetLatencyUpdated||u.liveSyncDuration||u.liveSyncDurationCount||c===0)&&(c=s!==void 0?s:a*i);const h=i;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,h)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const i=n.edge,s=e-t-this.edgeStalled,a=i-n.totalduration,o=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,s),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(H.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(H.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===Se.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,i;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class sX extends dE{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this),e.on(H.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this),e.off(H.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,i=[],s={},a={};let o=!1,u=!1,c=!1;t.levels.forEach(h=>{const p=h.attrs;let{audioCodec:v,videoCodec:y}=h;v&&(h.audioCodec=v=aA(v,n)||void 0),y&&(y=h.videoCodec=eV(y));const{width:_,height:A,unknownCodecs:E}=h,T=E?.length||0;if(o||(o=!!(_&&A)),u||(u=!!y),c||(c=!!v),T||v&&!this.isAudioSupported(v)||y&&!this.isVideoSupported(y)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:M,"FRAME-RATE":R,"HDCP-LEVEL":L,"PATHWAY-ID":w,RESOLUTION:N,"VIDEO-RANGE":O}=p,B=`${`${w||"."}-`}${h.bitrate}-${N}-${R}-${M}-${O}-${L}`;if(s[B])if(s[B].uri!==h.url&&!h.attrs["PATHWAY-ID"]){const P=a[B]+=1;h.attrs["PATHWAY-ID"]=new Array(P+1).join(".");const V=this.createLevel(h);s[B]=V,i.push(V)}else s[B].addGroupId("audio",p.AUDIO),s[B].addGroupId("text",p.SUBTITLES);else{const P=this.createLevel(h);s[B]=P,a[B]=1,i.push(P)}}),this.filterAndSortMediaOptions(i,t,o,u,c)}createLevel(e){const t=new $m(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(i.message),t.supportedResult=rO(i,[])}return t}isAudioSupported(e){return Gv(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Gv(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,i,s){var a;let o=[],u=[],c=e;const h=((a=t.stats)==null?void 0:a.parsing)||{};if((n||i)&&s&&(c=c.filter(({videoCodec:M,videoRange:R,width:L,height:w})=>(!!M||!!(L&&w))&&cV(R))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let M="no level with compatible codecs found in manifest",R=M;t.levels.length&&(R=`one or more CODECS in variant not supported: ${vi(t.levels.map(w=>w.attrs.CODECS).filter((w,N,O)=>O.indexOf(w)===N))}`,this.warn(R),M+=` (${R})`);const L=new Error(M);this.hls.trigger(H.ERROR,{type:Lt.MEDIA_ERROR,details:Se.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:L,reason:R})}}),h.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(M=>!M.audioCodec||this.isAudioSupported(M.audioCodec)),dw(o)),t.subtitles&&(u=t.subtitles,dw(u));const p=c.slice(0);c.sort((M,R)=>{if(M.attrs["HDCP-LEVEL"]!==R.attrs["HDCP-LEVEL"])return(M.attrs["HDCP-LEVEL"]||"")>(R.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&M.height!==R.height)return M.height-R.height;if(M.frameRate!==R.frameRate)return M.frameRate-R.frameRate;if(M.videoRange!==R.videoRange)return oA.indexOf(M.videoRange)-oA.indexOf(R.videoRange);if(M.videoCodec!==R.videoCodec){const L=aI(M.videoCodec),w=aI(R.videoCodec);if(L!==w)return w-L}if(M.uri===R.uri&&M.codecSet!==R.codecSet){const L=rA(M.codecSet),w=rA(R.codecSet);if(L!==w)return w-L}return M.averageBitrate!==R.averageBitrate?M.averageBitrate-R.averageBitrate:0});let v=p[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==p.length)){for(let M=0;M<p.length;M++)if(p[M].pathwayId===c[0].pathwayId){v=p[M];break}}this._levels=c;for(let M=0;M<c.length;M++)if(c[M]===v){var y;this._firstLevel=M;const R=v.bitrate,L=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${R}`),((y=this.hls.userConfig)==null?void 0:y.abrEwmaDefaultEstimate)===void 0){const w=Math.min(R,this.hls.config.abrEwmaDefaultEstimateMax);w>L&&L===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=w)}break}const _=s&&!i,A=this.hls.config,E=!!(A.audioStreamController&&A.audioTrackController),T={levels:c,audioTracks:o,subtitleTracks:u,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:E&&!_&&o.some(M=>!!M.url)};h.end=performance.now(),this.hls.trigger(H.MANIFEST_PARSED,T)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const h=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(H.ERROR,{type:Lt.OTHER_ERROR,details:Se.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:h,reason:h.message}),p)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,n===e&&i&&s===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${n}${s?" with Pathway "+s:""}`);const u={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(H.LEVEL_SWITCHING,u);const c=a.details;if(!c||c.live){const h=this.switchParams(a.uri,i?.details,c);this.loadPlaylist(h)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===_n.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Tt.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(s=>!!n[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var n;const{level:i,details:s}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${i}`),(o=t.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let u=a.details;u===t.details&&u.advanced&&(u=void 0),this.playlistLoaded(i,t,u)}else(n=t.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],a=e.details,o=a?.age;this.log(`Loading level index ${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(H.LEVEL_LOADING,{url:n,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((s,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(o=>o.level=-1)),!1));CO(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=n.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(H.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(H.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function dw(r){const e={};r.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function w3(){return self.SourceBuffer||self.WebKitSourceBuffer}function RC(){if(!Tc())return!1;const e=w3();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function B3(){if(!RC())return!1;const r=Tc();return typeof r?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(Hv(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(Hv(e,"audio"))))}function rX(){var r;const e=w3();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const aX=100;class oX extends fE{constructor(e,t,n){super(e,t,n,"stream-controller",Tt.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,s=i?i.currentTime:null;if(s===null||!yt(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const a=this.getFwdBufferInfoAtPos(i,s,Tt.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.LEVEL_LOADING,this.onLevelLoading,this),e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(H.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(H.BUFFER_CREATED,this.onBufferCreated,this),e.on(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(H.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(H.BUFFER_CREATED,this.onBufferCreated,this),e.off(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:i}=this;if(this.stopLoad(),this.setInterval(aX),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.firstAutoLevel),i.nextLoadLevel=s,this.level=i.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=ke.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ke.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ke.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e?.[t],i=n?.details;if(i&&(!i.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(i))break;this.state=ke.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ke.IDLE;break}break}case ke.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ke.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[s]))return;const a=n[s],o=this.getMainFwdBufferInfo();if(o===null)return;const u=this.getLevelDetails();if(u&&this._streamEnded(o,u)){const A={};this.altAudio===2&&(A.type="video"),this.hls.trigger(H.BUFFER_EOS,A),this.state=ke.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const c=a.details;if(!c||this.state===ke.WAITING_LEVEL||this.waitForLive(a)){this.level=s,this.state=ke.WAITING_LEVEL,this.startFragRequested=!1;return}const h=o.len,p=this.getMaxBufferLength(a.maxBitrate);if(h>=p)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const v=this.backtrackFragment?this.backtrackFragment.start:o.end;let y=this.getNextFragment(v,c);if(this.couldBacktrack&&!this.fragPrevious&&y&&rs(y)&&this.fragmentTracker.getState(y)!==Cs.OK){var _;const E=((_=this.backtrackFragment)!=null?_:y).sn-c.startSN,T=c.fragments[E-1];T&&y.cc===T.cc&&(y=T,this.fragmentTracker.removeFragment(T))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,v)){if(!y.gap){const E=this.audioOnly&&!this.altAudio?gi.AUDIO:gi.VIDEO,T=(E===gi.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;T&&this.afterBufferFlushed(T,E,Tt.MAIN)}y=this.getNextFragmentLoopLoading(y,c,o,Tt.MAIN,p)}y&&(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),this.loadFragment(y,a,v))}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);i===Cs.NOT_LOADED||i===Cs.PARTIAL?rs(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Tt.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<s.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,u=e[o],c=this.fragLastKbps;c&&this.fragCurrent?n=this.fragCurrent.duration*u.maxBitrate/(1e3*c)+1:n=0}else n=0;const a=this.getBufferedFrag(t.currentTime+n);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const u=o.maxStartPTS?o.maxStartPTS:o.start,c=o.duration,h=Math.max(a.end,u+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ke.KEY_LOADING:case ke.FRAG_LOADING:case ke.FRAG_LOADING_WAITING_RETRY:case ke.PARSING:case ke.PARSED:this.state=ke.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;ea(n,"playing",this.onMediaPlaying),ea(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(xa(n,"playing",this.onMediaPlaying),xa(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(H.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,i=!1;for(let s=0;s<t.levels.length;s++){const a=t.levels[s].audioCodec;a&&(n=n||a.indexOf("mp4a.40.2")!==-1,i=i||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&i&&!rX(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==ke.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=ke.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:i,startFragRequested:s}=this,a=t.level,o=t.details,u=o.totalduration;if(!i){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${u}`);const c=t.levelInfo,h=this.fragCurrent;h&&(this.state===ke.FRAG_LOADING||this.state===ke.FRAG_LOADING_WAITING_RETRY)&&h.level!==t.level&&h.loader&&this.abortCurrentFrag();let p=0;if(o.live||(n=c.details)!=null&&n.live){var v;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;p=this.alignPlaylists(o,c.details,(v=this.levelLastLoaded)==null?void 0:v.details)}if(c.details=o,this.levelLastLoaded=c,s||this.setStartPosition(o,p),this.hls.trigger(H.LEVEL_UPDATED,{details:o,level:a}),this.state===ke.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=ke.IDLE}s&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,s=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,u=s>=a-t.maxFragLookUpTolerance&&s<=o;if(i!==null&&n.duration>i&&(s<i||!u)){const h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!u&&n.readyState<4||s<o-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),n.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const p=nn.bufferInfo(n,i,0);if(!((c=p.buffered)!=null&&c.length)){n.currentTime=i;return}if(p.start<=s){n.currentTime=i;return}const{nextStart:y}=nn.bufferedInfo(p.buffered,s,0);y&&(n.currentTime=y)}else n.currentTime=i}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const o=a[n.level];if(!o){this.warn(`Level ${n.level} not found on progress`);return}const u=o.details;if(!u){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const c=o.videoCodec,h=u.PTSKnown||!u.live,p=(t=n.initSegment)==null?void 0:t.data,v=this._getAudioCodec(o),y=this.transmuxer=this.transmuxer||new jO(this.hls,Tt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),_=i?i.index:-1,A=_!==-1,E=new cE(n.level,n.sn,n.stats.chunkCount,s.byteLength,_,A),T=this.initPTS[n.cc];y.push(s,p,v,c,n,i,u.totalduration,h,E,T)}onAudioTrackSwitching(e,t){const n=this.hls,i=this.altAudio!==0;if(lA(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(H.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(H.AUDIO_TRACK_SWITCHED,t)}),n.trigger(H.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(H.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=lA(t.url,this.hls);if(n){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let i,s,a=!1;for(const o in n){const u=n[o];if(u.id==="main"){if(s=o,i=u,o==="video"){const c=n[o];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:i}=t,s=n.type===Tt.MAIN;if(s){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ke.PARSED&&(this.state=ke.IDLE);return}const o=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),rs(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}const a=this.media;a&&(!this._hasEnoughToStart&&nn.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=ke.ERROR;return}switch(t.details){case Se.FRAG_GAP:case Se.FRAG_PARSING_ERROR:case Se.FRAG_DECRYPT_ERROR:case Se.FRAG_LOAD_ERROR:case Se.FRAG_LOAD_TIMEOUT:case Se.KEY_LOAD_ERROR:case Se.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Tt.MAIN,t);break;case Se.LEVEL_LOAD_ERROR:case Se.LEVEL_LOAD_TIMEOUT:case Se.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ke.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===_n.LEVEL&&(this.state=ke.IDLE);break;case Se.BUFFER_ADD_CODEC_ERROR:case Se.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Se.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Se.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ke.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==gi.AUDIO||!this.altAudio){const n=(t===gi.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,Tt.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&n&&(n+=i);const s=this.getLevelDetails(),a=nn.getBuffered(e),o=a.length?a.start(0):0,u=o-n,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||u>0&&(u<c||this.loadingParts&&u<2*(s?.partTarget||0)))&&(this.log(`adjusting start position by ${u} to match buffer start`),n+=u,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${o}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:i}=this,s=n?.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=ke.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=s.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(H.FRAG_LOADED,n),s.bitrateTest=!1}).catch(n=>{this.state===ke.STOPPED||this.state===ke.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:i,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a){this.resetWhenMissingContext(s);return}const{frag:o,part:u,level:c}=a,{video:h,text:p,id3:v,initSegment:y}=i,{details:_}=c,A=this.altAudio?void 0:i.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=ke.PARSING,y){const E=y.tracks;if(E){const L=o.initSegment||o;if(this.unhandledEncryptionError(y,o))return;this._bufferInitSegment(c,E,L,s),n.trigger(H.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:t,tracks:E})}const T=y.initPTS,M=y.timescale,R=this.initPTS[o.cc];if(yt(T)&&(!R||R.baseTime!==T||R.timescale!==M)){const L=y.trackId;this.initPTS[o.cc]={baseTime:T,timescale:M,trackId:L},n.trigger(H.INIT_PTS_FOUND,{frag:o,id:t,initPTS:T,timescale:M,trackId:L})}}if(h&&_){A&&h.type==="audiovideo"&&this.logMuxedErr(o);const E=_.fragments[o.sn-1-_.startSN],T=o.sn===_.startSN,M=!E||o.cc>E.cc;if(i.independent!==!1){const{startPTS:R,endPTS:L,startDTS:w,endDTS:N}=h;if(u)u.elementaryStreams[h.type]={startPTS:R,endPTS:L,startDTS:w,endDTS:N};else if(h.firstKeyFrame&&h.independent&&s.id===1&&!M&&(this.couldBacktrack=!0),h.dropped&&h.independent){const O=this.getMainFwdBufferInfo(),F=(O?O.end:this.getLoadPosition())+this.config.maxBufferHole,B=h.firstKeyFramePTS?h.firstKeyFramePTS:R;if(!T&&F<B-this.config.maxBufferHole&&!M){this.backtrack(o);return}else M&&(o.gap=!0);o.setElementaryStreamInfo(h.type,o.start,L,o.start,N,!0)}else T&&R-(_.appliedTimelineOffset||0)>tS&&(o.gap=!0);o.setElementaryStreamInfo(h.type,R,L,w,N),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(h,o,u,s,T||M)}else if(T||M)o.gap=!0;else{this.backtrack(o);return}}if(A){const{startPTS:E,endPTS:T,startDTS:M,endDTS:R}=A;u&&(u.elementaryStreams[gi.AUDIO]={startPTS:E,endPTS:T,startDTS:M,endDTS:R}),o.setElementaryStreamInfo(gi.AUDIO,E,T,M,R),this.bufferFragmentData(A,o,u,s)}if(_&&v!=null&&v.samples.length){const E={id:t,frag:o,details:_,samples:v.samples};n.trigger(H.FRAG_PARSING_METADATA,E)}if(_&&p){const E={id:t,frag:o,details:_,samples:p.samples};n.trigger(H.FRAG_PARSING_USERDATA,E)}}logMuxedErr(e){this.warn(`${rs(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,i){if(this.state!==ke.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:s,video:a,audiovideo:o}=t;if(s){const c=e.audioCodec;let h=jx(s.codec,c);h==="mp4a"&&(h="mp4a.40.5");const p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5");const v=s.metadata;v&&"channelCount"in v&&(v.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log(`Android: force audio codec to ${h}`)),c&&c!==h&&this.log(`Swapping manifest audio codec "${c}" for "${h}"`),s.levelCodec=h,s.id=Tt.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${h||""}/${c||""}/${s.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=Tt.MAIN;const c=a.codec;if(c?.length===4)switch(c){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${a.codec!==c?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const u=Object.keys(t);if(u.length){if(this.hls.trigger(H.BUFFER_CODECS,t),!this.hls)return;u.forEach(c=>{const p=t[c].initSegment;p!=null&&p.byteLength&&this.hls.trigger(H.BUFFER_APPENDING,{type:c,data:p,frag:n,part:null,chunkMeta:i,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Tt.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e?.[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ke.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(nn.isBuffered(e,n)?t=this.getAppendedFrag(n):nn.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger(H.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(H.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return yt(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(yt(t)){const n=this.getLevelDetails(),i=this.currentFrag||(n?Pd(null,n.fragments,t):null);if(i){const s=i.programDateTime;if(s!==null){const a=s+(t-i.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class lX extends ko{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[n].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Se.KEY_LOAD_ERROR,n,i,s){return new fc({type:Lt.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:i})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,s=t.length;i<s;i++){const a=t[i];if(e.cc<=a.cc&&(!rs(e)||!rs(a)||e.sn<a.sn)||!n&&i==s-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const u=Jx(o);if(u)return this.emeController.getKeySystemAccess([u])})}if(this.config.requireKeySystemAccessOnStart){const i=uv(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Se.KEY_LOAD_ERROR,c))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,Se.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=Gb(s);let u=this.keyIdToKeyInfo[o];if((n=u)!=null&&n.decryptdata.key)return s.key=u.decryptdata.key,Promise.resolve({frag:e,keyInfo:u});if(this.emeController&&(i=u)!=null&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(u.decryptdata)){case"usable":case"usable-in-future":return u.keyLoadPromise.then(h=>{const{keyInfo:p}=h;return s.key=p.decryptdata.key,{frag:e,keyInfo:p}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${s.keyId?" keyId: "+er(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),u=this.keyIdToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(u,e):this.loadKeyEME(u,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(u,e);default:return Promise.reject(this.createKeyLoadError(e,Se.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i;if(!e.decryptdata.keyId&&(i=t.initSegment)!=null&&i.data){const a=z9(t.initSegment.data);if(a.length){let o=a[0];o.some(u=>u!==0)?(this.log(`Using keyId found in init segment ${er(o)}`),Ac.setKeyIdForUri(e.decryptdata.uri,o)):(o=Ac.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${er(o)}`)),e.decryptdata.keyId=o}}if(!e.decryptdata.keyId&&!rs(t))return Promise.resolve(n);const s=this.emeController.loadKey(n);return(e.keyLoadPromise=s.then(a=>(e.mediaKeySessionContext=a,n))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,i=n.loader,s=new i(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,o)=>{const u={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,y,_,A)=>{const{frag:E,keyInfo:T}=_,M=Gb(T.decryptdata);if(!E.decryptdata||T!==this.keyIdToKeyInfo[M])return o(this.createKeyLoadError(E,Se.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),A));T.decryptdata.key=E.decryptdata.key=new Uint8Array(v.data),E.keyLoader=null,T.loader=null,a({frag:E,keyInfo:T})},onError:(v,y,_,A)=>{this.resetLoader(y),o(this.createKeyLoadError(t,Se.KEY_LOAD_ERROR,new Error(`HTTP Error ${v.code} loading key ${v.text}`),_,ti({url:u.url,data:void 0},v)))},onTimeout:(v,y,_)=>{this.resetLoader(y),o(this.createKeyLoadError(t,Se.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),_))},onAbort:(v,y,_)=>{this.resetLoader(y),o(this.createKeyLoadError(t,Se.INTERNAL_ABORTED,new Error("key loading aborted"),_))}};s.load(u,h,p)})}resetLoader(e){const{frag:t,keyInfo:n,url:i}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null);const a=Gb(n.decryptdata)||i;delete this.keyIdToKeyInfo[a],s&&s.destroy()}}function Gb(r){if(r.keyFormat!==zs.FAIRPLAY){const e=r.keyId;if(e)return er(e)}return r.uri}function pw(r){const{type:e}=r;switch(e){case _n.AUDIO_TRACK:return Tt.AUDIO;case _n.SUBTITLE_TRACK:return Tt.SUBTITLE;default:return Tt.MAIN}}function Hb(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class uX{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.LEVEL_LOADING,this.onLevelLoading,this),e.on(H.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(H.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.LEVEL_LOADING,this.onLevelLoading,this),e.off(H.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(H.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,i=t.loader,s=n||i,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:_n.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:i,pathwayId:s,url:a,deliveryDirectives:o,levelInfo:u}=t;this.load({id:n,level:i,pathwayId:s,responseType:"text",type:_n.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:u})}onAudioTrackLoading(e,t){const{id:n,groupId:i,url:s,deliveryDirectives:a,track:o}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:_n.AUDIO_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:n,groupId:i,url:s,deliveryDirectives:a,track:o}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:_n.SUBTITLE_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const n=this.loaders[_n.LEVEL];if(n){const i=n.context;i&&!t.levels.some(s=>s===i.levelOrTrack)&&(n.abort(),delete this.loaders[_n.LEVEL])}}load(e){var t;const n=this.hls.config;let i=this.getInternalLoader(e);if(i){const c=this.hls.logger,h=i.context;if(h&&h.levelOrTrack===e.levelOrTrack&&(h.url===e.url||h.deliveryDirectives&&!e.deliveryDirectives)){h.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${h.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===_n.MANIFEST?s=n.manifestLoadPolicy.default:s=li({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),yt((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===_n.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===_n.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===_n.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const h=c.partTarget,p=c.targetduration;if(h&&p){const v=Math.max(h*3,p*.8)*1e3;s=li({},s,{maxTimeToFirstByteMs:Math.min(v,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(c,h,p,v)=>{const y=this.getInternalLoader(p);this.resetInternalLoader(p.type);const _=c.data;h.parsing.start=performance.now(),gl.isMediaPlaylist(_)||p.type!==_n.MANIFEST?this.handleTrackOrLevelPlaylist(c,h,p,v||null,y):this.handleMasterPlaylist(c,h,p,v)},onError:(c,h,p,v)=>{this.handleNetworkError(h,p,!1,c,v)},onTimeout:(c,h,p)=>{this.handleNetworkError(h,p,!0,void 0,c)}};i.load(e,o,u)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,i){const s=this.hls,a=e.data,o=Hb(e,n),u=gl.parseMasterPlaylist(a,o);if(u.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,u.playlistParsingError,i,t);return}const{contentSteering:c,levels:h,sessionData:p,sessionKeys:v,startTimeOffset:y,variableList:_}=u;this.variableList=_,h.forEach(M=>{const{unknownCodecs:R}=M;if(R){const{preferManagedMediaSource:L}=this.hls.config;let{audioCodec:w,videoCodec:N}=M;for(let O=R.length;O--;){const F=R[O];Gv(F,"audio",L)?(M.audioCodec=w=w?`${w},${F}`:F,Qm.audio[w.substring(0,4)]=2,R.splice(O,1)):Gv(F,"video",L)&&(M.videoCodec=N=N?`${N},${F}`:F,Qm.video[N.substring(0,4)]=2,R.splice(O,1))}}});const{AUDIO:A=[],SUBTITLES:E,"CLOSED-CAPTIONS":T}=gl.parseMasterPlaylistMedia(a,o,u);A.length&&!A.some(R=>!R.url)&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),A.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ri({}),bitrate:0,url:""})),s.trigger(H.MANIFEST_LOADED,{levels:h,audioTracks:A,subtitles:E,captions:T,contentSteering:c,url:o,stats:t,networkDetails:i,sessionData:p,sessionKeys:v,startTimeOffset:y,variableList:_})}handleTrackOrLevelPlaylist(e,t,n,i,s){const a=this.hls,{id:o,level:u,type:c}=n,h=Hb(e,n),p=yt(u)?u:yt(o)?o:0,v=pw(n),y=gl.parseLevelPlaylist(e.data,h,p,v,0,this.variableList);if(c===_n.MANIFEST){const _={attrs:new Ri({}),bitrate:0,details:y,name:"",url:h};y.requestScheduled=t.loading.start+TO(y,0),a.trigger(H.MANIFEST_LOADED,{levels:[_],audioTracks:[],url:h,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=y,this.handlePlaylistLoaded(y,e,t,n,i,s)}handleManifestParsingError(e,t,n,i,s){this.hls.trigger(H.ERROR,{type:Lt.NETWORK_ERROR,details:Se.MANIFEST_PARSING_ERROR,fatal:t.type===_n.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,n=!1,i,s){let a=`A network ${n?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===_n.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===_n.AUDIO_TRACK||e.type===_n.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let u=Se.UNKNOWN,c=!1;const h=this.getInternalLoader(e);switch(e.type){case _n.MANIFEST:u=n?Se.MANIFEST_LOAD_TIMEOUT:Se.MANIFEST_LOAD_ERROR,c=!0;break;case _n.LEVEL:u=n?Se.LEVEL_LOAD_TIMEOUT:Se.LEVEL_LOAD_ERROR,c=!1;break;case _n.AUDIO_TRACK:u=n?Se.AUDIO_TRACK_LOAD_TIMEOUT:Se.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case _n.SUBTITLE_TRACK:u=n?Se.SUBTITLE_TRACK_LOAD_TIMEOUT:Se.SUBTITLE_LOAD_ERROR,c=!1;break}h&&this.resetInternalLoader(e.type);const p={type:Lt.NETWORK_ERROR,details:u,fatal:c,url:e.url,loader:h,context:e,error:o,networkDetails:t,stats:s};if(i){const v=t?.url||e.url;p.response=ti({url:v,data:void 0},i)}this.hls.trigger(H.ERROR,p)}handlePlaylistLoaded(e,t,n,i,s,a){const o=this.hls,{type:u,level:c,levelOrTrack:h,id:p,groupId:v,deliveryDirectives:y}=i,_=Hb(t,i),A=pw(i);let E=typeof i.level=="number"&&A===Tt.MAIN?c:void 0;const T=e.playlistParsingError;if(T){if(this.hls.logger.warn(`${T} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(H.ERROR,{type:Lt.NETWORK_ERROR,details:Se.LEVEL_PARSING_ERROR,fatal:!1,url:_,error:T,reason:T.message,response:t,context:i,level:E,parent:A,networkDetails:s,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const M=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(H.ERROR,{type:Lt.NETWORK_ERROR,details:Se.LEVEL_EMPTY_ERROR,fatal:!1,url:_,error:M,reason:M.message,response:t,context:i,level:E,parent:A,networkDetails:s,stats:n});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),u){case _n.MANIFEST:case _n.LEVEL:if(E){if(!h)E=0;else if(h!==o.levels[E]){const M=o.levels.indexOf(h);M>-1&&(E=M)}}o.trigger(H.LEVEL_LOADED,{details:e,levelInfo:h||o.levels[0],level:E||0,id:p||0,stats:n,networkDetails:s,deliveryDirectives:y,withoutMultiVariant:u===_n.MANIFEST});break;case _n.AUDIO_TRACK:o.trigger(H.AUDIO_TRACK_LOADED,{details:e,track:h,id:p||0,groupId:v||"",stats:n,networkDetails:s,deliveryDirectives:y});break;case _n.SUBTITLE_TRACK:o.trigger(H.SUBTITLE_TRACK_LOADED,{details:e,track:h,id:p||0,groupId:v||"",stats:n,networkDetails:s,deliveryDirectives:y});break}}}class yc{static get version(){return zv}static isMSESupported(){return RC()}static isSupported(){return B3()}static getMediaSource(){return Tc()}static get Events(){return H}static get MetadataSchema(){return ya}static get ErrorTypes(){return Lt}static get ErrorDetails(){return Se}static get DefaultConfig(){return yc.defaultConfig?yc.defaultConfig:qY}static set DefaultConfig(e){yc.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new gC,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=I9(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=jY(yc.DefaultConfig,e,t);this.userConfig=e,n.progressive&&JY(n,t);const{abrController:i,bufferController:s,capLevelController:a,errorController:o,fpsController:u}=n,c=new o(this),h=this.abrController=new i(this),p=new EV(this),v=n.interstitialsController,y=v?this.interstitialsController=new v(this,yc):null,_=this.bufferController=new s(this,p),A=this.capLevelController=new a(this),E=new u(this),T=new uX(this),M=n.contentSteeringController,R=M?new M(this):null,L=this.levelController=new sX(this,R),w=new nX(this),N=new lX(this.config,this.logger),O=this.streamController=new oX(this,p,N),F=this.gapController=new eX(this,p);A.setStreamController(O),E.setStreamController(O);const B=[T,L,O];y&&B.splice(1,0,y),R&&B.splice(1,0,R),this.networkControllers=B;const P=[h,_,F,A,E,w,p];this.audioTrackController=this.createController(n.audioTrackController,B);const V=n.audioStreamController;V&&B.push(this.audioStreamController=new V(this,p,N)),this.subtitleTrackController=this.createController(n.subtitleTrackController,B);const J=n.subtitleStreamController;J&&B.push(this.subtititleStreamController=new J(this,p,N)),this.createController(n.timelineController,P),N.emeController=this.emeController=this.createController(n.emeController,P),this.cmcdController=this.createController(n.cmcdController,P),this.latencyController=this.createController(iX,P),this.coreComponents=P,B.push(c);const Q=c.onErrorOut;typeof Q=="function"&&this.on(H.ERROR,Q,c),this.on(H.MANIFEST_LOADED,T.onManifestLoaded,T)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,i){this._emitter.off(e,t,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const i=e===H.ERROR;this.trigger(H.ERROR,{type:Lt.OTHER_ERROR,details:Se.INTERNAL_EXCEPTION,fatal:i,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(H.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(H.ERROR,{type:Lt.OTHER_ERROR,details:Se.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,i=t?e:{media:n};this._media=n,this.trigger(H.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(H.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(H.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,i=this._url=rC.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(H.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Tt.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Tt.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Tt.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=sY()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){uV(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,n)for(let s=i;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=n)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=lO(t);return aO(e,n,navigator.mediaCapabilities)}}yc.defaultConfig=void 0;const cX=Object.freeze(Object.defineProperty({__proto__:null,AbrController:uO,AttrList:Ri,AudioStreamController:JO,AudioTrackController:$O,BasePlaylistController:dE,BaseSegment:aC,BaseStreamController:fE,BufferController:e3,CMCDController:f3,CapLevelController:pE,ChunkMetadata:cE,ContentSteeringController:h3,Cues:L3,DateRange:hC,EMEController:Sd,ErrorActionFlags:va,ErrorController:pO,ErrorDetails:Se,ErrorTypes:Lt,Events:H,FPSController:p3,FetchLoader:k1,Fragment:Wx,Hls:yc,HlsSkip:Sv,HlsUrlParameters:b1,KeySystemFormats:zs,KeySystems:Li,Level:$m,LevelDetails:vO,LevelKey:Ac,LoadStats:lE,M3U8Parser:gl,MetadataSchema:ya,NetworkErrorAction:Ms,Part:WB,PlaylistLevelType:Tt,SubtitleStreamController:_3,SubtitleTrackController:v3,TimelineController:R3,XhrLoader:CC,default:yc,fetchSupported:I3,getMediaSource:Tc,isMSESupported:RC,isSupported:B3,requestMediaKeySystemAccess:mC},Symbol.toStringTag,{value:"Module"})),fX=((r,e)=>typeof window<"u"&&typeof((r=window.document)==null?void 0:r.createElement)=="function"&&typeof((e=window.navigator)==null?void 0:e.userAgent)=="string")();let zb=null;async function hX(...r){var e;(e=zb)!==null&&e!==void 0||(zb=await A9(()=>Promise.resolve().then(()=>cX),void 0));const t=zb.default;return t.isSupported()?new t(...r):null}function O3(r,{unsuspend:e="loadedmetadata",start:t=!0,hls:n={},crossOrigin:i="anonymous",muted:s=!0,loop:a=!0,playsInline:o=!0,onVideoFrame:u,...c}={}){const h=Ja(_=>_.gl),p=Ue.useRef(null),v=SB(()=>new Promise(async _=>{let A,E;typeof r=="string"?A=r:E=r;const T=Object.assign(document.createElement("video"),{src:A,srcObject:E,crossOrigin:i,loop:a,muted:s,playsInline:o,...c});if(A&&fX&&A.endsWith(".m3u8")){const R=p.current=await hX(n);R&&(R.on(H.MEDIA_ATTACHED,()=>{R.loadSource(A)}),R.attachMedia(T))}const M=new MM(T);M.colorSpace=h.outputColorSpace,T.addEventListener(e,()=>_(M))}),[r]),y=v.source.data;return dX(y,u),Ue.useEffect(()=>(t&&v.image.play(),()=>{p.current&&(p.current.destroy(),p.current=null)}),[v,t]),v}const dX=(r,e)=>{Ue.useEffect(()=>{if(!e||!r.requestVideoFrameCallback)return;let t;const n=(...i)=>{e(...i),t=r.requestVideoFrameCallback(n)};return r.requestVideoFrameCallback(n),()=>r.cancelVideoFrameCallback(t)},[r,e])};class pX extends to{constructor(e=new Ve){super({uniforms:{inputBuffer:new _r(null),depthBuffer:new _r(null),resolution:new _r(new Ve),texelSize:new _r(new Ve),halfTexelSize:new _r(new Ve),kernel:new _r(0),scale:new _r(1),cameraNear:new _r(0),cameraFar:new _r(1),minDepthThreshold:new _r(0),maxDepthThreshold:new _r(1),depthScale:new _r(0),depthToBlurRatioBias:new _r(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${g9>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:vl,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class mX{constructor({gl:e,resolution:t,width:n=500,height:i=500,minDepthThreshold:s=0,maxDepthThreshold:a=1,depthScale:o=0,depthToBlurRatioBias:u=.25}){this.renderToScreen=!1,this.renderTargetA=new tr(t,t,{minFilter:Gn,magFilter:Gn,stencilBuffer:!1,depthBuffer:!1,type:Za}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new pX,this.convolutionMaterial.setTexelSize(1/n,1/i),this.convolutionMaterial.setResolution(new Ve(n,i)),this.scene=new iy,this.camera=new ty,this.convolutionMaterial.uniforms.minDepthThreshold.value=s,this.convolutionMaterial.uniforms.maxDepthThreshold.value=a,this.convolutionMaterial.uniforms.depthScale.value=o,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=u,this.convolutionMaterial.defines.USE_DEPTH=o>0;const c=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),h=new Float32Array([0,0,2,0,0,2]),p=new en;p.setAttribute("position",new On(c,3)),p.setAttribute("uv",new On(h,2)),this.screen=new $i(p,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,n){const i=this.scene,s=this.camera,a=this.renderTargetA,o=this.renderTargetB;let u=this.convolutionMaterial,c=u.uniforms;c.depthBuffer.value=t.depthTexture;const h=u.kernel;let p=t,v,y,_;for(y=0,_=h.length-1;y<_;++y)v=(y&1)===0?a:o,c.kernel.value=h[y],c.inputBuffer.value=p.texture,e.setRenderTarget(v),e.render(i,s),p=v;c.kernel.value=h[y],c.inputBuffer.value=p.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(i,s)}}let gX=class extends hg{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;(t=e.defines)!=null&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),e.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}};const ad=Ue.forwardRef(({mixBlur:r=0,mixStrength:e=1,resolution:t=256,blur:n=[0,0],minDepthThreshold:i=.9,maxDepthThreshold:s=1,depthScale:a=0,depthToBlurRatioBias:o=.25,mirror:u=0,distortion:c=1,mixContrast:h=1,distortionMap:p,reflectorOffset:v=0,...y},_)=>{BB({MeshReflectorMaterialImpl:gX});const A=Ja(({gl:le})=>le),E=Ja(({camera:le})=>le),T=Ja(({scene:le})=>le);n=Array.isArray(n)?n:[n,n];const M=n[0]+n[1]>0,R=n[0],L=n[1],w=Ue.useRef(null);Ue.useImperativeHandle(_,()=>w.current,[]);const[N]=Ue.useState(()=>new pc),[O]=Ue.useState(()=>new ee),[F]=Ue.useState(()=>new ee),[B]=Ue.useState(()=>new ee),[P]=Ue.useState(()=>new zt),[V]=Ue.useState(()=>new ee(0,0,-1)),[J]=Ue.useState(()=>new ni),[Q]=Ue.useState(()=>new ee),[ie]=Ue.useState(()=>new ee),[ne]=Ue.useState(()=>new ni),[k]=Ue.useState(()=>new zt),[K]=Ue.useState(()=>new gs),j=Ue.useCallback(()=>{var le;const pe=w.current.parent||((le=w.current)==null||(le=le.__r3f.parent)==null?void 0:le.object);if(!pe||(F.setFromMatrixPosition(pe.matrixWorld),B.setFromMatrixPosition(E.matrixWorld),P.extractRotation(pe.matrixWorld),O.set(0,0,1),O.applyMatrix4(P),F.addScaledVector(O,v),Q.subVectors(F,B),Q.dot(O)>0))return;Q.reflect(O).negate(),Q.add(F),P.extractRotation(E.matrixWorld),V.set(0,0,-1),V.applyMatrix4(P),V.add(B),ie.subVectors(F,V),ie.reflect(O).negate(),ie.add(F),K.position.copy(Q),K.up.set(0,1,0),K.up.applyMatrix4(P),K.up.reflect(O),K.lookAt(ie),K.far=E.far,K.updateMatrixWorld(),K.projectionMatrix.copy(E.projectionMatrix),k.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),k.multiply(K.projectionMatrix),k.multiply(K.matrixWorldInverse),k.multiply(pe.matrixWorld),N.setFromNormalAndCoplanarPoint(O,F),N.applyMatrix4(K.matrixWorldInverse),J.set(N.normal.x,N.normal.y,N.normal.z,N.constant);const Te=K.projectionMatrix;ne.x=(Math.sign(J.x)+Te.elements[8])/Te.elements[0],ne.y=(Math.sign(J.y)+Te.elements[9])/Te.elements[5],ne.z=-1,ne.w=(1+Te.elements[10])/Te.elements[14],J.multiplyScalar(2/J.dot(ne)),Te.elements[2]=J.x,Te.elements[6]=J.y,Te.elements[10]=J.z+1,Te.elements[14]=J.w},[E,v]),[se,oe,Y,Z]=Ue.useMemo(()=>{const le={minFilter:Gn,magFilter:Gn,type:Za},pe=new tr(t,t,le);pe.depthBuffer=!0,pe.depthTexture=new kf(t,t),pe.depthTexture.format=_l,pe.depthTexture.type=Cd;const Te=new tr(t,t,le),ce=new mX({gl:A,resolution:t,width:R,height:L,minDepthThreshold:i,maxDepthThreshold:s,depthScale:a,depthToBlurRatioBias:o}),Me={mirror:u,textureMatrix:k,mixBlur:r,tDiffuse:pe.texture,tDepth:pe.depthTexture,tDiffuseBlur:Te.texture,hasBlur:M,mixStrength:e,minDepthThreshold:i,maxDepthThreshold:s,depthScale:a,depthToBlurRatioBias:o,distortion:c,distortionMap:p,mixContrast:h,"defines-USE_BLUR":M?"":void 0,"defines-USE_DEPTH":a>0?"":void 0,"defines-USE_DISTORTION":p?"":void 0};return[pe,Te,ce,Me]},[A,R,L,k,t,u,M,r,e,i,s,a,o,c,p,h]);return hy(()=>{var le;const pe=w.current.parent||((le=w.current)==null||(le=le.__r3f.parent)==null?void 0:le.object);if(!pe)return;pe.visible=!1;const Te=A.xr.enabled,ce=A.shadowMap.autoUpdate;j(),A.xr.enabled=!1,A.shadowMap.autoUpdate=!1,A.setRenderTarget(se),A.state.buffers.depth.setMask(!0),A.autoClear||A.clear(),A.render(T,K),M&&Y.render(A,se,oe),A.xr.enabled=Te,A.shadowMap.autoUpdate=ce,pe.visible=!0,A.setRenderTarget(null)}),Ue.createElement("meshReflectorMaterialImpl",iA({attach:"material",key:"key"+Z["defines-USE_BLUR"]+Z["defines-USE_DEPTH"]+Z["defines-USE_DISTORTION"],ref:w},Z,y))}),P3=Ue.createContext();function vX({children:r}){const[e,t]=Ue.useState("idle"),n=["food","water","resources"];function i(y){const _=n.indexOf(y);return n[(_+1)%n.length]}function s(y){const _=n.indexOf(y);return n[(_-1+n.length)%n.length]}const[a,o]=Ue.useState(null),[u,c]=Ue.useState(0),[h,p]=Ue.useState(0),v=Ue.useRef(null);return ye.jsx(P3.Provider,{value:{mode:e,setMode:t,currentSection:a,setCurrentSection:o,currentScenario:u,setCurrentScenario:c,currentPage:h,setCurrentPage:p,getNextSection:i,getPrevSection:s,registerChangeSection:y=>v.current=y,changeSection:y=>v.current?.(y)},children:r})}function gg(){return Ue.useContext(P3)}function dc(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function N3(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}var $a={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},eg={duration:.5,overwrite:!1,delay:0},DC,ir,Ii,wo=1e8,mi=1/wo,z1=Math.PI*2,yX=z1/4,_X=0,U3=Math.sqrt,xX=Math.cos,SX=Math.sin,Ks=function(e){return typeof e=="string"},Qi=function(e){return typeof e=="function"},bc=function(e){return typeof e=="number"},LC=function(e){return typeof e>"u"},yu=function(e){return typeof e=="object"},Sa=function(e){return e!==!1},IC=function(){return typeof window<"u"},zx=function(e){return Qi(e)||Ks(e)},F3=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},br=Array.isArray,AX=/random\([^)]+\)/g,EX=/,\s*/g,mw=/(?:-?\.?\d|\.)+/gi,k3=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Mm=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Vb=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,G3=/[+-]=-?[.\d]+/,TX=/[^,'"\[\]\s]+/gi,bX=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,ki,ou,V1,wC,io={},gA={},H3,z3=function(e){return(gA=tg(e,io))&&ba},BC=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Xv=function(e,t){return!t&&console.warn(e)},V3=function(e,t){return e&&(io[e]=t)&&gA&&(gA[e]=t)||io},qv=function(){return 0},MX={suppressEvents:!0,isStart:!0,kill:!1},nS={suppressEvents:!0,kill:!1},CX={suppressEvents:!0},OC={},Bf=[],K1={},K3,Va={},Kb={},gw=30,iS=[],PC="",NC=function(e){var t=e[0],n,i;if(yu(t)||Qi(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(i=iS.length;i--&&!iS[i].targetTest(t););n=iS[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new pP(e[i],n)))||e.splice(i,1);return e},Ad=function(e){return e._gsap||NC(Bo(e))[0]._gsap},Y3=function(e,t,n){return(n=e[t])&&Qi(n)?e[t]():LC(n)&&e.getAttribute&&e.getAttribute(t)||n},Aa=function(e,t){return(e=e.split(",")).forEach(t)||e},ss=function(e){return Math.round(e*1e5)/1e5||0},Fi=function(e){return Math.round(e*1e7)/1e7||0},Nm=function(e,t){var n=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),n==="+"?e+i:n==="-"?e-i:n==="*"?e*i:e/i},RX=function(e,t){for(var n=t.length,i=0;e.indexOf(t[i])<0&&++i<n;);return i<n},vA=function(){var e=Bf.length,t=Bf.slice(0),n,i;for(K1={},Bf.length=0,n=0;n<e;n++)i=t[n],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},UC=function(e){return!!(e._initted||e._startAt||e.add)},X3=function(e,t,n,i){Bf.length&&!ir&&vA(),e.render(t,n,!!(ir&&t<0&&UC(e))),Bf.length&&!ir&&vA()},q3=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(TX).length<2?t:Ks(e)?e.trim():e},W3=function(e){return e},so=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},DX=function(e){return function(t,n){for(var i in n)i in t||i==="duration"&&e||i==="ease"||(t[i]=n[i])}},tg=function(e,t){for(var n in t)e[n]=t[n];return e},vw=function r(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=yu(t[n])?r(e[n]||(e[n]={}),t[n]):t[n]);return e},yA=function(e,t){var n={},i;for(i in e)i in t||(n[i]=e[i]);return n},bv=function(e){var t=e.parent||ki,n=e.keyframes?DX(br(e.keyframes)):so;if(Sa(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},LX=function(e,t){for(var n=e.length,i=n===t.length;i&&n--&&e[n]===t[n];);return n<0},j3=function(e,t,n,i,s){var a=e[i],o;if(s)for(o=t[s];a&&a[s]>o;)a=a._prev;return a?(t._next=a._next,a._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[i]=t,t._prev=a,t.parent=t._dp=e,t},gE=function(e,t,n,i){n===void 0&&(n="_first"),i===void 0&&(i="_last");var s=t._prev,a=t._next;s?s._next=a:e[n]===t&&(e[n]=a),a?a._prev=s:e[i]===t&&(e[i]=s),t._next=t._prev=t.parent=null},Hf=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Ed=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},IX=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},Y1=function(e,t,n,i){return e._startAt&&(ir?e._startAt.revert(nS):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},wX=function r(e){return!e||e._ts&&r(e.parent)},yw=function(e){return e._repeat?ng(e._tTime,e=e.duration()+e._rDelay)*e:0},ng=function(e,t){var n=Math.floor(e=Fi(e/t));return e&&n===e?n-1:n},_A=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},vE=function(e){return e._end=Fi(e._start+(e._tDur/Math.abs(e._ts||e._rts||mi)||0))},yE=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=Fi(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),vE(e),n._dirty||Ed(n,e)),e},J3=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=_A(e.rawTime(),t),(!t._dur||dy(0,t.totalDuration(),n)-t._tTime>mi)&&t.render(n,!0)),Ed(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-mi}},uu=function(e,t,n,i){return t.parent&&Hf(t),t._start=Fi((bc(n)?n:n||e!==ki?Co(e,n,t):e._time)+t._delay),t._end=Fi(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),j3(e,t,"_first","_last",e._sort?"_start":0),X1(t)||(e._recent=t),i||J3(e,t),e._ts<0&&yE(e,e._tTime),e},Q3=function(e,t){return(io.ScrollTrigger||BC("scrollTrigger",t))&&io.ScrollTrigger.create(t,e)},$3=function(e,t,n,i,s){if(kC(e,t,s),!e._initted)return 1;if(!n&&e._pt&&!ir&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&K3!==Ka.frame)return Bf.push(e),e._lazy=[s,i],1},BX=function r(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||r(t))},X1=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},OX=function(e,t,n,i){var s=e.ratio,a=t<0||!t&&(!e._start&&BX(e)&&!(!e._initted&&X1(e))||(e._ts<0||e._dp._ts<0)&&!X1(e))?0:1,o=e._rDelay,u=0,c,h,p;if(o&&e._repeat&&(u=dy(0,e._tDur,t),h=ng(u,o),e._yoyo&&h&1&&(a=1-a),h!==ng(e._tTime,o)&&(s=1-a,e.vars.repeatRefresh&&e._initted&&e.invalidate())),a!==s||ir||i||e._zTime===mi||!t&&e._zTime){if(!e._initted&&$3(e,t,i,n,u))return;for(p=e._zTime,e._zTime=t||(n?mi:0),n||(n=t&&!p),e.ratio=a,e._from&&(a=1-a),e._time=0,e._tTime=u,c=e._pt;c;)c.r(a,c.d),c=c._next;t<0&&Y1(e,t,n,!0),e._onUpdate&&!n&&qa(e,"onUpdate"),u&&e._repeat&&!n&&e.parent&&qa(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===a&&(a&&Hf(e,1),!n&&!ir&&(qa(e,a?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},PX=function(e,t,n){var i;if(n>t)for(i=e._first;i&&i._start<=n;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=n;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},ig=function(e,t,n,i){var s=e._repeat,a=Fi(t)||0,o=e._tTime/e._tDur;return o&&!i&&(e._time*=a/e._dur),e._dur=a,e._tDur=s?s<0?1e10:Fi(a*(s+1)+e._rDelay*s):a,o>0&&!i&&yE(e,e._tTime=e._tDur*o),e.parent&&vE(e),n||Ed(e.parent,e),e},_w=function(e){return e instanceof $r?Ed(e):ig(e,e._dur)},NX={_start:0,endTime:qv,totalDuration:qv},Co=function r(e,t,n){var i=e.labels,s=e._recent||NX,a=e.duration()>=wo?s.endTime(!1):e._dur,o,u,c;return Ks(t)&&(isNaN(t)||t in i)?(u=t.charAt(0),c=t.substr(-1)==="%",o=t.indexOf("="),u==="<"||u===">"?(o>=0&&(t=t.replace(/=/,"")),(u==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(o<0?s:n).totalDuration()/100:1)):o<0?(t in i||(i[t]=a),i[t]):(u=parseFloat(t.charAt(o-1)+t.substr(o+1)),c&&n&&(u=u/100*(br(n)?n[0]:n).totalDuration()),o>1?r(e,t.substr(0,o-1),n)+u:a+u)):t==null?a:+t},Mv=function(e,t,n){var i=bc(t[1]),s=(i?2:1)+(e<2?0:1),a=t[s],o,u;if(i&&(a.duration=t[1]),a.parent=n,e){for(o=a,u=n;u&&!("immediateRender"in o);)o=u.vars.defaults||{},u=Sa(u.vars.inherit)&&u.parent;a.immediateRender=Sa(o.immediateRender),e<2?a.runBackwards=1:a.startAt=t[s-1]}return new ms(t[0],a,t[s+1])},Wf=function(e,t){return e||e===0?t(e):t},dy=function(e,t,n){return n<e?e:n>t?t:n},Sr=function(e,t){return!Ks(e)||!(t=bX.exec(e))?"":t[1]},UX=function(e,t,n){return Wf(n,function(i){return dy(e,t,i)})},q1=[].slice,Z3=function(e,t){return e&&yu(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&yu(e[0]))&&!e.nodeType&&e!==ou},FX=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(i){var s;return Ks(i)&&!t||Z3(i,1)?(s=n).push.apply(s,Bo(i)):n.push(i)})||n},Bo=function(e,t,n){return Ii&&!t&&Ii.selector?Ii.selector(e):Ks(e)&&!n&&(V1||!sg())?q1.call((t||wC).querySelectorAll(e),0):br(e)?FX(e,n):Z3(e)?q1.call(e,0):e?[e]:[]},W1=function(e){return e=Bo(e)[0]||Xv("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return Bo(t,n.querySelectorAll?n:n===e?Xv("Invalid scope")||wC.createElement("div"):e)}},eP=function(e){return e.sort(function(){return .5-Math.random()})},tP=function(e){if(Qi(e))return e;var t=yu(e)?e:{each:e},n=Td(t.ease),i=t.from||0,s=parseFloat(t.base)||0,a={},o=i>0&&i<1,u=isNaN(i)||o,c=t.axis,h=i,p=i;return Ks(i)?h=p={center:.5,edges:.5,end:1}[i]||0:!o&&u&&(h=i[0],p=i[1]),function(v,y,_){var A=(_||t).length,E=a[A],T,M,R,L,w,N,O,F,B;if(!E){if(B=t.grid==="auto"?0:(t.grid||[1,wo])[1],!B){for(O=-wo;O<(O=_[B++].getBoundingClientRect().left)&&B<A;);B<A&&B--}for(E=a[A]=[],T=u?Math.min(B,A)*h-.5:i%B,M=B===wo?0:u?A*p/B-.5:i/B|0,O=0,F=wo,N=0;N<A;N++)R=N%B-T,L=M-(N/B|0),E[N]=w=c?Math.abs(c==="y"?L:R):U3(R*R+L*L),w>O&&(O=w),w<F&&(F=w);i==="random"&&eP(E),E.max=O-F,E.min=F,E.v=A=(parseFloat(t.amount)||parseFloat(t.each)*(B>A?A-1:c?c==="y"?A/B:B:Math.max(B,A/B))||0)*(i==="edges"?-1:1),E.b=A<0?s-A:s,E.u=Sr(t.amount||t.each)||0,n=n&&A<0?fP(n):n}return A=(E[v]-E.min)/E.max||0,Fi(E.b+(n?n(A):A)*E.v)+E.u}},j1=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var i=Fi(Math.round(parseFloat(n)/e)*e*t);return(i-i%1)/t+(bc(n)?0:Sr(n))}},nP=function(e,t){var n=br(e),i,s;return!n&&yu(e)&&(i=n=e.radius||wo,e.values?(e=Bo(e.values),(s=!bc(e[0]))&&(i*=i)):e=j1(e.increment)),Wf(t,n?Qi(e)?function(a){return s=e(a),Math.abs(s-a)<=i?s:a}:function(a){for(var o=parseFloat(s?a.x:a),u=parseFloat(s?a.y:0),c=wo,h=0,p=e.length,v,y;p--;)s?(v=e[p].x-o,y=e[p].y-u,v=v*v+y*y):v=Math.abs(e[p]-o),v<c&&(c=v,h=p);return h=!i||c<=i?e[h]:a,s||h===a||bc(a)?h:h+Sr(a)}:j1(e))},iP=function(e,t,n,i){return Wf(br(e)?!t:n===!0?!!(n=0):!i,function(){return br(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*i)/i})},kX=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(i){return t.reduce(function(s,a){return a(s)},i)}},GX=function(e,t){return function(n){return e(parseFloat(n))+(t||Sr(n))}},HX=function(e,t,n){return rP(e,t,0,1,n)},sP=function(e,t,n){return Wf(n,function(i){return e[~~t(i)]})},zX=function r(e,t,n){var i=t-e;return br(e)?sP(e,r(0,e.length),t):Wf(n,function(s){return(i+(s-e)%i)%i+e})},VX=function r(e,t,n){var i=t-e,s=i*2;return br(e)?sP(e,r(0,e.length-1),t):Wf(n,function(a){return a=(s+(a-e)%s)%s||0,e+(a>i?s-a:a)})},Wv=function(e){return e.replace(AX,function(t){var n=t.indexOf("[")+1,i=t.substring(n||7,n?t.indexOf("]"):t.length-1).split(EX);return iP(n?i:+i[0],n?0:+i[1],+i[2]||1e-5)})},rP=function(e,t,n,i,s){var a=t-e,o=i-n;return Wf(s,function(u){return n+((u-e)/a*o||0)})},KX=function r(e,t,n,i){var s=isNaN(e+t)?0:function(y){return(1-y)*e+y*t};if(!s){var a=Ks(e),o={},u,c,h,p,v;if(n===!0&&(i=1)&&(n=null),a)e={p:e},t={p:t};else if(br(e)&&!br(t)){for(h=[],p=e.length,v=p-2,c=1;c<p;c++)h.push(r(e[c-1],e[c]));p--,s=function(_){_*=p;var A=Math.min(v,~~_);return h[A](_-A)},n=t}else i||(e=tg(br(e)?[]:{},e));if(!h){for(u in t)FC.call(o,e,u,"get",t[u]);s=function(_){return zC(_,o)||(a?e.p:e)}}}return Wf(n,s)},xw=function(e,t,n){var i=e.labels,s=wo,a,o,u;for(a in i)o=i[a]-t,o<0==!!n&&o&&s>(o=Math.abs(o))&&(u=a,s=o);return u},qa=function(e,t,n){var i=e.vars,s=i[t],a=Ii,o=e._ctx,u,c,h;if(s)return u=i[t+"Params"],c=i.callbackScope||e,n&&Bf.length&&vA(),o&&(Ii=o),h=u?s.apply(c,u):s.call(c),Ii=a,h},cv=function(e){return Hf(e),e.scrollTrigger&&e.scrollTrigger.kill(!!ir),e.progress()<1&&qa(e,"onInterrupt"),e},Cm,aP=[],oP=function(e){if(e)if(e=!e.name&&e.default||e,IC()||e.headless){var t=e.name,n=Qi(e),i=t&&!n&&e.init?function(){this._props=[]}:e,s={init:qv,render:zC,add:FC,kill:aq,modifier:rq,rawVars:0},a={targetTest:0,get:0,getSetter:HC,aliases:{},register:0};if(sg(),e!==i){if(Va[t])return;so(i,so(yA(e,s),a)),tg(i.prototype,tg(s,yA(e,a))),Va[i.prop=t]=i,e.targetTest&&(iS.push(i),OC[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}V3(t,i),e.register&&e.register(ba,i,Ea)}else aP.push(e)},pi=255,fv={aqua:[0,pi,pi],lime:[0,pi,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,pi],navy:[0,0,128],white:[pi,pi,pi],olive:[128,128,0],yellow:[pi,pi,0],orange:[pi,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[pi,0,0],pink:[pi,192,203],cyan:[0,pi,pi],transparent:[pi,pi,pi,0]},Yb=function(e,t,n){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*pi+.5|0},lP=function(e,t,n){var i=e?bc(e)?[e>>16,e>>8&pi,e&pi]:0:fv.black,s,a,o,u,c,h,p,v,y,_;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),fv[e])i=fv[e];else if(e.charAt(0)==="#"){if(e.length<6&&(s=e.charAt(1),a=e.charAt(2),o=e.charAt(3),e="#"+s+s+a+a+o+o+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&pi,i&pi,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&pi,e&pi]}else if(e.substr(0,3)==="hsl"){if(i=_=e.match(mw),!t)u=+i[0]%360/360,c=+i[1]/100,h=+i[2]/100,a=h<=.5?h*(c+1):h+c-h*c,s=h*2-a,i.length>3&&(i[3]*=1),i[0]=Yb(u+1/3,s,a),i[1]=Yb(u,s,a),i[2]=Yb(u-1/3,s,a);else if(~e.indexOf("="))return i=e.match(k3),n&&i.length<4&&(i[3]=1),i}else i=e.match(mw)||fv.transparent;i=i.map(Number)}return t&&!_&&(s=i[0]/pi,a=i[1]/pi,o=i[2]/pi,p=Math.max(s,a,o),v=Math.min(s,a,o),h=(p+v)/2,p===v?u=c=0:(y=p-v,c=h>.5?y/(2-p-v):y/(p+v),u=p===s?(a-o)/y+(a<o?6:0):p===a?(o-s)/y+2:(s-a)/y+4,u*=60),i[0]=~~(u+.5),i[1]=~~(c*100+.5),i[2]=~~(h*100+.5)),n&&i.length<4&&(i[3]=1),i},uP=function(e){var t=[],n=[],i=-1;return e.split(Of).forEach(function(s){var a=s.match(Mm)||[];t.push.apply(t,a),n.push(i+=a.length+1)}),t.c=n,t},Sw=function(e,t,n){var i="",s=(e+i).match(Of),a=t?"hsla(":"rgba(",o=0,u,c,h,p;if(!s)return e;if(s=s.map(function(v){return(v=lP(v,t,1))&&a+(t?v[0]+","+v[1]+"%,"+v[2]+"%,"+v[3]:v.join(","))+")"}),n&&(h=uP(e),u=n.c,u.join(i)!==h.c.join(i)))for(c=e.replace(Of,"1").split(Mm),p=c.length-1;o<p;o++)i+=c[o]+(~u.indexOf(o)?s.shift()||a+"0,0,0,0)":(h.length?h:s.length?s:n).shift());if(!c)for(c=e.split(Of),p=c.length-1;o<p;o++)i+=c[o]+s[o];return i+c[p]},Of=(function(){var r="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in fv)r+="|"+e+"\\b";return new RegExp(r+")","gi")})(),YX=/hsl[a]?\(/,cP=function(e){var t=e.join(" "),n;if(Of.lastIndex=0,Of.test(t))return n=YX.test(t),e[1]=Sw(e[1],n),e[0]=Sw(e[0],n,uP(e[1])),!0},jv,Ka=(function(){var r=Date.now,e=500,t=33,n=r(),i=n,s=1e3/240,a=s,o=[],u,c,h,p,v,y,_=function A(E){var T=r()-i,M=E===!0,R,L,w,N;if((T>e||T<0)&&(n+=T-t),i+=T,w=i-n,R=w-a,(R>0||M)&&(N=++p.frame,v=w-p.time*1e3,p.time=w=w/1e3,a+=R+(R>=s?4:s-R),L=1),M||(u=c(A)),L)for(y=0;y<o.length;y++)o[y](w,v,N,E)};return p={time:0,frame:0,tick:function(){_(!0)},deltaRatio:function(E){return v/(1e3/(E||60))},wake:function(){H3&&(!V1&&IC()&&(ou=V1=window,wC=ou.document||{},io.gsap=ba,(ou.gsapVersions||(ou.gsapVersions=[])).push(ba.version),z3(gA||ou.GreenSockGlobals||!ou.gsap&&ou||{}),aP.forEach(oP)),h=typeof requestAnimationFrame<"u"&&requestAnimationFrame,u&&p.sleep(),c=h||function(E){return setTimeout(E,a-p.time*1e3+1|0)},jv=1,_(2))},sleep:function(){(h?cancelAnimationFrame:clearTimeout)(u),jv=0,c=qv},lagSmoothing:function(E,T){e=E||1/0,t=Math.min(T||33,e)},fps:function(E){s=1e3/(E||240),a=p.time*1e3+s},add:function(E,T,M){var R=T?function(L,w,N,O){E(L,w,N,O),p.remove(R)}:E;return p.remove(E),o[M?"unshift":"push"](R),sg(),R},remove:function(E,T){~(T=o.indexOf(E))&&o.splice(T,1)&&y>=T&&y--},_listeners:o},p})(),sg=function(){return!jv&&Ka.wake()},wn={},XX=/^[\d.\-M][\d.\-,\s]/,qX=/["']/g,WX=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),i=n[0],s=1,a=n.length,o,u,c;s<a;s++)u=n[s],o=s!==a-1?u.lastIndexOf(","):u.length,c=u.substr(0,o),t[i]=isNaN(c)?c.replace(qX,"").trim():+c,i=u.substr(o+1).trim();return t},jX=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<n?e.indexOf(")",n+1):n)},JX=function(e){var t=(e+"").split("("),n=wn[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[WX(t[1])]:jX(e).split(",").map(q3)):wn._CE&&XX.test(e)?wn._CE("",e):n},fP=function(e){return function(t){return 1-e(1-t)}},hP=function r(e,t){for(var n=e._first,i;n;)n instanceof $r?r(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?r(n.timeline,t):(i=n._ease,n._ease=n._yEase,n._yEase=i,n._yoyo=t)),n=n._next},Td=function(e,t){return e&&(Qi(e)?e:wn[e]||JX(e))||t},Gd=function(e,t,n,i){n===void 0&&(n=function(u){return 1-t(1-u)}),i===void 0&&(i=function(u){return u<.5?t(u*2)/2:1-t((1-u)*2)/2});var s={easeIn:t,easeOut:n,easeInOut:i},a;return Aa(e,function(o){wn[o]=io[o]=s,wn[a=o.toLowerCase()]=n;for(var u in s)wn[a+(u==="easeIn"?".in":u==="easeOut"?".out":".inOut")]=wn[o+"."+u]=s[u]}),s},dP=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},Xb=function r(e,t,n){var i=t>=1?t:1,s=(n||(e?.3:.45))/(t<1?t:1),a=s/z1*(Math.asin(1/i)||0),o=function(h){return h===1?1:i*Math.pow(2,-10*h)*SX((h-a)*s)+1},u=e==="out"?o:e==="in"?function(c){return 1-o(1-c)}:dP(o);return s=z1/s,u.config=function(c,h){return r(e,c,h)},u},qb=function r(e,t){t===void 0&&(t=1.70158);var n=function(a){return a?--a*a*((t+1)*a+t)+1:0},i=e==="out"?n:e==="in"?function(s){return 1-n(1-s)}:dP(n);return i.config=function(s){return r(e,s)},i};Aa("Linear,Quad,Cubic,Quart,Quint,Strong",function(r,e){var t=e<5?e+1:e;Gd(r+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});wn.Linear.easeNone=wn.none=wn.Linear.easeIn;Gd("Elastic",Xb("in"),Xb("out"),Xb());(function(r,e){var t=1/e,n=2*t,i=2.5*t,s=function(o){return o<t?r*o*o:o<n?r*Math.pow(o-1.5/e,2)+.75:o<i?r*(o-=2.25/e)*o+.9375:r*Math.pow(o-2.625/e,2)+.984375};Gd("Bounce",function(a){return 1-s(1-a)},s)})(7.5625,2.75);Gd("Expo",function(r){return Math.pow(2,10*(r-1))*r+r*r*r*r*r*r*(1-r)});Gd("Circ",function(r){return-(U3(1-r*r)-1)});Gd("Sine",function(r){return r===1?1:-xX(r*yX)+1});Gd("Back",qb("in"),qb("out"),qb());wn.SteppedEase=wn.steps=io.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,i=e+(t?0:1),s=t?1:0,a=1-mi;return function(o){return((i*dy(0,a,o)|0)+s)*n}}};eg.ease=wn["quad.out"];Aa("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(r){return PC+=r+","+r+"Params,"});var pP=function(e,t){this.id=_X++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Y3,this.set=t?t.getSetter:HC},Jv=(function(){function r(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,ig(this,+t.duration,1,1),this.data=t.data,Ii&&(this._ctx=Ii,Ii.data.push(this)),jv||Ka.wake()}var e=r.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,ig(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,i){if(sg(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(yE(this,n),!s._dp||s.parent||J3(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&uu(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===mi||!this._initted&&this._dur&&n||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),X3(this,n,i)),this},e.time=function(n,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+yw(this))%(this._dur+this._rDelay)||(n?this._dur:0),i):this._time},e.totalProgress=function(n,i){return arguments.length?this.totalTime(this.totalDuration()*n,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(n,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+yw(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(n,i){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*s,i):this._repeat?ng(this._tTime,s)+1:1},e.timeScale=function(n,i){if(!arguments.length)return this._rts===-mi?0:this._rts;if(this._rts===n)return this;var s=this.parent&&this._ts?_A(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-mi?0:this._rts,this.totalTime(dy(-Math.abs(this._delay),this.totalDuration(),s),i!==!1),vE(this),IX(this)},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(sg(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==mi&&(this._tTime-=mi)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=Fi(n);var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&uu(i,this,this._start-this._delay),this}return this._start},e.endTime=function(n){return this._start+(Sa(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(n){var i=this.parent||this._dp;return i?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?_A(i.rawTime(n),this):this._tTime:this._tTime},e.revert=function(n){n===void 0&&(n=CX);var i=ir;return ir=n,UC(this)&&(this.timeline&&this.timeline.revert(n),this.totalTime(-.01,n.suppressEvents)),this.data!=="nested"&&n.kill!==!1&&this.kill(),ir=i,this},e.globalTime=function(n){for(var i=this,s=arguments.length?n:i.rawTime();i;)s=i._start+s/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(n):s},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,_w(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var i=this._time;return this._rDelay=n,_w(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,i){return this.totalTime(Co(this,n),Sa(i))},e.restart=function(n,i){return this.play().totalTime(n?-this._delay:0,Sa(i)),this._dur||(this._zTime=-mi),this},e.play=function(n,i){return n!=null&&this.seek(n,i),this.reversed(!1).paused(!1)},e.reverse=function(n,i){return n!=null&&this.seek(n||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(n,i){return n!=null&&this.seek(n,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-mi:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-mi,this},e.isActive=function(){var n=this.parent||this._dp,i=this._start,s;return!!(!n||this._ts&&this._initted&&n.isActive()&&(s=n.rawTime(!0))>=i&&s<this.endTime(!0)-mi)},e.eventCallback=function(n,i,s){var a=this.vars;return arguments.length>1?(i?(a[n]=i,s&&(a[n+"Params"]=s),n==="onUpdate"&&(this._onUpdate=i)):delete a[n],this):a[n]},e.then=function(n){var i=this,s=i._prom;return new Promise(function(a){var o=Qi(n)?n:W3,u=function(){var h=i.then;i.then=null,s&&s(),Qi(o)&&(o=o(i))&&(o.then||o===i)&&(i.then=h),a(o),i.then=h};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?u():i._prom=u})},e.kill=function(){cv(this)},r})();so(Jv.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-mi,_prom:0,_ps:!1,_rts:1});var $r=(function(r){N3(e,r);function e(n,i){var s;return n===void 0&&(n={}),s=r.call(this,n)||this,s.labels={},s.smoothChildTiming=!!n.smoothChildTiming,s.autoRemoveChildren=!!n.autoRemoveChildren,s._sort=Sa(n.sortChildren),ki&&uu(n.parent||ki,dc(s),i),n.reversed&&s.reverse(),n.paused&&s.paused(!0),n.scrollTrigger&&Q3(dc(s),n.scrollTrigger),s}var t=e.prototype;return t.to=function(i,s,a){return Mv(0,arguments,this),this},t.from=function(i,s,a){return Mv(1,arguments,this),this},t.fromTo=function(i,s,a,o){return Mv(2,arguments,this),this},t.set=function(i,s,a){return s.duration=0,s.parent=this,bv(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new ms(i,s,Co(this,a),1),this},t.call=function(i,s,a){return uu(this,ms.delayedCall(0,i,s),a)},t.staggerTo=function(i,s,a,o,u,c,h){return a.duration=s,a.stagger=a.stagger||o,a.onComplete=c,a.onCompleteParams=h,a.parent=this,new ms(i,a,Co(this,u)),this},t.staggerFrom=function(i,s,a,o,u,c,h){return a.runBackwards=1,bv(a).immediateRender=Sa(a.immediateRender),this.staggerTo(i,s,a,o,u,c,h)},t.staggerFromTo=function(i,s,a,o,u,c,h,p){return o.startAt=a,bv(o).immediateRender=Sa(o.immediateRender),this.staggerTo(i,s,o,u,c,h,p)},t.render=function(i,s,a){var o=this._time,u=this._dirty?this.totalDuration():this._tDur,c=this._dur,h=i<=0?0:Fi(i),p=this._zTime<0!=i<0&&(this._initted||!c),v,y,_,A,E,T,M,R,L,w,N,O;if(this!==ki&&h>u&&i>=0&&(h=u),h!==this._tTime||a||p){if(o!==this._time&&c&&(h+=this._time-o,i+=this._time-o),v=h,L=this._start,R=this._ts,T=!R,p&&(c||(o=this._zTime),(i||!s)&&(this._zTime=i)),this._repeat){if(N=this._yoyo,E=c+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(E*100+i,s,a);if(v=Fi(h%E),h===u?(A=this._repeat,v=c):(w=Fi(h/E),A=~~w,A&&A===w&&(v=c,A--),v>c&&(v=c)),w=ng(this._tTime,E),!o&&this._tTime&&w!==A&&this._tTime-w*E-this._dur<=0&&(w=A),N&&A&1&&(v=c-v,O=1),A!==w&&!this._lock){var F=N&&w&1,B=F===(N&&A&1);if(A<w&&(F=!F),o=F?0:h%c?c:h,this._lock=1,this.render(o||(O?0:Fi(A*E)),s,!c)._lock=0,this._tTime=h,!s&&this.parent&&qa(this,"onRepeat"),this.vars.repeatRefresh&&!O&&(this.invalidate()._lock=1,w=A),o&&o!==this._time||T!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,u=this._tDur,B&&(this._lock=2,o=F?c:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!O&&this.invalidate()),this._lock=0,!this._ts&&!T)return this;hP(this,O)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(M=PX(this,Fi(o),Fi(v)),M&&(h-=v-(v=M._start))),this._tTime=h,this._time=v,this._act=!R,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,o=0),!o&&h&&c&&!s&&!w&&(qa(this,"onStart"),this._tTime!==h))return this;if(v>=o&&i>=0)for(y=this._first;y;){if(_=y._next,(y._act||v>=y._start)&&y._ts&&M!==y){if(y.parent!==this)return this.render(i,s,a);if(y.render(y._ts>0?(v-y._start)*y._ts:(y._dirty?y.totalDuration():y._tDur)+(v-y._start)*y._ts,s,a),v!==this._time||!this._ts&&!T){M=0,_&&(h+=this._zTime=-mi);break}}y=_}else{y=this._last;for(var P=i<0?i:v;y;){if(_=y._prev,(y._act||P<=y._end)&&y._ts&&M!==y){if(y.parent!==this)return this.render(i,s,a);if(y.render(y._ts>0?(P-y._start)*y._ts:(y._dirty?y.totalDuration():y._tDur)+(P-y._start)*y._ts,s,a||ir&&UC(y)),v!==this._time||!this._ts&&!T){M=0,_&&(h+=this._zTime=P?-mi:mi);break}}y=_}}if(M&&!s&&(this.pause(),M.render(v>=o?0:-mi)._zTime=v>=o?1:-1,this._ts))return this._start=L,vE(this),this.render(i,s,a);this._onUpdate&&!s&&qa(this,"onUpdate",!0),(h===u&&this._tTime>=this.totalDuration()||!h&&o)&&(L===this._start||Math.abs(R)!==Math.abs(this._ts))&&(this._lock||((i||!c)&&(h===u&&this._ts>0||!h&&this._ts<0)&&Hf(this,1),!s&&!(i<0&&!o)&&(h||o||!u)&&(qa(this,h===u&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(h<u&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,s){var a=this;if(bc(s)||(s=Co(this,s,i)),!(i instanceof Jv)){if(br(i))return i.forEach(function(o){return a.add(o,s)}),this;if(Ks(i))return this.addLabel(i,s);if(Qi(i))i=ms.delayedCall(0,i);else return this}return this!==i?uu(this,i,s):this},t.getChildren=function(i,s,a,o){i===void 0&&(i=!0),s===void 0&&(s=!0),a===void 0&&(a=!0),o===void 0&&(o=-wo);for(var u=[],c=this._first;c;)c._start>=o&&(c instanceof ms?s&&u.push(c):(a&&u.push(c),i&&u.push.apply(u,c.getChildren(!0,s,a)))),c=c._next;return u},t.getById=function(i){for(var s=this.getChildren(1,1,1),a=s.length;a--;)if(s[a].vars.id===i)return s[a]},t.remove=function(i){return Ks(i)?this.removeLabel(i):Qi(i)?this.killTweensOf(i):(i.parent===this&&gE(this,i),i===this._recent&&(this._recent=this._last),Ed(this))},t.totalTime=function(i,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Fi(Ka.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),r.prototype.totalTime.call(this,i,s),this._forcing=0,this):this._tTime},t.addLabel=function(i,s){return this.labels[i]=Co(this,s),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,s,a){var o=ms.delayedCall(0,s||qv,a);return o.data="isPause",this._hasPause=1,uu(this,o,Co(this,i))},t.removePause=function(i){var s=this._first;for(i=Co(this,i);s;)s._start===i&&s.data==="isPause"&&Hf(s),s=s._next},t.killTweensOf=function(i,s,a){for(var o=this.getTweensOf(i,a),u=o.length;u--;)Df!==o[u]&&o[u].kill(i,s);return this},t.getTweensOf=function(i,s){for(var a=[],o=Bo(i),u=this._first,c=bc(s),h;u;)u instanceof ms?RX(u._targets,o)&&(c?(!Df||u._initted&&u._ts)&&u.globalTime(0)<=s&&u.globalTime(u.totalDuration())>s:!s||u.isActive())&&a.push(u):(h=u.getTweensOf(o,s)).length&&a.push.apply(a,h),u=u._next;return a},t.tweenTo=function(i,s){s=s||{};var a=this,o=Co(a,i),u=s,c=u.startAt,h=u.onStart,p=u.onStartParams,v=u.immediateRender,y,_=ms.to(a,so({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:s.duration||Math.abs((o-(c&&"time"in c?c.time:a._time))/a.timeScale())||mi,onStart:function(){if(a.pause(),!y){var E=s.duration||Math.abs((o-(c&&"time"in c?c.time:a._time))/a.timeScale());_._dur!==E&&ig(_,E,0,1).render(_._time,!0,!0),y=1}h&&h.apply(_,p||[])}},s));return v?_.render(0):_},t.tweenFromTo=function(i,s,a){return this.tweenTo(s,so({startAt:{time:Co(this,i)}},a))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),xw(this,Co(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),xw(this,Co(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+mi)},t.shiftChildren=function(i,s,a){a===void 0&&(a=0);var o=this._first,u=this.labels,c;for(i=Fi(i);o;)o._start>=a&&(o._start+=i,o._end+=i),o=o._next;if(s)for(c in u)u[c]>=a&&(u[c]+=i);return Ed(this)},t.invalidate=function(i){var s=this._first;for(this._lock=0;s;)s.invalidate(i),s=s._next;return r.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var s=this._first,a;s;)a=s._next,this.remove(s),s=a;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),Ed(this)},t.totalDuration=function(i){var s=0,a=this,o=a._last,u=wo,c,h,p;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-i:i));if(a._dirty){for(p=a.parent;o;)c=o._prev,o._dirty&&o.totalDuration(),h=o._start,h>u&&a._sort&&o._ts&&!a._lock?(a._lock=1,uu(a,o,h-o._delay,1)._lock=0):u=h,h<0&&o._ts&&(s-=h,(!p&&!a._dp||p&&p.smoothChildTiming)&&(a._start+=Fi(h/a._ts),a._time-=h,a._tTime-=h),a.shiftChildren(-h,!1,-1/0),u=0),o._end>s&&o._ts&&(s=o._end),o=c;ig(a,a===ki&&a._time>s?a._time:s,1,1),a._dirty=0}return a._tDur},e.updateRoot=function(i){if(ki._ts&&(X3(ki,_A(i,ki)),K3=Ka.frame),Ka.frame>=gw){gw+=$a.autoSleep||120;var s=ki._first;if((!s||!s._ts)&&$a.autoSleep&&Ka._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||Ka.sleep()}}},e})(Jv);so($r.prototype,{_lock:0,_hasPause:0,_forcing:0});var QX=function(e,t,n,i,s,a,o){var u=new Ea(this._pt,e,t,0,1,xP,null,s),c=0,h=0,p,v,y,_,A,E,T,M;for(u.b=n,u.e=i,n+="",i+="",(T=~i.indexOf("random("))&&(i=Wv(i)),a&&(M=[n,i],a(M,e,t),n=M[0],i=M[1]),v=n.match(Vb)||[];p=Vb.exec(i);)_=p[0],A=i.substring(c,p.index),y?y=(y+1)%5:A.substr(-5)==="rgba("&&(y=1),_!==v[h++]&&(E=parseFloat(v[h-1])||0,u._pt={_next:u._pt,p:A||h===1?A:",",s:E,c:_.charAt(1)==="="?Nm(E,_)-E:parseFloat(_)-E,m:y&&y<4?Math.round:0},c=Vb.lastIndex);return u.c=c<i.length?i.substring(c,i.length):"",u.fp=o,(G3.test(i)||T)&&(u.e=0),this._pt=u,u},FC=function(e,t,n,i,s,a,o,u,c,h){Qi(i)&&(i=i(s||0,e,a));var p=e[t],v=n!=="get"?n:Qi(p)?c?e[t.indexOf("set")||!Qi(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():p,y=Qi(p)?c?nq:yP:GC,_;if(Ks(i)&&(~i.indexOf("random(")&&(i=Wv(i)),i.charAt(1)==="="&&(_=Nm(v,i)+(Sr(v)||0),(_||_===0)&&(i=_))),!h||v!==i||J1)return!isNaN(v*i)&&i!==""?(_=new Ea(this._pt,e,t,+v||0,i-(v||0),typeof p=="boolean"?sq:_P,0,y),c&&(_.fp=c),o&&_.modifier(o,this,e),this._pt=_):(!p&&!(t in e)&&BC(t,i),QX.call(this,e,t,v,i,y,u||$a.stringFilter,c))},$X=function(e,t,n,i,s){if(Qi(e)&&(e=Cv(e,s,t,n,i)),!yu(e)||e.style&&e.nodeType||br(e)||F3(e))return Ks(e)?Cv(e,s,t,n,i):e;var a={},o;for(o in e)a[o]=Cv(e[o],s,t,n,i);return a},mP=function(e,t,n,i,s,a){var o,u,c,h;if(Va[e]&&(o=new Va[e]).init(s,o.rawVars?t[e]:$X(t[e],i,s,a,n),n,i,a)!==!1&&(n._pt=u=new Ea(n._pt,s,e,0,1,o.render,o,0,o.priority),n!==Cm))for(c=n._ptLookup[n._targets.indexOf(s)],h=o._props.length;h--;)c[o._props[h]]=u;return o},Df,J1,kC=function r(e,t,n){var i=e.vars,s=i.ease,a=i.startAt,o=i.immediateRender,u=i.lazy,c=i.onUpdate,h=i.runBackwards,p=i.yoyoEase,v=i.keyframes,y=i.autoRevert,_=e._dur,A=e._startAt,E=e._targets,T=e.parent,M=T&&T.data==="nested"?T.vars.targets:E,R=e._overwrite==="auto"&&!DC,L=e.timeline,w,N,O,F,B,P,V,J,Q,ie,ne,k,K;if(L&&(!v||!s)&&(s="none"),e._ease=Td(s,eg.ease),e._yEase=p?fP(Td(p===!0?s:p,eg.ease)):0,p&&e._yoyo&&!e._repeat&&(p=e._yEase,e._yEase=e._ease,e._ease=p),e._from=!L&&!!i.runBackwards,!L||v&&!i.stagger){if(J=E[0]?Ad(E[0]).harness:0,k=J&&i[J.prop],w=yA(i,OC),A&&(A._zTime<0&&A.progress(1),t<0&&h&&o&&!y?A.render(-1,!0):A.revert(h&&_?nS:MX),A._lazy=0),a){if(Hf(e._startAt=ms.set(E,so({data:"isStart",overwrite:!1,parent:T,immediateRender:!0,lazy:!A&&Sa(u),startAt:null,delay:0,onUpdate:c&&function(){return qa(e,"onUpdate")},stagger:0},a))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(ir||!o&&!y)&&e._startAt.revert(nS),o&&_&&t<=0&&n<=0){t&&(e._zTime=t);return}}else if(h&&_&&!A){if(t&&(o=!1),O=so({overwrite:!1,data:"isFromStart",lazy:o&&!A&&Sa(u),immediateRender:o,stagger:0,parent:T},w),k&&(O[J.prop]=k),Hf(e._startAt=ms.set(E,O)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(ir?e._startAt.revert(nS):e._startAt.render(-1,!0)),e._zTime=t,!o)r(e._startAt,mi,mi);else if(!t)return}for(e._pt=e._ptCache=0,u=_&&Sa(u)||u&&!_,N=0;N<E.length;N++){if(B=E[N],V=B._gsap||NC(E)[N]._gsap,e._ptLookup[N]=ie={},K1[V.id]&&Bf.length&&vA(),ne=M===E?N:M.indexOf(B),J&&(Q=new J).init(B,k||w,e,ne,M)!==!1&&(e._pt=F=new Ea(e._pt,B,Q.name,0,1,Q.render,Q,0,Q.priority),Q._props.forEach(function(j){ie[j]=F}),Q.priority&&(P=1)),!J||k)for(O in w)Va[O]&&(Q=mP(O,w,e,ne,B,M))?Q.priority&&(P=1):ie[O]=F=FC.call(e,B,O,"get",w[O],ne,M,0,i.stringFilter);e._op&&e._op[N]&&e.kill(B,e._op[N]),R&&e._pt&&(Df=e,ki.killTweensOf(B,ie,e.globalTime(t)),K=!e.parent,Df=0),e._pt&&u&&(K1[V.id]=1)}P&&SP(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!K,v&&t<=0&&L.render(wo,!0,!0)},ZX=function(e,t,n,i,s,a,o,u){var c=(e._pt&&e._ptCache||(e._ptCache={}))[t],h,p,v,y;if(!c)for(c=e._ptCache[t]=[],v=e._ptLookup,y=e._targets.length;y--;){if(h=v[y][t],h&&h.d&&h.d._pt)for(h=h.d._pt;h&&h.p!==t&&h.fp!==t;)h=h._next;if(!h)return J1=1,e.vars[t]="+=0",kC(e,o),J1=0,u?Xv(t+" not eligible for reset"):1;c.push(h)}for(y=c.length;y--;)p=c[y],h=p._pt||p,h.s=(i||i===0)&&!s?i:h.s+(i||0)+a*h.c,h.c=n-h.s,p.e&&(p.e=ss(n)+Sr(p.e)),p.b&&(p.b=h.s+Sr(p.b))},eq=function(e,t){var n=e[0]?Ad(e[0]).harness:0,i=n&&n.aliases,s,a,o,u;if(!i)return t;s=tg({},t);for(a in i)if(a in s)for(u=i[a].split(","),o=u.length;o--;)s[u[o]]=s[a];return s},tq=function(e,t,n,i){var s=t.ease||i||"power1.inOut",a,o;if(br(t))o=n[e]||(n[e]=[]),t.forEach(function(u,c){return o.push({t:c/(t.length-1)*100,v:u,e:s})});else for(a in t)o=n[a]||(n[a]=[]),a==="ease"||o.push({t:parseFloat(e),v:t[a],e:s})},Cv=function(e,t,n,i,s){return Qi(e)?e.call(t,n,i,s):Ks(e)&&~e.indexOf("random(")?Wv(e):e},gP=PC+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",vP={};Aa(gP+",id,stagger,delay,duration,paused,scrollTrigger",function(r){return vP[r]=1});var ms=(function(r){N3(e,r);function e(n,i,s,a){var o;typeof i=="number"&&(s.duration=i,i=s,s=null),o=r.call(this,a?i:bv(i))||this;var u=o.vars,c=u.duration,h=u.delay,p=u.immediateRender,v=u.stagger,y=u.overwrite,_=u.keyframes,A=u.defaults,E=u.scrollTrigger,T=u.yoyoEase,M=i.parent||ki,R=(br(n)||F3(n)?bc(n[0]):"length"in i)?[n]:Bo(n),L,w,N,O,F,B,P,V;if(o._targets=R.length?NC(R):Xv("GSAP target "+n+" not found. https://gsap.com",!$a.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=y,_||v||zx(c)||zx(h)){if(i=o.vars,L=o.timeline=new $r({data:"nested",defaults:A||{},targets:M&&M.data==="nested"?M.vars.targets:R}),L.kill(),L.parent=L._dp=dc(o),L._start=0,v||zx(c)||zx(h)){if(O=R.length,P=v&&tP(v),yu(v))for(F in v)~gP.indexOf(F)&&(V||(V={}),V[F]=v[F]);for(w=0;w<O;w++)N=yA(i,vP),N.stagger=0,T&&(N.yoyoEase=T),V&&tg(N,V),B=R[w],N.duration=+Cv(c,dc(o),w,B,R),N.delay=(+Cv(h,dc(o),w,B,R)||0)-o._delay,!v&&O===1&&N.delay&&(o._delay=h=N.delay,o._start+=h,N.delay=0),L.to(B,N,P?P(w,B,R):0),L._ease=wn.none;L.duration()?c=h=0:o.timeline=0}else if(_){bv(so(L.vars.defaults,{ease:"none"})),L._ease=Td(_.ease||i.ease||"none");var J=0,Q,ie,ne;if(br(_))_.forEach(function(k){return L.to(R,k,">")}),L.duration();else{N={};for(F in _)F==="ease"||F==="easeEach"||tq(F,_[F],N,_.easeEach);for(F in N)for(Q=N[F].sort(function(k,K){return k.t-K.t}),J=0,w=0;w<Q.length;w++)ie=Q[w],ne={ease:ie.e,duration:(ie.t-(w?Q[w-1].t:0))/100*c},ne[F]=ie.v,L.to(R,ne,J),J+=ne.duration;L.duration()<c&&L.to({},{duration:c-L.duration()})}}c||o.duration(c=L.duration())}else o.timeline=0;return y===!0&&!DC&&(Df=dc(o),ki.killTweensOf(R),Df=0),uu(M,dc(o),s),i.reversed&&o.reverse(),i.paused&&o.paused(!0),(p||!c&&!_&&o._start===Fi(M._time)&&Sa(p)&&wX(dc(o))&&M.data!=="nested")&&(o._tTime=-mi,o.render(Math.max(0,-h)||0)),E&&Q3(dc(o),E),o}var t=e.prototype;return t.render=function(i,s,a){var o=this._time,u=this._tDur,c=this._dur,h=i<0,p=i>u-mi&&!h?u:i<mi?0:i,v,y,_,A,E,T,M,R,L;if(!c)OX(this,i,s,a);else if(p!==this._tTime||!i||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==h||this._lazy){if(v=p,R=this.timeline,this._repeat){if(A=c+this._rDelay,this._repeat<-1&&h)return this.totalTime(A*100+i,s,a);if(v=Fi(p%A),p===u?(_=this._repeat,v=c):(E=Fi(p/A),_=~~E,_&&_===E?(v=c,_--):v>c&&(v=c)),T=this._yoyo&&_&1,T&&(L=this._yEase,v=c-v),E=ng(this._tTime,A),v===o&&!a&&this._initted&&_===E)return this._tTime=p,this;_!==E&&(R&&this._yEase&&hP(R,T),this.vars.repeatRefresh&&!T&&!this._lock&&v!==A&&this._initted&&(this._lock=a=1,this.render(Fi(A*_),!0).invalidate()._lock=0))}if(!this._initted){if($3(this,h?i:v,a,s,p))return this._tTime=0,this;if(o!==this._time&&!(a&&this.vars.repeatRefresh&&_!==E))return this;if(c!==this._dur)return this.render(i,s,a)}if(this._tTime=p,this._time=v,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=M=(L||this._ease)(v/c),this._from&&(this.ratio=M=1-M),!o&&p&&!s&&!E&&(qa(this,"onStart"),this._tTime!==p))return this;for(y=this._pt;y;)y.r(M,y.d),y=y._next;R&&R.render(i<0?i:R._dur*R._ease(v/this._dur),s,a)||this._startAt&&(this._zTime=i),this._onUpdate&&!s&&(h&&Y1(this,i,s,a),qa(this,"onUpdate")),this._repeat&&_!==E&&this.vars.onRepeat&&!s&&this.parent&&qa(this,"onRepeat"),(p===this._tDur||!p)&&this._tTime===p&&(h&&!this._onUpdate&&Y1(this,i,!0,!0),(i||!c)&&(p===this._tDur&&this._ts>0||!p&&this._ts<0)&&Hf(this,1),!s&&!(h&&!o)&&(p||o||T)&&(qa(this,p===u?"onComplete":"onReverseComplete",!0),this._prom&&!(p<u&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),r.prototype.invalidate.call(this,i)},t.resetTo=function(i,s,a,o,u){jv||Ka.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),h;return this._initted||kC(this,c),h=this._ease(c/this._dur),ZX(this,i,s,a,o,h,c,u)?this.resetTo(i,s,a,o,1):(yE(this,0),this.parent||j3(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,s){if(s===void 0&&(s="all"),!i&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?cv(this):this.scrollTrigger&&this.scrollTrigger.kill(!!ir),this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(i,s,Df&&Df.vars.overwrite!==!0)._first||cv(this),this.parent&&a!==this.timeline.totalDuration()&&ig(this,this._dur*this.timeline._tDur/a,0,1),this}var o=this._targets,u=i?Bo(i):o,c=this._ptLookup,h=this._pt,p,v,y,_,A,E,T;if((!s||s==="all")&&LX(o,u))return s==="all"&&(this._pt=0),cv(this);for(p=this._op=this._op||[],s!=="all"&&(Ks(s)&&(A={},Aa(s,function(M){return A[M]=1}),s=A),s=eq(o,s)),T=o.length;T--;)if(~u.indexOf(o[T])){v=c[T],s==="all"?(p[T]=s,_=v,y={}):(y=p[T]=p[T]||{},_=s);for(A in _)E=v&&v[A],E&&((!("kill"in E.d)||E.d.kill(A)===!0)&&gE(this,E,"_pt"),delete v[A]),y!=="all"&&(y[A]=1)}return this._initted&&!this._pt&&h&&cv(this),this},e.to=function(i,s){return new e(i,s,arguments[2])},e.from=function(i,s){return Mv(1,arguments)},e.delayedCall=function(i,s,a,o){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:s,onReverseComplete:s,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:o})},e.fromTo=function(i,s,a){return Mv(2,arguments)},e.set=function(i,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(i,s)},e.killTweensOf=function(i,s,a){return ki.killTweensOf(i,s,a)},e})(Jv);so(ms.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Aa("staggerTo,staggerFrom,staggerFromTo",function(r){ms[r]=function(){var e=new $r,t=q1.call(arguments,0);return t.splice(r==="staggerFromTo"?5:4,0,0),e[r].apply(e,t)}});var GC=function(e,t,n){return e[t]=n},yP=function(e,t,n){return e[t](n)},nq=function(e,t,n,i){return e[t](i.fp,n)},iq=function(e,t,n){return e.setAttribute(t,n)},HC=function(e,t){return Qi(e[t])?yP:LC(e[t])&&e.setAttribute?iq:GC},_P=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},sq=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},xP=function(e,t){var n=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+i,n=n._next;i+=t.c}t.set(t.t,t.p,i,t)},zC=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},rq=function(e,t,n,i){for(var s=this._pt,a;s;)a=s._next,s.p===i&&s.modifier(e,t,n),s=a},aq=function(e){for(var t=this._pt,n,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?gE(this,t,"_pt"):t.dep||(n=1),t=i;return!n},oq=function(e,t,n,i){i.mSet(e,t,i.m.call(i.tween,n,i.mt),i)},SP=function(e){for(var t=e._pt,n,i,s,a;t;){for(n=t._next,i=s;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:a)?t._prev._next=t:s=t,(t._next=i)?i._prev=t:a=t,t=n}e._pt=s},Ea=(function(){function r(t,n,i,s,a,o,u,c,h){this.t=n,this.s=s,this.c=a,this.p=i,this.r=o||_P,this.d=u||this,this.set=c||GC,this.pr=h||0,this._next=t,t&&(t._prev=this)}var e=r.prototype;return e.modifier=function(n,i,s){this.mSet=this.mSet||this.set,this.set=oq,this.m=n,this.mt=s,this.tween=i},r})();Aa(PC+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(r){return OC[r]=1});io.TweenMax=io.TweenLite=ms;io.TimelineLite=io.TimelineMax=$r;ki=new $r({sortChildren:!1,defaults:eg,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});$a.stringFilter=cP;var bd=[],sS={},lq=[],Aw=0,uq=0,Wb=function(e){return(sS[e]||lq).map(function(t){return t()})},Q1=function(){var e=Date.now(),t=[];e-Aw>2&&(Wb("matchMediaInit"),bd.forEach(function(n){var i=n.queries,s=n.conditions,a,o,u,c;for(o in i)a=ou.matchMedia(i[o]).matches,a&&(u=1),a!==s[o]&&(s[o]=a,c=1);c&&(n.revert(),u&&t.push(n))}),Wb("matchMediaRevert"),t.forEach(function(n){return n.onMatch(n,function(i){return n.add(null,i)})}),Aw=e,Wb("matchMedia"))},AP=(function(){function r(t,n){this.selector=n&&W1(n),this.data=[],this._r=[],this.isReverted=!1,this.id=uq++,t&&this.add(t)}var e=r.prototype;return e.add=function(n,i,s){Qi(n)&&(s=i,i=n,n=Qi);var a=this,o=function(){var c=Ii,h=a.selector,p;return c&&c!==a&&c.data.push(a),s&&(a.selector=W1(s)),Ii=a,p=i.apply(a,arguments),Qi(p)&&a._r.push(p),Ii=c,a.selector=h,a.isReverted=!1,p};return a.last=o,n===Qi?o(a,function(u){return a.add(null,u)}):n?a[n]=o:o},e.ignore=function(n){var i=Ii;Ii=null,n(this),Ii=i},e.getTweens=function(){var n=[];return this.data.forEach(function(i){return i instanceof r?n.push.apply(n,i.getTweens()):i instanceof ms&&!(i.parent&&i.parent.data==="nested")&&n.push(i)}),n},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(n,i){var s=this;if(n?(function(){for(var o=s.getTweens(),u=s.data.length,c;u--;)c=s.data[u],c.data==="isFlip"&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(h){return o.splice(o.indexOf(h),1)}));for(o.map(function(h){return{g:h._dur||h._delay||h._sat&&!h._sat.vars.immediateRender?h.globalTime(0):-1/0,t:h}}).sort(function(h,p){return p.g-h.g||-1/0}).forEach(function(h){return h.t.revert(n)}),u=s.data.length;u--;)c=s.data[u],c instanceof $r?c.data!=="nested"&&(c.scrollTrigger&&c.scrollTrigger.revert(),c.kill()):!(c instanceof ms)&&c.revert&&c.revert(n);s._r.forEach(function(h){return h(n,s)}),s.isReverted=!0})():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),i)for(var a=bd.length;a--;)bd[a].id===this.id&&bd.splice(a,1)},e.revert=function(n){this.kill(n||{})},r})(),cq=(function(){function r(t){this.contexts=[],this.scope=t,Ii&&Ii.data.push(this)}var e=r.prototype;return e.add=function(n,i,s){yu(n)||(n={matches:n});var a=new AP(0,s||this.scope),o=a.conditions={},u,c,h;Ii&&!a.selector&&(a.selector=Ii.selector),this.contexts.push(a),i=a.add("onMatch",i),a.queries=n;for(c in n)c==="all"?h=1:(u=ou.matchMedia(n[c]),u&&(bd.indexOf(a)<0&&bd.push(a),(o[c]=u.matches)&&(h=1),u.addListener?u.addListener(Q1):u.addEventListener("change",Q1)));return h&&i(a,function(p){return a.add(null,p)}),this},e.revert=function(n){this.kill(n||{})},e.kill=function(n){this.contexts.forEach(function(i){return i.kill(n,!0)})},r})(),xA={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(i){return oP(i)})},timeline:function(e){return new $r(e)},getTweensOf:function(e,t){return ki.getTweensOf(e,t)},getProperty:function(e,t,n,i){Ks(e)&&(e=Bo(e)[0]);var s=Ad(e||{}).get,a=n?W3:q3;return n==="native"&&(n=""),e&&(t?a((Va[t]&&Va[t].get||s)(e,t,n,i)):function(o,u,c){return a((Va[o]&&Va[o].get||s)(e,o,u,c))})},quickSetter:function(e,t,n){if(e=Bo(e),e.length>1){var i=e.map(function(h){return ba.quickSetter(h,t,n)}),s=i.length;return function(h){for(var p=s;p--;)i[p](h)}}e=e[0]||{};var a=Va[t],o=Ad(e),u=o.harness&&(o.harness.aliases||{})[t]||t,c=a?function(h){var p=new a;Cm._pt=0,p.init(e,n?h+n:h,Cm,0,[e]),p.render(1,p),Cm._pt&&zC(1,Cm)}:o.set(e,u);return a?c:function(h){return c(e,u,n?h+n:h,o,1)}},quickTo:function(e,t,n){var i,s=ba.to(e,so((i={},i[t]="+=0.1",i.paused=!0,i.stagger=0,i),n||{})),a=function(u,c,h){return s.resetTo(t,u,c,h)};return a.tween=s,a},isTweening:function(e){return ki.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Td(e.ease,eg.ease)),vw(eg,e||{})},config:function(e){return vw($a,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,i=e.plugins,s=e.defaults,a=e.extendTimeline;(i||"").split(",").forEach(function(o){return o&&!Va[o]&&!io[o]&&Xv(t+" effect requires "+o+" plugin.")}),Kb[t]=function(o,u,c){return n(Bo(o),so(u||{},s),c)},a&&($r.prototype[t]=function(o,u,c){return this.add(Kb[t](o,yu(u)?u:(c=u)&&{},this),c)})},registerEase:function(e,t){wn[e]=Td(t)},parseEase:function(e,t){return arguments.length?Td(e,t):wn},getById:function(e){return ki.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new $r(e),i,s;for(n.smoothChildTiming=Sa(e.smoothChildTiming),ki.remove(n),n._dp=0,n._time=n._tTime=ki._time,i=ki._first;i;)s=i._next,(t||!(!i._dur&&i instanceof ms&&i.vars.onComplete===i._targets[0]))&&uu(n,i,i._start-i._delay),i=s;return uu(ki,n,0),n},context:function(e,t){return e?new AP(e,t):Ii},matchMedia:function(e){return new cq(e)},matchMediaRefresh:function(){return bd.forEach(function(e){var t=e.conditions,n,i;for(i in t)t[i]&&(t[i]=!1,n=1);n&&e.revert()})||Q1()},addEventListener:function(e,t){var n=sS[e]||(sS[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=sS[e],i=n&&n.indexOf(t);i>=0&&n.splice(i,1)},utils:{wrap:zX,wrapYoyo:VX,distribute:tP,random:iP,snap:nP,normalize:HX,getUnit:Sr,clamp:UX,splitColor:lP,toArray:Bo,selector:W1,mapRange:rP,pipe:kX,unitize:GX,interpolate:KX,shuffle:eP},install:z3,effects:Kb,ticker:Ka,updateRoot:$r.updateRoot,plugins:Va,globalTimeline:ki,core:{PropTween:Ea,globals:V3,Tween:ms,Timeline:$r,Animation:Jv,getCache:Ad,_removeLinkedListItem:gE,reverting:function(){return ir},context:function(e){return e&&Ii&&(Ii.data.push(e),e._ctx=Ii),Ii},suppressOverwrites:function(e){return DC=e}}};Aa("to,from,fromTo,delayedCall,set,killTweensOf",function(r){return xA[r]=ms[r]});Ka.add($r.updateRoot);Cm=xA.to({},{duration:0});var fq=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},hq=function(e,t){var n=e._targets,i,s,a;for(i in t)for(s=n.length;s--;)a=e._ptLookup[s][i],a&&(a=a.d)&&(a._pt&&(a=fq(a,i)),a&&a.modifier&&a.modifier(t[i],e,n[s],i))},jb=function(e,t){return{name:e,headless:1,rawVars:1,init:function(i,s,a){a._onInit=function(o){var u,c;if(Ks(s)&&(u={},Aa(s,function(h){return u[h]=1}),s=u),t){u={};for(c in s)u[c]=t(s[c]);s=u}hq(o,s)}}}},ba=xA.registerPlugin({name:"attr",init:function(e,t,n,i,s){var a,o,u;this.tween=n;for(a in t)u=e.getAttribute(a)||"",o=this.add(e,"setAttribute",(u||0)+"",t[a],i,s,0,0,a),o.op=a,o.b=u,this._props.push(a)},render:function(e,t){for(var n=t._pt;n;)ir?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",headless:1,init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},jb("roundProps",j1),jb("modifiers"),jb("snap",nP))||xA;ms.version=$r.version=ba.version="3.14.2";H3=1;IC()&&sg();wn.Power0;wn.Power1;wn.Power2;wn.Power3;wn.Power4;wn.Linear;wn.Quad;wn.Cubic;wn.Quart;wn.Quint;wn.Strong;wn.Elastic;wn.Back;wn.SteppedEase;wn.Bounce;wn.Sine;wn.Expo;wn.Circ;var Ew,Lf,Um,VC,gd,Tw,KC,dq=function(){return typeof window<"u"},Mc={},od=180/Math.PI,Fm=Math.PI/180,Am=Math.atan2,bw=1e8,YC=/([A-Z])/g,pq=/(left|right|width|margin|padding|x)/i,mq=/[\s,\(]\S/,hu={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},$1=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},gq=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},vq=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},yq=function(e,t){return t.set(t.t,t.p,e===1?t.e:e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},_q=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},EP=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},TP=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},xq=function(e,t,n){return e.style[t]=n},Sq=function(e,t,n){return e.style.setProperty(t,n)},Aq=function(e,t,n){return e._gsap[t]=n},Eq=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},Tq=function(e,t,n,i,s){var a=e._gsap;a.scaleX=a.scaleY=n,a.renderTransform(s,a)},bq=function(e,t,n,i,s){var a=e._gsap;a[t]=n,a.renderTransform(s,a)},Hi="transform",Ta=Hi+"Origin",Mq=function r(e,t){var n=this,i=this.target,s=i.style,a=i._gsap;if(e in Mc&&s){if(this.tfm=this.tfm||{},e!=="transform")e=hu[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return n.tfm[o]=mc(i,o)}):this.tfm[e]=a.x?a[e]:mc(i,e),e===Ta&&(this.tfm.zOrigin=a.zOrigin);else return hu.transform.split(",").forEach(function(o){return r.call(n,o,t)});if(this.props.indexOf(Hi)>=0)return;a.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(Ta,t,"")),e=Hi}(s||t)&&this.props.push(e,t,s[e])},bP=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},Cq=function(){var e=this.props,t=this.target,n=t.style,i=t._gsap,s,a;for(s=0;s<e.length;s+=3)e[s+1]?e[s+1]===2?t[e[s]](e[s+2]):t[e[s]]=e[s+2]:e[s+2]?n[e[s]]=e[s+2]:n.removeProperty(e[s].substr(0,2)==="--"?e[s]:e[s].replace(YC,"-$1").toLowerCase());if(this.tfm){for(a in this.tfm)i[a]=this.tfm[a];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),s=KC(),(!s||!s.isStart)&&!n[Hi]&&(bP(n),i.zOrigin&&n[Ta]&&(n[Ta]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},MP=function(e,t){var n={target:e,props:[],revert:Cq,save:Mq};return e._gsap||ba.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(i){return n.save(i)}),n},CP,Z1=function(e,t){var n=Lf.createElementNS?Lf.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Lf.createElement(e);return n&&n.style?n:Lf.createElement(e)},Wa=function r(e,t,n){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(YC,"-$1").toLowerCase())||i.getPropertyValue(t)||!n&&r(e,rg(t)||t,1)||""},Mw="O,Moz,ms,Ms,Webkit".split(","),rg=function(e,t,n){var i=t||gd,s=i.style,a=5;if(e in s&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);a--&&!(Mw[a]+e in s););return a<0?null:(a===3?"ms":a>=0?Mw[a]:"")+e},eM=function(){dq()&&window.document&&(Ew=window,Lf=Ew.document,Um=Lf.documentElement,gd=Z1("div")||{style:{}},Z1("div"),Hi=rg(Hi),Ta=Hi+"Origin",gd.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",CP=!!rg("perspective"),KC=ba.core.reverting,VC=1)},Cw=function(e){var t=e.ownerSVGElement,n=Z1("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=e.cloneNode(!0),s;i.style.display="block",n.appendChild(i),Um.appendChild(n);try{s=i.getBBox()}catch{}return n.removeChild(i),Um.removeChild(n),s},Rw=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},RP=function(e){var t,n;try{t=e.getBBox()}catch{t=Cw(e),n=1}return t&&(t.width||t.height)||n||(t=Cw(e)),t&&!t.width&&!t.x&&!t.y?{x:+Rw(e,["x","cx","x1"])||0,y:+Rw(e,["y","cy","y1"])||0,width:0,height:0}:t},DP=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&RP(e))},zf=function(e,t){if(t){var n=e.style,i;t in Mc&&t!==Ta&&(t=Hi),n.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(i==="--"?t:t.replace(YC,"-$1").toLowerCase())):n.removeAttribute(t)}},If=function(e,t,n,i,s,a){var o=new Ea(e._pt,t,n,0,1,a?TP:EP);return e._pt=o,o.b=i,o.e=s,e._props.push(n),o},Dw={deg:1,rad:1,turn:1},Rq={grid:1,flex:1},Vf=function r(e,t,n,i){var s=parseFloat(n)||0,a=(n+"").trim().substr((s+"").length)||"px",o=gd.style,u=pq.test(t),c=e.tagName.toLowerCase()==="svg",h=(c?"client":"offset")+(u?"Width":"Height"),p=100,v=i==="px",y=i==="%",_,A,E,T;if(i===a||!s||Dw[i]||Dw[a])return s;if(a!=="px"&&!v&&(s=r(e,t,n,"px")),T=e.getCTM&&DP(e),(y||a==="%")&&(Mc[t]||~t.indexOf("adius")))return _=T?e.getBBox()[u?"width":"height"]:e[h],ss(y?s/_*p:s/100*_);if(o[u?"width":"height"]=p+(v?a:i),A=i!=="rem"&&~t.indexOf("adius")||i==="em"&&e.appendChild&&!c?e:e.parentNode,T&&(A=(e.ownerSVGElement||{}).parentNode),(!A||A===Lf||!A.appendChild)&&(A=Lf.body),E=A._gsap,E&&y&&E.width&&u&&E.time===Ka.time&&!E.uncache)return ss(s/E.width*p);if(y&&(t==="height"||t==="width")){var M=e.style[t];e.style[t]=p+i,_=e[h],M?e.style[t]=M:zf(e,t)}else(y||a==="%")&&!Rq[Wa(A,"display")]&&(o.position=Wa(e,"position")),A===e&&(o.position="static"),A.appendChild(gd),_=gd[h],A.removeChild(gd),o.position="absolute";return u&&y&&(E=Ad(A),E.time=Ka.time,E.width=A[h]),ss(v?_*s/p:_&&s?p/_*s:0)},mc=function(e,t,n,i){var s;return VC||eM(),t in hu&&t!=="transform"&&(t=hu[t],~t.indexOf(",")&&(t=t.split(",")[0])),Mc[t]&&t!=="transform"?(s=$v(e,i),s=t!=="transformOrigin"?s[t]:s.svg?s.origin:AA(Wa(e,Ta))+" "+s.zOrigin+"px"):(s=e.style[t],(!s||s==="auto"||i||~(s+"").indexOf("calc("))&&(s=SA[t]&&SA[t](e,t,n)||Wa(e,t)||Y3(e,t)||(t==="opacity"?1:0))),n&&!~(s+"").trim().indexOf(" ")?Vf(e,t,s,n)+n:s},Dq=function(e,t,n,i){if(!n||n==="none"){var s=rg(t,e,1),a=s&&Wa(e,s,1);a&&a!==n?(t=s,n=a):t==="borderColor"&&(n=Wa(e,"borderTopColor"))}var o=new Ea(this._pt,e.style,t,0,1,xP),u=0,c=0,h,p,v,y,_,A,E,T,M,R,L,w;if(o.b=n,o.e=i,n+="",i+="",i.substring(0,6)==="var(--"&&(i=Wa(e,i.substring(4,i.indexOf(")")))),i==="auto"&&(A=e.style[t],e.style[t]=i,i=Wa(e,t)||i,A?e.style[t]=A:zf(e,t)),h=[n,i],cP(h),n=h[0],i=h[1],v=n.match(Mm)||[],w=i.match(Mm)||[],w.length){for(;p=Mm.exec(i);)E=p[0],M=i.substring(u,p.index),_?_=(_+1)%5:(M.substr(-5)==="rgba("||M.substr(-5)==="hsla(")&&(_=1),E!==(A=v[c++]||"")&&(y=parseFloat(A)||0,L=A.substr((y+"").length),E.charAt(1)==="="&&(E=Nm(y,E)+L),T=parseFloat(E),R=E.substr((T+"").length),u=Mm.lastIndex-R.length,R||(R=R||$a.units[t]||L,u===i.length&&(i+=R,o.e+=R)),L!==R&&(y=Vf(e,t,A,R)||0),o._pt={_next:o._pt,p:M||c===1?M:",",s:y,c:T-y,m:_&&_<4||t==="zIndex"?Math.round:0});o.c=u<i.length?i.substring(u,i.length):""}else o.r=t==="display"&&i==="none"?TP:EP;return G3.test(i)&&(o.e=0),this._pt=o,o},Lw={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Lq=function(e){var t=e.split(" "),n=t[0],i=t[1]||"50%";return(n==="top"||n==="bottom"||i==="left"||i==="right")&&(e=n,n=i,i=e),t[0]=Lw[n]||n,t[1]=Lw[i]||i,t.join(" ")},Iq=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,i=n.style,s=t.u,a=n._gsap,o,u,c;if(s==="all"||s===!0)i.cssText="",u=1;else for(s=s.split(","),c=s.length;--c>-1;)o=s[c],Mc[o]&&(u=1,o=o==="transformOrigin"?Ta:Hi),zf(n,o);u&&(zf(n,Hi),a&&(a.svg&&n.removeAttribute("transform"),i.scale=i.rotate=i.translate="none",$v(n,1),a.uncache=1,bP(i)))}},SA={clearProps:function(e,t,n,i,s){if(s.data!=="isFromStart"){var a=e._pt=new Ea(e._pt,t,n,0,0,Iq);return a.u=i,a.pr=-10,a.tween=s,e._props.push(n),1}}},Qv=[1,0,0,1,0,0],LP={},IP=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},Iw=function(e){var t=Wa(e,Hi);return IP(t)?Qv:t.substr(7).match(k3).map(ss)},XC=function(e,t){var n=e._gsap||Ad(e),i=e.style,s=Iw(e),a,o,u,c;return n.svg&&e.getAttribute("transform")?(u=e.transform.baseVal.consolidate().matrix,s=[u.a,u.b,u.c,u.d,u.e,u.f],s.join(",")==="1,0,0,1,0,0"?Qv:s):(s===Qv&&!e.offsetParent&&e!==Um&&!n.svg&&(u=i.display,i.display="block",a=e.parentNode,(!a||!e.offsetParent&&!e.getBoundingClientRect().width)&&(c=1,o=e.nextElementSibling,Um.appendChild(e)),s=Iw(e),u?i.display=u:zf(e,"display"),c&&(o?a.insertBefore(e,o):a?a.appendChild(e):Um.removeChild(e))),t&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},tM=function(e,t,n,i,s,a){var o=e._gsap,u=s||XC(e,!0),c=o.xOrigin||0,h=o.yOrigin||0,p=o.xOffset||0,v=o.yOffset||0,y=u[0],_=u[1],A=u[2],E=u[3],T=u[4],M=u[5],R=t.split(" "),L=parseFloat(R[0])||0,w=parseFloat(R[1])||0,N,O,F,B;n?u!==Qv&&(O=y*E-_*A)&&(F=L*(E/O)+w*(-A/O)+(A*M-E*T)/O,B=L*(-_/O)+w*(y/O)-(y*M-_*T)/O,L=F,w=B):(N=RP(e),L=N.x+(~R[0].indexOf("%")?L/100*N.width:L),w=N.y+(~(R[1]||R[0]).indexOf("%")?w/100*N.height:w)),i||i!==!1&&o.smooth?(T=L-c,M=w-h,o.xOffset=p+(T*y+M*A)-T,o.yOffset=v+(T*_+M*E)-M):o.xOffset=o.yOffset=0,o.xOrigin=L,o.yOrigin=w,o.smooth=!!i,o.origin=t,o.originIsAbsolute=!!n,e.style[Ta]="0px 0px",a&&(If(a,o,"xOrigin",c,L),If(a,o,"yOrigin",h,w),If(a,o,"xOffset",p,o.xOffset),If(a,o,"yOffset",v,o.yOffset)),e.setAttribute("data-svg-origin",L+" "+w)},$v=function(e,t){var n=e._gsap||new pP(e);if("x"in n&&!t&&!n.uncache)return n;var i=e.style,s=n.scaleX<0,a="px",o="deg",u=getComputedStyle(e),c=Wa(e,Ta)||"0",h,p,v,y,_,A,E,T,M,R,L,w,N,O,F,B,P,V,J,Q,ie,ne,k,K,j,se,oe,Y,Z,le,pe,Te;return h=p=v=A=E=T=M=R=L=0,y=_=1,n.svg=!!(e.getCTM&&DP(e)),u.translate&&((u.translate!=="none"||u.scale!=="none"||u.rotate!=="none")&&(i[Hi]=(u.translate!=="none"?"translate3d("+(u.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(u.rotate!=="none"?"rotate("+u.rotate+") ":"")+(u.scale!=="none"?"scale("+u.scale.split(" ").join(",")+") ":"")+(u[Hi]!=="none"?u[Hi]:"")),i.scale=i.rotate=i.translate="none"),O=XC(e,n.svg),n.svg&&(n.uncache?(j=e.getBBox(),c=n.xOrigin-j.x+"px "+(n.yOrigin-j.y)+"px",K=""):K=!t&&e.getAttribute("data-svg-origin"),tM(e,K||c,!!K||n.originIsAbsolute,n.smooth!==!1,O)),w=n.xOrigin||0,N=n.yOrigin||0,O!==Qv&&(V=O[0],J=O[1],Q=O[2],ie=O[3],h=ne=O[4],p=k=O[5],O.length===6?(y=Math.sqrt(V*V+J*J),_=Math.sqrt(ie*ie+Q*Q),A=V||J?Am(J,V)*od:0,M=Q||ie?Am(Q,ie)*od+A:0,M&&(_*=Math.abs(Math.cos(M*Fm))),n.svg&&(h-=w-(w*V+N*Q),p-=N-(w*J+N*ie))):(Te=O[6],le=O[7],oe=O[8],Y=O[9],Z=O[10],pe=O[11],h=O[12],p=O[13],v=O[14],F=Am(Te,Z),E=F*od,F&&(B=Math.cos(-F),P=Math.sin(-F),K=ne*B+oe*P,j=k*B+Y*P,se=Te*B+Z*P,oe=ne*-P+oe*B,Y=k*-P+Y*B,Z=Te*-P+Z*B,pe=le*-P+pe*B,ne=K,k=j,Te=se),F=Am(-Q,Z),T=F*od,F&&(B=Math.cos(-F),P=Math.sin(-F),K=V*B-oe*P,j=J*B-Y*P,se=Q*B-Z*P,pe=ie*P+pe*B,V=K,J=j,Q=se),F=Am(J,V),A=F*od,F&&(B=Math.cos(F),P=Math.sin(F),K=V*B+J*P,j=ne*B+k*P,J=J*B-V*P,k=k*B-ne*P,V=K,ne=j),E&&Math.abs(E)+Math.abs(A)>359.9&&(E=A=0,T=180-T),y=ss(Math.sqrt(V*V+J*J+Q*Q)),_=ss(Math.sqrt(k*k+Te*Te)),F=Am(ne,k),M=Math.abs(F)>2e-4?F*od:0,L=pe?1/(pe<0?-pe:pe):0),n.svg&&(K=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!IP(Wa(e,Hi)),K&&e.setAttribute("transform",K))),Math.abs(M)>90&&Math.abs(M)<270&&(s?(y*=-1,M+=A<=0?180:-180,A+=A<=0?180:-180):(_*=-1,M+=M<=0?180:-180)),t=t||n.uncache,n.x=h-((n.xPercent=h&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-h)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+a,n.y=p-((n.yPercent=p&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-p)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+a,n.z=v+a,n.scaleX=ss(y),n.scaleY=ss(_),n.rotation=ss(A)+o,n.rotationX=ss(E)+o,n.rotationY=ss(T)+o,n.skewX=M+o,n.skewY=R+o,n.transformPerspective=L+a,(n.zOrigin=parseFloat(c.split(" ")[2])||!t&&n.zOrigin||0)&&(i[Ta]=AA(c)),n.xOffset=n.yOffset=0,n.force3D=$a.force3D,n.renderTransform=n.svg?Bq:CP?wP:wq,n.uncache=0,n},AA=function(e){return(e=e.split(" "))[0]+" "+e[1]},Jb=function(e,t,n){var i=Sr(t);return ss(parseFloat(t)+parseFloat(Vf(e,"x",n+"px",i)))+i},wq=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,wP(e,t)},nd="0deg",iv="0px",id=") ",wP=function(e,t){var n=t||this,i=n.xPercent,s=n.yPercent,a=n.x,o=n.y,u=n.z,c=n.rotation,h=n.rotationY,p=n.rotationX,v=n.skewX,y=n.skewY,_=n.scaleX,A=n.scaleY,E=n.transformPerspective,T=n.force3D,M=n.target,R=n.zOrigin,L="",w=T==="auto"&&e&&e!==1||T===!0;if(R&&(p!==nd||h!==nd)){var N=parseFloat(h)*Fm,O=Math.sin(N),F=Math.cos(N),B;N=parseFloat(p)*Fm,B=Math.cos(N),a=Jb(M,a,O*B*-R),o=Jb(M,o,-Math.sin(N)*-R),u=Jb(M,u,F*B*-R+R)}E!==iv&&(L+="perspective("+E+id),(i||s)&&(L+="translate("+i+"%, "+s+"%) "),(w||a!==iv||o!==iv||u!==iv)&&(L+=u!==iv||w?"translate3d("+a+", "+o+", "+u+") ":"translate("+a+", "+o+id),c!==nd&&(L+="rotate("+c+id),h!==nd&&(L+="rotateY("+h+id),p!==nd&&(L+="rotateX("+p+id),(v!==nd||y!==nd)&&(L+="skew("+v+", "+y+id),(_!==1||A!==1)&&(L+="scale("+_+", "+A+id),M.style[Hi]=L||"translate(0, 0)"},Bq=function(e,t){var n=t||this,i=n.xPercent,s=n.yPercent,a=n.x,o=n.y,u=n.rotation,c=n.skewX,h=n.skewY,p=n.scaleX,v=n.scaleY,y=n.target,_=n.xOrigin,A=n.yOrigin,E=n.xOffset,T=n.yOffset,M=n.forceCSS,R=parseFloat(a),L=parseFloat(o),w,N,O,F,B;u=parseFloat(u),c=parseFloat(c),h=parseFloat(h),h&&(h=parseFloat(h),c+=h,u+=h),u||c?(u*=Fm,c*=Fm,w=Math.cos(u)*p,N=Math.sin(u)*p,O=Math.sin(u-c)*-v,F=Math.cos(u-c)*v,c&&(h*=Fm,B=Math.tan(c-h),B=Math.sqrt(1+B*B),O*=B,F*=B,h&&(B=Math.tan(h),B=Math.sqrt(1+B*B),w*=B,N*=B)),w=ss(w),N=ss(N),O=ss(O),F=ss(F)):(w=p,F=v,N=O=0),(R&&!~(a+"").indexOf("px")||L&&!~(o+"").indexOf("px"))&&(R=Vf(y,"x",a,"px"),L=Vf(y,"y",o,"px")),(_||A||E||T)&&(R=ss(R+_-(_*w+A*O)+E),L=ss(L+A-(_*N+A*F)+T)),(i||s)&&(B=y.getBBox(),R=ss(R+i/100*B.width),L=ss(L+s/100*B.height)),B="matrix("+w+","+N+","+O+","+F+","+R+","+L+")",y.setAttribute("transform",B),M&&(y.style[Hi]=B)},Oq=function(e,t,n,i,s){var a=360,o=Ks(s),u=parseFloat(s)*(o&&~s.indexOf("rad")?od:1),c=u-i,h=i+c+"deg",p,v;return o&&(p=s.split("_")[1],p==="short"&&(c%=a,c!==c%(a/2)&&(c+=c<0?a:-a)),p==="cw"&&c<0?c=(c+a*bw)%a-~~(c/a)*a:p==="ccw"&&c>0&&(c=(c-a*bw)%a-~~(c/a)*a)),e._pt=v=new Ea(e._pt,t,n,i,c,gq),v.e=h,v.u="deg",e._props.push(n),v},ww=function(e,t){for(var n in t)e[n]=t[n];return e},Pq=function(e,t,n){var i=ww({},n._gsap),s="perspective,force3D,transformOrigin,svgOrigin",a=n.style,o,u,c,h,p,v,y,_;i.svg?(c=n.getAttribute("transform"),n.setAttribute("transform",""),a[Hi]=t,o=$v(n,1),zf(n,Hi),n.setAttribute("transform",c)):(c=getComputedStyle(n)[Hi],a[Hi]=t,o=$v(n,1),a[Hi]=c);for(u in Mc)c=i[u],h=o[u],c!==h&&s.indexOf(u)<0&&(y=Sr(c),_=Sr(h),p=y!==_?Vf(n,u,c,_):parseFloat(c),v=parseFloat(h),e._pt=new Ea(e._pt,o,u,p,v-p,$1),e._pt.u=_||0,e._props.push(u));ww(o,i)};Aa("padding,margin,Width,Radius",function(r,e){var t="Top",n="Right",i="Bottom",s="Left",a=(e<3?[t,n,i,s]:[t+s,t+n,i+n,i+s]).map(function(o){return e<2?r+o:"border"+o+r});SA[e>1?"border"+r:r]=function(o,u,c,h,p){var v,y;if(arguments.length<4)return v=a.map(function(_){return mc(o,_,c)}),y=v.join(" "),y.split(v[0]).length===5?v[0]:y;v=(h+"").split(" "),y={},a.forEach(function(_,A){return y[_]=v[A]=v[A]||v[(A-1)/2|0]}),o.init(u,y,p)}});var BP={name:"css",register:eM,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,i,s){var a=this._props,o=e.style,u=n.vars.startAt,c,h,p,v,y,_,A,E,T,M,R,L,w,N,O,F,B;VC||eM(),this.styles=this.styles||MP(e),F=this.styles.props,this.tween=n;for(A in t)if(A!=="autoRound"&&(h=t[A],!(Va[A]&&mP(A,t,n,i,e,s)))){if(y=typeof h,_=SA[A],y==="function"&&(h=h.call(n,i,e,s),y=typeof h),y==="string"&&~h.indexOf("random(")&&(h=Wv(h)),_)_(this,e,A,h,n)&&(O=1);else if(A.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(A)+"").trim(),h+="",Of.lastIndex=0,Of.test(c)||(E=Sr(c),T=Sr(h),T?E!==T&&(c=Vf(e,A,c,T)+T):E&&(h+=E)),this.add(o,"setProperty",c,h,i,s,0,0,A),a.push(A),F.push(A,0,o[A]);else if(y!=="undefined"){if(u&&A in u?(c=typeof u[A]=="function"?u[A].call(n,i,e,s):u[A],Ks(c)&&~c.indexOf("random(")&&(c=Wv(c)),Sr(c+"")||c==="auto"||(c+=$a.units[A]||Sr(mc(e,A))||""),(c+"").charAt(1)==="="&&(c=mc(e,A))):c=mc(e,A),v=parseFloat(c),M=y==="string"&&h.charAt(1)==="="&&h.substr(0,2),M&&(h=h.substr(2)),p=parseFloat(h),A in hu&&(A==="autoAlpha"&&(v===1&&mc(e,"visibility")==="hidden"&&p&&(v=0),F.push("visibility",0,o.visibility),If(this,o,"visibility",v?"inherit":"hidden",p?"inherit":"hidden",!p)),A!=="scale"&&A!=="transform"&&(A=hu[A],~A.indexOf(",")&&(A=A.split(",")[0]))),R=A in Mc,R){if(this.styles.save(A),B=h,y==="string"&&h.substring(0,6)==="var(--"){if(h=Wa(e,h.substring(4,h.indexOf(")"))),h.substring(0,5)==="calc("){var P=e.style.perspective;e.style.perspective=h,h=Wa(e,"perspective"),P?e.style.perspective=P:zf(e,"perspective")}p=parseFloat(h)}if(L||(w=e._gsap,w.renderTransform&&!t.parseTransform||$v(e,t.parseTransform),N=t.smoothOrigin!==!1&&w.smooth,L=this._pt=new Ea(this._pt,o,Hi,0,1,w.renderTransform,w,0,-1),L.dep=1),A==="scale")this._pt=new Ea(this._pt,w,"scaleY",w.scaleY,(M?Nm(w.scaleY,M+p):p)-w.scaleY||0,$1),this._pt.u=0,a.push("scaleY",A),A+="X";else if(A==="transformOrigin"){F.push(Ta,0,o[Ta]),h=Lq(h),w.svg?tM(e,h,0,N,0,this):(T=parseFloat(h.split(" ")[2])||0,T!==w.zOrigin&&If(this,w,"zOrigin",w.zOrigin,T),If(this,o,A,AA(c),AA(h)));continue}else if(A==="svgOrigin"){tM(e,h,1,N,0,this);continue}else if(A in LP){Oq(this,w,A,v,M?Nm(v,M+h):h);continue}else if(A==="smoothOrigin"){If(this,w,"smooth",w.smooth,h);continue}else if(A==="force3D"){w[A]=h;continue}else if(A==="transform"){Pq(this,h,e);continue}}else A in o||(A=rg(A)||A);if(R||(p||p===0)&&(v||v===0)&&!mq.test(h)&&A in o)E=(c+"").substr((v+"").length),p||(p=0),T=Sr(h)||(A in $a.units?$a.units[A]:E),E!==T&&(v=Vf(e,A,c,T)),this._pt=new Ea(this._pt,R?w:o,A,v,(M?Nm(v,M+p):p)-v,!R&&(T==="px"||A==="zIndex")&&t.autoRound!==!1?_q:$1),this._pt.u=T||0,R&&B!==h?(this._pt.b=c,this._pt.e=B,this._pt.r=yq):E!==T&&T!=="%"&&(this._pt.b=c,this._pt.r=vq);else if(A in o)Dq.call(this,e,A,c,M?M+h:h);else if(A in e)this.add(e,A,c||e[A],M?M+h:h,i,s);else if(A!=="parseTransform"){BC(A,h);continue}R||(A in o?F.push(A,0,o[A]):typeof e[A]=="function"?F.push(A,2,e[A]()):F.push(A,1,c||e[A])),a.push(A)}}O&&SP(this)},render:function(e,t){if(t.tween._time||!KC())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:mc,aliases:hu,getSetter:function(e,t,n){var i=hu[t];return i&&i.indexOf(",")<0&&(t=i),t in Mc&&t!==Ta&&(e._gsap.x||mc(e,"x"))?n&&Tw===n?t==="scale"?Eq:Aq:(Tw=n||{})&&(t==="scale"?Tq:bq):e.style&&!LC(e.style[t])?xq:~t.indexOf("-")?Sq:HC(e,t)},core:{_removeProperty:zf,_getMatrix:XC}};ba.utils.checkPrefix=rg;ba.core.getStyleSaver=MP;(function(r,e,t,n){var i=Aa(r+","+e+","+t,function(s){Mc[s]=1});Aa(e,function(s){$a.units[s]="deg",LP[s]=1}),hu[i[13]]=r+","+e,Aa(n,function(s){var a=s.split(":");hu[a[1]]=i[a[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Aa("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(r){$a.units[r]="px"});ba.registerPlugin(BP);var Do=ba.registerPlugin(BP)||ba;Do.core.Tween;const qn=({texture:r,position:e=[0,0,0],scale:t=1,opacity:n=1,rotation:i=[0,0,0],transparent:s=!0})=>{const[a,o]=Ue.useState(1);return Ue.useEffect(()=>{r?.image&&o(r.image.width/r.image.height)},[r]),ye.jsxs("mesh",{position:e,rotation:i,renderOrder:10,children:[ye.jsx("planeGeometry",{args:[1*a*t,1*t]}),ye.jsx("meshBasicMaterial",{map:r,transparent:s,opacity:n,toneMapped:!1,depthWrite:!1,depthTest:!0})]})},sv=({texture:r,position:e,scale:t=1,speed:n=2,amplitude:i=.1})=>{const s=Ue.useRef(),a=e[1],[o,u]=Ue.useState(1);return Ue.useEffect(()=>{r?.image&&u(r.image.width/r.image.height)},[r]),hy(c=>{s.current&&(s.current.position.y=a+Math.sin(c.clock.elapsedTime*n)*i)}),ye.jsxs("mesh",{ref:s,position:e,renderOrder:10,children:[ye.jsx("planeGeometry",{args:[1*o*t,1*t]}),ye.jsx("meshBasicMaterial",{map:r,transparent:!0,toneMapped:!1,depthWrite:!1})]})},Nq=({page:r,textures:e,customScales:t=[],slideDistance:n=12})=>{const i=Ue.useRef([]),{size:s}=Ja();return Ue.useEffect(()=>{e.forEach((a,o)=>{const u=i.current[o];u&&(o===r?Do.fromTo(u.position,{y:-n,opacity:0},{y:0,opacity:1,duration:.8,ease:"power2.out"}):o<r?Do.to(u.position,{y:n,opacity:0,duration:.6}):Do.set(u.position,{y:-n,opacity:0}))})},[r,e,n]),ye.jsxs(YB,{renderPriority:1,children:[ye.jsx(KB,{makeDefault:!0,position:[0,0,10],zoom:100}),ye.jsx("group",{position:[0,0,0],children:e.map((a,o)=>{const u=t[o]||12;return ye.jsx("group",{ref:c=>i.current[o]=c,children:ye.jsx(qn,{texture:a,scale:u,position:[0,0,0]})},`grp-${o}`)})})]})};function Uq(){const{mode:r}=gg(),e=oE({idle_title:"/textures/inicio/cubo.png",intro_overlay:"/textures/inicio/introduction.png",food_overlay:"/textures/inicio/food.png",water_overlay:"/textures/inicio/water.png",resources_overlay:"/textures/inicio/resources.png"});if(r==="idle")return ye.jsx(qn,{texture:e.idle_title,position:[0,0,1.01],scale:1.8});let t=null;return r==="intro"?t=e.intro_overlay:r==="section-food"?t=e.food_overlay:r==="section-water"?t=e.water_overlay:r==="section-resources"&&(t=e.resources_overlay),t?ye.jsxs(YB,{renderPriority:1,children:[ye.jsx(KB,{makeDefault:!0,position:[0,0,10],zoom:60}),ye.jsx("group",{position:[0,0,0],children:ye.jsx(qn,{texture:t,scale:20,position:[0,0,0]})})]}):null}function Fq(){const{mode:r}=gg();let e=null;if(r==="intro"?e="/videos/intro.mp4":r==="section-food"?e="/videos/food.mp4":r==="section-water"?e="/videos/water.mp4":r==="section-resources"&&(e="/videos/resources.mp4"),!e)return null;const t=O3(e,{unsuspend:"canplay",crossOrigin:"Anonymous",muted:!1,loop:!0,start:!0,playsInline:!0});return Ue.useEffect(()=>{t&&(t.wrapS=mu,t.wrapT=mu,t.encoding=void 0)},[t]),ye.jsxs("group",{position:[0,0,0],children:[ye.jsxs("mesh",{position:[0,0,.05],children:[ye.jsx("planeGeometry",{args:[1.9,1.05]}),ye.jsx("meshBasicMaterial",{map:t,toneMapped:!1})]}),ye.jsxs("mesh",{position:[0,0,-.05],rotation:[0,Math.PI,0],children:[ye.jsx("planeGeometry",{args:[1.9,1.05]}),ye.jsx("meshBasicMaterial",{map:t,toneMapped:!1})]})]})}function kq(){const{mode:r}=gg();let e="#ffffff",t=.9,n=1,i=.1;r.includes("food")?e="#88ff8814":r.includes("water")?e="#8888ff1a":r.includes("resources")&&(e="#ff888817");const s={resolution:1024,mixBlur:3,mixStrength:5,blur:[300,100],minDepthThreshold:.5,maxDepthThreshold:.8,depthScale:4,depthToBlurRatioBias:1,color:e,metalness:i,roughness:t,mirror:n,far:1},a=[1.85,1.85],o=1.01;return ye.jsxs("group",{children:[ye.jsxs("mesh",{position:[0,-o,0],rotation:[-Math.PI/2,0,0],children:[ye.jsx("planeGeometry",{args:a}),ye.jsx(ad,{...s})]}),ye.jsxs("mesh",{position:[0,o,0],rotation:[Math.PI/2,0,0],children:[ye.jsx("planeGeometry",{args:a}),ye.jsx(ad,{...s})]}),ye.jsxs("mesh",{position:[-o,0,0],rotation:[0,Math.PI/2,0],children:[ye.jsx("planeGeometry",{args:a}),ye.jsx(ad,{...s})]}),ye.jsxs("mesh",{position:[o,0,0],rotation:[0,-Math.PI/2,0],children:[ye.jsx("planeGeometry",{args:a}),ye.jsx(ad,{...s})]}),ye.jsxs("mesh",{position:[0,0,-o],rotation:[0,0,0],children:[ye.jsx("planeGeometry",{args:a}),ye.jsx(ad,{...s})]}),ye.jsxs("mesh",{position:[0,0,o],rotation:[0,Math.PI,0],children:[ye.jsx("planeGeometry",{args:a}),ye.jsx(ad,{...s})]})]})}const Qb=()=>ye.jsx(ad,{resolution:512,mixBlur:1,mixStrength:20,mirror:1,color:"#ffffff",metalness:.9,roughness:.1,opacity:.1}),rv=({bgTop:r,bgBottom:e})=>ye.jsxs("group",{children:[ye.jsxs("mesh",{position:[0,0,-.99],children:[ye.jsx("planeGeometry",{args:[2,2]}),ye.jsx("meshBasicMaterial",{map:r,transparent:!0,toneMapped:!1})]}),ye.jsxs("mesh",{position:[0,-.95,0],rotation:[-Math.PI/2,0,0],children:[ye.jsx("planeGeometry",{args:[2,2]}),ye.jsx("meshBasicMaterial",{map:e,transparent:!0,toneMapped:!1})]}),ye.jsxs("mesh",{position:[0,.95,0],rotation:[Math.PI/2,0,0],children:[ye.jsx("planeGeometry",{args:[2,2]}),ye.jsx(Qb,{})]}),ye.jsxs("mesh",{position:[-.95,0,0],rotation:[0,Math.PI/2,0],children:[ye.jsx("planeGeometry",{args:[2,2]}),ye.jsx(Qb,{})]}),ye.jsxs("mesh",{position:[.95,0,0],rotation:[0,-Math.PI/2,0],children:[ye.jsx("planeGeometry",{args:[2,2]}),ye.jsx(Qb,{})]})]});function Gq(){const{currentPage:r,currentScenario:e}=gg(),t=a=>Math.abs(e-a)<=0,n=oE({intro_text:"/textures/food/text/intro.png",vision_text_1:"/textures/food/text/vision1.png",vision_text_2:"/textures/food/text/vision2.png",vision_fondo_top:"/textures/food/assets/vision_bg_top.png",vision_fondo_bottom:"/textures/food/assets/vision_bg_bottom.png",drone:"/textures/food/assets/drone.png",maiz:"/textures/food/assets/maiz.png",escenario1_text_1:"/textures/food/text/escenario1_1.png",escenario1_text_2:"/textures/food/text/escenario1_2.png",escenario1_text_3:"/textures/food/text/escenario1_3.png",escenario1_bg_top:"/textures/food/assets/escenario1_bg_top.png",escenario1_bg_bottom:"/textures/food/assets/escenario1_bg_bottom.png",tractor:"/textures/food/assets/tractor.png",casa_1:"/textures/food/assets/casa1.png",casa_2:"/textures/food/assets/casa2.png",casa_3:"/textures/food/assets/casa3.png",invernaderos:"/textures/food/assets/invernaderos.png",escenario2_text_1:"/textures/food/text/escenario2_1.png",escenario2_text_2:"/textures/food/text/escenario2_2.png",escenario2_text_3:"/textures/food/text/escenario2_3.png",escenario2_bg_top:"/textures/food/assets/escenario2_bg_top.png",escenario2_bg_bottom:"/textures/food/assets/escenario2_bg_bottom.png",nube:"/textures/food/assets/nube.png",tienda:"/textures/food/assets/tienda.png",oficinas:"/textures/food/assets/oficinas.png",industria:"/textures/food/assets/industria.png",casa_3:"/textures/food/assets/casa3.png",escenario3_text_1:"/textures/food/text/escenario3_1.png",escenario3_text_2:"/textures/food/text/escenario3_2.png",escenario3_text_3:"/textures/food/text/escenario3_3.png",escenario3_text_4:"/textures/food/text/escenario3_2.png",escenario3_bg_top:"/textures/food/assets/escenario3_bg_top.png",escenario3_bg_bottom:"/textures/food/assets/escenario3_bg_bottom.png",vaca:"/textures/food/assets/vaca.png",camion:"/textures/food/assets/camion.png",edificio:"/textures/food/assets/edificio.png",drone:"/textures/food/assets/drone.png",escenario4_text_1:"/textures/food/text/escenario4_1.png",escenario4_text_2:"/textures/food/text/escenario4_2.png",escenario4_text_3:"/textures/food/text/escenario4_3.png",escenario4_bg_top:"/textures/food/assets/escenario4_bg_top.png",escenario4_bg_bottom:"/textures/food/assets/escenario4_bg_bottom.png",mesa:"/textures/food/assets/mesa.png",silla1:"/textures/food/assets/silla1.png",silla2:"/textures/food/assets/silla2.png",conclusion_text:"/textures/food/text/conclusion.png"}),i=O3("/videos/food/intro.mp4",{autoplay:!0,loop:!0,muted:!0}),s={0:[n.intro_text],1:[n.vision_text_1,n.vision_text_2],2:[n.escenario1_text_1,n.escenario1_text_2,n.escenario1_text_3],3:[n.escenario2_text_1,n.escenario2_text_2,n.escenario2_text_3],4:[n.escenario3_text_1,n.escenario3_text_2,n.escenario3_text_3,n.escenario3_text_4],5:[n.escenario4_text_1,n.escenario4_text_2,n.escenario4_text_3],6:[n.conclusion_text],7:[]};return ye.jsxs("group",{children:[ye.jsx(Nq,{page:r,textures:s[e]||[]}),ye.jsx("group",{visible:t(0),rotation:[0,0,0],children:ye.jsxs("mesh",{position:[0,0,.05],children:[ye.jsx("planeGeometry",{args:[1.9,1.05]}),ye.jsx("meshBasicMaterial",{map:i,toneMapped:!1})]})}),ye.jsxs("group",{visible:t(1),rotation:[-Math.PI/2,0,0],children:[ye.jsx(rv,{bgTop:n.vision_fondo_top,bgBottom:n.vision_fondo_bottom}),ye.jsx(qn,{texture:n.maiz,position:[.15,-1,-.4],scale:.6,rotation:[-.3,-Math.PI/4.5,0]}),ye.jsx(qn,{texture:n.maiz,position:[.3,-1,-.4],scale:.6,rotation:[-.3,-Math.PI/4.5,0]}),ye.jsx(qn,{texture:n.maiz,position:[.45,-1,-.4],scale:.6,rotation:[-.3,-Math.PI/4.5,0]}),ye.jsx(qn,{texture:n.maiz,position:[.6,-1,-.4],scale:.6,rotation:[-.3,-Math.PI/4.5,0]}),ye.jsx(qn,{texture:n.maiz,position:[.75,-1,-.4],scale:.6,rotation:[-.3,-Math.PI/4.5,0]}),ye.jsx(qn,{texture:n.maiz,position:[.9,-1,-.4],scale:.6,rotation:[-.3,-Math.PI/4.5,0]}),ye.jsx(qn,{texture:n.maiz,position:[.105,-1,-.4],scale:.6,rotation:[-.3,-Math.PI/4.5,0]}),ye.jsx(qn,{texture:n.maiz,position:[.12,-1,-.4],scale:.6,rotation:[-.3,-Math.PI/4.5,0]}),ye.jsx(sv,{texture:n.drone,position:[.5,-.4,0],scale:.2,speed:3}),ye.jsx(sv,{texture:n.drone,position:[-.6,.2,.1],scale:.5,speed:3}),ye.jsx(sv,{texture:n.drone,position:[.7,.4,-.5],scale:.3,speed:3}),ye.jsx(sv,{texture:n.drone,position:[-.9,-.6,-.4],scale:.1,speed:3})]}),ye.jsxs("group",{visible:t(2),rotation:[Math.PI,0,0],children:[ye.jsx(rv,{bgTop:n.escenario1_bg_top,bgBottom:n.escenario1_bg_bottom}),ye.jsx(qn,{texture:n.casa_1,position:[.1,-.9,-.98],scale:.15}),ye.jsx(qn,{texture:n.casa_2,position:[-.4,-.9,-.98],scale:.15}),ye.jsx(qn,{texture:n.casa_3,position:[-.7,-.85,-.98],scale:.25}),ye.jsx(qn,{texture:n.invernaderos,position:[.65,-.9,-.98],scale:.15}),ye.jsx(qn,{texture:n.tractor,position:[-.2,-.78,-.4],scale:.5,speed:1,amplitude:.05})]}),ye.jsxs("group",{visible:t(3),rotation:[Math.PI/2,0,0],children:[ye.jsx(rv,{bgTop:n.escenario2_bg_top,bgBottom:n.escenario2_bg_bottom}),ye.jsx(qn,{texture:n.nube,position:[0,0,0],scale:.5}),ye.jsx(qn,{texture:n.tienda,position:[.4,-.85,-.1],scale:.15}),ye.jsx(qn,{texture:n.industria,position:[.3,-.8,.6],scale:.2}),ye.jsx(qn,{texture:n.oficinas,position:[-.3,-.8,-.1],scale:.2}),ye.jsx(qn,{texture:n.casa_3,position:[-.4,-.8,.6],scale:.25})]}),ye.jsxs("group",{visible:t(4),rotation:[0,0,0],children:[ye.jsx(rv,{bgTop:n.escenario3_bg_top,bgBottom:n.escenario3_bg_bottom}),ye.jsx(qn,{texture:n.vaca,position:[-.2,-.9,0],scale:.06}),ye.jsx(qn,{texture:n.camion,position:[.3,-.9,0],scale:.08}),ye.jsx(qn,{texture:n.edificio,position:[.05,-.9,.2],scale:.08}),ye.jsx(qn,{texture:n.edificio,position:[.05,-.9,-.3],scale:.08}),ye.jsx(sv,{texture:n.drone,position:[.5,-.9,.3],scale:.1})]}),ye.jsxs("group",{visible:t(5),rotation:[-Math.PI/2,0,0],children:[ye.jsx(rv,{bgTop:n.escenario4_bg_top,bgBottom:n.escenario4_bg_bottom}),ye.jsx(qn,{texture:n.mesa,position:[0,-.6,.8],scale:1,rotation:[-Math.PI/3,0,0]}),ye.jsx(qn,{texture:n.silla1,position:[-.5,-.7,0],scale:.6}),ye.jsx(qn,{texture:n.silla1,position:[-.55,-.7,.3],scale:.6}),ye.jsx(qn,{texture:n.silla1,position:[-.6,-.7,.6],scale:.6}),ye.jsx(qn,{texture:n.silla2,position:[.5,-.7,0],scale:.6}),ye.jsx(qn,{texture:n.silla2,position:[.55,-.7,.3],scale:.6}),ye.jsx(qn,{texture:n.silla2,position:[.6,-.7,.6],scale:.6})]}),ye.jsx("group",{visible:t(6),rotation:[Math.PI,0,0],children:ye.jsxs("mesh",{position:[0,0,.05],children:[ye.jsx("planeGeometry",{args:[2,1.15]}),ye.jsx("meshBasicMaterial",{map:i,toneMapped:!1})]})}),ye.jsx("group",{visible:t(7),rotation:[Math.PI/2,0,0]})]})}function Hq(r,e,t,n,i){const s=Ue.useRef(null),a=Ue.useRef(!1),o=()=>{r.current&&(r.current.rotation.x=r.current.rotation.x%(Math.PI*2),r.current.rotation.y=r.current.rotation.y%(Math.PI*2),r.current.rotation.z=r.current.rotation.z%(Math.PI*2))};return{playIntroAnimation:_=>{r.current&&(s.current&&s.current.kill(),s.current=Do.timeline({onComplete:()=>{const A=_();t(`section-${A}`),console.log("Intro terminada. Entrando a:",A)}}),s.current.add("start").to(r.current.position,{z:4.9,duration:1.5,ease:"power2.inOut"},"start").to(r.current.rotation,{x:0,y:-Math.PI,z:0,duration:1.5,ease:"power2.inOut"},"start").to(e.current.scale,{x:0,y:0,z:0,duration:1,ease:"power2.in"},"start").to({},{duration:5}).call(()=>{console.log("Cambiando a Cubo Normal"),i(!1)}).to({},{duration:5}))},playGrandEntrance:_=>{if(!r.current)return;s.current&&s.current.kill(),o(),s.current=Do.timeline({onStart:()=>console.log("4 Vueltas"),onComplete:_});const A=3,E=1,T=(Math.random()-.3)*.5,M=(Math.random()-.3)*.5;s.current.add("start").to(r.current.position,{z:1.8,duration:A,ease:"power2.inOut"},"start").to(r.current.position,{z:4.9,duration:E,ease:"power2.inOut"},`start+=${A}`).to(r.current.rotation,{y:"-="+Math.PI*8,duration:A+E,ease:"power2.inOut"},"start").to(r.current.rotation,{keyframes:[{x:T,duration:(A+E)*.33},{x:M,duration:(A+E)*.33},{x:0,duration:(A+E)*.34}],ease:"power1.inOut"},"start")},playSectionTransition:_=>{if(!r.current)return;o(),a.current=!0,s.current&&s.current.kill(),s.current=Do.timeline({onComplete:()=>{a.current=!1,_&&t(`section-${_}`)}});const A=.9,E=.9,T=1.8,M=(Math.random()-.5)*.3;s.current.add("start").to(r.current.position,{z:2.5,duration:A,ease:"power2.inOut"},"start").to(r.current.position,{z:4.9,duration:E,ease:"power2.inOut"},`start+=${A}`).to(r.current.rotation,{y:"-="+Math.PI,duration:T,ease:"power2.inOut"},"start").to(r.current.rotation,{keyframes:[{x:M,duration:T*.5},{x:0,duration:T*.5}],ease:"power1.inOut"},"start")},playVerticalFlip:_=>{r.current&&(a.current=!0,s.current&&s.current.kill(),o(),s.current=Do.timeline({onComplete:()=>{a.current=!1,_&&_()}}),s.current.to(r.current.position,{z:2,duration:.5,ease:"power2.out"}).to(r.current.rotation,{x:0,y:0,z:0,duration:1.2,ease:"power2.inOut"},"<").to(r.current.position,{z:4.9,duration:.8,ease:"power2.inOut"},"-=0.5"))},animateScenarioChange:_=>{if(!r.current)return;a.current=!0;const A=_*(Math.PI/2);Do.to(r.current.rotation,{x:A,y:0,z:0,duration:1.5,ease:"power2.inOut",onComplete:()=>{a.current=!1,console.log(`Llegada a Escenario ${_}`)}}),Do.to(r.current.position,{z:4.9,duration:1.5,ease:"power2.inOut"})},animateScrollZoom:(_,A)=>{if(!r.current||a.current)return;const E={0:[{z:4.9,rotY:0}],1:[{z:4,x:0,y:0,rotY:0},{z:4.2,x:0,y:.2,rotY:0}],2:[{z:4,rotY:0},{z:3.5,rotY:.1},{z:3,rotY:-.1},{z:2.5,rotY:0}],3:[{z:4,rotY:0},{z:3.2,rotY:.1},{z:3,rotY:-.1}],4:[{z:4,rotY:0},{z:3.5,rotY:.1},{z:3,rotY:-.1}],5:[{z:4,rotY:0},{z:3.5,rotY:.05},{z:3,rotY:-.05},{z:2.5,rotY:0}],6:[{z:.1,rotY:0}],7:[{z:5,rotY:0}]},T={z:4,x:0,y:0,rotY:0},M=E[A]?.[_]||T,R=M.z!==void 0?M.z:4,L=M.x!==void 0?M.x:0,w=M.y!==void 0?M.y:0,N=M.rotY!==void 0?M.rotY:0,O=A*(Math.PI/2);Do.to(r.current.position,{x:L,y:w,z:R,duration:1.2,ease:"power2.inOut"}),Do.to(r.current.rotation,{x:O,y:N,z:0,duration:1.2,ease:"power2.inOut"})},mainTimeline:s,isTransitioning:a}}function zq(r,e,t,n,i,s){const a=Ue.useRef(!1),o={0:0,1:1,2:2,3:2,4:3,5:2,6:0,7:0};Ue.useEffect(()=>{if(!r.startsWith("explore-"))return;const u=c=>{if(a.current||s.current)return;a.current=!0;const h=c.deltaY>0?1:-1,p=o[n]||0;if(h>0)e<p?t(v=>v+1):n<7&&(i(v=>v+1),t(0));else if(e>0)t(v=>v-1);else if(n>0){i(y=>y-1);const v=o[n-1]||0;t(v)}setTimeout(()=>{a.current=!1},1200)};return window.addEventListener("wheel",u),()=>window.removeEventListener("wheel",u)},[r,e,n,s])}function Vq(){const{scene:r}=wm("/models/cube.glb"),{scene:e}=wm("/models/cube_frame.glb"),{scene:t}=wm("/models/sphere.glb"),{mode:n,setMode:i,currentPage:s,setCurrentPage:a,currentScenario:o,setCurrentScenario:u,registerChangeSection:c}=gg(),h=Ue.useRef(),p=Ue.useRef(),v=Ue.useRef(!0),y=Ue.useRef(n),[_,A]=Ue.useState(!1),E=Ue.useRef(new Ve(0,0)),T=["food","water","resources"],M=3,[R,L]=Ue.useState(!0),{playIntroAnimation:w,playGrandEntrance:N,playSectionTransition:O,playVerticalFlip:F,animateScenarioChange:B,animateScrollZoom:P,isTransitioning:V}=Hq(h,p,i,u,L);zq(n,s,a,o,u,V);function J(){return T[Math.floor(Math.random()*T.length)]}function Q(ie){const ne=T.indexOf(ie);return T[(ne+1)%T.length]}return Ue.useEffect(()=>{c(ie=>O(ie))},[]),Ue.useEffect(()=>{n.startsWith("explore-")&&B(o)},[o]),Ue.useEffect(()=>{n.startsWith("explore-")&&P(s,o)},[s]),Ue.useEffect(()=>{if(n==="intro")w(J);else if(n.startsWith("section-")){y.current.startsWith("explore-")?(u(0),F()):v.current&&(L(!1),N(()=>{v.current=!1}));const ie=n.replace("section-",""),ne=setTimeout(()=>{const k=Q(ie);O(k)},15e3);return y.current=n,()=>clearTimeout(ne)}else n.startsWith("explore-")&&(y.current.startsWith("section-")&&F(),y.current=n)},[n]),Ue.useEffect(()=>{r&&r.traverse(ie=>{ie.isMesh&&(ie.material.depthWrite=!1,ie.material.side=Lo)})},[r]),hy((ie,ne)=>{if(!h.current||n!=="idle")return;const k=ie.clock.elapsedTime;E.current.x=_?-ie.mouse.y*1.5:Math.sin(k*.5)*.05,E.current.y=_?ie.mouse.x*1.5:Math.sin(k*.3)*.05,h.current.rotation.x=qS.lerp(h.current.rotation.x,E.current.x,.1),h.current.rotation.y=qS.lerp(h.current.rotation.y,E.current.y,.1),h.current.position.y=Math.sin(k)*.1,p.current&&(p.current.rotation.x=Math.sin(k)*.25,_&&(p.current.rotation.y+=ne*M))}),ye.jsxs("group",{ref:h,onPointerOver:()=>{n==="idle"&&A(!0)},onPointerOut:()=>A(!1),onClick:()=>{n==="idle"&&i("intro")},children:[R?ye.jsx("primitive",{object:e}):ye.jsx("primitive",{object:r}),R&&ye.jsx(kq,{}),ye.jsx(Fq,{}),ye.jsx(Uq,{}),n==="explore-food"&&ye.jsx(Gq,{}),ye.jsx("primitive",{ref:p,object:t,scale:.5,position:[0,0,0]})]})}const Kq="/assets/Logo-CQSpTGHR.svg",Bw="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3c!--%20Created%20with%20Inkscape%20(http://www.inkscape.org/)%20--%3e%3csvg%20width='75mm'%20height='75mm'%20viewBox='0%200%2075%2075'%20version='1.1'%20id='svg1'%20xml:space='preserve'%20sodipodi:docname='menu.svg'%20inkscape:version='1.4.2%20(f4327f4,%202025-05-13)'%20xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape'%20xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3csodipodi:namedview%20id='namedview1'%20pagecolor='%23505050'%20bordercolor='%23ffffff'%20borderopacity='1'%20inkscape:showpageshadow='0'%20inkscape:pageopacity='0'%20inkscape:pagecheckerboard='1'%20inkscape:deskcolor='%23505050'%20inkscape:document-units='mm'%20inkscape:zoom='1.0292292'%20inkscape:cx='-77.242273'%20inkscape:cy='-11.173411'%20inkscape:window-width='2560'%20inkscape:window-height='1369'%20inkscape:window-x='-8'%20inkscape:window-y='-8'%20inkscape:window-maximized='1'%20inkscape:current-layer='svg1'%20/%3e%3cdefs%20id='defs1'%20/%3e%3crect%20style='fill:%23ffffff;fill-opacity:0;stroke-width:0.336683'%20id='rect25'%20width='202.36786'%20height='202.71707'%20x='-0.71983314'%20y='-0.98441356'%20/%3e%3crect%20style='fill:%23ffffff;stroke-width:0.31552'%20id='rect1'%20width='6.2339339'%20height='75.400383'%20x='34.400883'%20y='-75.196426'%20ry='0.24371842'%20transform='matrix(7.2400731e-4,0.99999974,-0.99999994,3.5800129e-4,0,0)'%20/%3e%3crect%20style='fill:%23ffffff;stroke-width:0.314712'%20id='rect1-8'%20width='6.2339339'%20height='75.014801'%20x='68.76619'%20y='-75.043282'%20ry='0.2424721'%20transform='matrix(7.2030488e-4,0.99999974,-0.99999994,3.5984145e-4,0,0)'%20/%3e%3crect%20style='fill:%23ffffff;stroke-width:0.314982'%20id='rect1-5'%20width='6.2339339'%20height='75.143326'%20x='0.02688805'%20y='-75.092789'%20ry='0.24288751'%20transform='matrix(7.2153901e-4,0.99999974,-0.99999994,3.5922597e-4,0,0)'%20/%3e%3c/svg%3e",Yq="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3c!--%20Created%20with%20Inkscape%20(http://www.inkscape.org/)%20--%3e%3csvg%20width='75mm'%20height='75mm'%20viewBox='0%200%2075%2075'%20version='1.1'%20id='svg1'%20xml:space='preserve'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3cdefs%20id='defs1'%20/%3e%3crect%20style='fill:%23ffffff;fill-opacity:0;stroke-width:0.336683'%20id='rect25'%20width='202.36786'%20height='202.71707'%20x='-0.71983314'%20y='-0.98441356'%20/%3e%3crect%20style='fill:%23ffffff;stroke-width:0.264583'%20id='rect1'%20width='6.233933'%20height='53.020565'%20x='-33.68615'%20y='-64.030266'%20ry='0.17137961'%20transform='rotate(179.97083)'%20/%3e%3cg%20style='fill:%23ffffff'%20id='g2'%20transform='matrix(-1.3577622,6.9143465e-4,-6.9143465e-4,-1.3577622,61.35588,46.447342)'%3e%3cpath%20d='m%208.704893,12.90325%20c%200.39051,0.3905%201.02371,0.3905%201.414209,0%20l%204.8874,-4.8923%20c%200.7804,-0.7811%200.7801,-2.0469%20-6e-4,-2.8277%20l%20-4.8904,-4.89036%20c%20-0.390499,-0.39052%20-1.023699,-0.39052%20-1.414219,0%20-0.39053,0.39053%20-0.39053,1.02369%200,1.41422%20l%204.185619,4.18564%20c%200.3906,0.3905%200.3906,1.0237%200,1.4142%20l%20-4.182009,4.1821%20c%20-0.39053,0.3905%20-0.39053,1.0236%200,1.4142%20z'%20fill='%230f0f0f'%20id='path1'%20style='opacity:1;fill:%23ffffff'%20/%3e%3c/g%3e%3c/svg%3e",Xq="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3c!--%20Created%20with%20Inkscape%20(http://www.inkscape.org/)%20--%3e%3csvg%20width='75mm'%20height='75mm'%20viewBox='0%200%2075%2075'%20version='1.1'%20id='svg1'%20xml:space='preserve'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3cdefs%20id='defs1'%20/%3e%3crect%20style='fill:%23ffffff;fill-opacity:0;stroke-width:0.336683'%20id='rect25'%20width='202.36786'%20height='202.71707'%20x='-0.71983314'%20y='-0.98441356'%20/%3e%3crect%20style='fill:%23ffffff;stroke-width:0.264583'%20id='rect1'%20width='6.233933'%20height='53.020565'%20x='43.700558'%20y='10.989717'%20ry='0.17137961'%20/%3e%3cg%20style='fill:%23ffffff'%20id='g2'%20transform='matrix(1.3577624,0,0,1.3577624,16.054486,28.541399)'%3e%3cpath%20d='m%208.704893,12.90325%20c%200.39051,0.3905%201.02371,0.3905%201.414209,0%20l%204.8874,-4.8923%20c%200.7804,-0.7811%200.7801,-2.0469%20-6e-4,-2.8277%20l%20-4.8904,-4.89036%20c%20-0.390499,-0.39052%20-1.023699,-0.39052%20-1.414219,0%20-0.39053,0.39053%20-0.39053,1.02369%200,1.41422%20l%204.185619,4.18564%20c%200.3906,0.3905%200.3906,1.0237%200,1.4142%20l%20-4.182009,4.1821%20c%20-0.39053,0.3905%20-0.39053,1.0236%200,1.4142%20z'%20fill='%230f0f0f'%20id='path1'%20style='opacity:1;fill:%23ffffff'%20/%3e%3c/g%3e%3c/svg%3e",qq="/assets/Kubotasvision-BdNRr6TU.svg";function Wq(){const{mode:r,setMode:e,getNextSection:t,getPrevSection:n,changeSection:i,setCurrentPage:s}=gg(),[a,o]=Ue.useState(!1),u=r.startsWith("section-"),c=r.startsWith("explore-");if(!u&&!c)return null;const h=r.replace("section-","").replace("explore-","");return ye.jsxs(ye.Fragment,{children:[a&&ye.jsxs("div",{className:"menu-overlay",children:[ye.jsx("p",{children:"MEN"}),ye.jsx("button",{className:"white",onClick:()=>o(!1),children:"Cerrar"})]}),!c&&ye.jsx("div",{className:"top",children:ye.jsx("button",{onClick:()=>window.location.reload(),children:ye.jsx("img",{src:Kq,alt:"KUBOTA FUTURE CUBE"})})}),!c&&ye.jsx("div",{className:"menu hover",children:ye.jsx("button",{onClick:()=>o(!0),children:ye.jsx("img",{src:Bw,alt:"MENU"})})}),!c&&ye.jsx("div",{className:"left hover",children:ye.jsx("button",{onClick:()=>{const p=n(h);i(p)},children:ye.jsx("img",{src:Yq,alt:"Anterior"})})}),!c&&ye.jsx("div",{className:"right hover",children:ye.jsx("button",{onClick:()=>{const p=t(h);i(p)},children:ye.jsx("img",{src:Xq,alt:"Siguiente"})})}),!c&&ye.jsx("div",{className:"pie",children:ye.jsx("button",{children:ye.jsx("img",{src:qq,alt:"Kubotasvision"})})}),!c&&ye.jsx("div",{className:"explore hover",children:ye.jsx("button",{onClick:()=>{s(0),e(`explore-${h}`),console.log("Explorando seccin:",h)},children:"Explorar ms"})}),c&&ye.jsx("div",{className:"top-right",children:ye.jsx("button",{onClick:()=>{s(0),e(`section-${h}`),console.log("Volviendo a seccin:",h)},children:ye.jsx("img",{src:Bw,alt:"MENU"})})})]})}function jq(){return ye.jsxs("div",{children:[ye.jsxs(L6,{camera:{position:[0,0,6],fov:45},gl:{antialias:!0,toneMappingExposure:1.5},children:[ye.jsx("ambientLight",{intensity:2.8}),ye.jsx("directionalLight",{position:[5,-5,5],intensity:1}),ye.jsx(Ue.Suspense,{fallback:null,children:ye.jsx(Vq,{})})]}),ye.jsx(Wq,{})]})}ON.createRoot(document.getElementById("root")).render(ye.jsx(Ow.StrictMode,{children:ye.jsx(vX,{children:ye.jsx(jq,{})})}));
